!function(sources){var scripts=document.querySelectorAll("script"),head=document.querySelector("head"),script=scripts[scripts.length-1];script.id=script.id||"ts-js","blob:"===location.protocol&&Object.keys(sources).forEach(function(key){sources[key]="http:"+sources[key]}),function(existing){if(!existing){var oldsheet=document.querySelector("link[rel=stylesheet]"),newsheet=document.createElement("link");newsheet.id="ts-css",newsheet.rel="stylesheet",newsheet.href=sources.runtimecss,head.insertBefore(newsheet,oldsheet||head.lastElementChild)}}(document.querySelector("#ts-css")),"loading"===document.readyState||document.all?function(srcs){function onload(){0==--left&&ts.ui.$maybebootstrap(!0)}function onerror(error){var src=error.target.src;throw new URIError("The script "+src+" is not accessible :/")}var next=null,prev=script,left=srcs.length,root=script.parentNode;srcs.length?srcs.forEach(function(src){(next=document.createElement("script")).src=src,next.defer=!0,next.onload=onload,next.onerror=onerror,root.insertBefore(next,prev.nextSibling),prev=next}):setTimeout(function(){ts.ui.$maybebootstrap(!0)})}(function(){var srcs=[],lang=document.documentElement.getAttribute("lang");return lang?(lang=lang.toLowerCase().replace("_","-"),srcs.push(sources.langbundle.replace("<LANG>",lang))):document.all||console.log("No lang given. Will default to en-US"),srcs}()):console.error("ts.js should really not be loaded async at this point...")}({langbundle:"http://d5wfroyti11sa.cloudfront.net/prod/client/ts-lang-<LANG>-9.1.2.js",runtimecss:"css/ts-9.1.2.min.css"}),function(window){"use strict";!function(){function extend(what,whit){Object.keys(whit).forEach(function(key){var def=whit[key];void 0===what[key]&&(def.get&&def.set||(what[key]=def))})}function strings(){extend(String.prototype,{trim:function(){return this.trimLeft().trimRight()},trimRight:function(){return this.replace(/\s+$/,"")},trimLeft:function(){return this.replace(/^\s*/,"")},repeat:function(n){return new Array(n+1).join(this)},startsWith:function(sub){return 0===this.indexOf(sub)},endsWith:function(sub){sub=String(sub);var i=this.lastIndexOf(sub);return i>=0&&i===this.length-sub.length},contains:function(){return console.warn("String.prototype.contains is deprecated. You can use String.prototype.includes"),this.includes.apply(this,arguments)},includes:function(){return-1!==String.prototype.indexOf.apply(this,arguments)},toArray:function(){return this.split("")}})}function arrays(){extend(Array.prototype,{find:function(predicate){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof predicate)throw new TypeError("predicate must be a function");for(var value,list=Object(this),length=list.length>>>0,thisArg=arguments[1],i=0;i<length;i++)if(value=list[i],predicate.call(thisArg,value,i,list))return value}}),extend(Array,{every:function(array,fun,thisp){for(var res=!0,len=array.length>>>0,i=0;i<len;i++)if(void 0!==array[i]&&!fun.call(thisp,array[i],i,array)){res=!1;break}return res},forEach:function(array,fun,thisp){for(var len=array.length>>>0,i=0;i<len;i++)void 0!==array[i]&&fun.call(thisp,array[i],i,array)},map:function(array,fun,thisp){for(var m=[],len=array.length>>>0,i=0;i<len;i++)void 0!==array[i]&&m.push(fun.call(thisp,array[i],i,array));return m},filter:function(array,fun,thisp){return Array.prototype.filter.call(array,fun,thisp)},isArray:function(o){return"[object Array]"===Object.prototype.toString.call(o)},concat:function(a1,a2){function map(e){return e}return this.map(a1,map).concat(this.map(a2,map))}})}function functions(){extend(Function.prototype,{bind:function(oThis){if("function"!=typeof this)throw new TypeError("Function bind not callable");var fSlice=Array.prototype.slice,aArgs=fSlice.call(arguments,1),fToBind=this,Fnop=function(){},fBound=function(){return fToBind.apply(this instanceof Fnop?this:oThis||window,aArgs.concat(fSlice.call(arguments)))};return Fnop.prototype=this.prototype,fBound.prototype=new Fnop,fBound}})}function globals(){extend(window,{console:{log:function(){},debug:function(){},warn:function(){},error:function(){}}})}function effects(){extend(window,{requestAnimationFrame:window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(){var lastTime=0;return function(callback,element){var currTime=(new Date).getTime(),timeToCall=Math.max(0,16-(currTime-lastTime)),id=window.setTimeout(function(){callback(currTime+timeToCall)},timeToCall);return lastTime=currTime+timeToCall,id}}(),cancelAnimationFrame:window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||clearTimeout,setImmediate:function(){var list=[],handle=1,name="spiritual:emulated:setimmediate";return window.addEventListener("message",function(e){e.data===name&&list.length&&(list.shift().apply(window),e.stopPropagation())},!1),function(func){return list.push(func),window.postMessage(name,"*"),handle++}}()})}function extras(){extend(console,{debug:console.log}),extend(XMLHttpRequest.prototype,{overrideMimeType:function(){}}),extend(XMLHttpRequest,{UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4})}!function(isWorker){strings(),arrays(),functions(),globals(),extras(),isWorker||effects()}(!1)}(),window.gui=function(Namespace,Timer){return new Namespace("gui",{Namespace:Namespace,version:"-1.0.0",debug:!1,PARAM_CONTEXTID:"gui-contextid",PARAM_XHOST:"gui-xhost",BROADCAST_TODOM:"gui-broadcast-todom",BROADCAST_ONDOM:"gui-broadcast-ondom",BROADCAST_TOLOAD:"gui-broadcast-toload",BROADCAST_ONLOAD:"gui-broadcast-onload",BROADCAST_TOUNLOAD:"gui-broadcast-tounload",BROADCAST_ONUNLOAD:"gui-broadcast-unload",BROADCAST_WILL_UNLOAD:"gui-broadcast-will-unload",BROADCAST_MOUSECLICK:"gui-broadcast-mouseevent-click",BROADCAST_MOUSEMOVE:"gui-broadcast-mouseevent-mousemove",BROADCAST_MOUSEDOWN:"gui-broadcast-mouseevent-mousedown",BROADCAST_MOUSEUP:"gui-broadcast-mouseevent-mouseup",BROADCAST_SCROLL:"gui-broadcast-window-scroll",BROADCAST_RESIZE:"gui-broadcast-window-resize",BROADCAST_RESIZE_END:"gui-broadcast-window-resize-end",BROADCAST_POPSTATE:"gui-broadcast-window-popstate",BROADCAST_HASHCHANGE:"gui-broadcast-window-hashchange",BROADCAST_ORIENTATIONCHANGE:"gui-broadcast-orientationchange",BROADCAST_TWEEN:"gui-broadcast-tween",ACTION_DOC_ONDOMCONTENT:"gui-action-document-domcontent",ACTION_DOC_ONLOAD:"gui-action-document-onload",ACTION_DOC_ONHASH:"gui-action-document-onhash",ACTION_DOC_UNLOAD:"gui-action-document-unload",TIMEOUT_RESIZE_END:250,orientation:0,ORIENTATION_PORTRAIT:0,ORIENTATION_LANDSCAPE:1,$contextid:null,context:window,document:null,hosted:!1,xhost:"*",initialized:!1,unloading:!1,init:function(action,thisp){var is=this.initialized;return arguments.length&&(is?action.call(thisp):(this._initcallbacks=this._initcallbacks||[],this._initcallbacks.push(function(){if(gui.debug)try{action.call(thisp)}catch(exception){throw console.error(action.toString()),exception}else action.call(thisp)}))),is},ready:function(action,thisp){return this.init(action,thisp)},module:function(name,module){var Module;if(gui.Type.isString(name)&&name.length)return Module=gui.Module.extend(name,module||{}),module=gui.Module.$register(new Module(name));throw new Error("Module needs an identity token")},hasModule:function(name){return gui.Module.$hasModule(name)},namespaces:function(){return Namespace.namespaces.map(function(ns){return ns.$ns})},spacenames:function(){Namespace.namespaces.forEach(function(ns){ns.spacename()})},namespace:function(ns,members){var no;if(!gui.Type.isString(ns))throw new TypeError("Expected a namespace string");return no=gui.Object.lookup(ns),no=new gui.Namespace(ns),no=gui.Object.assert(ns,no),gui.Object.extend(no,members||{})},broadcastGlobal:function(msg,arg){gui.Type.isEvent(arg)&&(arg=new gui.EventSummary(arg)),gui.Broadcast.dispatchGlobal(msg,arg)},_initcallbacks:null,_exist:function(){return this.hosted=window!==parent,this.$contextid="key"+Math.random().toString().slice(2,11),this.hosted&&(this.xhost="*"),this},$initialize:function(){this.spacenames(),this.initialized=!0;var list=this._initcallbacks;if(list){for(;list.length;)list.shift()();this._initcallbacks=null}},$shutdown:function(){this.unloading=!0},$mark:function(string){Timer.mark(string)},$stop:function(string){return Timer.stop(string)},$measure:function(string,action,thisp){this.$mark(string);var res=action.call(thisp);return this.$stop(string),res},$measurements:function(){return Timer.measurements()||[]}})._exist()}(function(){function Namespace(ns,members){Namespace.namespaces.push(this),this.$ns=ns,members&&Object.keys(members).forEach(function(key){Object.defineProperty(this,key,Object.getOwnPropertyDescriptor(members,key))},this)}return Namespace.namespaces=[],Namespace.prototype={$ns:null,toString:function(){return"[namespace "+this.$ns+"]"},spacename:function(){return this._spacename(this,this.$ns),this},_spacename:function(o,name){gui.Object.each(o,function(key,value){"$superclass"!==key&&gui.Type.isConstructor(value)&&value.$classname===gui.Class.ANONYMOUS&&(Object.defineProperty(value,"$classname",{value:name+"."+key,enumerable:!0,writable:!1}),this._spacename(value,name+"."+key))},this)}},Namespace}(),function(native,enabled){function push(item){for(var mid,low=0,high=list.length;low<high;)list[mid=low+high>>>1].startTime<item.startTime?low=mid+1:high=mid;return list.splice(low,0,item),item}var sets={},list=[];return{mark:function(key){return enabled&&(native?performance.mark("mark "+key):sets["$"+key]=Date.now()),this},stop:function(key){if(enabled){if(native){performance.mark("stop "+key),performance.measure(key,"mark "+key,"stop "+key);var entries=performance.getEntriesByName(key);return entries[entries.length-1]}var init=sets["$"+key];return push({startTime:init,name:key,duration:Date.now()-init,itemType:"measure"})}},measurements:function(){if(enabled)return native?performance.getEntriesByType("measure"):list.slice()}}}(!!(window.performance&&performance.mark&&performance.measure&&performance.getEntriesByName&&performance.getEntriesByType),!("10114"!==location.port&&"ui.tradeshift.com"!==location.host))),gui.$mark("boostrap everything"),gui.$mark("- parse spiritual"),gui.KeyMaster={generateKey:function(){var key="key"+Math.random().toString().slice(2,11);return this._keys[key]?key=this.generateKey():this._keys[key]=!0,key},generateGUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=16*Math.random()|0;return("x"===c?r:3&r|8).toString(16)}).toLowerCase()},isKey:function(string){var hit=null,looks=!1;return gui.Type.isString(string)&&(looks=(hit=this.extractKey(string))&&hit[0]===string),looks},extractKey:function(string){return/key\d{9}/.exec(string)},_keys:Object.create(null)},gui.Object={create:function(proto,props){var resolved={};return Object.keys(props).forEach(function(prop){resolved[prop]={value:props[prop],writable:!0,enumerable:!0,configurable:!0}}),Object.create(proto,resolved)},extend:function(target,source,loose){var hiding=this._hiding;if(!gui.Type.isObject(source))throw new TypeError("Expected object, got "+gui.Type.of(source));return Object.keys(source).forEach(function(key){if(!loose||!gui.Type.isDefined(target[key])){var desc=Object.getOwnPropertyDescriptor(source,key);desc=hiding?gui.Object._hide(desc):desc,Object.defineProperty(target,key,desc)}},this),target},extendmissing:function(target,source){return this.extend(target,source,!0)},copy:function(source){try{return this.extend({},source)}catch(exception){throw new TypeError("Could not object-copy "+gui.Type.of(source))}},each:function(object,func,thisp){return Object.keys(object).map(function(key){return func.call(thisp,key,object[key])}).filter(function(result){return void 0!==result})},all:function(object,func,thisp){var res=[];for(var key in object)res.push(func.call(thisp,key,object[key]));return res.filter(function(result){return void 0!==result})},map:function(source,domap,thisp){var mapping,result={};return this.each(source,function(key,value){void 0!==(mapping=domap.call(thisp,key,value))&&(result[key]=mapping)}),result},lookup:function(opath,context){var result,struct=context||self;if(!gui.Type.isString(opath))throw new TypeError("Expected string, got "+gui.Type.of(opath));return opath.includes(".")?(opath.split(".").every(function(part){return struct=struct[part],gui.Type.isDefined(struct)}),result=struct):result=struct[opath],result},assert:function(opath,value,context){var prop,struct=context||self;if(opath.includes(".")){var parts=opath.split(".");prop=parts.pop(),parts.forEach(function(part){struct=struct[part]||(struct[part]={})})}else prop=opath;return struct&&(struct[prop]=value),value},methods:function(object){var name,value,desc,obj=object,result=[];for(name in object){for(;!(desc=Object.getOwnPropertyDescriptor(obj,name));)obj=Object.getPrototypeOf(obj);"function"==typeof desc.value&&(value=object[name],gui.Type.isMethod(value)&&result.push(name))}return result},ownmethods:function(object){var that=this;return Object.keys(object).filter(function(key){return!that._isaccessor(object,key)&&gui.Type.isMethod(object[key])}).map(function(key){return key})},nonmethods:function(object){var result=[];for(var def in object)if(this._isaccessor(object,def));else{var o=object[def];gui.Type.isFunction(o)||result.push(def)}return result},bindall:function(object){var methods=Array.prototype.slice.call(arguments).slice(1);return methods.length||(methods=gui.Object.ownmethods(object).filter(function(name){return"_"!==name[0]})),methods.forEach(function(name){object[name]=object[name].bind(object)}),object},hidden:function(method){return gui.Object._hiding=!0,method.$hidden=!0,method},_hiding:!1,_isaccessor:function(object,key){var desc=Object.getOwnPropertyDescriptor(object,key);return!(!desc||!desc.get&&!desc.set)},_hide:function(desc){return desc.value&&gui.Type.isFunction(desc.value)&&desc.value.$hidden&&desc.configurable&&(desc.enumerable=!1),desc}},gui.Type={of:function(o){var type={}.toString.call(o).match(this._typeexp)[1].toLowerCase();return"domwindow"===type&&"undefined"===String(typeof o)&&(type="undefined"),type},isDefined:function(o){return"undefined"!==this.of(o)},isComplex:function(o){switch(this.of(o)){case"undefined":case"boolean":case"number":case"string":case"null":return!1}return!0},isWindow:function(o){return o&&o.document&&o.location&&o.alert&&o.setInterval},isEvent:function(o){return this.of(o).endsWith("event")&&this.isDefined(o.type)},isElement:function(o){return this.of(o).endsWith("element")&&o.nodeType===Node.ELEMENT_NODE},isDocumentFragment:function(o){return o&&o.nodeName&&"#document-fragment"===o.nodeName},isDocument:function(o){return o&&o.nodeType===Node.DOCUMENT_NODE},isMethod:function(o){return o&&this.isFunction(o)&&!this.isConstructor(o)&&!String(o).includes("[native code]")},isSpirit:function(o){return o&&o instanceof gui.Spirit},isConstructor:function(what){return this.isFunction(what)&&this.isObject(what.prototype)&&Object.keys(what.prototype).length},isGuiClass:function(what){return this.isConstructor(what)&&what.$classname},isSpiritConstructor:function(what){return this.isFunction(what)&&this.isFunction(what.summon)},isArrayLike:function(what){return"0"in what&&!this.isArray(what)},cast:function(string){var result=String(string);switch(result){case"null":result=null;break;case"true":case"false":result="true"===result;break;default:String(parseInt(result,10))===result?result=parseInt(result,10):String(parseFloat(result))===result&&(result=parseFloat(result))}return result},_typeexp:/\s([a-zA-Z]+)/},function(){["array","function","object","string","number","boolean","null","arguments","file"].forEach(function(type){this["is"+type[0].toUpperCase()+type.slice(1)]=function(o){return this.of(o)===type}},this)}.call(gui.Type),gui.Object.bindall(gui.Type),gui.Array={of:function(){var slice=Array.prototype.slice;return Array.of||function(){return slice.call(arguments)}}(),from:Array.from||function(arg){for(var array=[],object=Object(arg),len=object.length>>>0,i=0;i<len;)i in object&&(array[i]=object[i]),i++;return array},make:function(arg){switch(gui.Type.of(arg)){case"string":return arg.split(" ");case"array":return this.from(arg);default:return gui.Type.isArrayLike(arg)?this.from(arg):[arg]}},remove:function(array,from,to){var markers=gui.Array.from(arguments).slice(1);return markers.some(isNaN)?this.remove.apply(this,[array].concat(markers.map(function(m){return isNaN(m)?array.indexOf(m):m}))):(array.splice(from,!to||1+to-from+(!(to<0^from>=0)&&(to<0||-1)*array.length)),array.length)}},gui.Arguments={provided:function(){var types=gui.Array.from(arguments);return function(action){return function(){if(gui.Arguments._match(arguments,types))return action.apply(this,arguments)}}},confirmed:function(){var types=gui.Array.from(arguments);return function(action){return function(){if(gui.Arguments._validate(arguments,types))return action.apply(this,arguments);gui.Arguments._abort(this)}}},_validating:!1,_bugsummary:null,_match:function(args,types){return types.every(function(type,index){return this._matches(type,args[index],index)},this)},_validate:function(args,types){this._validating=!0;var is=this._match(args,types);return this._validating=!1,is},_xtract:function(xpect,optional){return optional?xpect.slice(1,-1):xpect},_matches:function(xpect,arg,index){var needs=!xpect.startsWith("("),split=this._xtract(xpect,!needs).split("|"),input=gui.Type.of(arg),match="*"===xpect||"node"===xpect&&arg&&arg.nodeType||"constructor"===xpect&&arg&&gui.Type.isConstructor(arg)||"element"===xpect&&arg&&arg.nodeType===Node.ELEMENT_NODE||"spirit"===xpect&&arg&&arg.$instanceid&&arg.element||!needs&&"undefined"===input||!needs&&split.indexOf("*")>-1||split.indexOf(input)>-1;return!match&&this._validating&&("string"===input&&(arg='"'+arg+'"'),this._bugsummary=[index,xpect,input,arg]),match},_abort:function(that){var summ=this._bugsummary,name=that.constructor.$classname||String(that);console.error(["Spiritual GUI: Bad argument "+summ.shift(),"for "+name+":","Expected "+summ.shift()+",","got "+summ.shift()+":",summ.shift()].join(" "))}},gui.Function={create:function(name,params,body,context){var F=context?context.Function:Function;return name=this.safename(name),params=params?params.join(","):"",body=body||"",new F("return function "+name+" ( "+params+" ) {"+body+"}")()},decorateBefore:gui.Arguments.confirmed("object|function","string","function")(function(target,name,decorator){return this._decorate("before",target,name,decorator)}),decorateAfter:gui.Arguments.confirmed("object|function","string","function")(function(target,name,decorator){return this._decorate("after",target,name,decorator)}),decorateAround:function(){throw new Error("TODO")},safename:function(name){return name&&name.includes(".")&&(name=name.split(".").pop()),name||""},_decorate:function(position,target,name,decorator){return target[name]=gui.Combo[position](decorator)(target[name]),target}},gui.Class={create:function(){var b=this._breakdown_base(arguments),C=this._createclass(null,b.proto,b.name);return gui.Object.extend(C.prototype,b.protos),gui.Object.extend(C,b.statics),gui.Property.extendall(b.protos,C.prototype),b.recurring&&gui.Object.each(b.recurring,function(key,val){var desc=Object.getOwnPropertyDescriptor(C,key);desc&&!desc.writable||(C[key]=C.$recurring[key]=val)}),C},get:function(classid){return this._classes[classid]||null},$constructor:function(){var constructor=this.$onconstruct||this.onconstruct,nonenumprop=gui.Property.nonenumerable,returnvalue=this;return Object.defineProperties(this,{$instanceid:nonenumprop({value:gui.KeyMaster.generateKey()}),displayName:nonenumprop({value:this.constructor.displayName,writable:!0})}),gui.Type.isFunction(constructor)&&(returnvalue=constructor.apply(this,arguments)),returnvalue||this},_classes:Object.create(null),ANONYMOUS:"Anonymous",_BODY:function($name){var body=$name.toString().trim();return body.slice(body.indexOf("{")+1,-1)}(function $name(){return this instanceof $name?gui.Class.$constructor.apply(this,arguments):$name.extend.apply($name,arguments)}),_breakdown_base:function(args){var named=gui.Type.isString(args[0]);return{name:named?args[0]:null,proto:args[named?1:0]||Object.create(null),protos:args[named?2:1]||Object.create(null),recurring:args[named?3:2]||Object.create(null),statics:args[named?4:3]||Object.create(null)}},_breakdown_subs:function(args){var named=gui.Type.isString(args[0]);return{name:named?args[0]:null,protos:args[named?1:0]||Object.create(null),recurring:args[named?2:1]||Object.create(null),statics:args[named?3:2]||Object.create(null)}},_createclass:function(SuperC,proto,name){name=name||gui.Class.ANONYMOUS;var C=function $Class(){return this instanceof $Class?gui.Class.$constructor.apply(this,arguments):$Class.extend.apply($Class,arguments)};return C.$classid=gui.KeyMaster.generateKey(),C.prototype=Object.create(proto||null),C.prototype.constructor=C,C=this._internals(C,SuperC),C=this._interface(C),C=this._classname(C,name),this._classes[C.$classid]=C,C},_createsubclass:function(SuperC,args){return args=this._breakdown_subs(args),this._extendclass(SuperC,args.protos,args.recurring,args.statics,args.name)},_extendclass:function(SuperC,protos,recurring,statics,name){var C=this._createclass(SuperC,SuperC.prototype,name);return gui.Object.extend(C,statics),gui.Object.extend(C.$recurring,recurring),gui.Object.each(C.$recurring,function(key,val){var desc=Object.getOwnPropertyDescriptor(C,key);desc&&!desc.writable||(C[key]=val)}),gui.Property.extendall(protos,C.prototype),C=this._classname(C,name)},_internals:function(C,SuperC){return C.$super=null,C.$subclasses=[],C.$superclass=SuperC||null,C.$recurring=SuperC?gui.Object.copy(SuperC.$recurring):Object.create(null),SuperC&&SuperC.$subclasses.push(C),C},_interface:function(C){return["extend","mixin","is"].forEach(function(method){C[method]=this[method]},this),C},_classname:function(C,name){return C.$classname=name||gui.Class.ANONYMOUS,Object.defineProperty(C.prototype,"$classname",{enumerable:!1,configurable:!0,get:function(){return this.constructor.$classname}}),C.toString=function(){return"[function "+this.$classname+"]"},C.prototype.toString=function(){return"[object "+this.constructor.$classname+"]"},C},_namedbody:function(name){return this._BODY.replace(new RegExp("\\$name","gm"),gui.Function.safename(name))}},gui.Object.extend(gui.Class,{extend:function(){return gui.Class._createsubclass(this,arguments)},mixin:function(proto,recurring,statics){return Array.forEach(arguments,function(mixins,i){mixins&&gui.Object.each(mixins,function(name,value){0===i?this.prototype[name]=value:gui.Class.descendantsAndSelf(this,function(C){C.$recurring[name]=value,C[name]=value})},this)},this),this},is:function(object){return gui.Type.isObject(object)&&object instanceof this},isInstance:function(){console.error("Deprecated API is derecated")}}),gui.Object.extend(gui.Class,{children:function(C,action,thisp){var results=[];return action=action||gui.Combo.identity,C.$subclasses.forEach(function(sub){results.push(action.call(thisp,sub))},thisp),results},descendants:function(C,action,thisp,results){return results=results||[],action=action||gui.Combo.identity,C.$subclasses.forEach(function(sub){results.push(action.call(thisp,sub)),gui.Class.descendants(sub,action,thisp,results)},thisp),results},descendantsAndSelf:function(C,action,thisp){var results=[];return action=action||gui.Combo.identity,results.push(action.call(thisp,C)),this.descendants(C,action,thisp,results)},parent:function(C,action,thisp){return C&&C.$superclass?(action=action||gui.Combo.identity).call(thisp,C.$superclass):null},ancestors:function(C,action,thisp,results){return results=results||[],action=action||gui.Combo.identity,C.$superclass&&(results.push(action.call(thisp,C.$superclass)),gui.Class.ancestors(C.$superclass,action,thisp,results)),results},ancestorsAndSelf:function(C,action,thisp){var results=[];return action=action||gui.Combo.identity,results.push(action.call(thisp,C)),this.ancestors(C,action,thisp,results)},family:function(C,action,thisp){var results=this.ancestorsAndSelf(C).concat(this.descendants(C));return action&&(results=results.map(function(Con){return action.call(thisp,Con)})),results}}),gui.Property={extendall:function(source,target){return Object.keys(source).forEach(function(key){this.extend(source,target,key)},this),target},extend:function(source,target,key){var desc=Object.getOwnPropertyDescriptor(source,key);return desc=this._accessor(target,key,desc),Object.defineProperty(target,key,desc),target},nonenumerable:function(desc){return gui.Object.extendmissing({configurable:!0,enumerable:!1},desc)},accessor:function(object,key,def){if(this._isaccessor(def))return Object.defineProperty(object,key,{enumerable:!0,configurable:!0,get:def.getter||this._NOGETTER,set:def.setter||this._NOSETTER});throw new TypeError("Expected getter and/or setter method")},_isaccessor:function(obj){return Object.keys(obj).every(function(key){var is=!1;switch(key){case"getter":case"setter":is=gui.Type.isFunction(obj[key])}return is})},_accessor:function(proto,key,desc){var val=desc.value;return gui.Type.isObject(val)&&(val.getter||val.setter)&&this._isactive(val)&&(desc=this._activeaccessor(proto,key,val)),desc},_isactive:function(obj){return Object.keys(obj).every(function(key){var is=!1;switch(key){case"getter":case"setter":is=gui.Type.isFunction(obj[key])}return is})},_activeaccessor:function(proto,key,def){var desc;return["getter","setter"].forEach(function(name,set){for(;proto&&proto[key]&&!gui.Type.isDefined(def[name]);)proto=Object.getPrototypeOf(proto),(desc=Object.getOwnPropertyDescriptor(proto,key))&&(def[name]=desc[set?"set":"get"])}),{enumerable:!0,configurable:!0,get:def.getter||this._NOGETTER,set:def.setter||this._NOSETTER}},_NOGETTER:function(){throw new Error("Getting a property that has only a setter")},_NOSETTER:function(){throw new Error("Setting a property that has only a getter")}},gui.Object.bindall(gui.Property),gui.Interface={validate:function(interfais,object){var is=!0,expected=interfais.toString(),type=gui.Type.of(object);switch(type){case"null":case"string":case"number":case"boolean":case"undefined":throw new Error("Expected "+expected+", got "+type+": "+object);default:try{var missing=null,t=null;if(!(is=Object.keys(interfais).every(function(name){return missing=name,t=gui.Type.of(interfais[name]),gui.Type.of(object[name])===t})))throw new Error("Expected "+expected+". A required "+type+' "'+missing+'" is missing')}catch(exception){throw new Error("Expected "+expected)}}return is}},gui.Combo={before:function(decoration){return function(base){return function(){return decoration.apply(this,arguments),base.apply(this,arguments)}}},after:function(decoration){return function(base){return function(){var result=base.apply(this,arguments);return decoration.apply(this,arguments),result}}},around:function(decoration){var slice=[].slice;return function(base){return function(){var argv,callback,result,that=this;return argv=arguments.length>=1?slice.call(arguments,0):[],result=void 0,callback=function(){return result=base.apply(that,argv)},decoration.apply(this,[callback].concat(argv)),result}}},provided:function(condition){return function(base,otherwise){return function(){return condition.apply(this,arguments)?base.apply(this,arguments):otherwise?otherwise.apply(this,arguments):void 0}}},chained:function(base){return function(){var result=base.apply(this,arguments);return void 0===result?this:result}},memoized:function(base){var memos;return memos={},function(){var key;return key=JSON.stringify(arguments),memos.hasOwnProperty(key)?memos[key]:(memos[key]=base.apply(this,arguments),memos[key])}},identity:function(subject){return subject}},gui.Plugin=gui.Class.create(Object.prototype,{client:null,spirit:null,context:null,onconstruct:function(){},ondestruct:function(){},handleEvent:function(e){gui.Type.isFunction(this.onevent)&&this.onevent(e)},$destructed:!1,$onconstruct:function(client){this.client=client,gui.hasModule("gui-spirits@wunderbyte.com")&&client instanceof gui.Spirit&&(this.spirit=client||null,this.context=window),this.onconstruct()},$ondestruct:function(){}},{lazy:!0},{$prepare:function(spirit,prefix,Plugin){Object.defineProperty(spirit,prefix,{enumerable:!0,configurable:!0,get:function(){var plugin=new Plugin(this);return this.life.plugins[prefix]=!0,gui.Plugin.$assign(spirit,prefix,plugin),plugin}})},$assign:function(spirit,prefix,plugin){Object.defineProperty(spirit,prefix,{enumerable:!0,configurable:!0,get:function(){return plugin},set:function(){throw new Error('The property name "'+prefix+'" is reserved for the '+plugin.$classname+" and cannot be redefined.")}})}}),gui.SuperPlugin=function(suber){return gui.Plugin.extend({onconstruct:function(){suber.onconstruct.call(this),console.error(["Note that 'this.super' doesn't really exist. You can either:","1) compile the script serverside using 'grunt-spiritual-build' or","2) use the pattern 'SuperClass.prototype.methodname.apply(this)'","(the Grunt task basically just applies this pattern to the code)"].join("\n"))}})}(gui.Plugin.prototype),gui.TrackerPlugin=gui.Plugin.extend({onconstruct:function(){gui.Plugin.prototype.onconstruct.call(this),this._trackedtypes=Object.create(null),this.spirit&&(this._sig=gui.$contextid)},ondestruct:function(){gui.Plugin.prototype.ondestruct.call(this),gui.Object.each(this._trackedtypes,function(type,list){list.slice().forEach(function(checks){this._cleanup(type,checks)},this)},this)},toggle:function(arg,checks){console.error("TODO: SpiritTracker#toggle")},shift:function(on){var rest=gui.Array.from(arguments).slice(1);return on?this.add.apply(this,rest):this.remove.apply(this,rest)},shiftGlobal:function(on){return this._globalize(function(){return this.shift.apply(arguments)})},contains:function(arg){return gui.Array.make(arg).every(function(type){return this._trackedtypes[type]},this)},_global:!1,_trackedtypes:null,_sig:null,_globalize:function(operation){this._global=!0;var res=operation.call(this);return this._global=!1,res},_addchecks:function(type,checks){var result=!1,list=this._trackedtypes[type];return list?result=!this._haschecks(list,checks):(list=this._trackedtypes[type]=[],result=!0),result&&checks&&list.push(checks),result},_removechecks:function(type,checks){var result=!1,list=this._trackedtypes[type];if(list){var index=this._checksindex(list,checks);index>-1&&(result=!0,0===gui.Array.remove(list,index)&&delete this._trackedtypes[type])}return result},_containschecks:function(type,checks){var result=!1,list=this._trackedtypes[type];return list&&(result=!checks||this._haschecks(list,checks)),result},_haschecks:function(list,checks){var result=!checks||!1;return result||list.every(function(a){return a.every(function(b,i){return b===checks[i]})&&(result=!0),!result}),result},_hashandlers:function(){return Object.keys(this._trackedtypes).length>0},_checksindex:function(list,checks){var result=-1;return list.every(function(a,index){return a.every(function(b,i){return b===checks[i]})&&(result=index),-1===result}),result},_cleanup:function(type,checks){this._removechecks(type,checks)}}),gui.Action=function(confirmed,chained){return gui.hosted&&addEventListener("message",function(e){window.gui&&gui.Type&&gui.Type.isString(e.data)&&e.source===parent&&gui.Action.$maybeDescendGlobal(e.data)}),gui.Class.create(Object.prototype,{target:null,type:null,data:null,direction:null,global:!1,isConsumed:!1,isCancelled:!1,consumer:null,instanceid:null,onconstruct:function(json){gui.Object.extend(this,json)},consume:function(consumer){this.isConsumed=!0,this.consumer=consumer},cancel:function(consumer){this.isCancelled=!0,this.consume(consumer)}},{},{DESCEND:"descend",ASCEND:"ascend",IActionHandler:{onaction:function(a){},toString:function(){return"[interface ActionHandler]"}},add:confirmed("node","array|string","object|function")(chained(function(elm,type,handler){this._listen(!0,elm,type,handler,!1)})),remove:confirmed("node","array|string","object|function")(chained(function(node,type,handler){this._listen(!1,node,type,handler,!1)})),addGlobal:confirmed("node","array|string","object|function")(chained(function(node,type,handler){this._listen(!0,node,type,handler,!0)})),removeGlobal:confirmed("node","array|string","object|function")(chained(function(node,type,handler){this._listen(!1,node,type,handler,!0)})),dispatch:function(target,type,data){return this.ascend(target,type,data)},ascend:function(target,type,data){return this._dispatch(target,type,data,gui.Action.ASCEND,!1)},descend:function(target,type,data){return this._dispatch(target,type,data,gui.Action.DESCEND,!1)},dispatchGlobal:function(target,type,data){return this.ascendGlobal(target,type,data)},ascendGlobal:function(target,type,data){return this._dispatch(target,type,data,gui.Action.ASCEND,!0)},descendGlobal:function(target,type,data){return this._dispatch(target,type,data,gui.Action.DESCEND,!0)},stringify:function(a,key){return"spiritual-action:"+(a.target=null,a.data=function(d){if(gui.Type.isComplex(d))if(gui.Type.isFunction(d.stringify))d=d.stringify();else try{JSON.stringify(d)}catch(jsonexception){d=null}return d}(a.data),a.instanceid=key||null,JSON.stringify(a))},parse:function(msg){return msg.startsWith("spiritual-action:")?new gui.Action(JSON.parse(msg.split("spiritual-action:")[1])):null},$maybeDescendGlobal:function(postmessage){var action,root,handlers,data=postmessage;gui.Type.isString(data)&&data.startsWith("spiritual-action:")&&(action=gui.Action.parse(data)).direction===gui.Action.DESCEND&&((handlers=this._globals[action.type])&&handlers.slice().forEach(function(handler){handler.onaction(action)}),gui.hasModule("gui-spirits@wunderbyte.com")&&gui.ready(function(){(root=gui.get("html"))&&(root.action.$handleownaction=!0,root.action.descendGlobal(action.type,action.data))}))},_globals:{},_locals:{},_listen:function(add,node,type,handler,global){if(node.nodeType!==Node.DOCUMENT_NODE)throw new TypeError("Document node expected");var map=global?this._globals:this._locals,handlers=map[type],ok=gui.Action.IActionHandler;gui.Interface.validate(ok,handler)&&gui.Array.make(type).forEach(function(t){add?(handlers||(handlers=map[type]=[]),-1===handlers.indexOf(handler)&&handlers.push(handler)):handlers&&0===gui.Array.remove(handlers,handler)&&delete map[type]})},_dispatch:function(target,type,data,direction,global){var action=new gui.Action({target:target,type:type,data:data,direction:direction||gui.Action.ASCEND,global:global||!1}),crawler=new gui.Crawler(gui.CRAWLER_ACTION);return crawler.global=action.global||!1,crawler[action.direction](target,{handleSpirit:function(spirit){var directive=gui.Crawler.CONTINUE;return spirit.action.contains(type)&&(spirit.action.$onaction(action),action.isConsumed&&(directive=gui.Crawler.STOP,action.consumer=spirit)),directive},transcend:function(win,uri,key){var msg=gui.Action.stringify(action,key);win.postMessage(msg,"*")}}),action}})}(gui.Arguments.confirmed,gui.Combo.chained),gui.Broadcast=function(confirmed,chained){return window.addEventListener("message",function(e){window.gui&&gui.Type&&gui.Type.isString(e.data)&&e.data.startsWith("spiritual-broadcast:")&&gui.Broadcast.$maybeBroadcastGlobal(e.data)}),gui.Class.create(Object.prototype,{target:null,type:null,data:null,global:!1,$contextid:null,$contextids:null,$onconstruct:function(defs){gui.Object.extend(this,defs),this.$contextids=this.$contextids||[]}},{},{IBroadcastHandler:{onbroadcast:function(b){},toString:function(){return"[interface BroadcastHandler]"}},$target:null,_globals:Object.create(null),_locals:Object.create(null),add:chained(function(message,handler,sig){this._add(message,handler,sig||gui.$contextid)}),remove:chained(function(message,handler,sig){this._remove(message,handler,sig||gui.$contextid)}),addGlobal:chained(function(message,handler){this._add(message,handler)}),removeGlobal:chained(function(message,handler){this._remove(message,handler)}),dispatch:function(type,data){if(gui.Type.isString(type))return this._dispatch({type:type,data:data,global:!1});console.error('The "target" argument (the first argument) of gui.Broadcast.dispatch is deprecated'),this.dispatch(arguments[1],arguments[2])},dispatchGlobal:function(type,data){return gui.Type.isString(type)?this._dispatch({type:type,data:data,global:!0,$contextid:gui.$contextid}):(console.error('The "target" argument (the first argument) of gui.Broadcast.dispatchGlobal is deprecated'),this.dispatchGlobal(arguments[1],arguments[2]))},stringify:function(b){return"spiritual-broadcast:"+(b.target=null,b.data=function(d){if(gui.Type.isComplex(d))if(gui.Type.isFunction(d.stringify))d=d.stringify();else try{JSON.stringify(d)}catch(jsonexception){d=null}return d}(b.data),JSON.stringify(b))},parse:function(msg){var prefix="spiritual-broadcast:";if(msg.startsWith(prefix))return JSON.parse(msg.split(prefix)[1])},$maybeBroadcastGlobal:function(postmessage){var b=gui.Broadcast.parse(postmessage);-1===b.$contextids.indexOf(gui.$contextid)&&gui.Broadcast._dispatch(b)},_add:confirmed("array|string","object|function","(string)")(function(type,handler,sig){if(gui.Type.isArray(type))type.forEach(function(t){this._add(t,handler,sig)},this);else{var map;sig?(map=this._locals[sig])||(map=this._locals[sig]=Object.create(null)):map=this._globals,map[type]||(map[type]=[]);var array=map[type];-1===array.indexOf(handler)&&array.push(handler)}}),_remove:function(message,handler,sig){if(gui.Type.isArray(message))message.forEach(function(msg){this._remove(msg,handler,sig)},this);else{var index,array=function(locals,globals){return sig?locals[sig]?locals[sig][message]:void 0:globals[message]}(this._locals,this._globals);array&&(index=array.indexOf(handler))>-1&&gui.Array.remove(array,index)}},_dispatch:function(b){var map=b.global?this._globals:this._locals[gui.$contextid];if(gui.hasModule("gui-spirits@wunderbyte.com")&&(gui.spiritualized||(b.type,gui.BROADCAST_WILL_SPIRITUALIZE)),this.$target&&(b.global||(b.target=this.$target),this.$target=null),b instanceof gui.Broadcast==!1&&(b=new gui.Broadcast(b)),map){var handlers=map[b.type];handlers&&handlers.slice().forEach(function(handler){handler.onbroadcast(b)})}return b.global&&this._propagate(b),b},_propagate:function(b){var postmessage=(b.$contextids.push(gui.$contextid),gui.Broadcast.stringify(b));this._propagateDown(postmessage),this._propagateUp(postmessage,b.type)},_propagateDown:function(postmessage){var iframes=document.querySelectorAll("iframe");Array.forEach(iframes,function(iframe){iframe.contentWindow.postMessage(postmessage,"*")})},_propagateUp:function(postmessage){window!==top&&parent.postMessage(postmessage,"*")}})}(gui.Arguments.confirmed,gui.Combo.chained),function(confirmed){function safeapply(thisp){return!thisp||(void 0===thisp.$destructed||!thisp.$destructed)}gui.Tick=function(type){this.type=type},gui.Tick.prototype={type:null,toString:function(){return"[object gui.Tick]"}},gui.Object.extend(gui.Tick,{toString:function(){return"[function gui.Tick]"},add:function(type,handler,sig){return this._add(type,handler,!1,sig||gui.$contextid)},remove:function(type,handler,sig){return this._remove(type,handler,sig||gui.$contextid)},one:function(type,handler,sig){return this._add(type,handler,!0,sig||gui.$contextid)},next:function(action,thisp){setImmediate(function(){safeapply(thisp)&&action.call(thisp)})},nextFrame:function(action,thisp){return requestAnimationFrame(function(timestamp){safeapply(thisp)&&action.call(thisp,timestamp)})},cancelFrame:function(n){cancelAnimationFrame(n)},time:confirmed("function","(number)","(function|object)")(function(action,time,thisp){return setTimeout(function(){safeapply(thisp)&&action.call(thisp)},time||0)}),cancelTime:function(n){clearTimeout(n)},start:confirmed("string","number")(function(type,time){var map=this._intervals;if(!map[type]){var tick=new gui.Tick(type);map[type]=setInterval(function(){this._doit(tick)}.bind(this),time)}}),stop:confirmed("string")(function(type){var map=this._intervals,id=map[type];id&&(clearInterval(id),delete map[type])}),dispatch:function(type,time,sig){return this._dispatch(type,time,sig||gui.$contextid)},_intervals:Object.create(null),_tempname:{types:Object.create(null),handlers:Object.create(null)},_add:function(type,handler,one,sig){if(Array.isArray(handler)&&(handler=handler[0]),gui.Type.isArray(type))type.forEach(function(t){this._add(t,handler,one,sig)},this);else{var list,index,map=this._tempname;(list=map.handlers[type])||(list=map.handlers[type]=[]),-1===(index=list.indexOf(handler))&&(index=list.push(handler)-1),one&&(list._one=list._one||Object.create(null),list._one[index]=!0)}return this},_remove:function(type,handler,sig){if(gui.Type.isArray(type))type.forEach(function(t){this._remove(t,handler,sig)},this);else{Array.isArray(handler)&&(handler=handler[0]);var map=this._tempname,list=map.handlers[type];if(list){var index=list.indexOf(handler);index>-1&&(gui.Array.remove(list,index),0===list.length&&delete map.handlers[type])}}return this},_dispatch:function(type,time,sig){var types=this._tempname.types,tick=new gui.Tick(type);if(time=time||0,!types[type]){types[type]=!0;var that=this,doit=function(){delete types[type],that._doit(tick)};time?time>0?setTimeout(doit,time):doit():setImmediate(doit)}return tick},_doit:function(tick){var list=this._tempname.handlers[tick.type];if(list){var mishandlers=[];list.filter(function(handler){return!handler.$destructed||(mishandlers.push(handler),!1)}).forEach(function(handler){handler.ontick(tick)}),mishandlers.forEach(function(handler){gui.Array.remove(list,list.indexOf(handler))})}}})}(gui.Arguments.confirmed),gui.Document=function(){function doaction(type,data){gui.hosted&&gui.Action.ascendGlobal(document,type,data)}function dobrodcast(){gui.Array.make(arguments).forEach(function(type){gui.Broadcast.dispatch(type)})}function islayoutready(){return window.innerWidth>0}return gui.Class.create(Object.prototype,{onconstruct:function(){var that=this,add=function(target,events,capture){events.split(" ").forEach(function(type){target.addEventListener(type,that,capture)})};add(document,"DOMContentLoaded visibilitychange"),add(document,"click mousedown mouseup",!0),add(window,"load hashchange resize"),gui.hosted||add(window,"orientationchange"),window.chrome&&chrome.app&&chrome.runtime||add(window,"unload")},handleEvent:function(e){switch(e.type){case"click":case"mousedown":case"mouseup":this._onmouseevent(e);break;case"orientationchange":this._onrotate();break;case"resize":this._onresize();break;case"DOMContentLoaded":this._ondom();break;case"load":this._onload();break;case"unload":this._onunload();break;case"hashchange":this._onhashchange();break;case"visibilitychange":this._onvisibilitychange(!document.hidden)}},_loaded:!1,_domloaded:!0,_timeout:-1,_ondom:function(){this._domloaded=!0,gui.$initialize(),this._configure(gui.namespaces()),function onlayoutready(){islayoutready()?(doaction(gui.ACTION_DOC_ONDOMCONTENT,location.href),dobrodcast(gui.BROADCAST_TODOM,gui.BROADCAST_ONDOM)):setTimeout(onlayoutready)}()},_onload:function(){this._loaded=!0,dobrodcast(gui.BROADCAST_TOLOAD,gui.BROADCAST_ONLOAD),doaction(gui.ACTION_DOC_ONLOAD,location.href)},_onunload:function(){this._unloaded=!0,gui.$shutdown(),dobrodcast(gui.BROADCAST_TOUNLOAD,gui.BROADCAST_ONUNLOAD),doaction(gui.ACTION_DOC_UNLOAD,location.href)},_onhashchange:function(){doaction(gui.ACTION_DOC_ONHASH,location.hash)},_onmouseevent:function(e){gui.broadcastGlobal({click:gui.BROADCAST_MOUSECLICK,mousedown:gui.BROADCAST_MOUSEDOWN,mouseup:gui.BROADCAST_MOUSEUP}[e.type],gui.$contextid)},_onresize:function(){clearTimeout(this._timeout),this._timeout=setTimeout(function(){gui.Broadcast.dispatch(gui.BROADCAST_RESIZE_END)},gui.TIMEOUT_RESIZE_END)},_onrotate:function(){gui.hosted||(gui.orientation=window.innerWidth>window.innerHeight?1:0,gui.broadcastGlobal(gui.BROADCAST_ORIENTATIONCHANGE,gui.orientation))},_onvisibilitychange:function(visible){var root=gui.get(document.documentElement);visible&&root&&root.reflex()},_configure:function(spaces){var prop,def,metas=document.querySelectorAll("meta[name]");Array.forEach(metas,function(meta){prop=meta.getAttribute("name"),spaces.forEach(function(ns){prop.startsWith(ns+".")&&(def=gui.Object.lookup(prop),gui.Type.isDefined(def)?gui.Object.assert(prop,gui.Type.cast(meta.getAttribute("content"))):console.error('No definition for "'+prop+'"'))})})}})}(),gui.document=new gui.Document,gui.Module=gui.Class.create(Object.prototype,{oncontextinitialize:function(){},onrun:function(){},ondom:function(){},onload:function(){},onunload:function(){},$modname:null,$onconstruct:function(name){this.$modname=name,this.toString=function(){return"[module "+name+"]"}}},{},{$register:function(module){var name=module.$modname;if(this.$hasModule(name))throw new Error(name+" loaded twice?");return this._modules.push(module),gui.Type.isFunction(module.oncontextinitialize)&&module.oncontextinitialize(window),gui.Type.isFunction(module.onrun)&&module.onrun(),module},$hasModule:function(name){return this._modules.some(function(module){return module.$modname===name})},_modules:[]}),function(modules){gui.Object.each({ondom:gui.BROADCAST_TODOM,onload:gui.BROADCAST_TOLOAD,onunload:gui.BROADCAST_TOUNLOAD},function(action,broadcast){gui.Broadcast.add(broadcast,{onbroadcast:function(){modules.forEach(function(module){module[action]()})}})})}(gui.Module._modules),gui.Garbage={DENIAL:"Attempt to handle destructed object",toString:function(){return"[object gui.Garbage]"},ontick:function(t){"gui-tick-garbage-empty"===t.type&&window.gui&&this._nukemnow()},$collect:function(spirit){gui.unloading?this.$nuke(spirit):(this._spirits.push(spirit),gui.Tick.dispatch("gui-tick-garbage-empty"))},$nuke:function(spirit){var prefixes=[],plugins=spirit.life.plugins;gui.Object.each(plugins,function(prefix,instantiated){instantiated?"life"!==prefix&&prefixes.push(prefix):Object.defineProperty(spirit,prefix,{enumerable:!0,configurable:!0,get:function(){},set:function(){}})}),plugins=prefixes.map(function(key){return spirit[key]},this),gui.unloading||(this.$nukeplugins(plugins,!1),gui.Tick.next(function(){this.$nukeplugins(plugins,!0),this.$nukeelement(spirit),this.$nukeallofit(spirit)},this))},$nukeplugins:function(plugins,nuke){nuke?plugins.forEach(function(plugin){this.$nukeallofit(plugin)},this):plugins.map(function(plugin){return plugin.ondestruct(),plugin}).forEach(function(plugin){plugin.$ondestruct()})},$nukeelement:function(spirit){try{spirit.element.spirit=null}catch(denied){}},$nukeallofit:function(thing){var nativeprops=Object.prototype;if(!gui.unloading&&!thing.$destructed){thing.$destructed=!0;for(var prop in thing)if((thing.hasOwnProperty(prop)||gui.debug)&&void 0===nativeprops[prop]&&"$destructed"!==prop){var desc=Object.getOwnPropertyDescriptor(thing,prop);desc&&!desc.configurable||(gui.debug?this._definePropertyItentified(thing,prop):Object.defineProperty(thing,prop,this.DENIED))}}},DENIED:{enumerable:!0,configurable:!0,get:function(){gui.Garbage.DENY()},set:function(){gui.Garbage.DENY()}},DENY:function(message){var stack,e=new Error(gui.Garbage.DENIAL+(message?": "+message:""));!gui.Client.isExplorer&&(stack=e.stack)?((stack=gui.Client.isWebKit?stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@").split("\n"):stack.split("\n")).shift(),stack.shift(),console.warn(e.message+"\n"+stack)):console.warn(e.message)},_spirits:[],_definePropertyItentified:function(thing,prop){Object.defineProperty(thing,prop,{enumerable:!0,configurable:!0,get:function(){gui.Garbage.DENY(thing)},set:function(){gui.Garbage.DENY(thing)}})},_nukemnow:function(){var spirit,spirits=this._spirits.slice();if(window.gui){for(;spirit=spirits.shift();)this.$nuke(spirit);this._spirits=[]}}},gui.Tick.add("gui-tick-garbage-empty",gui.Garbage),gui.URL=function(doc,href){if(!doc||doc.nodeType!==Node.DOCUMENT_NODE)throw new TypeError("Document expected");var val,link=gui.URL._createLink(doc,href);Object.keys(gui.URL.prototype).forEach(function(key){gui.Type.isString(val=link[key])&&("pathname"!==key||val.startsWith("/")||(val="/"+val),this[key]=val)},this),this.id=this.hash?this.hash.substring(1):null,this.external=this.href.split("#")[0]!==doc.URL.split("#")[0]},gui.URL.prototype={hash:null,host:null,hostname:null,href:null,pathname:null,port:null,protocol:null,search:null,id:null,external:!1,toString:function(){return this.href}},gui.URL.absolute=function(base,href){if(href=href||"",base.nodeType===Node.DOCUMENT_NODE)return new gui.URL(base,href).href;if("string"==typeof base){var stack=base.split("/"),parts=href.split("/");return stack.pop(),parts.forEach(function(part){"."!==part&&(".."===part?stack.pop():stack.push(part))}),stack.join("/")}},gui.URL.external=function(src,doc){doc=doc||document;var url=new gui.URL(doc,src);return url.host!==doc.location.host||url.port!==doc.location.port},gui.URL.getParam=function(url,name){name=name.replace(/(\[|\])/g,"\\$1");var results=new RegExp("[\\?&]"+name+"=([^&#]*)").exec(url);return null===results?null:results[1]},gui.URL.setParam=function(url,name,value){var cut,params=[],index=-1,path=url.split("#")[0],hash=url.split("#")[1];return path.indexOf("?")>-1&&(path=(cut=path.split("?"))[0],(params=cut[1].split("&")).every(function(param,i){var x=param.split("=");return x[0]===name&&(index=i,null!==value&&(x[1]=value,params[i]=x.join("="))),index<0})),null===value?index>-1&&params.remove(index,index):index<0&&(params[params.length]=[name,value].join("=")),params=params.length>0?"?"+params.join("&"):"",path+params+(hash?"#"+hash:"")},gui.URL.parametrize=function(baseurl,params){return gui.Type.isObject(params)&&gui.Object.each(params,function(key,value){switch(baseurl+=baseurl.includes("?")?"&":"?",gui.Type.of(value)){case"array":baseurl+=value.map(function(member){return key+"="+String(member)}).join("&");break;default:baseurl+=key+"="+String(value)}}),baseurl},gui.URL.origin=function(win){var loc=win.location;return loc.origin||loc.protocol+"//"+loc.host},gui.URL._createLink=function(doc,href){var link=doc.createElement("a");if(link.href=href||"",gui.Client.isExplorer){var uri=gui.URL.parseUri(link.href);Object.keys(uri).forEach(function(key){link[key]||(link[key]=uri[key])})}return link},gui.URL.parseUri=function(str){for(var o=gui.URL.parseOptions,m=o.parser[o.strictMode?"strict":"loose"].exec(str),uri={},i=14;i--;)uri[o.key[i]]=m[i]||"";return uri[o.q.name]={},uri[o.key[12]].replace(o.q.parser,function($0,$1,$2){$1&&(uri[o.q.name][$1]=$2)}),uri},gui.URL.parseOptions={strictMode:!0,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},gui.Then=function(callback,thisp){callback&&this.then(callback,thisp)},gui.Then.prototype={toString:function(){return"[object gui.Then]"},then:function(callback,thisp){this._callback=callback||null,this._pointer=thisp||null,this._now&&this.now.apply(this,this._arg)},now:gui.Combo.chained(function(){var c=this._callback,p=this._pointer;c?(this.then(null,null),c.apply(p,arguments)):(this._arg=arguments,this._now=!0)}),_callback:null,_pointer:null,_now:!1},gui.HTMLParser={toString:function(){return"[object gui.HTMLParser]"},parse:function(markup,targetdoc){return this.parseAll(markup,targetdoc)[0]||null},parseAll:function(markup,targetdoc){return this.parseToNodes(markup,targetdoc).filter(function(node){return node.nodeType===Node.ELEMENT_NODE})},parseToNode:function(markup,targetdoc){return this.parseToNodes(markup,targetdoc)[0]||null},parseToNodes:function(markup,targetdoc){var elm,doc=this._document||(this._document=document.implementation.createHTMLDocument(""));return gui.Guide.suspend(function(){return doc.body.innerHTML=this._unsanitize(markup),elm=doc.querySelector("."+this._classname)||doc.body,Array.map(elm.childNodes,function(node){return(targetdoc||document).importNode(node,!0)})},this)},parseToDocument:function(markup){return markup=markup||"",gui.Guide.suspend(function(){var doc=document.implementation.createHTMLDocument("");if(markup.toLowerCase().includes("<!doctype"))try{doc.documentElement.innerHTML=markup}catch(ie9exception){(doc=new ActiveXObject("htmlfile")).open(),doc.write(markup),doc.close()}else doc.body.innerHTML=markup;return doc})},_classname:"_gui-htmlparser",_comments:/<!--[\s\S]*?-->/g,_firsttag:/^<([a-z]+)/i,_document:null,_unsanitize:function(markup){var match,fix;return markup=markup.trim().replace(this._comments,""),(match=markup.match(this._firsttag))&&(fix=this._unsanestructures[match[1]])&&(markup=fix.replace("${class}",this._classname).replace("${markup}",markup)),markup},_unsanestructures:function(){var map={td:'<table><tbody><tr class="${class}">${markup}</tr></tbody></table>',tr:'<table><tbody class="${class}">${markup}</tbody></table>',tbody:'<table class="${class}">${markup}</table>',col:'<table><colgroup class="${class}">${markup}</colgroup></table>',option:'<select class="${class}"><option>a</option>${markup}</select>'};return map.th=map.td,["thead","tfoot","caption","colgroup"].forEach(function(tag){map[tag]=map.tbody}),map}()},gui.EventSummary=function(e){this._construct(e)},gui.EventSummary.prototype={event:null,window:null,document:null,documentspirit:null,toString:function(){return"[object gui.EventSummary]"},_construct:function(e){var win=null,doc=null,target=e.target,type=target.nodeType;gui.Type.isDefined(type)?win=(doc=type===Node.DOCUMENT_NODE?target:target.ownerDocument).defaultView:doc=(win=target).document,this.event=e,this.window=win,this.document=doc,this.documentspirit=doc.documentElement.spirit}},gui.Crawler=function(Type){return gui.Class.create(Object.prototype,{type:null,direction:null,global:!1,toString:function(){return"[object gui.Crawler]"},onconstruct:function(type){this.type=type||null},ascend:function(start,handler){this._stopped=!1,this.direction=gui.Crawler.ASCENDING;var win,elm=gui.hasModule("gui-spirits@wunderbyte.com")&&start instanceof gui.Spirit?start.element:start;do{if(elm.nodeType===Node.DOCUMENT_NODE&&(this.global&&(win=elm.defaultView).gui.hosted?win.gui.xhost?(elm=null,Type.isFunction(handler.transcend)&&handler.transcend(win.parent,win.gui.xhost,win.gui.$contextid)):elm=win.frameElement:elm=null),elm)switch(this._handleElement(elm,handler)){case gui.Crawler.STOP:elm=null;break;default:elm=elm.parentNode}}while(elm)},ascendGlobal:function(start,handler){this.global=!0,this.ascend(start,handler),this.global=!1},descend:function(start,handler,arg){this._stopped=!1,this.direction=gui.Crawler.DESCENDING;var elm=start instanceof gui.Spirit?start.element:start;elm.nodeType===Node.DOCUMENT_NODE&&(elm=elm.documentElement),this._descend(elm,handler,arg,!0)},descendGlobal:function(start,handler,arg){this.global=!0,this.descend(start,handler,arg),this.global=!1},_stopped:!1,_descend:function(elm,handler,arg,start){var next,spirit,directive=this._handleElement(elm,handler,arg);switch(directive){case gui.Crawler.STOP:this._stopped=!0;break;case gui.Crawler.CONTINUE:case gui.Crawler.SKIP_CHILDREN:directive!==gui.Crawler.SKIP_CHILDREN&&(elm.childElementCount?this._descend(elm.firstElementChild,handler,arg,!1):this.global&&"iframe"===elm.localName&&(spirit=elm.spirit)&&spirit instanceof gui.IframeSpirit&&Type.isFunction(handler.transcend)&&handler.transcend(spirit.contentWindow,spirit.xguest,spirit.$instanceid)),this._stopped||!start&&(next=elm.nextElementSibling)&&this._descend(next,handler,arg,!1)}},_handleElement:function(element,handler,arg){var spirit,hasspirit=gui.hasModule("gui-spirits@wunderbyte.com"),directive=gui.Crawler.CONTINUE;return handler&&(Type.isFunction(handler.handleElement)&&(directive=handler.handleElement(element,arg)),!directive&&hasspirit&&(spirit=gui.get(element))&&((directive=spirit.oncrawler(this))||Type.isFunction(handler.handleSpirit)&&(directive=this._handleSpirit(spirit,handler)))),directive||(directive=gui.Crawler.CONTINUE),directive},_handleSpirit:function(spirit,handler){return handler.handleSpirit(spirit)}},{},{ASCENDING:"ascending",DESCENDING:"descending",CONTINUE:0,STOP:1,SKIP:2,SKIP_CHILDREN:4})}(gui.Type),gui.Request=function(url,doc){doc=doc||document,this._headers={Accept:"application/json"},url&&this.url(url,doc)},gui.Request.prototype=function(chained){return{url:chained(function(url,doc){this._url=doc?new gui.URL(doc,url).href:url}),sync:chained(function(){this._async=!1}),async:chained(function(){this._async=!0}),accept:chained(function(mimetype){this._headers.Accept=mimetype}),acceptJSON:chained(function(){this.accept("application/json")}),acceptXML:chained(function(){this.accept("text/xml")}),acceptText:chained(function(){this.accept("text/plain")}),format:chained(function(mimetype){this._format=mimetype}),override:chained(function(doit){this._override=doit||!0}),headers:chained(function(headers){if(!gui.Type.isObject(headers))throw new TypeError("Object expected");gui.Object.each(headers,function(name,value){this._headers[name]=String(value)},this)}),_async:!0,_url:null,_format:"application/json",_override:!1,_headers:null,_request:function(method,payload,callback){var that=this,request=new XMLHttpRequest,xtarget=gui.URL.external(this._url,document);request.onreadystatechange=function(){if(this.readyState===XMLHttpRequest.DONE){var data=that._response(this.responseText);callback(this.status,data,this.responseText)}},this._override&&request.overrideMimeType(this._headers.Accept),request.open(method.toUpperCase(),this._url,!0),xtarget||gui.Object.each(this._headers,function(name,value){request.setRequestHeader(name,value,!1)}),request.send(payload)},_response:function(text){var result=text;try{switch(this._headers.Accept){case"application/json":result=JSON.parse(text);break;case"text/xml":result=(new DOMParser).parseFromString(text,"text/xml")}}catch(exception){gui.debug&&console.error(this._headers.Accept+" dysfunction at "+this._url)}return result}}}(gui.Combo.chained),["get","post","put","delete"].forEach(function(method){gui.Request.prototype[method]=function(payload){if(gui.Type.isFunction(payload))throw new Error("Deprecated: gui.Request returns a gui.Then");var then=new gui.Then;return payload="get"===method?null:payload,this._request(method,payload,function(status,data,text){then.now(status,data,text)}),then}}),gui.Client=function(){function supports(feature){var root=document.documentElement,fixt=feature[0].toUpperCase()+feature.substring(1);return!["","Webkit","Moz","O","ms"].every(function(prefix){return void 0===root.style[prefix?prefix+fixt:feature]})}var agent=navigator.userAgent.toLowerCase();return new function(){this.isExplorer=agent.includes("msie")||agent.includes("trident")||agent.includes("edge"),this.isExplorer9=this.isExplorer&&agent.includes("msie 9"),this.isExplorer10=this.isExplorer&&agent.includes("msie 10"),this.isExplorer11=this.isExplorer&&agent.includes("rv:11"),this.isExplorer12=this.isExplorer&&agent.includes("rv:12"),this.isEdge=this.isExplorer&&agent.includes("edge"),this.isWebKit=!this.isExplorer&&(agent.includes("webkit")||agent.includes("opera")),this.isChrome=!this.isExplorer&&this.isWebKit&&agent.includes("chrome"),this.isSafari=!this.isExplorer&&this.isWebKit&&!this.isChrome&&agent.includes("safari"),this.isGecko=!this.isExplorer&&!this.isWebKit&&!this.isOpera&&agent.includes("gecko"),this.isBlink=agent.includes("blink"),this.isChromeApp=!!(window.chrome&&window.chrome.app&&window.chrome.app.runtime),this.agent=function(){return this.isWebKit?"webkit":this.isGecko?"gecko":this.isOpera?"opera":"explorer"}.call(this),this.system=function(shortlist){var os=null;return["window mobile","windows","ipad","iphone","os x","linux","haiku","amiga"].every(function(test){return agent.includes(test)&&(os=test.match(/ipad|iphone/)?"ios":test.replace(/ /g,"")),null===os}),os}(),this.hasTouch=void 0!==window.ontouchstart||this.isChrome,this.hasPointers=!1,this.hasBlob=window.Blob&&(window.URL||window.webkitURL),this.hasHistory=!(!window.history||!window.history.pushState),this.isTouchDevice=["android","webos","iphone","ipad","ipod","blackberry","windows phone"].some(function(system){return agent.includes(system)}),this.hasTransitions=supports("transition"),this.hasTransforms=supports("transform"),this.hasAnimations=supports("animationName"),this.has3D=supports("perspective"),this.hasFlex=supports("flex"),this.hasProxies=window.Proxy&&window.Proxy.create,this.hasPerformance=window.performance&&window.performance.now,Object.defineProperty(this,"hasFlexBox",{get:function(){console.error("Depracated API is deprecated: hasFlexBox >> hasFlex")}}),this.hasAnimationFrame=function(){var win=window;return!!(win.requestAnimationFrame||win.webkitRequestAnimationFrame||win.mozRequestAnimationFrame||win.msRequestAnimationFrame||win.oRequestAnimationFrame)}(),this.hasTemplates="content"in document.createElement("template"),this.hasImports="import"in document.createElement("link"),this.hasMutations=!["","WebKit","Moz","O","Ms"].every(function(vendor){return!gui.Type.isDefined(window[vendor+"MutationObserver"])}),this.hasAttributesOnPrototype=function(Client_){if(Client_.isSafari||Client_.isEdge)return!1;if(Client_.isWebKit){var rex=/chrom(e|ium)\/([0-9]+)\./,raw=agent.match(rex),ver=raw?parseInt(raw[2],10):0;return!ver||ver>=44}return!0}(this),this.scrollRoot=null,this.scrollBarSize=0,this.hasPositionFixed=!1,this.hasPassiveEventListeners=function(){var supportsPassiveOption=!1;try{var opts=Object.defineProperty({},"passive",{get:function(){supportsPassiveOption=!0}});window.addEventListener("test",null,opts)}catch(e){}return supportsPassiveOption}(),this.$init=function(){if(gui.CSSPlugin){var win=window,doc=document,html=doc.documentElement,body=doc.body,root=null,temp=body.appendChild(gui.CSSPlugin.style(doc.createElement("div"),{position:"absolute",height:"10px",width:"10px",top:"100%"}));win.scrollBy(0,10),root=html.scrollTop?html:body,this.scrollRoot=root,gui.CSSPlugin.style(temp,{position:"fixed",top:"10px"});var has=10===temp.getBoundingClientRect().top;this.hasPositionFixed=has,body.removeChild(temp),win.scrollBy(0,-10);var inner=gui.CSSPlugin.style(document.createElement("p"),{width:"100%",height:"200px"}),outer=gui.CSSPlugin.style(document.createElement("div"),{position:"absolute",top:"0",left:"0",visibility:"hidden",width:"200px",height:"150px",overflow:"hidden"});outer.appendChild(inner),html.appendChild(outer);var w1=inner.offsetWidth;outer.style.overflow="scroll";var w2=inner.offsetWidth;w1===w2&&(w2=outer.clientWidth),html.removeChild(outer),this.scrollBarSize=w1-w2,this.scrollBarSize||this.isTouchDevice||("windows"===this.system?this.isEdge?this.scrollBarSize=12:this.scrollBarSize=17:"linux"===this.system&&this.isGecko?this.scrollBarSize=16:this.scrollBarSize=15)}}}}(),gui.MapList=function(confirmed,GuiArray){function MapList(Fit){this._map=Object.create(null),this._fit=Fit||null}return MapList.prototype={get:function(key){return this._map[key]},set:confirmed("string","array")(function(key,val){return this._map[key]=val,this._map[key]}),has:function(key){return void 0!==this._map[key]},delete:function(key){this._map[key]=null,delete this._map[key]},add:confirmed("string")(function(key,val){var list=this.get(key)||this.set(key,[]),puts=-1===list.indexOf(val);if(puts){if(this._fit&&!(val instanceof this._fit))throw new TypeError(val+" is not a "+this._fit);list.push(val)}return puts}),remove:confirmed("string")(function(key,val){var list=this.get(key);list&&0===GuiArray.remove(list,val)&&this.delete(key)}),each:function(callback,thisp){gui.Object.each(this._map,function(key,list){callback.call(thisp,key,list)})},_map:null,_fit:null},MapList}(gui.Arguments.confirmed,gui.Array),gui.module("gui@wunderbyte.com")}(self),function(window){"use strict";gui=gui.Object.extend(gui,{MODE_ROBOT:"robot",MODE_HUMAN:"human",MODE_FUNNY:"funny",BROADCAST_WILL_SPIRITUALIZE:"gui-broadcast-will-spiritualize",BROADCAST_DID_SPIRITUALIZE:"gui-broadcast-did-spiritualize",ACTION_DOC_ONSPIRITUALIZED:"gui-action-document-spiritualized",$ACTION_XFRAME_VISIBILITY:"gui-action-xframe-visibility",LIFE_CONSTRUCT:"gui-life-construct",LIFE_CONFIGURE:"gui-life-configure",LIFE_ENTER:"gui-life-enter",LIFE_ATTACH:"gui-life-attach",LIFE_READY:"gui-life-ready",LIFE_DETACH:"gui-life-detach",LIFE_EXIT:"gui-life-exit",LIFE_ASYNC:"gui-life-async",LIFE_DESTRUCT:"gui-life-destruct",LIFE_VISIBLE:"gui-life-visible",LIFE_INVISIBLE:"gui-life-invisible",LIFE_RENDER:"gui-life-render",LIFE_IFRAME_CONSTRUCT:"gui-life-iframe-construct",LIFE_IFRAME_DOMCONTENT:"gui-life-iframe-domcontent",LIFE_IFRAME_SPIRITUALIZED:"gui-life-iframe-spiritualized",LIFE_IFRAME_ONLOAD:"gui-life-iframe-onload",LIFE_IFRAME_ONHASH:"gui-life-iframe-onhash",LIFE_IFRAME_UNLOAD:"gui-life-iframe-unload",$TICK_INSIDE:"gui-tick-spirits-inside",$TICK_OUTSIDE:"gui-tick-spirits-outside",CRAWLER_SPIRITUALIZE:"gui-crawler-spiritualize",CRAWLER_MATERIALIZE:"gui-crawler-materialize",CRAWLER_DETACH:"gui-crawler-detach",CRAWLER_DISPOSE:"gui-crawler-dispose",CRAWLER_ACTION:"gui-crawler-action",CRAWLER_VISIBLE:"gui-crawler-visible",CRAWLER_INVISIBLE:"gui-crawler-invisible",CRAWLER_REFLEX:"gui-crawler-reflex",CLASS_NOSPIRITS:"gui-nospirits",CLASS_INVISIBLE:"_gui-invisible",CLASS_HIDDEN:"_gui-hidden",mode:"robot",autostrap:!0,bootstrapdelay:-1,spiritualizing:!1,spiritualized:!1,attributes:null,bootstrap:function(){function start(){gui.spiritualizing=!0,gui.Guide.$startGuiding(),gui.spiritualizing=!1,gui._nowready()}gui.bootstrap=function(){};var delay=gui.bootstrapdelay;gui.Client.$init(),delay>-1?setTimeout(start,delay):start()},spiritualize:function(target){gui.Guide.$spiritualize(target||document)},spiritualizeSub:function(target){gui.Guide.$spiritualizeSub(target||document)},spiritualizeOne:function(target){gui.Guide.$spiritualizeOne(target||document)},materialize:function(target,webkithack){gui.Guide.$materialize(target||document,webkithack)},materializeSub:function(target){gui.Guide.$materializeSub(target||document)},materializeOne:function(target){gui.Guide.$materializeOne(target||document)},suspend:function(operation){return gui.DOMObserver.suspend(function(){return gui.Guide.suspend(operation)})},get:function(arg,callback,thisp){var spirit;if(1===arguments.length){if(this.spiritualizing||this.spiritualized)spirit=this._getspirit(arg);else if(window.console&&console.warn&&console.error){var message=this._guigetmessage();"localhost"===location.hostname?console.error(message):console.warn(message)}}else{var elm=this._getelement(arg);this._getmanaged(elm,callback,thisp)}return spirit||null},getAll:function(arg){console.error("TODO: gui.getAll")},channel:function(){gui.Guide.$channel.apply(gui.Guide,arguments)},hasChannels:function(){return gui.Guide.$hasChannels()},getChannels:function(){return gui.Guide.$getChannels()},ready:function(action,thisp){var is=this.spiritualized;return arguments.length&&(is?action.call(thisp):(this._readycallbacks=this._readycallbacks||[],this._readycallbacks.push(function(){action.call(thisp)}))),is},$getnow:function(elm){var list=this._managedgetters;if(list.length){var entries=[];this._managedgetters=list.filter(function(entry){return entry[0]!==elm||(entries.push(entry),!1)}),entries.forEach(function(entry){var elm=entry[0],fun=entry[1],dat=entry[2];fun&&fun.call(dat,elm.spirit)})}},_readycallbacks:null,_managedgetters:[],_getmanaged:function(elm,callback,thisp){var list=this._managedgetters;elm&&(elm.spirit?callback.call(thisp,elm.spirit):list.push([elm,callback,thisp]))},_initialize:function(){return this.attributes=["gui"],gui.Broadcast.add(gui.BROADCAST_TODOM,{onbroadcast:function(){gui.autostrap&&gui.bootstrap()}}),this},_nowready:function(){this.spiritualized=!0;var list=this._readycallbacks;if(list){for(;list.length;)list.shift()();this._readycallbacks=null}},_getspirit:function(arg){if(gui.Type.isString(arg)&&gui.KeyMaster.isKey(arg))return gui.Guide.$getSpiritById(arg);var elm=this._getelement(arg);return elm?elm.spirit:null},_getelement:function(arg){var elm=null,doc=document;if(gui.Type.isString(arg)){arg=arg.trim();try{elm=arg.match(/[^a-zA-Z\d]/)?doc.querySelector(arg):doc.getElementById(arg)||doc.querySelector(arg)}catch(badselector){console.warn(badselector.message,arg)}}else gui.Type.isElement(arg)&&(elm=arg);return elm},_guigetmessage:function(){return["ts.ui.get() failed because we're not initialized just yet.","You can supply a callback function as the second argument","or you can wrap your existing code in ts.ui.ready(mycallback)."].join(" ")}}._initialize()),gui.ActionPlugin=function(confirmed,chained){return gui.TrackerPlugin.extend({type:null,data:null,add:confirmed("array|string","(object|function)")(chained(function(arg,handler){handler=handler||this.spirit,gui.Interface.validate(gui.Action.IActionHandler,handler)&&gui.Array.make(arg).forEach(function(type){this._addchecks(type,[handler,this._global])},this)})),remove:confirmed("array|string","(object|function)")(chained(function(arg,handler){handler=handler||this.spirit,gui.Interface.validate(gui.Action.IActionHandler,handler)&&gui.Array.make(arg).forEach(function(type){this._removechecks(type,[handler,this._global])},this)})),addGlobal:function(arg,handler){return this._globalize(function(){return this.add(arg,handler)})},removeGlobal:function(arg,handler){return this._globalize(function(){return this.remove(arg,handler)})},dispatch:confirmed("string","(*)")(function(type,data){return gui.Action.dispatch(this.spirit,type,data)}),ascend:confirmed("string","(*)")(function(type,data){return gui.Action.ascend(this.spirit,type,data)}),descend:confirmed("string","(*)")(function(type,data){return gui.Action.descend(this.spirit,type,data)}),dispatchGlobal:confirmed("string","(*)")(function(type,data){return gui.Action.dispatchGlobal(this.spirit,type,data)}),ascendGlobal:confirmed("string","(*)")(function(type,data){return gui.Action.ascendGlobal(this.spirit,type,data)}),descendGlobal:confirmed("string","(*)")(function(type,data){return gui.Action.descendGlobal(this.spirit,type,data)}),_cleanup:function(type,checks){var handler=checks[0];checks[1]?this.removeGlobal(type,handler):this.remove(type,handler)},$handleownaction:!1,$onaction:function(action){var list=this._trackedtypes[action.type];list&&list.forEach(function(checks){var handler=checks[0],matches=checks[1]===action.global,hacking=handler===this.spirit&&this.$handleownaction;matches&&(handler!==action.target||hacking)&&handler.onaction(action)},this)}})}(gui.Arguments.confirmed,gui.Combo.chained),gui.BroadcastPlugin=function(chained,confirmed){return gui.TrackerPlugin.extend({add:confirmed("string|array")(chained(function(arg,handler){handler=handler||this.spirit;var sig=this._global?null:this._sig;gui.Array.make(arg).forEach(function(type){this._addchecks(type,[handler,this._global])&&(this._global?gui.Broadcast.addGlobal(type,handler):gui.Broadcast.add(type,handler,sig))},this)})),remove:confirmed("string|array")(chained(function(arg,handler){handler=handler||this.spirit;var sig=this._global?null:this._sig;gui.Array.make(arg).forEach(function(type){this._removechecks(type,[handler,this._global])&&(this._global?gui.Broadcast.removeGlobal(type,handler):gui.Broadcast.remove(type,handler,sig))},this)})),dispatch:confirmed("string|array")(function(arg,data){var result=null,global=this._global,sig=global?null:this._sig;return this._global=!1,gui.Array.make(arg).forEach(function(type){gui.Broadcast.$target=this.spirit,result=global?gui.Broadcast.dispatchGlobal(type,data):gui.Broadcast.dispatch(type,data,sig)},this),result}),addGlobal:function(arg,handler){return this._globalize(function(){return this.add(arg,handler)})},removeGlobal:function(arg,handler){return this._globalize(function(){return this.remove(arg,handler)})},shiftGlobal:function(on,arg,handler){return this._globalize(function(){return this.shift(on,arg,handler)})},dispatchGlobal:function(arg,data){return this._globalize(function(){return this.dispatch(arg,data)})},_cleanup:function(type,checks){var handler=checks[0];checks[1]?gui.Broadcast.removeGlobal(type,handler):gui.Broadcast.remove(type,handler,this._sig)}})}(gui.Combo.chained,gui.Arguments.confirmed),gui.TickPlugin=function(chained,guiArray){return gui.TrackerPlugin.extend({onconstruct:function(){gui.TrackerPlugin.prototype.onconstruct.call(this),this._timeouts=[]},ondestruct:function(){gui.TrackerPlugin.prototype.ondestruct.call(this),this._timeouts.forEach(function(id){gui.Tick.cancelTime(id)})},add:chained(function(types,handler,one){this.spirit.$destructed||(handler=handler||this.spirit,gui.Interface.validate(gui.ITickHandler,handler)&&guiArray.make(types).forEach(function(type){this._addchecks(type,[handler,this._global])&&this._add(type,handler,!1)},this))}),remove:chained(function(types,handler){handler=handler||this.spirit,gui.Interface.validate(gui.ITickHandler,handler)&&guiArray.make(types).forEach(function(type){this._removechecks(type,[handler,this._global])&&this._remove(type,handler)},this)}),one:chained(function(types,handler){this.add(types,handler,!0)}),next:chained(function(action,thisp){gui.Tick.next(action,thisp||this.spirit)}),nextFrame:function(action,thisp){return gui.Tick.nextFrame(action,thisp||this.spirit)},cancelFrame:chained(function(n){gui.Tick.cancelFrame(n)}),time:function(action,time,thisp){var id=gui.Tick.time(action,time,thisp||this.spirit);return this._timeouts.push(id),id},cancelTime:chained(function(n){gui.Tick.cancelTime(n)}),addStart:chained(function(type,time,handler,one){gui.Tick.add(type,handler,one).start(type,time)}),start:chained(function(type,time){gui.Tick.start(type,time)}),stop:chained(function(type){gui.Tick.stop(type)}),dispatch:function(type,time){return this._dispatch(type,time||0)},_global:!1,_timeouts:null,_add:function(type,handler,one){var sig=this.spirit.$contextid;one?this._global?gui.Tick.oneGlobal(type,handler):gui.Tick.one(type,handler,sig):this._global?gui.Tick.addGlobal(type,handler):gui.Tick.add(type,handler,sig)},_remove:function(type,handler){var sig=this.spirit.$contextid;this._global?gui.Tick.removeGlobal(type,handler):gui.Tick.remove(type,handler,sig)},_dispatch:function(type,time){var sig=this.spirit.$contextid;return this._global?gui.Tick.dispatchGlobal(type,time):gui.Tick.dispatch(type,time,sig)},_cleanup:function(type,checks){var handler=checks[0],bglobal=checks[1];this._remove(type,[handler])&&(bglobal?gui.Tick.removeGlobal(type,handler):gui.Tick.remove(type,handler,this.$contextid))}})}(gui.Combo.chained,gui.Array),gui.ITickHandler={toString:function(){return"[object ITickHandler]"},ontick:function(tick){}},gui.Life=function(target,type){this.target=target,this.type=type},gui.Life.prototype={target:null,type:null,toString:function(){return"[object gui.Life]"}},gui.LifePlugin=gui.TrackerPlugin.extend({constructed:!1,configured:!1,entered:!1,attached:!1,detached:!0,ready:!1,async:!1,exited:!1,destructed:!1,visible:void 0,rendered:!1,plugins:null,onconstruct:function(){gui.TrackerPlugin.prototype.onconstruct.call(this),this._handlers=Object.create(null),this.plugins=Object.create(null)},add:function(arg,handler){return handler=handler||this.spirit,gui.Array.make(arg).forEach(function(type){this._addchecks(type,[handler])&&(this._handlers[type]||(this._handlers[type]=[]),this._handlers[type].push(handler))},this),this.spirit},remove:function(arg,handler){return handler=handler||this.spirit,gui.Array.make(arg).forEach(function(type){if(this._removechecks(type,[handler])&&this._handlers[type]){var index=this._handlers[type].indexOf(type);gui.Array.remove(this._handlers[type],index),0===this._handlers[type].length&&delete this._handlers[type]}},this),this.spirit},dispatch:function(type){var list=this._handlers[type];if(list){var life=new gui.Life(this.spirit,type);switch(list.forEach(function(handler){handler.onlife(life)}),type){case gui.LIFE_CONSTRUCT:case gui.LIFE_CONFIGURE:case gui.LIFE_ENTER:case gui.LIFE_READY:case gui.LIFE_DETACH:case gui.LIFE_EXIT:case gui.LIFE_DESTRUCT:delete this._handlers[type]}}},_handlers:null,_cleanup:function(type,checks){var handler=checks[0];this.remove(type,handler)}}),gui.ConfigPlugin=gui.Plugin.extend({configureall:function(){var atts=this.spirit.element.attributes;Array.forEach(atts,function(att){this.configureone(att.name,att.value)},this)},onlife:function(l){var update;if(l.type===gui.LIFE_READY)for(;update=this._onready.shift();)update.action()},configureone:function(name,value){var hit,gux=this.spirit.window.gui,dot=gui.ConfigPlugin.SEPARATOR;gux.attributes.every(function(fix){return(hit=name.startsWith(fix+dot))&&this._evaluate(name,value,fix,dot),!hit},this)},_onready:null,_evaluate:function(name,value,fix,dot){var struct=this.spirit,success=!0,prop=null,cuts=null;(name=prop=name.split(fix+dot)[1]).indexOf(dot)>-1&&(cuts=name.split(dot)).forEach(function(cut,i){gui.Type.isDefined(struct)?i<cuts.length-1?struct=struct[cut]:prop=cut:success=!1}),success&&gui.Type.isDefined(struct[prop])?this._schedule(struct,prop,this._revaluate(value)):console.error('No definition for "'+name+'" in '+this.spirit.toString())},_schedule:function(struct,prop,value){gui.Type.isFunction(struct[prop])?this.spirit.life.ready?struct[prop](value):(this.spirit.life.add(gui.LIFE_READY,this),this._onready?this._onready.reduce(function(x,o,i){return o.struct===struct&&o.prop===prop?i:x},-1):this._onready=[],this._onready.push({struct:struct,prop:prop,action:function(){struct[prop](value)}})):struct[prop]=value},_revaluate:function(value){return gui.Type.isString(value)&&(gui.hasModule("edbml@wunderbyte.com")&&value.startsWith("edbml.$get")?value=window.edbml.$get(gui.KeyMaster.extractKey(value)[0]):(value=gui.Type.cast(value),gui.Type.isString(value)&&(value=gui.ConfigPlugin.jsonvaluate(value)))),value}},{lazy:!1,SEPARATOR:".",jsonify:function(div){return function(json){return div.setAttribute("onclick","this.json = "+json),div.click(),div.json}}(document.createElement("div")),jsonvaluate:function(value){return[["%5B","%5D"],["%7B","%7D"]].some(function(tokens){return value.startsWith(tokens[0])&&value.endsWith(tokens[1])})&&(value=decodeURIComponent(value),value=gui.ConfigPlugin.jsonify(value)),value}}),gui.Att=function(name,value){this.value=gui.Type.cast(value),this.name=this.type=name},gui.Att.prototype={name:null,type:null,value:null},gui.AttPlugin=function(confirmed,chained,Client){return gui.TrackerPlugin.extend({get:function(name){return gui.AttPlugin.get(this.spirit.element,name)},set:chained(function(name,value){this.$suspended||gui.AttPlugin.set(this.spirit.element,name,value)}),has:function(name){return gui.AttPlugin.has(this.spirit.element,name)},del:chained(function(name){this.$suspended||gui.AttPlugin.del(this.spirit.element,name)}),all:function(){return gui.AttPlugin.all(this.spirit.element)},shift:confirmed("boolean","string")(chained(function(on,name,value){if(on){if(void 0===value)throw new TypeError('Missing value for "'+name+'"');this.set(name,value)}else this.del(name)})),getmap:function(){return gui.AttPlugin.getmap(this.spirit.element)},setmap:function(map){gui.AttPlugin.setmap(this.spirit.element,map)},add:confirmed("array|string","(object|function)")(chained(function(arg,handler){handler=handler||this.spirit,gui.Interface.validate(gui.IAttHandler,handler)&&gui.Array.make(arg).forEach(function(type){this._addchecks(type,[handler])&&(this._onadd(type),"class"===type&&Client.isExplorer9&&this.spirit.element.addEventListener("DOMAttrModified",this))},this)})),remove:confirmed("array|string","(object|function)")(chained(function(arg,handler){handler=handler||this.spirit,gui.Interface.validate(gui.IAttHandler,handler)&&gui.Array.make(arg).forEach(function(type){this._removechecks(type,[handler])&&"class"===type&&Client.isExplorer9&&this.spirit.element.removeEventListener("DOMAttrModified",this)},this)})),handleEvent:function(e){"DOMAttrModified"===e.type&&"class"===e.attrName&&this.$onatt("class",e.newValue)},_cleanup:function(type,checks){gui.TrackerPlugin.prototype._cleanup.call(this,type,checks),"class"===type&&Client.isExplorer9&&this.spirit.element.removeEventListener("DOMAttrModified",this)},$suspended:!1,$suspend:function(action){this.$suspended=!0;var res=action();return this.$suspended=!1,res},$onatt:function(name,value){var list,att,handler,trigger;!!gui.attributes.every(function(prefix){return(trigger=name.startsWith(prefix))&&this.spirit.config.configureone(name,value),!trigger},this)&&(list=this._trackedtypes[name])&&(att=new gui.Att(name,value),list.forEach(function(checks){(handler=checks[0]).onatt(att)},this))},_onadd:function(name){if(this.has(name)){var value=this.get(name);name.startsWith(gui.ConfigPlugin.PREFIX)?this.spirit.config.configureone(name,value):this.$onatt(name,value)}}},{},{get:function(elm,name){switch(name){case"disabled":case"readonly":case"required":case"autofocus":return elm.spirit.att.has(elm,name)}return gui.Type.cast(elm.getAttribute(name))},set:chained(function(elm,name,value,$hotfix){var spirit=elm.spirit,change=!1;this._ischecked(elm,name)?(change=elm.checked!==value,elm.checked="false"!==String(value)&&null!==value,change&&spirit.att.$onatt(name,value)):this._isvalue(elm,name)?(change=elm.value!==String(value))&&(elm.value=String(value),spirit.att.$onatt(name,value)):"required"===name?elm.required=!!value:"readonly"===name?elm.readOnly=!!value:"disabled"===name?elm.disabled=!!value:"autofocus"===name?elm.autofocus=!!value:null===value?this.del(elm,name):(value=String(value),elm.getAttribute(name)!==value&&(spirit?(spirit.att.$suspend(function(){elm.setAttribute(name,value)}),spirit.att.$onatt(name,value)):elm.setAttribute(name,value)))}),_ischecked:function(elm,name){return elm.type&&void 0!==elm.checked&&"checked"===name},_isvalue:function(elm,name){return void 0!==elm.value&&"value"===name},has:function(elm,name){return elm.hasAttribute(name)},del:chained(function(elm,name){var spirit=elm.spirit;this._ischecked(elm,name)?elm.checked=!1:this._isvalue(elm,name)?elm.value="":spirit?(spirit.att.$suspend(function(){elm.removeAttribute(name)}),spirit.config.configureone(name,null)||spirit.att.$onatt(name,null)):elm.removeAttribute(name)}),all:function(elm){return gui.Array.from(elm.attributes)},getmap:function(elm){var map=Object.create(null);return this.all(elm).forEach(function(att){map[att.name]=gui.Type.cast(att.value)}),map},setmap:chained(function(elm,map){gui.Object.each(map,function(name,value){this.set(elm,name,value)},this)})})}(gui.Arguments.confirmed,gui.Combo.chained,gui.Client),gui.IAttHandler={toString:function(){return"[object IAttHandler]"},onatt:function(att){}},gui.BoxPlugin=gui.Plugin.extend({width:0,height:0,localX:0,localY:0,pageX:0,pageY:0,clientX:0,clientY:0,_scrollroot:function(){return function(doc){return"html"===gui.Client.scrollRoot.localName?doc.documentElement:doc.body}(this.spirit.document)}}),Object.defineProperties(gui.BoxPlugin.prototype,{width:{get:function(){return this.spirit.element.offsetWidth}},height:{get:function(){return this.spirit.element.offsetHeight}},localX:{get:function(){return this.spirit.element.offsetLeft}},localY:{get:function(){return this.spirit.element.offsetTop}},pageX:{get:function(){return this.clientX+this._scrollroot().scrollLeft}},pageY:{get:function(){return this.clientY+this._scrollroot().scrollTop}},clientX:{get:function(){return this.spirit.element.getBoundingClientRect().left}},clientY:{get:function(){return this.spirit.element.getBoundingClientRect().top}}}),gui.CSSPlugin=function(chained,confirmed){return gui.Plugin.extend({add:confirmed("string|array")(chained(function(name){var elm=this.spirit.element;gui.Array.make(name).forEach(function(n){gui.CSSPlugin.add(elm,n)})})),remove:confirmed("string|array")(chained(function(name){var elm=this.spirit.element;gui.Array.make(name).forEach(function(n){gui.CSSPlugin.remove(elm,n)})})),toggle:confirmed("string|array")(chained(function(name){var elm=this.spirit.element;gui.Array.make(name).forEach(function(n){gui.CSSPlugin.toggle(elm,n)})})),shift:confirmed("*","string|array")(chained(function(on,name){var elm=this.spirit.element;gui.Array.make(name).forEach(function(n){gui.CSSPlugin.shift(elm,on,n)})})),contains:confirmed("string")(function(name){return gui.CSSPlugin.contains(this.spirit.element,name)}),set:chained(function(prop,val){gui.CSSPlugin.set(this.spirit.element,prop,val)}),style:chained(function(map){gui.CSSPlugin.style(this.spirit.element,map)}),get:function(prop){return gui.CSSPlugin.get(this.spirit.element,prop)},compute:function(prop){return gui.CSSPlugin.compute(this.spirit.element,prop)},name:chained(function(name){var result=this.spirit.element.className;return void 0!==name&&(this.spirit.element.className=name,result=this.spirit),result}),matches:function(selector){return gui.CSSPlugin.matches(this.spirit.element,selector)}},{},{add:chained(function(element,name){if(gui.Type.isString(name))if(name.indexOf(" ")>-1&&(name=name.split(" ")),gui.Type.isArray(name))name.forEach(function(n){this.add(element,n)},this);else if(this._supports)element.classList.contains(name)||element.classList.add(name);else{var now=element.className.split(" ");-1===now.indexOf(name)&&(now.push(name),element.className=now.join(" "))}}),remove:chained(function(element,name){if(gui.Type.isString(name))if((name=name||"").indexOf(" ")>-1&&(name=name.split(" ")),gui.Type.isArray(name))name.forEach(function(n){this.remove(element,n)},this);else if(this._supports)element.classList.remove(name);else{var now=element.className.split(" "),idx=now.indexOf(name);idx>-1&&gui.Array.remove(now,idx),element.className=now.join(" ")}}),toggle:chained(function(element,name){gui.Type.isString(name)&&(this._supports?element.classList.toggle(name):this.contains(element,name)?this.remove(element,name):this.add(element,name))}),shift:chained(function(element,on,name){on?this.add(element,name):this.remove(element,name)}),contains:function(element,name){return this._supports?element.classList.contains(name):element.className.split(" ").indexOf(name)>-1},set:chained(function(element,prop,value){value=this._shorthand(prop,value),"float"===prop?prop="cssFloat":(value=this._jsvalue(value),prop=this._jsproperty(prop)),element.style[prop]=value}),get:function(element,prop){return prop=this._jsproperty(prop),this._jsvalue(element.style[prop])},style:function(thing,styles){var element=thing instanceof gui.Spirit?thing.element:thing;return gui.Object.each(styles,function(prop,value){this.set(element,prop,value)},this),thing},compute:function(thing,prop){var element=thing instanceof gui.Spirit?thing.element:thing;return prop=this._standardcase(this._jsproperty(prop)),window.getComputedStyle(element,null).getPropertyValue(prop)},matches:function(node,selector){var matches=!1;try{matches=node[this._matchmethod](selector)}catch(dysfunction){throw console.error('Invalid selector: "'+selector+'"'),dysfunction}return matches},_vendors:["","-webkit-","-moz-","-ms-","-o-"],_supports:void 0!==document.documentElement.classList,_shorthand:function(prop,value){var short;switch(gui.Type.of(value)){case"number":(short=this._numbershorthands[prop])&&(value=short.replace("@",value));break;case"string":(short=this._stringshorthands[prop])&&(value=short.replace("@",value))}return String(value)},_camelcase:function(string){return string.replace(/-([a-z])/gi,function(all,letter){return letter.toUpperCase()})},_standardcase:function(string){return string.replace(/[A-Z]/g,function(all,letter){return"-"+string.charAt(letter).toLowerCase()})},_jsproperty:function(prop){var vendors=this._vendors,fixt=prop,element=document.documentElement;return(prop=String(prop)).startsWith("-beta-")?vendors.every(function(vendor){var test=this._camelcase(prop.replace("-beta-",vendor));return void 0===element.style[test]||(fixt=test,!1)},this):fixt=this._camelcase(fixt),fixt},_jsvalue:function(value){var vendors=this._vendors,element=document.documentElement;if((value=String(value))&&value.includes("-beta-")){var parts=[];value.split(", ").forEach(function(part){(part=part.trim()).startsWith("-beta-")?vendors.every(function(vendor){var test=this._camelcase(part.replace("-beta-",vendor));return void 0===element.style[test]||(parts.push(part.replace("-beta-",vendor)),!1)},this):parts.push(part)},this),value=parts.join(",")}return value},_cssproperty:function(prop){return this._standardcase(this._jsproperty(prop))},_cssvalue:function(value){return this._standardcase(this._jsvalue(value))},_numbershorthands:{top:"@px",right:"@px",bottom:"@px",left:"@px",width:"@px",height:"@px",maxWidth:"@px",maxHeight:"@px",minWidth:"@px",minHeight:"@px",textIndent:"@px",margin:"@px",marginTop:"@px",marginRight:"@px",marginBottom:"@px",marginLeft:"@px",padding:"@px",paddingTop:"@px",paddingRight:"@px",paddingBottom:"@px",paddingLeft:"@px",fontWeight:"@",opacity:"@",zIndex:"@"},_stringshorthands:{backgroundImage:'url("@")',position:"@",display:"@",visibility:"@"},_matchmethod:function(){var match=null,root=document.documentElement;return["mozMatchesSelector","webkitMatchesSelector","msMatchesSelector","oMatchesSelector","matchesSelector"].every(function(method){return gui.Type.isDefined(root[method])&&(match=method),null===match}),match}()})}(gui.Combo.chained,gui.Arguments.confirmed),function(Plugin){function getset(prop){Object.defineProperty(Plugin.prototype,prop,{enumerable:!0,configurable:!0,get:function(){if(this.spirit)return parseInt(this.get(prop),10)},set:function(val){this.set(prop,val)}})}[Plugin._numbershorthands,Plugin._stringshorthands].forEach(function(shorts){for(var prop in shorts)shorts.hasOwnProperty(prop)&&getset(prop)})}(gui.CSSPlugin),gui.DOMPlugin=function(chained,guide,observer){return gui.Plugin.extend({id:chained(function(id){if(!id)return this.spirit.element.id||null;this.spirit.element.id=id}),title:chained(function(title){var element=this.spirit.element;if(!gui.Type.isDefined(title))return element.title;element.title=title||""}),html:chained(function(html,position){return gui.DOMPlugin.html(this.spirit.element,html,position)}),outerHtml:chained(function(html){return gui.DOMPlugin.outerHtml(this.spirit.element,html)}),text:chained(function(text){return gui.DOMPlugin.text(this.spirit.element,text)}),empty:chained(function(){this.html("")}),hide:chained(function(){this.spirit.css.contains(gui.CLASS_HIDDEN)||(this.spirit.css.add(gui.CLASS_HIDDEN),gui.hasModule("gui-layout@wunderbyte.com")&&this.spirit.visibility&&this.spirit.visibility.off())}),show:chained(function(){this.spirit.css.contains(gui.CLASS_HIDDEN)&&(this.spirit.css.remove(gui.CLASS_HIDDEN),gui.hasModule("gui-layout@wunderbyte.com")&&this.spirit.visibility&&this.spirit.visibility.on())}),tag:function(){return this.spirit.element.localName},embedded:function(){return gui.DOMPlugin.embedded(this.spirit.element)},remove:function(){var parent=this.spirit.element.parentNode;parent&&parent.removeChild(this.spirit.element)},clone:function(){return this.spirit.element.cloneNode(!0)},ordinal:function(){return gui.DOMPlugin.ordinal(this.spirit.element)},compare:function(other){return gui.DOMPlugin.compare(this.spirit.element,other)},contains:function(other){return gui.DOMPlugin.contains(this.spirit.element,other)},containedBy:function(other){return gui.DOMPlugin.contains(other,this.spirit.element)},parseToNode:function(html){return gui.DOMPlugin.parseToNode(html)},parseToNodes:function(html){return gui.DOMPlugin.parseToNodes(html)}},{},{html:function(elm,html,pos){return gui.Type.isString(html)?pos?elm.insertAdjacentHTML(pos,html):void(gui.mode===gui.MODE_ROBOT?(gui.materializeSub(elm),gui.suspend(function(){elm.innerHTML=html}),gui.spiritualizeSub(elm)):elm.innerHTML=html):elm.innerHTML},outerHtml:function(elm,html){if(!gui.Type.isString(html))return elm.outerHTML;gui.mode===gui.MODE_ROBOT?(gui.materialize(elm),gui.suspend(function(){elm.outerHTML=html}),gui.spiritualize(elm)):elm.outerHTML=html},text:function(elm,text){var guide_=gui.Guide;if(!gui.Type.isString(text))return elm.textContent;gui.mode===gui.MODE_ROBOT?(guide_.materializeSub(elm),gui.suspend(function(){elm.textContent=text})):elm.textContent=text},ordinal:function(element){var result=0,parent=element.parentNode;if(parent)for(var node=parent.firstElementChild;node&&node!==element;)node=node.nextElementSibling,result++;return result},compare:function(node1,node2){return node1=node1 instanceof gui.Spirit?node1.element:node1,node2=node2 instanceof gui.Spirit?node2.element:node2,node1.compareDocumentPosition(node2)},contains:function(node,othernode){var check=Node.DOCUMENT_POSITION_CONTAINS+Node.DOCUMENT_POSITION_PRECEDING;return this.compare(othernode,node)===check},follows:function(node,othernode){return this.compare(othernode,node)===Node.DOCUMENT_POSITION_FOLLOWING},precedes:function(node,othernode){return this.compare(othernode,node)===Node.DOCUMENT_POSITION_PRECEDING},embedded:function(node){return node=node instanceof gui.Spirit?node.element:node,this.contains(node.ownerDocument,node)},group:function(nodes){for(var node,groups=[];node=nodes.pop();)(function(target,others){return others.some(function(other){return gui.DOMPlugin.contains(other,target)})})(node,nodes)||groups.push(node);return groups},q:function(node,selector,type){var result=null;return this._qualify(node,selector)(function(node_,selector_){if(type)result=this.qall(node_,selector_,type)[0]||null;else try{result=node_.querySelector(selector_)}catch(exception){throw console.error("Dysfunctional selector: "+selector_),exception}return result})},qall:function(node,selector,type){var result=[];return this._qualify(node,selector)(function(node_,selector_){return result=gui.Array.from(node_.querySelectorAll(selector_)),type&&(result=result.filter(function(el){return el.spirit&&el.spirit instanceof type}).map(function(el){return el.spirit})),result})},qdoc:function(selector,type){return this.q(document,selector,type)},qdocall:function(selector,type){return this.qall(document,selector,type)},_qualify:function(node,selector,action){var id,hadid=!0,orig=node,regexp=this._thiskeyword;return node.nodeType===Node.ELEMENT_NODE&&regexp.test(selector)&&(hadid=node.id,id=node.id=node.id||gui.KeyMaster.generateKey(),selector=selector.replace(regexp,"#"+id),node=node.ownerDocument),function(action_){var res=action_.call(gui.DOMPlugin,node,selector);return orig&&!hadid&&(orig.id=""),res}},_thiskeyword:/^this|,this/g})}(gui.Combo.chained,gui.Guide,gui.DOMObserver),gui.Object.bindall(gui.DOMPlugin),gui.DOMPlugin.mixin(gui.Object.map({q:function(selector,type){return gui.DOMPlugin.q(this.spirit.element,selector,type)},qall:function(selector,type){return gui.DOMPlugin.qall(this.spirit.element,selector,type)},qdoc:function(selector,type){return gui.DOMPlugin.qdoc(selector,type)},qdocall:function(selector,type){return gui.DOMPlugin.qdocall(selector,type)}},function(name,base){return function(){var selector=arguments[0],type=arguments[1];if(gui.Type.isString(selector)){if(1===arguments.length||gui.Type.isFunction(type))return base.apply(this,arguments);throw type=gui.Type.of(type),new TypeError("Unknown spirit for query: "+name+"("+selector+","+type+")")}throw new TypeError("Bad selector for query: "+name+"("+selector+")")}})),gui.DOMPlugin.mixin(gui.Object.map({next:function(type){var result=null,spirit=null,el=this.spirit.element;if(type){for(;null!==(el=el.nextElementSibling);)if(null!==(spirit=el.spirit)&&spirit instanceof type){result=spirit;break}}else result=el.nextElementSibling;return result},previous:function(type){var result=null,spirit=null,el=this.spirit.element;if(type){for(;null!==(el=el.previousElementSibling);)if(null!==(spirit=el.spirit)&&spirit instanceof type){result=spirit;break}}else result=el.previousElementSibling;return result},first:function(type){var result=null,spirit=null,el=this.spirit.element.firstElementChild;if(type)for(;null===result&&null!==el;)null!==(spirit=el.spirit)&&spirit instanceof type&&(result=spirit),el=el.nextElementSibling;else result=el;return result},last:function(type){var result=null,spirit=null,el=this.spirit.element.lastElementChild;if(type)for(;null===result&&null!==el;)null!==(spirit=el.spirit)&&spirit instanceof type&&(result=spirit),el=el.previoustElementSibling;else result=el;return result},parent:function(type){var result=this.spirit.element.parentNode;if(result&&type){var spirit=result.spirit;result=spirit&&spirit instanceof type?spirit:null}return result},child:function(type){var result=this.spirit.element.firstElementChild;return result&&type&&(result=this.children(type)[0]||null),result},children:function(type){var result=gui.Array.from(this.spirit.element.children);return type&&(result=result.filter(function(elm){return elm.spirit&&elm.spirit instanceof type}).map(function(elm){return elm.spirit})),result},ancestor:function(type){var result=this.parent();return type&&(result=null,(new gui.Crawler).ascend(this.parent(),{handleSpirit:function(spirit){if(spirit instanceof type)return result=spirit,gui.Crawler.STOP}})),result},ancestors:function(type){var result=[],crawler=new gui.Crawler;return type?crawler.ascend(this.parent(),{handleSpirit:function(spirit){spirit instanceof type&&result.push(spirit)}}):crawler.ascend(this.parent(),{handleElement:function(el){result.push(el)}}),result},descendant:function(type){var result=this.child(),me=this.spirit.element;return type&&(new gui.Crawler).descend(me,{handleSpirit:function(spirit){if(spirit instanceof type&&spirit.element!==me)return result=spirit,gui.Crawler.STOP}}),result},descendants:function(type){var result=[],me=this.spirit.element;return(new gui.Crawler).descend(me,{handleElement:function(element){type||element===me||result.push(element)},handleSpirit:function(spirit){type&&spirit instanceof type&&spirit.element!==me&&result.push(spirit)}}),result},following:function(type){for(var spirit,result=[],el=this.spirit.element;el=el.nextElementSibling;)type?(spirit=el.spirit)&&spirit instanceof type&&result.push(spirit):result.push(el);return result},preceding:function(type){for(var spirit,result=[],el=this.spirit.element;el=el.previousElementSibling;)type?(spirit=el.spirit)&&spirit instanceof type&&result.push(spirit):result.push(el);return result},siblings:function(type){return this.preceding(type).concat(this.following(type))}},function(name,base){return function(Type){if(!gui.Type.isDefined(Type)||gui.Type.isFunction(Type))return base.apply(this,arguments);throw new TypeError("Unknown spirit for query: "+name+"("+gui.Type.of(Type)+")")}})),gui.DOMPlugin.mixin({appendTo:function(thing){var elm=this.spirit.element;return gui.Type.isSpirit(thing)?thing.dom.append(elm):gui.Type.isElement(thing)&&thing.appendChild(elm),this},insertBefore:function(thing){var elm=this.spirit.element;return gui.Type.isSpirit(thing)?thing.dom.before(elm):gui.Type.isElement(thing)&&thing.parentNode.insertBefore(elm,thing),this},insertAfter:function(thing){var elm=this.spirit.element;return gui.Type.isSpirit(thing)?thing.dom.after(elm):gui.Type.isElement(thing)&&thing.parentNode.insertBefore(elm.nextSibling,thing),this},parseToNode:function(html,targetdoc){return gui.HTMLParser.parseToNode(html,targetdoc)},parseToNodes:function(html,targetdoc){return gui.HTMLParser.parseToNodes(html,targetdoc)}}),gui.DOMPlugin.mixin(gui.Object.map({append:function(things){var els=things,element=this.spirit.element;els.forEach(function(el){element.appendChild(el)})},prepend:function(things){var els=things,element=this.spirit.element,first=element.firstChild;els.reverse().forEach(function(el){element.insertBefore(el,first)})},before:function(things){var els=things,target=this.spirit.element,parent=target.parentNode;els.reverse().forEach(function(el){parent.insertBefore(el,target)})},after:function(things){var els=things,target=this.spirit.element,parent=target.parentNode;els.forEach(function(el){parent.insertBefore(el,target.nextSibling)})},replace:function(things){this.after(things),this.remove()}},function(name,base){return function(things){var elms=Array.map(gui.Array.make(things),function(thing){return thing&&thing instanceof gui.Spirit?thing.element:thing}).filter(function(thing){return thing&&gui.Type.isNumber(thing.nodeType)});return elms.length&&base.call(this,elms),things}})),gui.EventPlugin=function(chained,guiArray,DOMPlugin,Interface,Type){return gui.TrackerPlugin.extend({add:chained(function(arg,target,handler,capture){if(!(target=this._getelementtarget(target)).nodeType&&!Type.isWindow(target))throw new TypeError("Invalid target: "+target+" ("+this.spirit.$classname+")");if(handler=handler||this.spirit,capture=capture||!1,Interface.validate(gui.IEventHandler,handler)){var checks=[target,handler,capture];this._breakdown(arg).forEach(function(type){this._addchecks(type,checks)&&this._shiftEventListener(!0,target,type,handler,capture)},this)}}),remove:chained(function(arg,target,handler,capture){if(!(target=this._getelementtarget(target)).nodeType&&!Type.isWindow(target))throw new TypeError("Invalid target: "+target+" ("+this.spirit.$classname+")");if(handler=handler||this.spirit,capture=capture||!1,Interface.validate(gui.IEventHandler,handler)){var checks=[target,handler,capture];this._breakdown(arg).forEach(function(type){this._removechecks(type,checks)&&this._shiftEventListener(!1,target,type,handler,capture)},this)}}),toggle:chained(function(arg,target,handler,capture){target=this._getelementtarget(target),handler=handler||this.spirit,capture=capture||!1,target instanceof gui.Spirit&&(target=target.element);var checks=[target,handler,capture];guiArray.make(arg).forEach(function(type){this._contains(type,checks)?this.add(type,target,handler,capture):this.remove(type,target,handler,capture)},this)}),dispatch:function(type,params){var elm=this.spirit.element,evt=null;return window.CustomEvent&&!gui.Client.isExplorer?evt=new CustomEvent(type,params):(params=params||{bubbles:!1,cancelable:!1,detail:void 0},(evt=document.createEvent("HTMLEvents")).initEvent(type,params.bubbles,params.cancelable)),evt.eventName=type,elm.dispatchEvent?elm.dispatchEvent(evt):elm[type]?elm[type]():elm["on"+type]?elm["on"+type]():void 0},handleEvent:function(e){var related=e.relatedTarget,element=this.spirit.element,inorout=related&&related!==element&&!DOMPlugin.contains(element,related);switch(e.type){case"mouseover":inorout&&this._mouseenter&&this.spirit.onevent(this._getfakeevent(e,"mouseenter"));break;case"mouseout":inorout&&this._mouseleave&&this.spirit.onevent(this._getfakeevent(e,"mouseleave"))}},_mouseenter:!1,_mouseleave:!1,_shiftEventListener:function(add,target,type,handler,capture){target[add?"addEventListener":"removeEventListener"](type,handler,capture)},_enterleavetype:function(add,type,handler){if(handler!==this.spirit)throw new TypeError(type+" not (yet) supported on "+handler);switch(type){case"mouseenter":return this._mouseenter=add,"mouseover";case"mouseleave":return this._mouseleave=add,"mouseout"}},_getelementtarget:function(target){return(target=target||this.spirit.element)instanceof gui.Spirit?target.element:target},_getfakeevent:function(realevent,newtype){var prop,fakeevent=Object.create(null);for(prop in realevent){switch(prop){case"webkitMovementX":case"webkitMovementY":break;default:fakeevent[prop]=realevent[prop]}fakeevent.type=newtype}return fakeevent},_cleanup:function(type,checks){var target=checks[0],handler=checks[1],capture=checks[2];this.remove(type,target,handler,capture)},_breakdown:function(arg){return guiArray.make(arg).map(function(type){return"transitionend"===type?this._transitionend():type},this)},_transitionend:function(){return"transition"in document.documentElement.style?"transitionend":"webkitTransitionEnd"}})}(gui.Combo.chained,gui.Array,gui.DOMPlugin,gui.Interface,gui.Type),gui.IEventHandler={toString:function(){return"[object IEventHandler]"},handleEvent:function(e){},onevent:function(e){}},gui.SpritePlugin=function(){return gui.Plugin.extend({x:{getter:function(){return this._pos.x},setter:function(x){this._pos.x=x,this._apply()}},y:{getter:function(){return this._pos.y},setter:function(y){this._pos.y=y,this._apply()}},z:{getter:function(){return this._pos.z},setter:function(z){this._pos.z=z,this._apply()}},scale:{getter:function(){return this._gro},setter:function(scale){this._gro=scale,this._apply()}},xoffset:{getter:function(){return this._org.x},setter:function(x){this._org.x=x,this._apply()}},yoffset:{getter:function(){return this._org.y},setter:function(y){this._org.y=y,this._apply()}},zoffset:{getter:function(){return this._org.z},setter:function(z){this._org.z=z,this._apply()}},onconstruct:function(){gui.Plugin.prototype.onconstruct.call(this),this._pos=new gui.Position,this._org=new gui.Position,this._gro=1},reset:function(){this.spirit.css.set("-beta-transform",""),this.spirit.css.set("-beta-transform-origin",""),gui.Client.has3D||(this.spirit.css.left="",this.spirit.css.top="")},_pos:null,_gro:null,_org:null,_def:null,_defpos:function(css){return this._def||(this._def=new gui.Position(parseInt(css.compute("left"),10),parseInt(css.compute("top"),10)))},_apply:function(){var coords=this._pos,origin=this._org,scaled=parseFloat(this._gro),tforms=[coords.x,coords.y,coords.z].map(parseFloat),offset=[origin.x,origin.y,origin.z].map(parseFloat),plugin=this.spirit.css;if(gui.Client.has3D)plugin.style({"-beta-transform-origin":offset.join("px ")+"px","-beta-transform":"translate3d("+tforms.join("px,")+"px) scale("+scaled+")"});else{var iepos=this._defpos(plugin);plugin.style({left:Math.round(iepos.x+tforms[0]+offset[0]),top:Math.round(iepos.y+tforms[1]+offset[1]),msTransformOrigin:offset[0]+"px "+offset[1]+"px",msTransform:"scale("+scaled+")"})}}})}(),gui.Spirit=gui.Class.create(Object.prototype,{element:null,document:document,window:window,toString:function(){return"[object gui.Spirit]"},exorcise:function(){this.life.destructed||(gui.Spirit.$destruct(this),gui.Spirit.$dispose(this))},onconstruct:function(){},onconfigure:function(){},onenter:function(){},onattach:function(){},onready:function(){},oninit:function(){},ondetach:function(){},onexit:function(){},ondestruct:function(){},onasync:function(){},oncrawler:function(crawler){},reflex:function(action,thisp){action&&action.apply(thisp),new gui.Crawler(gui.CRAWLER_REFLEX).descend(this,{handleSpirit:function(spirit){spirit.onflex()}})},onflex:function(){},$instanceid:null,$contextid:null,$destructed:!1,$onconstruct:function(elm){this.$contextid=gui.$contextid,this.element=elm,this.document=document,this.window=window,gui.Spirit.$construct(this)},$ondestruct:function(){},$pluginplugins:function(){var Plugin,plugins=this.constructor.$plugins;this.life=new gui.LifePlugin(this),this.config=new gui.ConfigPlugin(this),Object.keys(plugins).filter(function(prefix){return"life"!==prefix&&"config"!==prefix}).sort().forEach(function(prefix){Plugin=plugins[prefix],(this.life.plugins[prefix]=!Plugin.lazy)?gui.Plugin.$assign(this,prefix,new Plugin(this)):gui.Plugin.$prepare(this,prefix,Plugin)},this)},$debug:function(constructing){if(gui.debug){var val,elm=this.element,fix=gui.attributes[0];constructing?gui.attributes.every(function(f){return!elm.hasAttribute(f)})&&(val="["+this.constructor.$classname+"]",elm.setAttribute(fix,val)):(val=elm.getAttribute(fix))&&val.startsWith("[")&&elm.removeAttribute(fix)}}},{portals:!0,summon:function(doc){return this.possess((doc||document).createElement("div"))},possess:function(element){return gui.Guide.$possess(element,this)},extend:function(){var C=gui.Class.extend.apply(this,arguments);return C.$plugins=gui.Object.copy(this.$plugins),C},plugin:function(prefix,plugin,override){var plugins=this.$plugins,proto=this.prototype;return!proto.hasOwnProperty(prefix)||null===proto.prefix||override?plugins[prefix]&&!override||(plugins[prefix]=plugin,proto.prefix=null,gui.Class.children(this,function(child){child.plugin(prefix,plugin,override)})):console.error("Plugin naming crash in "+this+": "+prefix),this},$plugins:Object.create(null)},{$construct:function(spirit){spirit.$pluginplugins(),spirit.$debug(!0),spirit.life.constructed=!0,spirit.onconstruct(),spirit.life.dispatch(gui.LIFE_CONSTRUCT)},$configure:function(spirit){spirit.config.configureall(),spirit.life.configured=!0,spirit.onconfigure(),spirit.life.dispatch(gui.LIFE_CONFIGURE)},$enter:function(spirit){gui.Guide.$inside(spirit),spirit.life.entered=!0,spirit.onenter(),spirit.life.dispatch(gui.LIFE_ENTER)},$attach:function(spirit){gui.Guide.$inside(spirit),spirit.life.attached=!0,spirit.life.detached=!1,spirit.onattach(),spirit.life.dispatch(gui.LIFE_ATTACH)},$ready:function(spirit){spirit.life.ready=!0,spirit.onready(),spirit.life.dispatch(gui.LIFE_READY),gui.$getnow(spirit.element)},$detach:function(spirit){gui.Guide.$outside(spirit),spirit.life.attached=!1,spirit.life.detached=!0,spirit.life.visible=!1,spirit.life.dispatch(gui.LIFE_DETACH),spirit.life.dispatch(gui.LIFE_INVISIBLE),spirit.ondetach()},$exit:function(spirit){spirit.life.exited=!0,spirit.life.dispatch(gui.LIFE_EXIT),spirit.onexit()},$async:function(spirit){spirit.life.async=!0,spirit.onasync(),spirit.life.dispatch(gui.LIFE_ASYNC)},$destruct:function(spirit){spirit.$debug(!1),spirit.life.destructed=!0,spirit.life.dispatch(gui.LIFE_DESTRUCT),spirit.ondestruct()},$dispose:function(spirit){spirit.$ondestruct(),spirit.$destructed=!0,gui.Guide.$forget(spirit),gui.Garbage.$collect(spirit)},$oninit:function(spirit){spirit.life.initialized=!0,spirit.life.dispatch("life-initialized"),spirit.oninit()}}),gui.DocumentSpirit=gui.Spirit.extend({onready:function(){gui.Spirit.prototype.onready.call(this),(this.waiting=gui.hosted)&&this.action.addGlobal(gui.$ACTION_XFRAME_VISIBILITY),this.action.dispatchGlobal(gui.ACTION_DOC_ONSPIRITUALIZED),this.broadcast.add(gui.BROADCAST_RESIZE_END)},onaction:function(a){switch(gui.Spirit.prototype.onaction.call(this,a),this.action.$handleownaction=!1,a.type){case gui.$ACTION_XFRAME_VISIBILITY:this._waiting=!1,gui.hasModule("gui-layout@wunderbyte.com")&&(!0===a.data?this.visibility.on():this.visibility.off()),a.consume()}},onbroadcast:function(b){gui.Spirit.prototype.onbroadcast.call(this,b),b.type===gui.BROADCAST_RESIZE_END&&this.reflex()},oncrawler:function(crawler){var dir=gui.Spirit.prototype.oncrawler.call(this,crawler);if(dir===gui.Crawler.CONTINUE)switch(crawler.type){case gui.CRAWLER_VISIBLE:case gui.CRAWLER_INVISIBLE:this._waiting&&(dir=gui.Crawler.STOP)}return dir},onvisible:function(){this.css.remove(gui.CLASS_INVISIBLE),gui.Spirit.prototype.onvisible.call(this)},oninvisible:function(){this.css.add(gui.CLASS_INVISIBLE),gui.Spirit.prototype.oninvisible.call(this)},_loaded:!1,_waiting:!1,_timeout:null}),gui.IframeSpirit=gui.Spirit.extend({spiritualized:!1,fit:!1,xguest:null,contentWindow:{getter:function(){return this.element.contentWindow}},contentDocument:{getter:function(){return this.element.contentDocument}},contentLocation:null,onconstruct:function(){gui.Spirit.prototype.onconstruct.call(this),this.event.add("message",window),this._postbox=[]},onenter:function(){gui.Spirit.prototype.onenter.call(this),this.event.add("load"),this.action.addGlobal([gui.ACTION_DOC_ONDOMCONTENT,gui.ACTION_DOC_ONLOAD,gui.ACTION_DOC_ONHASH,gui.ACTION_DOC_ONSPIRITUALIZED,gui.ACTION_DOC_UNLOAD]),this.fit&&(this.css.height=0);var src=this.element.src;src&&src!==gui.IframeSpirit.SRC_DEFAULT&&(src.startsWith("blob:")||this._setupsrc(src))},onaction:function(a){gui.Spirit.prototype.onaction.call(this,a),this.action.$handleownaction=!1;var base;switch(a.type){case gui.ACTION_DOC_ONDOMCONTENT:this.contentLocation=new gui.URL(document,a.data),this.life.dispatch(gui.LIFE_IFRAME_DOMCONTENT),this.action.remove(a.type),a.consume();break;case gui.ACTION_DOC_ONLOAD:this.contentLocation=new gui.URL(document,a.data),this.life.dispatch(gui.LIFE_IFRAME_ONLOAD),this.action.remove(a.type),a.consume();break;case gui.ACTION_DOC_ONHASH:base=this.contentLocation.href.split("#")[0],this.contentLocation=new gui.URL(document,base+a.data),this.life.dispatch(gui.LIFE_IFRAME_ONHASH),a.consume();break;case gui.ACTION_DOC_ONSPIRITUALIZED:this._onspiritualized(),this.life.dispatch(gui.LIFE_IFRAME_SPIRITUALIZED),this.action.remove(a.type),a.consume();break;case gui.ACTION_DOC_UNLOAD:this._onunload(),this.life.dispatch(gui.LIFE_IFRAME_UNLOAD),this.action.add([gui.ACTION_DOC_ONCONSTRUCT,gui.ACTION_DOC_ONDOMCONTENT,gui.ACTION_DOC_ONLOAD,gui.ACTION_DOC_ONSPIRITUALIZED]),a.consume()}},onevent:function(e){switch(gui.Spirit.prototype.onevent.call(this,e),e.type){case"message":this._onmessage(e.data,e.origin,e.source)}},onvisible:function(){gui.Spirit.prototype.onvisible.call(this),this.spiritualized&&this._visibility()},oninvisible:function(){gui.Spirit.prototype.oninvisible.call(this),this.spiritualized&&this._visibility()},src:function(src){return src&&(this._setupsrc(src),this.element.src=src),this.element.src},url:function(url,src){return src&&this._setupsrc(src),url&&(this.element.src=url),this.contentLocation.href},postMessage:function(msg){this.spiritualized?this.contentWindow.postMessage(msg,"*"):this._postbox.push(msg)},_setupsrc:function(src){var doc=document;this.contentLocation=new gui.URL(doc,src),this.xguest=function(secured){if(secured)return"*";if(gui.URL.external(src,doc)){var url=new gui.URL(doc,src);return url.protocol+"//"+url.host}return null}(this._sandboxed())},_onspiritualized:function(){for(this.spiritualized=!0;this._postbox.length;)this.postMessage(this._postbox.shift());this._visibility()},_onfit:function(height){this.fit&&(this.css.height=height,this.action.dispatchGlobal(gui.ACTION_DOC_FIT))},_onunload:function(){this.spiritualized=!1,this.fit&&(this.css.height=0)},_onmessage:function(msg,origin,source){if(source===this.contentWindow&&msg.startsWith("spiritual-action:")){var a=gui.Action.parse(msg);a.direction===gui.Action.ASCEND&&(this.action.$handleownaction=!0,this.action.ascendGlobal(a.type,a.data))}},_sandboxed:function(){var sandbox=this.element.sandbox;return sandbox&&sandbox.length},_visibility:function(){gui.hasModule("gui-layout@wunderbyte.com")&&gui.Type.isDefined(this.life.visible)&&this.action.descendGlobal(gui.$ACTION_XFRAME_VISIBILITY,this.life.visible)}},{summon:function(doc,src){var iframe=doc.createElement("iframe"),spirit=this.possess(iframe);if(spirit.css.add("gui-iframe"),src){if(gui.URL.external(src,doc)){var url=new gui.URL(doc,src);spirit.xguest=url.protocol+"//"+url.host}}else src=this.SRC_DEFAULT;return iframe.src=src,spirit}},{SRC_DEFAULT:"javascript:void(false);"}),gui.Position=function(x,y,z){this.x=x||0,this.y=y||0,this.z=z||0},gui.Position.prototype={x:0,y:0,z:0,toString:function(){return"[object gui.Position]"},clone:function(){return new gui.Position(this.x,this.y,this.z)}},gui.Position.isEqual=function(p1,p2){return p1.x===p2.x&&p1.y===p2.y},gui.Dimension=function(w,h){this.w=w||0,this.h=h||0},gui.Dimension.prototype={w:0,h:0,toString:function(){return"[object gui.Dimension]"}},gui.Dimension.isEqual=function(dim1,dim2){return dim1.w===dim2.w&&dim1.h===dim2.h},gui.Geometry=function(x,y,w,h){this.x=x||0,this.y=y||0,this.w=w||0,this.h=h||0},gui.Geometry.prototype={x:0,y:0,w:0,h:0,toString:function(){return"[object gui.Geometry]"},hitTest:function(geo){return gui.Geometry.hitTest(this,geo)}},gui.Geometry.isEqual=function(geo1,geo2){return geo1.x===geo2.x&&geo1.y===geo2.y&&geo1.w===geo2.w&&geo1.h===geo2.h},gui.Geometry.hitTest=function(geo1,geo2){function x(g1,g2){return g1.x>=g2.x&&g1.x<=g2.x+g2.w}function y(g1,g2){return g1.y>=g2.y&&g1.y<=g2.y+g2.h}var hitx=x(geo1,geo2)||x(geo2,geo1),hity=y(geo1,geo2)||y(geo2,geo1);return hitx&&hity},gui.UnitBezier=function(p1x,p1y,p2x,p2y){this.cx=3*p1x,this.bx=3*(p2x-p1x)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*p1y,this.by=3*(p2y-p1y)-this.cy,this.ay=1-this.cy-this.by},gui.UnitBezier.prototype={epsilon:1e-6,sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(x){var t0,t1,t2,x2,d2,i;for(t2=x,i=0;i<8;i++){if(x2=this.sampleCurveX(t2)-x,Math.abs(x2)<this.epsilon)return t2;if(d2=this.sampleCurveDerivativeX(t2),Math.abs(d2)<this.epsilon)break;t2-=x2/d2}if(t0=0,t1=1,(t2=x)<t0)return t0;if(t2>t1)return t1;for(;t0<t1;){if(x2=this.sampleCurveX(t2),Math.abs(x2-x)<this.epsilon)return t2;x>x2?t0=t2:t1=t2,t2=.5*(t1-t0)+t0}return t2},solve:function(x){return this.sampleCurveY(this.solveCurveX(x))}},gui.DOMChanger={init:function(){var proto=Element.prototype;if(gui.Type.isDefined(proto.spirit))throw new Error("Spiritual loaded twice?");proto.spirit=null},change:function(){var combos=gui.DOMCombos;this._changeelement(gui.Client.isExplorer?HTMLElement:Element,combos),this._changefragment(DocumentFragment,this._fragmethods(combos))},_changeelement:function(Elm,combos){this._isoldgecko()?this._changeoldgecko(combos):this._change(Elm.prototype,combos)},_changefragment:function(Frag,combosubset){this._change(Frag.prototype,combosubset)},_fragmethods:function(combos){var frag=document.createDocumentFragment();return gui.Object.map(combos,function(key,value){if(frag[key])return value})},_change:function(proto,combos){var root=document.documentElement,isok=gui.Client.hasAttributesOnPrototype;gui.Object.each(combos,function(name,combo){this._docombo(proto,name,combo,root,isok)},this)},_changeoldgecko:function(combos){var did=[];this._tags().forEach(function(tag){var p=document.createElement(tag).constructor.prototype;p!==Object.prototype&&-1===did.indexOf(p)&&(this._change(p,combos),did.push(p))},this)},_docombo:function(proto,name,combo,root,ok){this._ismethod(name)?this._domethod(proto,name,combo):gui.Client.isGecko?this._dogeckoaccesor(proto,name,combo,root):ok&&this._doaccessor(proto,name,combo)},_ismethod:function(name){switch(name){case"remove":case"appendChild":case"removeChild":case"insertBefore":case"replaceChild":case"setAttribute":case"removeAttribute":case"insertAdjacentHTML":case"insertAdjacentElement":return!0}return!1},_domethod:function(proto,name,combo){var base=proto[name];proto[name]=combo(function(){return base.apply(this,arguments)})},_doaccessor:function(proto,name,combo,once){var base=Object.getOwnPropertyDescriptor(proto,name);gui.Client.isExplorer9&&"className"===name||(base?Object.defineProperty(proto,name,{configurable:!0,get:function(){return base.get.call(this)},set:combo(function(value){base.set.call(this,value)})}):once||this._doaccessor(Node.prototype,name,combo,!0))},_dogeckoaccesor:function(proto,name,combo,root){this._isoldgecko()?this._dolegacyaccessor(proto,name,combo,root):this._doaccessor(proto,name,combo)},_isoldgecko:function(){return gui.Client.isGecko&&!(window.Symbol&&Symbol.for)},_dolegacyaccessor:function(proto,name,combo,root){var getter=root.__lookupGetter__(name),setter=root.__lookupSetter__(name);getter?(proto.__defineGetter__(name,function(){return getter.apply(this,arguments)}),proto.__defineSetter__(name,combo(function(){setter.apply(this,arguments)}))):this._doaccessor(Node.prototype,name,combo,root)},_tags:function(){return"a abbr address area article aside audio b base bdi bdo blockquote body br button canvas caption cite code col colgroup command datalist dd del details device dfn div dl dt em fieldset figcaption figure footer form h1 h2 h3 h4 h5 h6 head header hgroup hr html i iframe img input ins kbd keygen label legend li link main map menu meta meter nav noscript ol optgroup option output p param pre progress q rp rt ruby s samp script section select small source span strong style submark summary sup table tbody td textarea tfoot th thead time title tr track ul unknown var video wbr".split(" ")}},gui.DOMCombos=function(before,after,around,provided,Type,guiArray,DOMPlugin){function detach(node){var contents=[node];Type.isDocumentFragment(node)&&(contents=guiArray.from(node.childNodes)),contents.forEach(function(n){gui.Guide.$detach(n)})}var ifEmbedded=provided(function(newnode,oldnode){return Type.isDocumentFragment(this)?DOMPlugin.embedded(this)||newnode&&DOMPlugin.embedded(newnode)||oldnode&&DOMPlugin.embedded(oldnode):DOMPlugin.embedded(this)}),ifSpirit=provided(function(){var spirit=gui.get(this);return spirit&&!spirit.$destructed}),spiritualizeAfter=around(function(action,node){var contents=[node];Type.isDocumentFragment(node)&&(contents=guiArray.from(node.childNodes)),action(),contents.forEach(function(n){gui.spiritualize(n)})}),detachBefore=before(function(node){detach(node||this)}),detachSubBefore=before(function(){gui.Guide.$detach(this,!0)}),detachOldBefore=before(function(newnode,oldnode){detach(oldnode)}),setAttBefore=before(function(name,value){gui.get(this).att.set(name,value)}),delAttBefore=before(function(name){gui.get(this).att.del(name)}),suspending=(before(function(name){gui.get(this).att.set("class",name)}),around(function(action){return gui.DOMObserver.observes?gui.DOMObserver.suspend(function(){return action()}):action()})),spiritualizeSubAfter=after(function(){gui.spiritualizeSub(this)}),parent=null,materializeThisBefore=before(function(){parent=this.parentNode,gui.materialize(this)}),spiritualizeParentAfter=after(function(){gui.spiritualize(parent)}),spiritualizeAdjacentAfter=after(function(position,html){var elm=this,elms=[];switch(position.toLowerCase()){case"beforebegin":for(;elm=elm.previousElementSibling;)elms.push(elm);break;case"afterbegin":case"beforeend":for(elm=this.firstElementChild;elm;)elms.push(elm),elm=elm.nextElementSibling;break;case"afterend":for(;elm=elm.nextElementSibling;)elms.push(elm)}elms.forEach(function(next){gui.get(next)||gui.spiritualize(next)})}),spiritualizeAdjacentElementAfter=after(function(position,element){gui.spiritualize(element)}),ifEnabled=provided(function(){return!!this.ownerDocument.defaultView}),otherwise=function(action){return action};return{appendChild:function(base){return ifEnabled(ifEmbedded(detachBefore(spiritualizeAfter(suspending(base))),otherwise(base)),otherwise(base))},insertBefore:function(base){return ifEnabled(ifEmbedded(detachBefore(spiritualizeAfter(suspending(base))),otherwise(base)),otherwise(base))},replaceChild:function(base){return ifEnabled(ifEmbedded(detachOldBefore(spiritualizeAfter(suspending(base))),otherwise(base)),otherwise(base))},insertAdjacentHTML:function(base){return ifEnabled(ifEmbedded(spiritualizeAdjacentAfter(suspending(base)),otherwise(base)),otherwise(base))},insertAdjacentElement:function(base){return ifEnabled(ifEmbedded(spiritualizeAdjacentElementAfter(suspending(base)),otherwise(base)),otherwise(base))},removeChild:function(base){return ifEnabled(ifEmbedded(detachBefore(suspending(base)),otherwise(base)),otherwise(base))},remove:function(base){return ifEnabled(ifEmbedded(detachBefore(suspending(base)),otherwise(base)),otherwise(base))},setAttribute:function(base){return ifEnabled(ifEmbedded(ifSpirit(setAttBefore(base),otherwise(base)),otherwise(base)),otherwise(base))},removeAttribute:function(base){return ifEnabled(ifEmbedded(ifSpirit(delAttBefore(base),otherwise(base)),otherwise(base)),otherwise(base))},innerHTML:function(base){return ifEnabled(ifEmbedded(detachSubBefore(spiritualizeSubAfter(suspending(base))),otherwise(base)),otherwise(base))},outerHTML:function(base){return ifEnabled(ifEmbedded(materializeThisBefore(detachBefore(spiritualizeParentAfter(suspending(base)))),otherwise(base)),otherwise(base))},textContent:function(base){return ifEnabled(ifEmbedded(detachSubBefore(suspending(base)),otherwise(base)),otherwise(base))}}}(gui.Combo.before,gui.Combo.after,gui.Combo.around,gui.Combo.provided,gui.Type,gui.Array,gui.DOMPlugin),gui.DOMObserver=function(Type,GuiArray){function iselement(node){return node&&node.nodeType===Node.ELEMENT_NODE}function materialize(node){gui.materialize(node,!0)}function spiritualize(node){gui.spiritualize(node)}function concatenate(array,nodelist){return array.concat(GuiArray.from(nodelist))}function collect(mutations,added){return mutations.reduce(function(result,mutation){return concatenate(result,added?mutation.addedNodes:mutation.removedNodes)},[])}function addednodes(mutations){var added=collect(mutations,!0);return added.filter(function(node,i){return added.indexOf(node)===i})}function removednodes(mutations,added){return collect(mutations,!1).filter(function(node){return-1===added.indexOf(node)})}function handlemutations(mutations){if(connected){var added=addednodes(mutations);removednodes(mutations,added).filter(iselement).forEach(materialize),added.filter(iselement).forEach(spiritualize)}}var connected=!0,suspend=0;return{observes:!1,observe:function(){if(!gui.Client.hasMutations)throw new Error("MutationObserver no such thing: Browser (version) not supported");this.observes=!0,new(this._mutationobserver())(handlemutations).observe(document,{childList:!0,subtree:!0})},suspend:function(action,thisp){var res;return this.observes&&1==++suspend&&(connected=!1),Type.isFunction(action)&&(res=action.call(thisp)),this.observes&&this.resume(),res},resume:function(){this.observes&&0==--suspend&&(connected=!0)},_mutationobserver:function(){return window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver}}}(gui.Type,gui.Array),gui.Assistant=function(Crawler){return{$possess:function(elm,Spirit){if(elm.spirit)throw new Error("Cannot repossess element with spirit "+elm.spirit+" (exorcise first)");if(gui.debug&&!gui.Type.isSpiritConstructor(Spirit))throw new Error("Not a spirit constructor ("+gui.Type.of(Spirit)+")");return elm.spirit=new Spirit(elm),elm.spirit},$maybepossess:function(elm,channels){var hit;return elm.spirit||(hit=this._maybepossess(elm,channels))&&this.$possess(elm,hit),elm.spirit},$detectspirits:function(element,skip,one,channels){var spirit,spirits=[],Assistant=this;return new Crawler(gui.CRAWLER_SPIRITUALIZE).descend(element,{handleElement:function(elm){if(skip&&elm===element||((spirit=elm.spirit)||(spirit=Assistant.$maybepossess(elm,channels)),spirit&&(spirit.life.attached||spirits.push(spirit))),one)return Crawler.SKIP_CHILDREN;if(!elm.childElementCount)return Crawler.SKIP_CHILDREN;if(elm.hasAttribute("tempname"))return Crawler.SKIP_CHILDREN;switch(elm.localName){case"pre":case"code":return Crawler.SKIP_CHILDREN}return Crawler.CONTINUE}}),spirits},_maybepossess:function(elm,channels){var res=null;return elm.nodeType===Node.ELEMENT_NODE&&gui.attributes.every(function(fix){return"data-ts"===fix||null===(res=this._maybepossessinline(elm,fix))},this)&&channels&&channels.every(function(def){var select=def[0],spirit=def[1];return gui.CSSPlugin.matches(elm,select)&&(res=spirit),null===res},this),res},_maybepossessinline:function(elm,fix){var res=null,att=elm.getAttribute(fix);return gui.Type.isString(att)&&!att.startsWith("[")&&(""!==att?(res=gui.Object.lookup(att))||console.error(att+" is not defined."):res=!1),res}}}(gui.Crawler),gui.Guide=function(Assistant,Type,guiArray,Broadcast,DOMPlugin,Spirit,Tick,Crawler){var documentspirits={incoming:[],inside:Object.create(null),outside:Object.create(null)};return{toString:function(){return"[object gui.Guide]"},suspend:function(operation,thisp){this._suspended=!0;var res=operation.call(thisp);return this._suspended=!1,res},$startGuiding:function(){gui.$stop("- idle time ..."),this._startGuiding(),Broadcast.dispatch(gui.BROADCAST_WILL_SPIRITUALIZE),gui.$measure("- spiritualize initially",function(){this._spiritualizeinitially(),gui.$stop("boostrap everything")},this),Broadcast.dispatch(gui.BROADCAST_DID_SPIRITUALIZE)},$possess:function(elm,newSpirit){return Assistant.$possess(elm,newSpirit)},$spiritualize:function(target){target=Type.isSpirit(target)?target.element:target,this._maybespiritualize(target,!1,!1)},$spiritualizeSub:function(target){this._maybespiritualize(target,!0,!1)},$spiritualizeOne:function(target){this._maybespiritualize(target,!1,!0)},$materialize:function(target,webkithack){this._maybematerialize(target,!1,!1,webkithack)},$materializeSub:function(target){this._maybematerialize(target,!0,!1)},$materializeOne:function(target){this._maybematerialize(target,!1,!0)},$detach:function(target,skip){this._maybedetach(target,!!skip)},$forget:function(spirit){var spirits=documentspirits,key=spirit.$instanceid;delete spirits.inside[key],delete spirits.outside[key],this._stoptracking(spirit)},$channel:function(){switch(Type.of(arguments[0])){case"string":this._channelOne.apply(this,arguments);break;case"array":this._channelAll.apply(this,arguments)}},$hasChannels:function(){return this._channels&&this._channels.length},$getChannels:function(){return this._channels.slice()},$debug:function(){console.log(this._channels.reduce(function(log,channel){return log+"\n\n"+channel[0]+" : "+channel[1]},location.href))},$inside:function(spirit){var spirits=documentspirits,key=spirit.$instanceid;spirits.inside[key]||(spirits.outside[key]&&delete spirits.outside[key],spirits.inside[key]=spirit,spirits.incoming.push(spirit),Tick.dispatch(gui.$TICK_INSIDE,4))},$outside:function(spirit){var spirits=documentspirits,key=spirit.$instanceid;spirits.outside[key]||(spirits.inside[key]&&(delete spirits.inside[key],this._stoptracking(spirit)),spirits.outside[key]=spirit,Tick.dispatch(gui.$TICK_OUTSIDE,0))},$goasync:function(spirits){if(spirits.forEach(function(spirit){Spirit.$async(spirit)}),gui.hosted){var docspirit=gui.get(document.documentElement);if(!docspirit||void 0===docspirit.life.visible)return}this._visibility(spirits)},$getSpiritById:function(key){return documentspirits.inside[key]||null},_arrivals:Object.create(null),_channels:[],_todochannels:null,_suspended:!1,_startGuiding:function(){var ticks=[gui.$TICK_INSIDE,gui.$TICK_OUTSIDE];gui.Tick.add(ticks,{ontick:function(tick){tick.type===ticks[0]?gui.Guide._updateincoming():gui.Guide._updateoutside()}}),this._todochannels&&(this._channelAll(this._todochannels),this._todochannels=null)},_spiritualizeinitially:function(){var root=document.documentElement;gui.DOMChanger.init(),this.$spiritualizeOne(root),gui.mode===gui.MODE_ROBOT&&(gui.DOMChanger.change(),gui.Client.hasAttributesOnPrototype||gui.DOMObserver.observe(),this.$spiritualizeSub(root)),Spirit.$ready(gui.get(root))},_handles:function(node,webkithack){return node&&Type.isElement(node)&&!this._suspended&&(webkithack||DOMPlugin.embedded(node))},_collect:function(node,skip,id){var list=[];return new Crawler(id).descend(node,{handleSpirit:function(spirit){skip&&spirit.element===node||spirit.life.destructed||list.push(spirit)}}),list},_maybespiritualize:function(node,skip,one){node=Type.isSpirit(node)?node.element:node,node=Type.isDocument(node)?node.documentElement:node,this._handles(node)&&this._spiritualize(node,skip,one)},_spiritualize:function(elm,skip,one){var spirits,channels=this._channels;skip=!1,spirits=Assistant.$detectspirits(elm,skip,one,channels),this._sequence(spirits)},_sequence:function(){function configure(spirit){return spirit.life.configured||Spirit.$configure(spirit),spirit}function enter(spirit){return spirit.life.entered||Spirit.$enter(spirit),spirit}function attach(spirit){return spirit.life.attached||Spirit.$attach(spirit),spirit}function ready(spirit){spirit.life.ready||root.is(spirit)||Spirit.$ready(spirit)}var root=gui.DocumentSpirit;return function(spirits){spirits.map(configure).map(enter).map(attach).reverse().forEach(ready)}}(),_maybematerialize:function(node,skip,one,force,webkithack){node=Type.isSpirit(node)?node.element:node,node=Type.isDocument(node)?node.documentElement:node,(force||this._handles(node,webkithack))&&this._materialize(node,skip,one)},_materialize:function(element,skip,one){this._collect(element,skip,gui.CRAWLER_MATERIALIZE).reverse().filter(function(spirit){return!(!spirit.life.attached||spirit.life.destructed)&&(Spirit.$destruct(spirit),!0)}).forEach(function(spirit){Spirit.$dispose(spirit)})},_maybedetach:function(element,skip){element=Type.isSpirit(element)?element.element:element,this._handles(element)&&this._collect(element,skip,gui.CRAWLER_DETACH).forEach(function(spirit){Spirit.$detach(spirit)})},_channelOne:function(select,klass){var spirit,booting=!!this._todochannels;gui.initialized?(spirit="string"==typeof klass?gui.Object.lookup(klass):klass,!gui.debug||Type.isSpiritConstructor(spirit)?booting?this._channels.unshift([select,spirit]):this._channels.push([select,spirit]):console.error('Bad spirit for selector "'+select+'": '+spirit)):(this._todochannels=this._todochannels||[],this._todochannels.push([select,klass]))},_channelAll:function(channels){gui.initialized?channels.forEach(function(c){this._channelOne(c[0],c[1])},this):(this._todochannels=this._todochannels||[],this._todochannels=this._todochannels.concat(channels.reverse()))},_stoptracking:function(spirit){var incoming=documentspirits.incoming;if(incoming.length){var i=incoming.indexOf(spirit);i>-1&&guiArray.remove(incoming,i)}},_updateincoming:function(){gui.Guide.$goasync(documentspirits.incoming),documentspirits.incoming=[]},_updateoutside:function(){var outside=documentspirits.outside,spirits=gui.Object.each(outside,function(key,spirit){return spirit});spirits.forEach(function(spirit){Spirit.$destruct(spirit)}),spirits.forEach(function(spirit){Spirit.$dispose(spirit)}),documentspirits.outside=Object.create(null)},_visibility:function(spirits){gui.hasModule("gui-layout@wunderbyte.com")&&DOMPlugin.group(spirits).forEach(function(spirit){gui.VisibilityPlugin.$init(spirit)},this)}}}(gui.Assistant,gui.Type,gui.Array,gui.Broadcast,gui.DOMPlugin,gui.Spirit,gui.Tick,gui.Crawler),gui.Module.mixin({onbeforespiritualize:function(){},onafterspiritualize:function(){},$onconstruct:function(name){this.$modname=name,gui.Module.$init(this),this.toString=function(){return"[module "+name+"]"}}},{},{$init:function(module){gui.Type.isObject(module.mixin)&&gui.Spirit.mixin(module.mixin),gui.Type.isArray(module.channel)&&gui.channel(module.channel),gui.Type.isObject(module.plugin)&&gui.Object.each(module.plugin,function(prefix,Plugin){gui.Type.isDefined(Plugin)?gui.Spirit.plugin(prefix,Plugin):console.error("Undefined plugin for prefix: "+prefix)})}}),function(modules){modules.forEach(gui.Module.$init)}(gui.Module._modules),function(modules){gui.Object.each({onbeforespiritualize:gui.BROADCAST_WILL_SPIRITUALIZE,onafterspiritualize:gui.BROADCAST_DID_SPIRITUALIZE},function(action,broadcast){gui.Broadcast.add(broadcast,{onbroadcast:function(){modules.forEach(function(module){module[action]()})}})})}(gui.Module._modules),gui.module("gui-spirits@wunderbyte.com",{channel:[["html",gui.DocumentSpirit],[".gui-iframe",gui.IframeSpirit],[".gui-spirit",gui.Spirit]],plugin:{super:gui.SuperPlugin,action:gui.ActionPlugin,broadcast:gui.BroadcastPlugin,tick:gui.TickPlugin,att:gui.AttPlugin,config:gui.ConfigPlugin,box:gui.BoxPlugin,css:gui.CSSPlugin,dom:gui.DOMPlugin,event:gui.EventPlugin,life:gui.LifePlugin,sprite:gui.SpritePlugin},mixin:{onaction:function(action){},onbroadcast:function(broadcast){},ontick:function(tick){},onatt:function(att){},onevent:function(event){},onlife:function(life){},handleEvent:function(e){"webkitTransitionEnd"===e.type&&(e={type:"transitionend",target:e.target,currentTarget:e.currentTarget,propertyName:e.propertyName,elapsedTime:e.elapsedTime,pseudoElement:e.pseudoElement}),this.onevent(e)},$ondestruct:gui.Combo.before(function(){this.handleEvent=function(){}})(gui.Spirit.prototype.$ondestruct)}})}(self),function(window){"use strict";self.edb=gui.namespace("edb",(gui.Arguments.confirmed,{version:"-1.0.0",debug:!1,$accessaware:!1,BROADCAST_ACCESS:"edb-broadcast-access",BROADCAST_CHANGE:"edb-broadcast-change",BROADCAST_OUTPUT:"edb-broadcast-output",BROADCAST_SCRIPT_INVOKE:"edb-broadcast-script-invoke",TICK_SCRIPT_UPDATE:"edb-tick-script-update",TICK_COLLECT_INPUT:"edb-tick-collect-input",TICK_PUBLISH_CHANGES:"edb-tick-update-changes",get:function(){console.error("Deprecated API is deprecated: edb.get()")}})),edb.Type=function(chained){return gui.Class.create(null,{onconstruct:function(){},ondestruct:function(){},output:chained(function(){edb.Output.$output(this)}),outputGlobal:chained(function(){console.error("Not supported just yet: "+this+".outputGlobal()")}),revoke:chained(function(){edb.Output.$revoke(this)}),dispose:chained(function(){edb.Type.$destruct(this)}),serializeToString:function(filter,tabs){return(new edb.Serializer).serializeToString(this,filter,tabs)},$originalid:null,$destructed:!1,$onconstruct:function(){},$ondestruct:function(){this.constructor.storage&&this.persist()}})}(gui.Combo.chained),edb.Type.mixin(null,null,{is:function(o){return edb.Object.is(o)||edb.Array.is(o)},isConstructor:function(o){return gui.Type.isGuiClass(o)&&gui.Class.ancestorsAndSelf(o).some(function(C){return C===edb.Object||C===edb.Array})},lookup:function(context,arg){var type=null;switch(gui.Type.of(arg)){case"function":type=arg;break;case"string":type=gui.Object.lookup(arg,context);break;case"object":console.error(this+": expected edb.Type constructor (not an object)")}if(!type)throw new TypeError('The type "'+arg+'" does not exist');return type},cast:function(value){if(gui.Type.isComplex(value)&&!edb.Type.is(value))switch(gui.Type.of(value)){case"object":return edb.Object.from(value);case"array":return edb.Array.from(value)}return value},mixin:function(protos,xstatics,statics){return[edb.Object,edb.Array].forEach(function(Type){Type.mixin(protos,xstatics,statics)}),this},$observe:function(type,handler){var id=type.$instanceid,obs=this._observers,handlers=obs[id]||(obs[id]=[]);return-1===handlers.indexOf(handler)&&handlers.push(handler),type},$unobserve:function(type,handler){var index,id=type.$instanceid,obs=this._observers,handlers=obs[id];return handlers&&(index=handlers.indexOf(handler))>-1&&0===gui.Array.remove(handlers,index)&&delete obs[id],type},$destruct:function(type){(new edb.Crawler).crawl(type,{ontype:function(t){t.$destructed||(type.ondestruct(),type.$ondestruct(),type.$destructed=!0,gui.unloading||gui.Garbage.$nukeallofit(type))}})}}),function(confirmed){var iomixins={isOutput:function(){return edb.Output.$is(this)},getOutput:function(){console.error("Deprecated API is deprecated: getOutput()")},revokeOutput:function(){console.error("Deprecated API is deprecated: revokeOutput()")}},spassermixins={from:gui.Arguments.confirmed("(string|object|array|null)")(function(json){var Type=this;return json&&(edb.Type.is(json)&&(json=(new edb.Serializer).serializeToString(json)),gui.Type.isString(json)&&(json.includes("$object")||json.includes("$array"))&&(json=(new edb.Parser).parseFromString(json,null))),new Type(json)}),extend:function(){var C=gui.Class.extend.apply(this,arguments);return C.output=new edb.Output(C),C}};[iomixins,spassermixins].forEach(function(mixins){gui.Object.each(mixins,function(key,value){edb.Type[key]=value})}),edb.Type.$staticmixins=function(){var mixins={};return[iomixins,spassermixins].forEach(function(set){Object.keys(set).forEach(function(key){mixins[key]=set[key]},this)},this),mixins}}(gui.Arguments.confirmed),edb.Object=function(confirmed,chained){return gui.Class.create(Object.prototype,{addObserver:confirmed("object|function")(chained(function(handler){edb.Object.observe(this,handler)})),removeObserver:confirmed("object|function")(chained(function(handler){edb.Object.unobserve(this,handler)})),$onconstruct:function(json){switch(edb.Type.prototype.$onconstruct.apply(this,arguments),gui.Type.of(json)){case"object":case"undefined":case"null":var proxy=gui.Object.copy(json||{}),types=edb.ObjectPopulator.populate(proxy,this);edb.ObjectProxy.approximate(proxy,this,types);break;default:throw new TypeError("Unexpected edb.Object constructor argument of type "+gui.Type.of(json)+": "+String(json))}this.onconstruct(),this.oninit&&console.error("Deprecated API is deprecated: "+this+".oninit")},toJSON:function(){return gui.Object.map(this,function(key,value){var c=key.charAt(0);if("$"!==c&&"_"!==c)return edb.Type.is(value)?value.toJSON():value})}})}(gui.Arguments.confirmed,gui.Combo.chained),edb.Object.mixin(null,edb.Type.$staticmixins(),{observe:edb.Type.$observe,unobserve:edb.Type.$unobserve,ontick:function(tick){var exists,snapshot,changes,handlers,mishandlers,observers=this._observers;if(tick.type===edb.TICK_PUBLISH_CHANGES){snapshot=gui.Object.copy(this._changes),this._changes=Object.create(null);var changelings=[];gui.Object.each(snapshot,function(instanceid,propdef){(handlers=observers[instanceid])&&(changes=[],mishandlers=[],gui.Object.each(propdef,function(name,change){changes.push(change)}),handlers.filter(function(handler){return(exists=!handler.$destructed)||mishandlers.push(handler),exists}).forEach(function(handler){handler.__changes||(handler.__changes=[]),handler.__changes.push(changes),-1===changelings.indexOf(handler)&&changelings.push(handler)}),mishandlers.forEach(function(handler){var index=handlers.indexOf(handler);gui.Array.remove(handlers,index)}))}),changelings.forEach(function(handler){var groups=handler.__changes;handler.onchange(groups.reduce(function(sum,changesToReduce){return sum.concat(changesToReduce)},[])),delete handler.__changes})}},$onaccess:function(object,name){edb.$accessaware&&gui.Broadcast.dispatch(edb.BROADCAST_ACCESS,[object,name])},$onchange:function(object,name,oldval,newval){if(oldval!==newval){var type=edb.ObjectChange.TYPE_UPDATE,all=this._changes,id=object.$instanceid;(all[id]||(all[id]=Object.create(null)))[name]=new edb.ObjectChange(object,name,type,oldval,newval),gui.Tick.dispatch(edb.TICK_PUBLISH_CHANGES,0)}},_observers:Object.create(null),_changes:Object.create(null)}),gui.Tick.add(edb.TICK_PUBLISH_CHANGES,edb.Object),gui.Object.extendmissing(edb.Object.prototype,edb.Type.prototype),function(proto,chained){function convert(array,args){return edb.ArrayPopulator.convert(array,args)}function onchange(array,index,removed,added){edb.Array.$onchange(array,index,removed,added)}function observes(array){var key=array.$instanceid;return!!edb.Array._observers[key]}edb.Array=gui.Class.create(proto,{push:function(){var idx=this.length,add=convert(this,arguments),res=proto.push.apply(this,add);return observes(this)&&onchange(this,idx,null,add),res},pop:function(){var idx=this.length-1,res=proto.pop.apply(this);return observes(this)&&idx>=0&&onchange(this,idx,[res],null),res},shift:function(){var res=proto.shift.apply(this);return observes(this)&&onchange(this,0,[res],null),res},unshift:function(){var add=convert(this,arguments),res=proto.unshift.apply(this,add);return observes(this)&&onchange(this,0,null,add),res},splice:function(){var arg=arguments,idx=arg[0],add=convert(this,[].slice.call(arg,2)),fix=[idx,arg[1]].concat(add),out=proto.splice.apply(this,fix);return observes(this)&&onchange(this,idx,out,add),out},reverse:function(){if(observes(this)){var out=this.toJSON();onchange(this,0,out,proto.reverse.apply(out.slice()))}return proto.reverse.apply(this)},onconstruct:function(members){},addObserver:chained(function(handler){edb.Object.observe(this,handler),edb.Array.observe(this,handler)}),removeObserver:chained(function(handler){edb.Object.unobserve(this,handler),edb.Array.unobserve(this,handler)}),$of:null,$onconstruct:function(){var object,types;edb.Type.prototype.$onconstruct.apply(this,arguments),arguments.length&&(object=arguments[0]?arguments[0].$object||{}:{},types=edb.ObjectPopulator.populate(object,this),edb.ArrayPopulator.populate(this,arguments),edb.ObjectProxy.approximate(object,this,types)),this.onconstruct([].slice.call(this))},get:function(index){return edb.$accessaware&&edb.Array.$onaccess(this,index),this[index]},getLength:function(index){return edb.$accessaware&&edb.Array.$onaccess(this,index),this.length},setLength:function(length){for(var out=[];this.length>length;)out.push(this.pop());out.length&&onchange(this,this.length-1,out)},toJSON:function(){return Array.map(this,function(thing){return edb.Type.is(thing)?thing.toJSON():thing})}})}(Array.prototype,gui.Combo.chained),edb.Array.mixin(null,edb.Type.$staticmixins(),{observe:edb.Type.$observe,unobserve:edb.Type.$unobserve,isConstructor:function(o){return gui.Type.isConstructor(o)&&gui.Class.ancestorsAndSelf(o).indexOf(edb.Array)>-1},ontick:function(tick){var snapshot,handlers,observers=this._observers;tick.type===edb.TICK_PUBLISH_CHANGES&&(snapshot=gui.Object.copy(this._changes),this._changes=Object.create(null),gui.Object.each(snapshot,function(instanceid,changes){(handlers=observers[instanceid])&&handlers.forEach(function(handler){handler.onchange(changes)})}))},_observers:Object.create(null),_changes:Object.create(null),$onaccess:function(array,index){edb.$accessaware&&gui.Broadcast.dispatch(edb.BROADCAST_ACCESS,[array])},$onchange:function(array,index,removed,added){var key=array.$instanceid,all=this._changes;(all[key]||(all[key]=[])).push(new edb.ArrayChange(array,index,removed,added)),gui.Tick.dispatch(edb.TICK_PUBLISH_CHANGES,0)}}),function(proto){var beforeaccess=gui.Combo.before(function(){edb.$accessaware&&edb.Array.$onaccess(this,-1)});!function(protoToDecorate,methods){methods.forEach(function(method){protoToDecorate[method]=beforeaccess(protoToDecorate[method])})}(proto,["filter","forEach","every","map","some","indexOf","lastIndexOf","slice"])}(edb.Array.prototype),gui.Tick.add(edb.TICK_PUBLISH_CHANGES,edb.Array),gui.Object.extendmissing(edb.Array.prototype,edb.Type.prototype),edb.ObjectPopulator=function(isdefined,iscomplex,isfunction,isconstructor){function definitions(handler){var Type=edb.Object.is(handler)?edb.Object:edb.Array,Base=edb.Object.is(handler)?Object:Array,keys=[],classes=[edb.Type,Type,Base];return gui.Object.all(handler,function(key){isregular(key)&&classes.every(function(o){return void 0===o.prototype[key]})&&keys.push(key)}),keys}function evalheaders(json,type){var id=json.$originalid||json.$instanceid;delete json.$instanceid,delete json.$originalid,id&&Object.defineProperty(type,"$originalid",gui.Property.nonenumerable({value:id}))}function faildefined(name,key){throw new TypeError(name+' declares "'+key+'" as something undefined')}function failconstructor(name,key){throw new TypeError(name+' "'+key+'" must resolve to a constructor')}function isregular(key){return key.match(/^[a-z]/i)}function lookupDescriptor(proto,key){return proto.hasOwnProperty(key)?Object.getOwnPropertyDescriptor(proto,key):(proto=Object.getPrototypeOf(proto))?lookupDescriptor(proto,key):null}return{populate:function(json,type){var Def,def,val,desc,types=Object.create(null),base=type.constructor.prototype,name=type.constructor.$classname,pure=[];return evalheaders(json,type),definitions(type).forEach(function(key){switch(def=type[key],val=json[key],def){case Object:val&&gui.Type.isObject(val)?type[key]=JSON.parse(JSON.stringify(val)):type[key]=null,pure.push(key);break;case Array:val&&Array.isArray(val)?type[key]=JSON.parse(JSON.stringify(val)):type[key]=null,pure.push(key);break;default:isdefined(val)?isdefined(def)?iscomplex(def)&&(isfunction(def)?(isconstructor(def)||(def=def(val)),isconstructor(def)?null!==val&&(Def=def,types[key]=Def.from(json[key])):failconstructor(name,key)):types[key]=edb.Type.cast(isdefined(val)?val:def)):faildefined(name,key):isregular(key)&&edb.Type.isConstructor(def)?(json[key]=null,types[key]=def):(desc=lookupDescriptor(base,key))&&Object.defineProperty(json,key,desc)}}),gui.Object.nonmethods(json).filter(function(key){return-1===pure.indexOf(key)}).forEach(function(key){var def_=json[key];isregular(key)&&gui.Type.isComplex(def_)&&(types[key]||(types[key]=edb.Type.cast(def_)))}),types}}}(gui.Type.isDefined,gui.Type.isComplex,gui.Type.isFunction,gui.Type.isConstructor),edb.ArrayPopulator=function(Type){function oflist(array){return array.$of&&array.$of.prototype.reverse}function islist(o){return Array.isArray(o)||edb.Array.is(o)}function constructas(EdbType,o){if(!gui.debug||edb.Type.isConstructor(EdbType)){if(!edb.Type.is(o))return new EdbType(o);if(EdbType.is(o))return o;fail(EdbType,o)}else fail("edb.Type",EdbType)}function filterfrom(filter,o){var t=filter(o);return Type.isConstructor(t)&&(t=constructas(t,o)),t}function fail(expected,received,message){throw new TypeError("$of expected "+expected+", got "+received+(message?" ("+message+")":""))}function guidedconvert(args,array){return args.map(function(o){return void 0!==o&&(o=Type.isConstructor(array.$of)?constructas(array.$of,o):filterfrom(function(x){return array.$of(x)},o)),o})}function autoconvert(args){return args.map(function(o){if(!edb.Type.is(o))switch(Type.of(o)){case"object":return new edb.Object(o);case"array":return new edb.Array(o)}return o})}return{populate:function(array,args){var first=args[0];first&&(!oflist(array)&&islist(first)&&(args=first),Array.prototype.push.apply(array,this.convert(array,args)))},convert:function(array,args){if(args=gui.Array.from(args),Type.isNull(array.$of))return autoconvert(args);if(Type.isFunction(array.$of))return guidedconvert(args,array);var type=Type.of(array.$of);throw new Error(array+" cannot be $of "+type)}}}(gui.Type),edb.ObjectProxy=function(){function getter(key,base){return function(){var result=base.apply(this);return edb.$accessaware&&!suspend&&edb.Object.$onaccess(this,key),result}}function setter(key,base){return function(newval){suspend=!0;var oldval=this[key];base.apply(this,arguments),(newval=this[key])!==oldval&&edb.Object.$onchange(this,key,oldval,newval),suspend=!1}}function deepclone(thing){try{thing=JSON.parse(JSON.stringify(thing))}catch(exception){console.error("Could not parse as JSON",exception.message,thing)}return thing}var suspend=!1;return{approximate:function(target,handler,types){gui.Object.ownmethods(target).forEach(function(key){handler[key]=target[key]}),target=gui.Object.copy(target),gui.Object.nonmethods(target).forEach(function(key){var desc=Object.getOwnPropertyDescriptor(target,key);desc.configurable&&Object.defineProperty(handler,key,{enumerable:desc.enumerable,configurable:desc.configurable,get:getter(key,function(){if(desc.get)return desc.get.call(this);var inst=types[key];return inst&&edb.Type.is(inst)?inst:target[key]}),set:setter(key,function(value){var Type,type;if(desc.set)desc.set.call(this,value);else if(type=types[key])edb.Type.is(value)?types[key]=value:null===value?types[key]=null:((Type=edb.Type.is(type)?type.constructor:type).from||console.error('Bad setup for "'+key+'"'),types[key]=Type.from(value)),edb.Object.$onchange(handler,key,type,types[key]);else{var oldval=target[key],cast=(Type=handler.constructor).prototype[key];switch(cast){case Object:case Array:if(!gui.Type.isNull(value)&&!gui.Type.isComplex(value))throw new TypeError("Expected "+cast);target[key]=deepclone(value),oldval!==value&&edb.Object.$onchange(handler,key,oldval,value);break;default:target[key]=edb.Type.cast(value)}}})})})}}}(),edb.Change=function(){},edb.Change.prototype={object:null,type:null},edb.ObjectChange=function(object,name,type,oldval,newval){this.object=object,this.name=name,this.type=type,this.oldValue=oldval,this.newValue=newval},edb.ObjectChange.prototype=gui.Object.create(edb.Change.prototype,{name:null,oldValue:void 0,newValue:void 0}),edb.ObjectChange.TYPE_UPDATE="update",edb.ArrayChange=function(array,index,removed,added){this.type=edb.ArrayChange.TYPE_SPLICE,this.object=array,this.index=index,this.removed=removed||[],this.added=added||[]},edb.ArrayChange.prototype=gui.Object.create(edb.Change.prototype,{index:-1,removed:null,added:null}),edb.ArrayChange.TYPE_SPLICE="splice",edb.ArrayChange.toSpliceParams=function(change){if(change.type===edb.ArrayChange.TYPE_SPLICE){var idx=change.index,out=change.removed.length,add=change.added;return[idx,out].concat(add)}throw new TypeError},edb.Output=function(chained){return gui.Class.create({get:function(){var input=edb.Output.$get(this._type);return input?input.data:null},revoke:chained(function(){edb.Output.$revoke(this._type)}),connect:chained(function(handler){edb.Input.$connect(this._type,handler)}),disconnect:chained(function(handler){edb.Input.$disconnect(this._type,handler)}),_type:null,$onconstruct:function(Type){this._type=Type},add:function(){return this.connect.apply(this,arguments)},remove:function(){return this.disconnect.apply(this,arguments)}},{},{$output:chained(function(type){var input=this._makeinput(type.constructor,type);gui.Broadcast.dispatch(edb.BROADCAST_OUTPUT,input)}),$revoke:chained(function(type){var Type=edb.Type.is(type)?type.constructor:type,nullinput=this._makeinput(Type,null);gui.Broadcast.dispatch(edb.BROADCAST_OUTPUT,nullinput),delete this._map[Type.$classid]}),$is:function(Type){if(Type){if(this._map){var classid=Type.$classid;return!!this._map[classid]}return!1}throw new TypeError("No such Type")},$get:function(Type){if(Type){if(this._map){var classid=Type.$classid,typeobj=this._map[classid];return typeobj?new edb.Input(typeobj.constructor,typeobj):null}return null}throw new TypeError("No such Type")},_map:{},_makeinput:function(Type,type){var classid=Type.$classid;return this._map[classid]=type,new edb.Input(Type,type)}})}(gui.Combo.chained),edb.Input=function(chained,memoized,Interface,GuiType,GuiClass){var handlers=new gui.MapList;return gui.Class.create({type:null,data:null,revoked:!1,onconstruct:function(Type,type){if(!edb.Type.is(type)&&null!==type)throw new TypeError(type+" is not a Type instance");this.type=Type,this.data=type}},{},{IInputHandler:{oninput:function(i){},toString:function(){return"[interface InputHandler]"}},$connect:chained(function(Types,handler){Types=this.$breakdown(Types),Interface.validate(this.IInputHandler,handler)&&Types.every(this._check)&&this._add(Types,handler)}),$disconnect:chained(function(Types,handler){return Types=this.$breakdown(Types),Interface.validate(this.IInputHandler,handler)&&Types.every(this._check)&&this._remove(Types,handler),Types}),$breakdown:function(arg){return GuiType.isArray(arg)?this._breakarray(arg):this._breakother(arg)},$onoutput:function(input){var Type,type=input.data;null===type||handlers.each(function(classid,list){Type=GuiClass.get(classid),type instanceof Type&&list.slice().forEach(function(handler){handler.oninput(input)})})},$bestmatch:function(target,types,up){return this._bestmatch(target.$classid,types.map(function(type){return type.$classid}),up)},$rateall:function(target,types,up,action){types.forEach(function(type){action(type,this.$rateone(up?target:type,up?type:target))},this)},$rateone:function(target,type){return this._rateone(target.$classid,type.$classid)},_breakarray:function(array){return array.map(function(o){switch(GuiType.of(o)){case"function":return o;case"string":return gui.Object.lookup(o);case"object":console.error("Expected function. Got object.")}},this)},_breakother:function(arg){switch(GuiType.of(arg)){case"function":return[arg];case"string":return this._breakarray(arg.split(" "));case"object":console.error("Expected function. Got object.")}},_add:function(Types,handler){Types.filter(function(Type){return handlers.add(Type.$classid,handler)}).forEach(function(Type){GuiClass.descendantsAndSelf(Type,function(T){if(T.isOutput()){var input=edb.Output.$get(Type);handler.oninput(input)}},this)},this)},_remove:function(Types,handler){Types.forEach(function(Type){handlers.remove(Type.$classid,handler)})},_check:function(Type){if(!GuiType.isDefined(Type))throw new TypeError("Could not register input for undefined Type");return!0},_bestmatch:memoized(function(targetid,typeids,up){var best=null,rating=Number.MAX_VALUE,target=gui.Class.get(targetid),types=typeids.map(function(id){return gui.Class.get(id)});return this.$rateall(target,types,up,function(type,rate){rate>-1&&rate<rating&&(rating=rate,best=type)}),best}),_rateone:memoized(function(targetid,typeid){var target=gui.Class.get(targetid),type=gui.Class.get(typeid),r=0,rating=-1,parent=target;if(target===type)rating=0;else for(;parent=gui.Class.parent(parent);)r++,parent===type&&(parent=null,rating=r);return rating}),add:function(){console.error("Deprecated API is deprecated: edb.Input.add()")},remove:function(){console.error("Deprecated API is deprecated: edb.Input.remove()")},$add:function(){return console.error("Deprecated API is deprecated: edb.Input.$add(). Use edb.Input.$connect()"),this.$connect.apply(this,arguments)},$remove:function(){return console.error("Deprecated API is deprecated: edb.Input.$remove(). Use edb.Input.$disconnect()"),this.$disconnect.apply(this,arguments)}})}(gui.Combo.chained,gui.Combo.memoized,gui.Interface,gui.Type,gui.Class),gui.Broadcast.add(edb.BROADCAST_OUTPUT,{onbroadcast:function(b){edb.Input.$onoutput(b.data)}}),edb.Crawler=function(){function Crawler(){}function crawl(type,handler){gui.Object.each(type,istype).forEach(function(oneType){handle(oneType,handler),crawl(oneType,handler)})}function istype(key,value){if(edb.Type.is(value))return value}function handle(type,handler){handler.ontype&&handler.ontype(type),handler.onarray&&edb.Array.is(type)&&handler.onarray(type),handler.onobject&&edb.Object.is(type)&&handler.onobject(type)}return Crawler.prototype={crawl:function(type,handler){if(!edb.Type.is(type))throw new TypeError;handle(type,handler),crawl(type,handler)}},Crawler}(),edb.Serializer=function(){function Serializer(){}function isType(thing){return edb.Type.is(thing)}function isArray(type){return edb.Array.is(type)}function parse(type){return isArray(type)?asArray(type):asObject(type)}function asObject(type){var map=gui.Object.map(type,mapObject,type);return{$object:gui.Object.extend({$classname:type.$classname,$instanceid:type.$instanceid,$originalid:type.$originalid},map)}}function asArray(type){return gui.Object.extend(asObject(type),{$array:mapArray(type)})}function mapObject(key,value){var c=key.charAt(0);if(!("_"===c||"$"===c||isArray(this)&&key.match(INTRINSIC))){if(isType(value))return parse(value);if(!gui.Type.isComplex(value)){if(isType(this)){var base=this.constructor.prototype,desc=Object.getOwnPropertyDescriptor(base,key);if(desc&&(desc.set||desc.get))return}return value}switch(value.constructor){case Object:case Array:return value}}}function mapArray(type){return Array.map(type,function(thing){return isType(thing)?parse(thing):thing})}Serializer.prototype={serializeToString:function(type,filter,tabs){if(isType(type))return JSON.stringify(parse(type),filter,tabs);throw new TypeError("Expected edb.Object|edb.Array")}};var INTRINSIC=/^length|^\d+/;return Serializer}(),edb.Parser=function(){function Parser(){}function parse(json,type){var Type,name;if(null===type||(type?Type=(name=type.$classname||name)?type:gui.Object.lookup(name):(name=json.$object.$classname,Type=gui.Object.lookup(name))),json=mapValue(json),null===type)return json;if(Type)return Type.from(json);var error=new TypeError(name+" is not defined");throw name===gui.Class.ANONYMOUS&&console.error('TODO: Spiritual should make sure that nothing is ever "'+name+'"\n'+JSON.stringify(json,null,4)),error}function isType(json){return gui.Type.isComplex(json)&&(json.$array||json.$object)}function asObject(type){return gui.Object.map(type.$object,mapObject)}function asArray(type){var members=type.$array.map(mapValue);return members.$object=type.$object,members}function mapObject(key,value){switch(key){case"$classname":return;default:return mapValue(value)}}function mapValue(value){return isType(value)?value.$array?asArray(value):asObject(value):value}return Parser.prototype={parseFromString:function(json,type){try{json=JSON.parse(json)}catch(JSONException){throw new TypeError("Bad JSON: "+JSONException.message)}finally{if(isType(json))return parse(json,type);throw new TypeError("Expected serialized edb.Object|edb.Array")}}},Parser}(),edb.InputPlugin=function(chained,Input){return gui.TrackerPlugin.extend({done:!0,onconstruct:function(){gui.TrackerPlugin.prototype.onconstruct.call(this),this._watches=[],this._matches=[],this._needing=[]},ondestruct:function(){gui.TrackerPlugin.prototype.ondestruct.call(this),this.disconnect(this._watches)},connect:chained(function(arg,handler,required){var Types=Input.$breakdown(arg);Types.length&&(this.done=this.done&&!1===required,Types.forEach(function(Type){this._addchecks(Type.$classid,[handler||this.spirit]),this._watches.push(Type),required&&this._needing.push(Type)},this),Input.$connect(Types,this))}),disconnect:chained(function(arg,handler){var Types=Input.$breakdown(arg);Types.length&&(Types.forEach(function(Type){this._removechecks(Type.$classid,[handler||this.spirit]),gui.Array.remove(this._watches,Type),gui.Array.remove(this._needing,Type),this._matches=this._matches.filter(function(input){return input.type!==Type})},this),Input.$disconnect(Types,this),this.done=this._done())}),one:function(){console.error("Not supported just yet: "+this+".one()")},get:function(Type){var Types=this._matches.map(function(input){return input.data.constructor}),best=Input.$bestmatch(Type,Types,!1),input=best?this._matches.filter(function(inputMatch){return inputMatch.type===best}).shift():null;return input?input.data:null},oninput:function(input){this.$oninput(input)},match:function(input){return!(this._matches.length&&!this._matches.every(function(match){return match.$instanceid!==input.$instanceid}))&&this._maybeinput(input)},add:function(){return console.error("Deprecated API is deprecated: input.add(). Use input.connect()"),this.connect.apply(this,arguments)},remove:function(){return console.error("Deprecated API is deprecated: input.remove(). Use input.disconnect()"),this.disconnect.apply(this,arguments)},$oninput:function(input){if(input)return null===input.data?(this._mayberevoke(input),!1):this.match(input);throw new TypeError("Bad input: "+input+" "+(this.spirit||""))},_watches:null,_matches:null,_needing:null,_maybeinput:function(input){var best=Input.$bestmatch(input.type,this._watches,!0);return!!best&&(this._updatematch(input,best),this.done=this._done(),this._updatehandlers(input),!0)},_mayberevoke:function(input){var matches=this._matches,watches=this._watches,best=Input.$bestmatch(input.type,watches,!0);if(best){var oldinput=matches.filter(function(inputFilter){return inputFilter.type===best})[0],index=matches.indexOf(oldinput);matches.splice(index,1),this.done=this._done(),this.done||(input.revoked=!0,this._updatehandlers(input))}},_updatematch:function(newinput,bestmatch){var matches=this._matches,oldindex=-1,oldrating=-1,newrating=Input.$rateone(newinput.type,bestmatch);matches.forEach(function(match,i){(oldrating=Input.$rateone(match.type,bestmatch))>-1&&oldrating<=newrating&&(oldindex=i)}),oldindex>-1?matches[oldindex]=newinput:matches.push(newinput)},_updatehandlers:function(input){gui.Class.ancestorsAndSelf(input.type,function(Type){var list=this._trackedtypes[Type.$classid];list&&list.forEach(function(checks){checks[0].oninput(input)})},this)},_done:function(){var needs=this._needing,haves=this._matches;return needs.every(function(Type){return haves.some(function(input){return input.data instanceof Type})})},_cleanup:function(classid,checks){if(this._removechecks(classid,checks)){var Type=gui.Class.get(classid);Input.$disconnect(Type,this)}}})}(gui.Combo.chained,edb.Input),gui.module("edb@wunderbyte.com",{plugin:{input:edb.InputPlugin},mixin:{oninput:function(input){}}}),edb.Synchronizer=function(){function sync(type,ways,global){var id=type.$originalid||type.$instanceid;4!==ways&&1!==ways||syncto(type,id,global),4!==ways&&2!==ways||syncas(type,id,global),type.$synchronizity=ways,type.$synchglobally=global||!1}function syncto(type,id,global){var broadcast=edb.SyncTransmitter.BROADCAST+id,addscoped=global?"addGlobal":"add";gui.Broadcast[addscoped](broadcast,new edb.SyncReceiver(type))}function syncas(type,id,global){type.addObserver(edb.SyncTransmitter),global&&(edb.Synchronizer.globals[id]=!0)}return{$NONE:0,$SYNC_AS:1,$SYNC_TO:2,$SYNC:4,globals:Object.create(null),sync:gui.Arguments.confirmed("object","number","(boolean)")(function(type,ways,global){return(new edb.Crawler).crawl(type,{ontype:function(t){t.$synchronizity||sync(t,ways,global)}}),type})}}(),edb.ObjectSync=function(change,instanceid){change=gui.Object.copy(change),change=edb.ObjectSync.experimental(change),change=edb.ObjectSync.filter(change),gui.Object.extend(this,change),this.$instanceid=instanceid},edb.ObjectSync.prototype={name:null,type:null,newValue:null,$instanceid:null},edb.ObjectSync.experimental=function(change){var old=change.oldValue,neu=change.newValue;return edb.Type.is(old)&&(change.$synchronizity=old.$synchronizity,change.$synchglobally=old.$synchglobally,change.newValue=JSON.parse(neu.serializeToString())),change},edb.ObjectSync.filter=function(change){return gui.Object.map(change,function(key,value){if(!key.match(/oldValue|object/))return value})},edb.ArraySync=function(change,instanceid){var array=change.object;this.$synchronizity=array.$synchronizity,this.$synchglobally=array.$synchglobally,this.type=edb.ArrayChange.TYPE_SPLICE,change.added=change.added.map(function(thing){return edb.Type.is(thing)?JSON.parse(thing.serializeToString()):thing}),this.args=edb.ArrayChange.toSpliceParams(change),this.$instanceid=instanceid},edb.ArraySync.prototype={type:null,args:null,$instanceid:null},edb.SyncTransmitter=function(confirmed){function onchange(changes){var dispatch={},syncdone=[];changes.forEach(function(c){maybechange(c,c.object,dispatch,syncdone)}),gui.Object.each(dispatch,function(id,syncs){var method=edb.Synchronizer.globals[id]?"dispatchGlobal":"dispatch";gui.Broadcast[method](edb.SyncTransmitter.BROADCAST+id,syncs)}),syncdone.forEach(function(type){delete type.$willsync})}function maybechange(change,type,dispatch,syncdone){var sourceid=type.$instanceid,targetid=type.$originalid||sourceid;type.$willsync?syncdone.push(type):(setupsync(change),(dispatch[targetid]=dispatch[targetid]||[]).push(getchange(change,sourceid)))}function getchange(change,sourceid){switch(change.type){case edb.ObjectChange.TYPE_UPDATE:return new edb.ObjectSync(change,sourceid);case edb.ArrayChange.TYPE_SPLICE:return new edb.ArraySync(change,sourceid)}}function setupsync(change){function maybesync(thing){edb.Type.is(thing)&&edb.Synchronizer.sync(thing,change.object.$synchronizity,change.object.$synchglobally)}switch(change.type){case edb.ObjectChange.TYPE_UPDATE:maybesync(change.newValue);break;case edb.ArrayChange.TYPE_SPLICE:change.added.forEach(maybesync)}}return{BROADCAST:"edb-synchronize-",onchange:function(changes){onchange(changes)}}}(gui.Arguments.confirmed),edb.SyncReceiver=function(type){this.type=type},edb.SyncReceiver.prototype={type:null,onbroadcast:function(b){var type=this.type,changes=b.data;changes.some(function(c){return c.$instanceid!==type.$instanceid})&&changes.forEach(function(c){this._change(type,c)},this)},_change:function(type,c){switch(c.type){case edb.ObjectChange.TYPE_UPDATE:this._objectchange(type,c);break;case edb.ArrayChange.TYPE_SPLICE:this._arraychange(type,c)}},_objectchange:function(type,c){var name=c.name,value=c.newValue;type[name]!==value&&(value&&(value.$object||value.$array)&&(value=JSON.stringify(value),value=(new edb.Parser).parseFromString(value),edb.Synchronizer.sync(value,c.$synchronizity,c.$synchglobally)),type.$willsync=!0,type[name]=value)},_arraychange:function(type,c){type.$willsync=!0;var isobject=gui.Type.isObject,x=c.args.slice(2).map(function(thing){return isobject(thing)&&(thing.$object||thing.$array)&&(thing=JSON.stringify(thing),thing=(new edb.Parser).parseFromString(thing),edb.Synchronizer.sync(thing,c.$synchronizity,c.$synchglobally)),thing});x.unshift(c.args[1]),x.unshift(c.args[0]),type.splice.apply(type,x)}},gui.module("edb-sync@wunderbyte.com",{oncontextinitialize:function(){function sync(Type,source,ways,global){return edb.Synchronizer.sync(Type.from(source),ways,global)}edb.Type.mixin({$synchronizity:edb.SyncTransmitter.$NONE,$synchglobally:!1},{syncAs:function(source){return sync(this,source,edb.Synchronizer.$SYNC_AS)},syncTo:function(source){return sync(this,source,edb.Synchronizer.$SYNC_TO)},sync:function(source){return sync(this,source,edb.Synchronizer.$SYNC)},syncGlobalAs:function(source){return sync(this,source,edb.Synchronizer.$SYNC_AS,!0)},syncGlobalTo:function(source){return sync(this,source,edb.Synchronizer.$SYNC_TO,!0)},syncGlobal:function(source){return sync(this,source,edb.Synchronizer.$SYNC,!0)}})}})}(),function(window){"use strict";!function(root){if(root.atob)try{root.atob(" ")}catch(e){root.atob=function(atob){var func=function(string){return atob(String(string).replace(/[\t\n\f\r ]+/g,""))};return func.original=atob,func}(root.atob)}else{var b64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",b64re=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/;root.btoa=function(string){for(var bitmap,a,b,c,result="",i=0,rest=(string=String(string)).length%3;i<string.length;){if((a=string.charCodeAt(i++))>255||(b=string.charCodeAt(i++))>255||(c=string.charCodeAt(i++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");bitmap=a<<16|b<<8|c,result+=b64.charAt(bitmap>>18&63)+b64.charAt(bitmap>>12&63)+b64.charAt(bitmap>>6&63)+b64.charAt(63&bitmap)}return rest?result.slice(0,rest-3)+"===".substring(rest):result},root.atob=function(string){if(string=String(string).replace(/[\t\n\f\r ]+/g,""),!b64re.test(string))throw new TypeError("Failed to execute 'atob' on 'Window': The string to be decoded is not correctly encoded.");string+="==".slice(2-(3&string.length));for(var bitmap,r1,r2,result="",i=0;i<string.length;)bitmap=b64.indexOf(string.charAt(i++))<<18|b64.indexOf(string.charAt(i++))<<12|(r1=b64.indexOf(string.charAt(i++)))<<6|(r2=b64.indexOf(string.charAt(i++))),result+=64===r1?String.fromCharCode(bitmap>>16&255):64===r2?String.fromCharCode(bitmap>>16&255,bitmap>>8&255):String.fromCharCode(bitmap>>16&255,bitmap>>8&255,255&bitmap);return result}}}(self),window.ts=window.ts||{toString:function(){return"[namespace ts]"}},gui.$mark("- parse runtime"),gui.autostrap=!1,ts.ui=gui.namespace("ts.ui",function(Client,guiArray,confirmed,chained){var breakpointers=[];return{version:"9.1.2",greenfield:!1,frankenstein:function(path){var vendorappid=/[A-Z][A-Za-z]+\.[A-Z][A-Za-z]+/;return!(window===top||!(path.includes("/app/")||path.includes("/v4/")||path.match(vendorappid)))}(window.location.pathname),topframe:!1,subframe:!1,appframe:!0,breakpoint:null,usetransitions:Client.hasTransitions,hasPointers:Client.hasPointers||!Client.isExplorer9,TRADESHIFT_HOME:"/",UNIT:22,UNIT_HALF:11,UNIT_DOUBLE:44,UNIT_TRIPLE:66,CLASS_ENGINE:"ts-engine-"+Client.agent,CLASS_MOBILE:"ts-mobile",CLASS_TABLET:"ts-tablet",CLASS_DESKTOP:"ts-desktop",CLASS_SELECT:"ts-select",CLASS_MOBILE_ONLY:"ts-mobile-only",CLASS_TABLET_ONLY:"ts-tablet-only",CLASS_DESKTOP_ONLY:"ts-desktop-only",CLASS_HAS_TOPBAR:"ts-has-topbar",CLASS_HAS_TOPBAR_TABS:"ts-has-topbar-tabs",CLASS_HAS_NOTE:"ts-has-note",CLASS_USEFLEX:"ts-useflex",CLASS_NOFLEX:"ts-noflex",CLASS_USETRANSITION:"ts-usetransition",CLASS_NOTRANSITION:"ts-notransition",CLASS_TRANSITION:"ts-transition",CLASS_PRIMARY:"ts-primary",CLASS_SECONDARY:"ts-secondary",CLASS_TERTIARY:"ts-tertiary",CLASS_DANGER:"ts-danger",CLASS_VISIBLE:"ts-visible",CLASS_HIDDEN:"ts-hidden",CLASS_LOADING:"ts-loading",CLASS_BLOCKING:"ts-blocking",CLASS_NONBLOCKING:"ts-nonblocking",CLASS_WAITING:"ts-waiting",CLASS_READY:"ts-ready",CLASS_BUSY:"ts-busy",CLASS_OPEN:"ts-open",CLASS_CLOSED:"ts-closed",CLASS_OPENING:"ts-opening",CLASS_CLOSING:"ts-closing",CLASS_TOP:"ts-top",CLASS_RIGHT:"ts-right",CLASS_BOTTOM:"ts-bottom",CLASS_LEFT:"ts-left",CLASS_MICRO:"ts-micro",CLASS_MACRO:"ts-macro",CLASS_CHECKED:"ts-checked",CLASS_SELECTED:"ts-selected",CLASS_SUCCESS:"ts-success",CLASS_WARNING:"ts-warning",CLASS_ERROR:"ts-error",CLASS_INFO:"ts-info",CLASS_OPTIMIZED:"ts-optimized",CLASS_MAIN:"ts-main",CLASS_IFRAME:"ts-iframe",CLASS_MAINFRAME:"ts-mainframe",CLASS_TABS:"ts-tabs",CLASS_COVER:"ts-cover",CLASS_ASIDE:"ts-aside",CLASS_DRAWER:"ts-drawer",CLASS_HEADER:"ts-header",CLASS_PANEL:"ts-panel",CLASS_MENU:"ts-menu",CLASS_BUTTON:"ts-button",CLASS_BUTTONS:"ts-buttons",CLASS_LINK:"ts-link",CLASS_DIALOG:"ts-dialog",CLASS_NOTE:"ts-note",CLASS_LOADING_BAR:"ts-loading-bar",CLASS_IS_LOADING:"ts-is-loading",CLASS_FORM:"ts-form",CLASS_PREVIEW:"ts-preview",CLASS_FIELD:"ts-field",CLASS_GROUP:"ts-group",CLASS_TEXT:"ts-text",CLASS_DATE:"ts-date",CLASS_TIME:"ts-time",CLASS_FAKE:"ts-fake",CLASS_TEXTAREA:"ts-textarea",CLASS_FIELDLABEL:"ts-fieldlabel",CLASS_TEXTLABEL:"ts-textlabel",CLASS_DATELABEL:"ts-datelabel",CLASS_FAKELABEL:"ts-fakelabel",CLASS_SWITCHLABEL:"ts-switchlabel",CLASS_CUSTOMICONLABEL:"ts-customiconlabel",CLASS_OPTIONS:"ts-options",CLASS_OPTION:"ts-option",CLASS_FOCUS:"ts-focus",CLASS_FOCUS_ON:"ts-focus-on",CLASS_EMPTY:"ts-empty",CLASS_SWITCHBOX:"ts-switchbox",CLASS_DISABLED:"ts-disabled",CLASS_READONLY:"ts-readonly",CLASS_REQUIRED:"ts-required",CLASS_NOLOCK:"ts-nolock",CLASS_HASLABEL:"ts-haslabel",CLASS_BG_LITE:"ts-bg-lite",CLASS_BG_WHITE:"ts-bg-white",CLASS_BG_DARK:"ts-bg-dark",CLASS_BG_BLUE:"ts-bg-blue",CLASS_BG_GREEN:"ts-bg-green",CLASS_BG_YELLOW:"ts-bg-yellow",CLASS_BG_ORANGE:"ts-bg-orange",CLASS_BG_RED:"ts-bg-red",CLASS_BG_PURPLE:"ts-bg-purple",CLASS_BLACK:"ts-color-black",CLASS_DARK:"ts-color-dark",CLASS_MEDIUM:"ts-color-medium",CLASS_LITE:"ts-color-lite",CLASS_WHITE:"ts-color-white",CLASS_BLUE:"ts-color-blue",CLASS_GREEN:"ts-color-green",CLASS_YELLOW:"ts-color-yellow",CLASS_ORANGE:"ts-color-orange",CLASS_RED:"ts-color-red",CLASS_PURPLE:"ts-color-purple",ICON_CLOSE:"ts-icon-close",ACTION_CLICK:"ts-action-click",ACTION_CLOSE:"ts-action-close",ACTION_SWITCH:"ts-action-switch",ACTION_DID_LOAD:"ts-action-did-load",ACTION_CHANGED:"ts-action-changed",ACTION_FRAME_ONDOM:"ts-action-frame-ondom",ACTION_FRAME_ONLOAD:"ts-action-frame-onload",ACTION_FRAME_UNLOAD:"ts-action-frame-unload",ACTION_FRAME_ONHASH:"ts-action-frame-onhash",ACTION_ASIDE_WILL_OPEN:"ts-action-aside-will-open",ACTION_ASIDE_DID_OPEN:"ts-action-aside-did-open",ACTION_ASIDE_WILL_CLOSE:"ts-action-aside-will-close",ACTION_ASIDE_DID_CLOSE:"ts-action-aside-did-close",ACTION_SAFE_LINK:"ts-action-safe-link",ACTION_SAFE_BUTTON:"ts-action-safe-button",ACTION_SAFE_FORM:"ts-action-safe-form",ACTION_PANEL_ATTACH:"ts-action-panel-attach",ACTION_PANEL_DETACH:"ts-action-panel-detach",ACTION_PANEL_SHOW:"ts-action-panel-show",ACTION_PANEL_HIDE:"ts-action-panel-hide",ACTION_PAGER_SELECT:"ts-action-pager-select",ACTION_STATUSBAR_LEVEL:"ts-action-statusbar-level",ACTION_FOOTER_LEVEL:"ts-action-footer-level",ACTION_ROOT_CLASSNAMES:"ts-action-root-classnames",MESSAGE_BUSY:"ts-busy",MESSAGE_DONE:"ts-done",ACTION_GLOBAL_LOAD:"ts-action-g-load",ACTION_GLOBAL_LOAD_HTML:"ts-action-g-load-html",ACTION_GLOBAL_LOCATION_CHANGEHREF:"ts-action-g-location-changehref",ACTION_GLOBAL_LOCATION_CHANGEHASH:"ts-action-g-location-changehash",ACTION_GLOBAL_MODELS_INITIALIZE:"ts-action-g-models-initialize",ACTION_GLOBAL_COMPLETED:"ts-action-g-completed",ACTION_GLOBAL_TERMINATE:"ts-action-g-terminate",ACTION_GLOBAL_MESSAGE_UP:"ts-action-g-message-up",ACTION_GLOBAL_MESSAGE_DOWN:"ts-action-g-message-down",ACTION_GLOBAL_DOCUMENT_TITLE:"ts-action-g-document-title",ACTION_GLOBAL_LOCALSTORAGE_SET:"ts-action-g-localdata-set",ACTION_GLOBAL_LOCALSTORAGE_ERROR:"ts-action-g-localdata-error",ACTION_GLOBAL_ANALYTICS_READY:"ts-action-g-analytics-ready",ACTION_GLOBAL_ANALYTICS_SETUP:"ts-action-g-analytics-setup",ACTION_GLOBAL_ANALYTICS_TRACK:"ts-action-g-analytics-track",BROADCAST_COMPLETED:"ts-broadcast-completed",BROADCAST_TERMINATE:"ts-broadcast-terminate",BROADCAST_DIALOG_WILL_OPEN:"ts-broadcast-dialog-will-open",BROADCAST_DIALOG_GO_OPEN:"ts-broadcast-dialog-go-open",BROADCAST_DIALOG_DID_OPEN:"ts-broadcast-dialog-did-open",BROADCAST_DIALOG_WILL_CLOSE:"ts-broadcast-dialog-will-close",BROADCAST_DIALOG_DID_CLOSE:"ts-broadcast-dialog-did-close",BROADCAST_MODAL_WILL_OPEN:"ts-broadcast-modal-will-open",BROADCAST_MODAL_DID_OPEN:"ts-broadcast-modal-did-open",BROADCAST_MODAL_WILL_CLOSE:"ts-broadcast-modal-will-close",BROADCAST_MODAL_DID_CLOSE:"ts-broadcast-modal-did-close",BROADCAST_ATTENTION_MOVE:"ts-broadcast-attention-move",BROADCAST_PANEL_SYNC_MENU:"ts-broadcast-panel-sync-to-menu",BROADCAST_GLOBAL_MODEL_UPDATE:"ts-broadcast-g-model-update",BROADCAST_GLOBAL_STATUS_BUSY_BLOCKING:"ts-broadcast-g-status-busy-blocking",BROADCAST_GLOBAL_STATUS_DONE_BLOCKING:"ts-broadcast-g-status-done-blocking",BROADCAST_GLOBAL_STATUS_BUSY:"ts-broadcast-g-status-busy",BROADCAST_GLOBAL_STATUS_DONE:"ts-broadcast-g-status-done",BROADCAST_GLOBAL_ALL_BUSY:"ts-broadcast-g-all-busy",BROADCAST_GLOBAL_ALL_DONE:"ts-broadcast-g-all-done",BROADCAST_GLOBAL_DIALOGS_WILL_ON:"ts-broadcast-g-dialogs-will-on",BROADCAST_GLOBAL_DIALOGS_DID_OFF:"ts-broadcast-g-dialogs-did-off",BROADCAST_GLOBAL_DIALOGS_WILL_BLOCK:"ts-broadcast-g-dialogs-will-block",BROADCAST_GLOBAL_DIALOGS_DID_UNBLOCK:"ts-broadcast-g-dialogs-did-unblock",BROADCAST_GLOBAL_ASIDES_WILL_ON:"ts-broadcast-g-asides-will-on",BROADCAST_GLOBAL_ASIDES_DID_ON:"ts-broadcast-g-asides-did-on",BROADCAST_GLOBAL_ASIDES_WILL_OFF:"ts-broadcast-g-asides-will-off",BROADCAST_GLOBAL_ASIDES_DID_OFF:"ts-broadcast-g-asides-did-off",BROADCAST_GLOBAL_ASIDES_DO_CLOSE:"ts-broadcast-g-asides-do-close",BROADCAST_GLOBAL_PROGRESSBAR:"ts-broadcast-g-progressbar",BROADCAST_GLOBAL_APP_LOADING:"ts-broadcast-g-app-loading",BROADCAST_GLOBAL_APP_ABORTED:"ts-broadcast-g-app-aborted",BROADCAST_GLOBAL_APP_COMPLETE:"ts-broadcast-g-app-complete",BROADCAST_GLOBAL_TOPBAR_UPDATE:"ts-broadcast-g-topbar-update",BROADCAST_GLOBAL_TOPBAR_READY:"ts-broadcast-g-topbar-ready",BROADCAST_GLOBAL_TOPBAR_UPDATE_DEFAULT_TITLE:"ts-broadcast-g-topbar-update-default-title",BROADCAST_GLOBAL_USER_WILL_EXIT:"ts-broadcast-g-user-will-exit",BROADCAST_GLOBAL_COVER_TOUCH:"ts-broadcast-global-cover-touch",BROADCAST_GLOBAL_COVER_HOVER:"ts-broadcast-global-cover-hover",BROADCAST_GLOBAL_MENU_OPEN:"ts-broadcast-g-menu-open",BROADCAST_GLOBAL_MENU_CLOSE:"ts-broadcast-g-menu-close",BROADCAST_TO_CHROME:"Tradeshift.Chrome",BROADCAST_CHROME_MENU_OPEN:"ts-broadcast-chrome-menu-open",BROADCAST_CHROME_MENU_CLOSE:"ts-broadcast-chrome-menu-close",EVENT_ASIDE_WILL_OPEN:"ts-open",EVENT_ASIDE_DID_OPEN:"ts-opened",EVENT_ASIDE_WILL_CLOSE:"ts-close",EVENT_ASIDE_DID_CLOSE:"ts-closed",EVENT_FOCUS:"ts-focus",EVENT_BLUR:"ts-blur",TICK_SELECT_CHECK:"ts-tick-select-check",LIFE_STATUS_BUSY:"ts-life-status-busy",LIFE_STATUS_DONE:"ts-life-status-done",TRANSITION_NOW:100,TRANSITION_FAST:200,TRANSITION_SLOW:600,TRANSITION_DELAY:30,TIMING_SLOWDOWN:"cubic-bezier(0,1,0,1)",TIMING_SPEEDUP:"cubic-bezier(1,0,1,0)",ZINDEX_ASIDE:2e3,get:function(){return gui.get.apply(gui,arguments)},init:chained(function(action,opt_thisp){gui.init(action,opt_thisp)}),ready:chained(function(action,opt_thisp){gui.ready(action,opt_thisp)}),openMenu:chained(function(){gui.Broadcast.dispatchGlobal(this.BROADCAST_GLOBAL_MENU_OPEN),ts.app.broadcast(this.BROADCAST_TO_CHROME,this.BROADCAST_CHROME_MENU_OPEN)}),closeMenu:chained(function(){gui.Broadcast.dispatchGlobal(this.BROADCAST_GLOBAL_MENU_CLOSE),ts.app.broadcast(this.BROADCAST_TO_CHROME,this.BROADCAST_CHROME_MENU_CLOSE)}),load:function(href,opt_target){var url=new gui.URL(document,href);this.ready(function(){ts.ui.get("html").action.dispatchGlobal(ts.ui.ACTION_GLOBAL_LOAD,{href:url.href,target:opt_target})})},reflex:chained(function(){ts.ui.get(document.documentElement).reflex()}),isMobilePoint:function(){return this._getlayout().isMobilePoint()},isTabletPoint:function(){return this._getlayout().isTabletPoint()},isDesktopPoint:function(){return this._getlayout().isDesktopPoint()},addBreakPointListener:function(callback){breakpointers.push(callback)},removeBreakPointListener:function(callback){gui.Array.remove(breakpointers,breakpointers.indexOf(callback))},onchange:function(changes){changes.forEach(function(c){c.object instanceof ts.ui.LayoutModel&&"breakpoint"===c.name&&(ts.ui.breakpoint=c.newValue,breakpointers.forEach(function(callback){callback(c.newValue,c.oldValue)}))})},_getlayout:function(){var model=ts.ui.LayoutModel.output.get();return model||console.error(this+" is not initialized"),model},$domloaded:!1,$jsloaded:!1,$maybebootstrap:function(jsloaded){this.$jsloaded=this.$jsloaded||!!jsloaded,this.$domloaded&&this.$jsloaded&&gui.bootstrap()}}}(gui.Client,gui.Array,gui.Arguments.confirmed,gui.Combo.chained)),ts.ui.BACKGROUND_COLORS={dark:ts.ui.CLASS_BG_DARK,lite:ts.ui.CLASS_BG_LITE,white:ts.ui.CLASS_BG_WHITE,blue:ts.ui.CLASS_BG_BLUE,green:ts.ui.CLASS_BG_GREEN,purple:ts.ui.CLASS_BG_PURPLE,yellow:ts.ui.CLASS_BG_YELLOW,orange:ts.ui.CLASS_BG_ORANGE,red:ts.ui.CLASS_BG_RED},ts.ui.COLORS={black:ts.ui.CLASS_BLACK,dark:ts.ui.CLASS_DARK,medium:ts.ui.CLASS_MEDIUM,lite:ts.ui.CLASS_LITE,white:ts.ui.CLASS_WHITE,blue:ts.ui.CLASS_BLUE,green:ts.ui.CLASS_GREEN,purple:ts.ui.CLASS_PURPLE,yellow:ts.ui.CLASS_YELLOW,orange:ts.ui.CLASS_ORANGE,red:ts.ui.CLASS_RED},ts.ui.ICONS={"ts-icon-logo-trade":"K","ts-icon-logo-shift":"L","ts-icon-logo-t1":"M","ts-icon-logo-t2":"N","ts-icon-discovery":"E","ts-icon-activity":"f","ts-icon-todo":"q","ts-icon-network":"G","ts-icon-createdocument":"P","ts-icon-alldocuments":"j","ts-icon-document":";","ts-icon-sales":"X","ts-icon-purchases":"$","ts-icon-cart":"$","ts-icon-drafts":"F","ts-icon-apps":"a","ts-icon-usersettings":"U","ts-icon-settings":"y","ts-icon-companyprofile":"H","ts-icon-logout":"Q","ts-icon-support":"?","ts-icon-checked":"3","ts-icon-accept":"3","ts-icon-done":"3","ts-icon-checked-alt":"2","ts-icon-remove":"D","ts-icon-add":"&","ts-icon-close":"*","ts-icon-location":"@","ts-icon-addfilter":"k","ts-icon-followed":"S","ts-icon-unfollowed":"5","ts-icon-search":"s","ts-icon-statuschange":"1","ts-icon-edit":"p","ts-icon-rating":"r","ts-icon-share":"R","ts-icon-industry":"z","ts-icon-showpicker":"6","ts-icon-warning":"!","ts-icon-timer":"t","ts-icon-comment":"w","ts-icon-more":"+","ts-icon-users":"g","ts-icon-ownership":"\xa7","ts-icon-companysize":"g","ts-icon-view":"I","ts-icon-reject":"d","ts-icon-dispute":"\\","ts-icon-menuswitch":"l","ts-icon-delete":"#","ts-icon-cancel":"d","ts-icon-info":"i","ts-icon-forums":"i","ts-icon-addfield":",","ts-icon-fileaccess":"/","ts-icon-error":"!","ts-icon-appactivate":"&","ts-icon-appactive":"3","ts-icon-fileattach":"A","ts-icon-reset":"n","ts-icon-send":"m","ts-icon-save":"e","ts-icon-proceed":">","ts-icon-back":"<","ts-icon-download":"B","ts-icon-broadcastmessage":"b","ts-icon-insertfrominventory":"|","ts-icon-triangleright":"6","ts-icon-triangleleft":"8","ts-icon-triangleup":"9","ts-icon-triangledown":"7","ts-icon-arrowright":">","ts-icon-arrowleft":"<","ts-icon-arrowup":"u","ts-icon-arrowdown":"v","ts-icon-preview":"o","ts-icon-locked":"V","ts-icon-unlocked":"W","ts-icon-next":">","ts-icon-approve":"3","ts-icon-code":"C","ts-icon-halt":"h","ts-icon-pay":"_","ts-icon-other":"O","ts-icon-myapps":"Y","ts-icon-companyevent":"c","ts-icon-split":"%","ts-icon-split-alt":"\xf7","ts-icon-merge":"J","ts-icon-associated":"=","ts-icon-radio":"{","ts-icon-radioon":":","ts-icon-checkbox":"'","ts-icon-checkboxon":'"',"ts-icon-written-request":"(","ts-icon-categories":")","ts-icon-favorites":"\u2265","ts-icon-heart":"\u2265","ts-icon-preferred":"\u222b","ts-icon-pin":"\u222b","ts-icon-previously-requested":"\u221e","ts-icon-archive":"\xf7","ts-icon-add-to-archive":"\u2205","ts-icon-calendar":"\xa9","ts-icon-select":"}"},ts.ui.ready(function(){var layout=ts.ui.LayoutModel.output.get();ts.ui.breakpoint=layout.breakpoint,layout.addObserver(ts.ui)}),addEventListener("DOMContentLoaded",function(){ts.ui.$domloaded=!0,ts.ui.$maybebootstrap()}),ts.lib=ts.lib||{version:"-1.0.0",toString:function(){return"[namespace ts.lib]"}},ts.lib.Date=function(){function zf(num){return num<10?"0"+num:""+num}function _getDateString(date){void 0===date&&(date=new Date);var month=zf(date.getMonth()+1),day=zf(date.getDate());return date.getFullYear()+"-"+month+"-"+day}function _dateStringToObject(dateString){if(10!==dateString.length)return{year:_getCurrentFullYear(),month:_getCurrentMonth(),day:_getCurrentDay()};var dateArray=dateString.split("-");return{year:parseInt(dateArray[0],10),month:parseInt(dateArray[1]-1,10),day:parseInt(dateArray[2],10)}}function _getCurrentFullYear(){return parseInt((new Date).getFullYear(),10)}function _getCurrentMonth(){return parseInt((new Date).getMonth(),10)}function _getCurrentDay(){return parseInt((new Date).getDate(),10)}var regionalDateFormats=[];regionalDateFormats["en-US"]="mm/dd/yy",regionalDateFormats["en-GB"]="dd/mm/yy",regionalDateFormats.da="dd-mm-yy",regionalDateFormats.hu="yy.mm.dd.";var regionalDateFormat=regionalDateFormats["en-US"];return{getLocalizedDateString:function(date){var dateObj,year=(dateObj="string"==typeof date?_dateStringToObject(date):date).year,month=dateObj.month+1,day=dateObj.day;month=month<10?"0"+month:""+month,day=day<10?"0"+day:""+day,year=""+year;for(var prevChar="x",returnDate="",i=0,regionalDateFormatLength=regionalDateFormat.length;i<regionalDateFormatLength;++i){var currentChar=regionalDateFormat[i];returnDate+="y"===currentChar?year.substr("y"===prevChar?3:2,1):"m"===currentChar?month.substr("m"===prevChar?1:0,1):"d"===currentChar?day.substr("d"===prevChar?1:0,1):currentChar,prevChar=currentChar}return returnDate},dateStringRelativeToNow:function(diffDays){var currentDate=new Date,currentYear=currentDate.getFullYear(),currentMonth=currentDate.getMonth(),currentDay=currentDate.getDate();return _getDateString(new Date(currentYear,currentMonth,currentDay+diffDays))},getCurrentFullYear:_getCurrentFullYear,getCurrentMonth:_getCurrentMonth,getCurrentDay:_getCurrentDay,getCurrentTimestamp:function(){return(new Date).getTime()},getDaysInMonth:function(year,month){return parseInt(32-new Date(year,month,32).getDate(),10)},getFirstDayInMonth:function(year,month){return parseInt(new Date(year,month,1).getDay(),10)},dateStringToObject:_dateStringToObject,getMillisecondsFromISO:function(isoDate){return Date.parse(isoDate)},getDateString:_getDateString,getDateTimeString:function(date){void 0===date&&(date=new Date);var hour=zf(date.getHours()),min=zf(date.getMinutes()),sec=zf(date.getSeconds());return _getDateString(date)+" "+hour+":"+min+":"+sec},getCurrentDateString:function(){return _getDateString(new Date)}}}(),ts.lib.Location=function(){function dohref(href,opt_target){ts.ui.get("html").action.dispatchGlobal(ts.ui.ACTION_GLOBAL_LOAD,{target:opt_target||null,href:href})}function dohash(hash){hash=hash.startsWith("#")?hash.slice(1):hash,location.replace("#"+hash)}return{toString:function(){return"[object ts.lib.Location]"},assign:function(href,opt_target){href.startsWith("#")?dohash(href):dohref(href,opt_target)},reload:function(){console.error("todo")}}}(),ts.ui.Greenfield=function(up,down){function setupactions(){ts.ui.appframe?doaction=function(data){gui.Action.ascendGlobal(document,up,data),handleactions()}:ts.ui.subframe&&gui.get("main",function(main){doaction=function(data){main.action.descendGlobal(down,data)}})}function handleactions(html){gui.Action.addGlobal(document,down,{onaction:function(a){a.consume(),"apply"===a.data.action&&ts.ui.Greenfield.$applyhere(a)}})}function applyhere(target,method,params){(target=gui.Object.lookup(target))[method].apply(target,params)}var doaction=function(data){};return(ts.ui.subframe||ts.ui.appframe)&&(gui.hasModule("core-gui@tradeshift.com")?gui.ready(setupactions):gui.init(setupactions)),{toString:function(){return"[object ts.ui.Greenfield]"},api:function(base){function api(){return base.apply(this,arguments)}return api.$api=!0,api},$applyreverse:function(target,method,params){params=gui.Array.from(params),doaction({action:"apply",target:target,method:method,params:params})},$applyhere:function(a){applyhere(a.data.target,a.data.method,a.data.params)}}}(ts.ui.ACTION_GLOBAL_MESSAGE_UP,ts.ui.ACTION_GLOBAL_MESSAGE_DOWN),ts.ui.String={LABEL_SUBMIT:"Proceed",LABEL_ACCEPT:"OK",LABEL_CANCEL:"Cancel",LABEL_HELP:"Help",LABEL_INFO:"Read More",LABEL_OPTIONS:"Options",LABEL_DATEPICK:"Select Date",OFFLINE_NOTIFICATION:"You are offline. Please contact your internet.",OFFLINE_TRYRELOADING:"Try again",BAD_SERVICE_NOTIFICATION:"An unfortunate error has occured",BAD_SERVICE_TRYRELOADING:"Try again",ERROR_PATTERNMISMATCH:"The value does not match the specified pattern",ERROR_RANGEOVERFLOW:"Too much",ERROR_RANGEUNDERFLOW:"Not too much",ERROR_STEPMISTMATCH:"Abnormal step",ERROR_TOOLONG:"The value exceeds the specified maxlength",ERROR_TYPEMISMATCH:"The value is not in the required syntax",ERROR_BADINPUT:"That's just plain wrong.",ERROR_VALUEMISSING:"Please type something here",getError:function(error){if(error=this+" "+error.toUpperCase())return error;console.error("No such error",error)}},ts.ui.Markdown=function(linkparser){function inlinefunction(rules){return function(input){return rules.reduce(function(result,rule){var regx=rule[0],html=rule[1];return result.replace(regx,html)},input)}}function blockfunction(rules){return function(input,output){return rules.some(function(rule){var post,regx=rule[0],html=rule[1];return regx.test(input)&&(post=input.replace(regx,""),output=enclose(html,post)),!!output}),output}}function enclose(outer,inner){return outer.replace("$",inner.trim())}function sanitize(markup){var ul=/<\/ul>\n<ul>/g,ol=/<\/ol>\n<ol>/g;return[1,2,3].reduce(function(insanity){return insanity.replace(ul,"\n").replace(ol,"\n")},markup)}function validate(tags){return(tags||[]).forEach(function(tag){if(-1===ORDER.indexOf(tag))throw new Error('Not supported: "$tag"'.replace("$tag",tag))}),tags}function getparsers(tags){return tags=tags||ORDER,ORDER.filter(function(tag){return tags.indexOf(tag)>-1}).map(function(tag){return parsers[tag]})}function eachline(string,action,doubles){var x2=/\n{2,}/;return string.split(doubles?x2:"\n").map(action).join("\n")}function parseline(line,lineParsers){return lineParsers.reduce(function(result,parse){return parse(result)||result},line.trimRight())}function paragraphs(html){var exclude=/^<(h|ul|ol|li|pre)/;return eachline(html,function(section){return unhack(eachline(linehack(section),function(line){return exclude.test(line)?line:enclose("<p>$</p>",unhack(line,!0))}))},!0)}function linehack(string){return string.replace(SINGLENEWLINE,"$1 %%%")}function unhack(string,breaks){return string.replace(/%%%/g,breaks?"<br/>":"")}var ORDER=["h","strong","em","strike","code","a","ul","ol"],SINGLENEWLINE=/(^|[^\n])\n(?!\n)/g,parsers={h:blockfunction([[/^####/,"<h4>$</h4>"],[/^###/,"<h3>$</h3>"],[/^##/,"<h2>$</h2>"],[/^#/,"<h1>$</h1>"]]),ul:blockfunction([[/^ {6}\*/,"<ul><ul><ul><ul><li>$</li></ul></ul></ul></ul>"],[/^ {4}\*/,"<ul><ul><ul><li>$</li></ul></ul></ul>"],[/^ {2}\*/,"<ul><ul><li>$</li></ul></ul>"],[/^\*/,"<ul><li>$</li></ul>"]]),ol:blockfunction([[/^ {6}\d+\./,"<ol><ol><ol><ol><li>$</li></ol></ol></ol></ol>"],[/^ {3}\d+\./,"<ol><ol><ol><li>$</li></ol></ol></ol>"],[/^ {2}\d+\./,"<ol><ol><li>$</li></ol></ol>"],[/^\d+\./,"<ol><li>$</li></ol>"]]),strong:inlinefunction([[/\*\*(.*?)\*\*/g,"<strong>$1</strong>"]]),em:inlinefunction([[/\*(.*?)\*/g,"<em>$1</em>"]]),strike:inlinefunction([[/~~(.*?)~~/g,"<del>$1</del>"]]),code:inlinefunction([[/`(.*?)`/g,"<code>$1</code>"]]),a:linkparser};return{parse:function(markdown,tagnames){var allParsers=getparsers(validate(tagnames));return paragraphs(sanitize(eachline(edbml.safetext(markdown),function(line){return parseline(line,allParsers)})))}}}(function(txt,url){function unnormalize(line){return line.indexOf("](")<0?line:line=line.split("](").map(function(cut){var normal=cut;if(isnormaltext(cut)){var l=normal.lastIndexOf("[");normal=normal.substr(0,l)+normal.substr(l).replace("[","(")}if(isnormalurl(cut)){var f=normal.indexOf(")");normal=normal.substr(0,f+1).replace(")","]")+normal.substr(f+1)}return normal}).join(")[")}function isnormaltext(cut){return cut.split("[").length>cut.split("]").length}function isnormalurl(cut){return cut.split(")").length>cut.split("(").length}function link(){return'<a data-ts="Button" data-ts.type="$type" data-ts.data="$data">$text</a>'.replace("$type",ts.ui.ACTION_SAFE_LINK).replace("$data",edbml.safeattr(href)).replace("$text",edbml.safetext(text))}function parsecut(cut,idx,all){var ends=all.length-1===idx;url.test(cut)&&(href=gethref(cut.replace(txt,""),ends));var res=text&&href?donecut():"";return txt.test(cut)&&(text=gettext(cut.replace(url,""))),res}function gethref(cut,ends){return post=ends?cut.replace(url,""):"",(test=url.exec(cut))?test[0].slice(0,-1):""}function gettext(cut){return last=getlastindex(cut),init=cut.substr(0,last),cut.slice(last+1)}function getlastindex(cut){var left=cut.lastIndexOf("("),right=cut.lastIndexOf(")");return left<0?-1:left<=right?getlastindex(cut.substr(0,left-1)):left}function donecut(){return html=init+link()+post,reset(),html}function reset(){init="",text="",href="",post=""}var init,text,href,post,last,html,test;return function(line){return reset(),(line=unnormalize(line)).split(")[").map(parsecut).join("")||line}}(/\(.+$/,/^.+\]/)),ts.ui.Dialog=function(opt_json){var model=ts.ui.DialogModel.syncGlobal(opt_json);return model.addObserver(ts.ui.Dialog),model},ts.ui.Dialog.toString=function(){return"[function ts.ui.Dialog]"},ts.ui.Dialog.confirm=function(){},ts.ui.Dialog.warning=function(){},ts.ui.Dialog.danger=function(){},ts.ui.Dialog.DEFAULT_TIME=1500,function(api,chained,hidden,GuiArray,GuiObject,Type){function getspirit(model){var id=model.$instanceid;return gui.get("#"+id)||function(){var spirit=ts.ui.DialogSpirit.summon(model);return spirit.dom.id(id).appendTo(document.body),spirit}()}function applyreverse(method){var params=[].slice.call(arguments,1);ts.ui.Greenfield.$applyreverse("ts.ui.Dialog",method,params)}function toggle(model,open){return ts.ui.greenfield?open?applyreverse("$open",model.serializeToString()):applyreverse("$close",model.$instanceid):getspirit(model).open(open),model}function extractobject(args){return GuiArray.from(args).find(Type.isObject)||{}}function extractstring(args){return GuiArray.from(args).filter(gui.Type.isString)}function tostring(string){return string?String(string):void 0}function getdialog(type,args,note){var dialog=getmodel(type,note||!1,extractstring(args),extractobject(args));return dialog.open(),dialog}function getmodel(type,note,strings,config){return Dialog(GuiObject.extendmissing(config,{type:type,icon:geticon(type),items:[{item:"text",text:tostring(strings[0])}]})).acceptButton(type===Dialog.SUCCESS?null:{label:tostring(strings[1])}).cancelButton(note?null:{label:tostring(strings[2])})}function geticon(type){switch(type){case Dialog.SUCCESS:return"ts-icon-accept";case Dialog.INFO:return"ts-icon-info";case Dialog.WARNING:return"ts-icon-warning";case Dialog.ERROR:return"ts-icon-error";case Dialog.DANGER:return"ts-icon-warning";case Dialog.CONFIRM:return"ts-icon-question"}return null}var Dialog=ts.ui.Dialog;GuiObject.extend(Dialog,{INFO:"ts-dialog-info",SUCCESS:"ts-dialog-success",WARNING:"ts-dialog-warning",ERROR:"ts-dialog-error",DANGER:"ts-dialog-danger",CONFIRM:"ts-dialog-confirm",onchange:hidden(function(changes){changes.forEach(function(c){var model=c.object;switch(c.name){case"isOpen":toggle(model,c.newValue);break;case"disposed":if(!ts.ui.greenfield){var spirit=gui.get("#"+model.$instanceid);spirit&&gui.Tick.time(function(){spirit.dom.remove()},100)}}})})}),GuiObject.extend(Dialog,{confirm:chained(api(function(){return getdialog(this.CONFIRM,arguments)})),warning:chained(api(function(){return getdialog(this.WARNING,arguments)})),danger:chained(api(function(){return getdialog(this.DANGER,arguments)})),$getdialog:hidden(api(function(type,args,note){return getdialog(type,args,note)})),$open:hidden(api(function(json){getspirit(Dialog(json)).open()})),$close:hidden(api(function(id){var spirit=gui.get("#"+id);spirit&&spirit.isOpen&&spirit.close()}))})}(ts.ui.Greenfield.api,gui.Combo.chained,gui.Object.hidden,gui.Array,gui.Object,gui.Type),ts.ui.Menu=function(json){return ts.ui.MenuModel.from(json)},ts.ui.Menu.toString=function(){return"[function ts.ui.Menu]"},ts.ui.Buttons=function(json){return ts.ui.ButtonMenuModel.from(json)},ts.ui.Buttons.toString=function(){return"[function ts.ui.Buttons]"},ts.ui.Aside=function(json){var model=ts.ui.AsideModel.syncGlobal(json);return model.addObserver(ts.ui.Aside),model},ts.ui.Aside.toString=function(){return"[function ts.ui.Aside]"},ts.ui.Aside.closeAll=function(){gui.Broadcast.dispatchGlobal(ts.ui.BROADCAST_GLOBAL_ASIDES_DO_CLOSE)},function(api,hidden){function getspirit(model){var id=getid(model);return gui.get("#"+id)||function(){var spirit=ts.ui.AsideSpirit.summon(model);return document.body.appendChild(spirit.element),spirit.element.id=id,spirit.onclosed=function(){model.isOpen=!1},spirit}()}function getid(model){return"aside-"+(model.id||model.$instanceid)}function applyreverse(method){var params=[].slice.call(arguments,1);ts.ui.Greenfield.$applyreverse("ts.ui.Aside",method,params)}function toggle(model,open){return ts.ui.greenfield?open?applyreverse("$open",model.serializeToString()):applyreverse("$close",getid(model)):getspirit(model).open(open),model}gui.Object.extend(ts.ui.Aside,{onchange:hidden(function(changes){changes.forEach(function(c){var model=c.object;switch(c.name){case"isOpen":toggle(model,c.newValue);break;case"disposed":var spirit=gui.get("#"+getid(model));spirit&&gui.Tick.time(function(){spirit.dom.remove()},100)}})})}),gui.Object.extend(ts.ui.Aside,{$open:hidden(api(function(json){var model=ts.ui.Aside(json),spirit=getspirit(model);model.addObserver(ts.ui.Aside),spirit.open()})),$close:hidden(api(function(id){var spirit=gui.get("#"+id);spirit&&spirit.isOpen&&spirit.close()}))})}(ts.ui.Greenfield.api,gui.Object.hidden),ts.ui.DatePicker=function(json){var model=ts.ui.DatePickerModel.syncGlobal(json);return model.addObserver(ts.ui.DatePicker),model},ts.ui.DatePicker.toString=function(){return"[function ts.ui.DatePicker]"},ts.ui.DatePicker.localize=function(config){},function(api,hidden){function toggle(model,open){var aside,id=model.$instanceid;return open?asides[id]=(asides[id]||ts.ui.Aside({title:model.title,items:[model],onclosed:function(){gui.Type.isFunction(model.onclosed)&&model.onclosed(),model.isOpen=!1}})).open():(aside=asides[id])&&gui.Tick.time(function(){aside.close()},100),model}var asides={},locale=null;gui.Object.extend(ts.ui.DatePicker,{localize:function(newlocale){if(!arguments.length)return locale;locale&&!Object.keys(locale).every(function(key){var has=newlocale.hasOwnProperty(key);return has||console.error("Missing translations for "+key),has})||(locale=newlocale)},onchange:hidden(function(changes){changes.forEach(function(c){var model=c.object;switch(c.name){case"isOpen":toggle(model,c.newValue);break;case"disposed":model.removeObserver(ts.ui.DatePicker);var aside=asides[model.$instanceid];aside&&(delete asides[model.$instanceid],aside.dispose())}})})})}(ts.ui.Greenfield.api,gui.Object.hidden),ts.ui.DatePicker.localize({firstDay:1,monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"]}),ts.ui.Notification={toString:function(){return"ts.ui.Notification"},info:function(text){},success:function(text){},warning:function(text){},error:function(text){}},function(Dialog,GuiObject,chained,confirmed){function confirm(action){return confirmed("string","(string|object)","(object)")(action)}function getdialog(type,args){return Dialog.$getdialog(type,args,!0)}GuiObject.extend(ts.ui.Notification,{success:confirm(function(){return getdialog(Dialog.SUCCESS,arguments)}),info:confirm(function(){return getdialog(Dialog.INFO,arguments)}),warning:confirm(function(){return getdialog(Dialog.WARNING,arguments)}),error:confirm(function(){return getdialog(Dialog.ERROR,arguments)})})}(ts.ui.Dialog,gui.Object,gui.Combo.chained,gui.Arguments.confirmed),ts.ui.Note=function(opt_json){return ts.ui.Note._model?(console.warn("Note model already exists! There can be only one!"),ts.ui.Note._model):(ts.ui.Note._model=new ts.ui.NoteModel(opt_json),ts.ui.Note._model.addObserver(ts.ui.Note),ts.ui.Note._addSpirit(),ts.ui.Note._model)},ts.ui.Note.toString=function(){return"[funtion ts.ui.Note]"},gui.Object.extend(ts.ui.Note,{_addSpirit:function(){if(document.querySelector(".ts-maincontent ~ .ts-note"))ts.ui.Note._model.$isTopNote=!0;else{var noteSpirit=ts.ui.NoteSpirit.summon(ts.ui.Note._model);ts.ui.Note._model.$isTopNote=!0,noteSpirit.dom.insertBefore(document.querySelector(".ts-maincontent"))}},onchange:function(){}}),ts.ui.Main=function(confirmed){function getmain(){var main=ts.ui.get(".ts-main");if(main)return main;throw new Error("The Main component either doesn't exist or it is not initialized yet.")}function getbar(action,cb){if(!cb)return action();gui.ready(function(){cb(action())})}return{toString:function(){return"[object ts.ui.Main]"},tabbar:confirmed("(function)")(function(cb){return getbar(function(){return getmain().tabbar()},cb)}),toolbar:confirmed("(function)")(function(cb){return getbar(function(){return getmain().toolbar()},cb)}),statusbar:confirmed("(function)")(function(cb){return getbar(function(){return getmain().statusbar()},cb)})}}(gui.Arguments.confirmed),ts.ui.Model=function(Type){return edb.Object.extend({id:null,item:"model",disposed:!1,tempdirtyflag:-1,onconstruct:function(){edb.Object.prototype.onconstruct.call(this),gui.debug&&"model"===this.item&&console.error("A unique property 'item' is missing from "+this,JSON.stringify(this,null,!0))},render:function(){return'<p class="todo">'+this.$classname+".render()</p>"},dispose:function(){this.disposed=!0,gui.Tick.time(function(){edb.Type.$destruct(this)},0,this)},$dirty:function(){this.tempdirtyflag=Math.random()},_maybeinvoke:function(action,arg){if(action){var args=[];arguments.length>1&&args.push(arg),Type.isString(action)&&(action=new Function(action)),action.apply(this,args)}return!!action}})}(gui.Type),ts.ui.Collection=function(chained,guiArray){function getmodel(item){return{text:ts.ui.TextModel,input:ts.ui.InputModel,form:ts.ui.FormModel,menu:ts.ui.MenuModel,item:ts.ui.ItemModel,select:ts.ui.SelectModel,textarea:ts.ui.TextAreaModel,date:ts.ui.DatePickerModel,button:ts.ui.ButtonModel,comment:ts.ui.CommentModel,action:ts.ui.ActionModel}[item]||(console.error('"'+item+'" not matched to nothing'),null)}function anything(collection,input,assumed){if(input)return ts.ui.Model.is(input)?input:input.item?getmodel(input.item):assumed?getmodel(assumed):collection.constructor===ts.ui.Collection?null:nothing(collection)}function something(collection,input,allowed,assumed){var Model,item=input.item;return item?ts.ui.Model.is(input)&&allowed.some(function(it){return(Model=getmodel(it)).is(input)})?input:(Model=getmodel(item))?Model:badthing(collection,item,allowed):assumed?getmodel(assumed):nothing(collection)}function badthing(collection,item,allowed){return console.error(collection+" doesn't accept \""+item+'", use one of: '+allowed),null}function nothing(collection){return console.error("Item for "+collection+" needs an 'item' property"),null}return edb.Array.extend({item:"collection",disposed:!1,$of:function(input){var allowed=this.constructor.allow,assumed=this.constructor.assume;return input?allowed?something(this,input,allowed,assumed):anything(this,input,assumed):null},get:function(id){switch(gui.Type.of(id)){case"number":return edb.Array.prototype.get.call(this,id);case"string":return this.reduce(function(result,model){return result||(model.id&&model.id===id?model:null)},null)}},render:function(){return this.map(function(model){return model.render()}).join("")},remove:chained(function(model){guiArray.remove(this,model),model.dispose()}),contains:function(model){return this.indexOf(model)>-1},clear:chained(function(){for(;this.length;)this.pop()}),dispose:function(){this.disposed=!0,edb.Array.prototype.dispose.call(this)}},{allow:null,assume:null})}(gui.Combo.chained,gui.Array),ts.ui.LayoutModel=ts.ui.Model.extend({item:"layout",booting:!0,breakpoint:null,breakpoints:null,menuopen:!1,blocking:!1,asides:edb.Array,dialogs:edb.Array,attention:edb.Array,onconstruct:function(){ts.ui.Model.prototype.onconstruct.call(this),this.asides=[],this.dialogs=[],this.attention=[]},isMobilePoint:function(){return this.breakpoint===ts.ui.LayoutModel.BREAKPOINT_MOBILE},isTabletPoint:function(){return this.breakpoint===ts.ui.LayoutModel.BREAKPOINT_TABLET},isDesktopPoint:function(){return this.breakpoint===ts.ui.LayoutModel.BREAKPOINT_DESKTOP}},{BREAKPOINTS:{1270:"desktop",600:"tablet",0:"mobile"},BREAKPOINT_MOBILE:"mobile",BREAKPOINT_TABLET:"tablet",BREAKPOINT_DESKTOP:"desktop"}),ts.ui.DeviceModel=ts.ui.Model.extend({item:"device",orientation:"landscape"},{ORIENTATION_LANDSCAPE:"landscape",ORIENTATION_PORTRAIT:"portrait"}),ts.ui.AsideModel=function(chained){return ts.ui.Model.extend({item:"aside",items:ts.ui.Collection,id:null,title:null,status:null,onopen:null,onbeforeopened:null,onopened:null,onclose:null,onclosed:null,isOpen:!1,color:null,autofocus:!0,gofocused:!1,suspendopen:!1,onconstruct:function(){ts.ui.Model.prototype.onconstruct.call(this),this.items=this.items||[],this.addObserver(this)},ondestruct:function(){ts.ui.Model.prototype.ondestruct.call(this),this.removeObserver(this)},onchange:function(changes){changes.forEach(function(c){if("status"===c.name){var method=c.newValue;this[method]&&this[method]()}},this)},open:chained(function(){this.isOpen=!0}),close:chained(function(){this.isOpen=!1}),focus:chained(function(){this.gofocused=!0}),unsuspendopen:chained(function(){this.suspendopen=!1})})}(gui.Combo.chained),function(methods){var proto=ts.ui.AsideModel.prototype;gui.Object.each(methods,function(method,classname){proto[method]=function(){return this.color=classname,this}})}(ts.ui.BACKGROUND_COLORS),ts.ui.ItemCollection=ts.ui.Collection.extend({item:"items"},{assume:"item"}),ts.ui.MenuModel=function(Type,chained){return ts.ui.Model.extend({item:"menu",items:Array,select:"one",selectedIndex:-1,selectedIndexes:edb.Array,maxItemsShown:-1,search:null,searchterm:null,random:-1,onselect:null,donebuttonlabel:ts.ui.String.LABEL_ACCEPT,donebuttonenabled:!1,donebuttonpressed:!1,title:null,onconstruct:function(){ts.ui.Model.prototype.onconstruct.call(this);var that=this;this.addObserver(this),this.select,this._searchmodel=new ts.ui.SearchModel({onsearch:function(value){that.searchterm=value},onidle:function(value){that.searchterm=value}})},ondestruct:function(){ts.ui.Model.prototype.ondestruct.call(this),this.removeObserver(this)},onchange:function(changes){changes.forEach(function(c){switch(c.name){case"searchterm":this._search(c.newValue);break;case"selectedIndex":this.onselect&&this.onselect(c.newValue)}},this)},showallitems:chained(function(){this.maxItemsShown=-1}),render:function(){return ts.ui.menu.edbml(this)},done:function(){this.donebuttonpressed=!0},open:function(){ts.ui.Aside({title:"Test",items:[this]}).open()},scrollContainingPanel:function(scrollTop){gui.Broadcast.dispatch(ts.ui.BROADCAST_PANEL_SYNC_MENU,{menuid:this.$instanceid,offset:scrollTop})},_searchmodel:null,_search:function(value){Type.isFunction(this.search)&&(this.items.forEach(function(item){var bool=this.search(item,value);if(!Type.isBoolean(bool))throw new TypeError("Search expected a boolean");item.visible=bool},this),this._forcerefresh())},_forcerefresh:function(){this.random=Math.random()}})}(gui.Type,gui.Combo.chained),ts.ui.TabModel=function(chained){return ts.ui.Model.extend({item:"tab",id:null,label:null,icon:null,selected:!1,counter:0,onselect:null,closeable:!1,$isontop:!0,onclose:null,closable:{getter:function(){return this.closeable},setter:function(value){this.closeable=value}},onconstruct:function(){ts.ui.Model.prototype.onconstruct.call(this),this.addObserver(this),this.selected&&this._doselect()},ondestruct:function(){ts.ui.Model.prototype.ondestruct.call(this),this.removeObserver(this)},onchange:function(changes){changes.forEach(function(c){"selected"===c.name&&c.newValue&&this._doselect()},this)},select:chained(function(){this.selected=!0}),unselect:chained(function(){this.selected=!1}),$onselect:null,_timeout:-1,_doselect:function(){(this.onselect||this.$onselect)&&(gui.Tick.cancelTime(this._timeout),this._timeout=gui.Tick.time(function(){this.$onselect&&this.$onselect(),this.onselect&&this.onselect()},25,this))}})}(gui.Combo.chained),ts.ui.TabCollection=function(chained,confirmed,Type){return ts.ui.Collection.extend({$of:ts.ui.TabModel,item:"tabs",newtabbutton:null,onselect:function(index){},selectedIndex:{getter:function(){return this._current?this.indexOf(this._current):-1},setter:function(i){if(!(i>=0&&i<this.length))throw new RangeError("Out of range");this._toggle(this[i],this._current)}},showNew:confirmed("(function)")(chained(function(opt_cb){var that=this;this.newtabbutton&&this.newtabbutton.dispose(),this.newtabbutton=new ts.ui.ButtonModel({onclick:function(){opt_cb&&opt_cb.call(that)}})})),hideNew:chained(function(){this.newtabbutton&&(this.newtabbutton.dispose(),this.newtabbutton=null)}),onconstruct:function(tabs){if(ts.ui.Collection.prototype.onconstruct.call(this),this.addObserver(this),this.length){var that=this;this.selectedIndex=tabs.reduce(function(x,tab,i){return tab.addObserver(that),tab.selected?i:x},0)}},onchange:function(changes){changes.forEach(function(c){switch(c.object.item){case"tab":this._ontabchange(c);break;case"tabs":this._onthischange(c)}},this)},_current:null,_lastknownindex:-1,_toggle:function(newtab,oldtab){var oldindex=this._lastknownindex;newtab!==oldtab&&(oldtab&&oldtab.unselect(),this._current=newtab.select(),this._lastknownindex=this.selectedIndex,Type.isFunction(this.onselect)&&this.onselect.call(this,this.selectedIndex,oldindex))},_ontabchange:function(c){c.type===edb.ObjectChange.TYPE_UPDATE&&"selected"===c.name&&c.newValue&&c.object!==this._current&&(this.selectedIndex=this.indexOf(c.object))},_onthischange:function(c){switch(c.type){case edb.ArrayChange.TYPE_SPLICE:this._onsplice(c.object,c.removed,c.added)}},_onsplice:function(tabs,removed,added){var that=this,current=this._current;removed.length&&gui.Tick.next(function(){removed.filter(function(tab){return-1===tabs.indexOf(tab)}).forEach(function(tab){tab.removeObserver(that),tab.dispose()})}),added.forEach(function(tab){tab.addObserver(that),tab.selected&&this._toggle(tab,current)},this),setTimeout(function(){this._fallback()}.bind(this))},_fallback:function(){if(this.length){if(-1===this.selectedIndex){for(var last=this._lastknownindex;last>this.length;)last--;last>=1?this[last-1].select():this[0].select()}}else this._lastknownindex=-1,this._current=null}})}(gui.Combo.chained,gui.Arguments.confirmed,gui.Type),ts.ui.ButtonModel=function(chained,confirmed,Type){return ts.ui.Model.extend({item:"button",label:null,icon:null,info:null,flex:0,type:ts.ui.CLASS_TERTIARY,reverse:!1,onclick:null,visible:!0,disabled:!1,tabindex:-1,autofocus:!1,busystatus:null,name:null,value:null,action:null,data:null,click:chained(function(){Type.isFunction(this.onclick)&&setTimeout(function(){this.onclick()}.bind(this),50)}),show:chained(function(){this.visible=!0}),hide:chained(function(){this.visible=!1}),enable:chained(function(){this.disabled=!1}),disable:chained(function(){this.disabled=!0}),busy:confirmed("(string)")(chained(function(label){this.busystatus=label||!0})),done:chained(function(){this.busystatus=null}),isPrimary:function(){return this.type.includes(ts.ui.CLASS_PRIMARY)},render:function(isButtonMenu,isMobile){return ts.ui.button.edbml(this,isButtonMenu,isMobile)},_oldlabel:null})}(gui.Combo.chained,gui.Arguments.confirmed,gui.Type),ts.ui.ButtonCollection=function(confirmed,chained){return ts.ui.Collection.extend({item:"buttons",visible:!0,disabled:!1,$of:confirmed("(object|array)")(function(arg){return ts.ui.ButtonModel.is(arg)||ts.ui.ButtonCollection.is(arg)?arg:Array.isArray(arg)?ts.ui.ButtonCollection:ts.ui.ButtonModel}),ascending:function(action,opt_thisp){return this._eachOrdered(!0,action||function(button){return button},opt_thisp)},descending:function(action,opt_thisp){return this._eachOrdered(!1,action||function(button){return button},opt_thisp)},render:function(){return ts.ui.buttons.edbml(this)},hide:chained(function(){this.visible=!1,this.forEach(function(button){button.hide()})}),show:chained(function(){this.visible=!0,this.forEach(function(button){button.show()})}),disable:chained(function(){this.disabled=!0,this.forEach(function(button){button.disable()})}),enable:chained(function(){this.disabled=!1,this.forEach(function(button){button.enable()})}),_eachOrdered:function(ascending,action,opt_thisp){return this._orderedBy(ascending).map(function(button,i){return action.call(opt_thisp,button,i)})},_orderedBy:function(opt_ascending){var result=[].concat(this._filterBy(ts.ui.CLASS_DANGER),this._filterBy(ts.ui.CLASS_PRIMARY),this._filterBy(ts.ui.CLASS_SECONDARY),this._filterBy(ts.ui.CLASS_TERTIARY));return opt_ascending?result.reverse():result},_filterBy:function(klass){return this.filter(function(member){switch(member.constructor){case ts.ui.ButtonModel:return member.type.includes(klass);case ts.ui.ButtonCollection:return member.length&&member[0].type.includes(klass)}})}})}(gui.Arguments.confirmed,gui.Combo.chained),ts.ui.ButtonMenuModel=ts.ui.Model.extend({item:"buttonsmenu",items:ts.ui.ButtonCollection,render:function(){return ts.ui.buttonsmenu.edbml(this)}}),ts.ui.ActionModel=ts.ui.ButtonModel.extend({isAction:!0}),ts.ui.ActionCollection=function(confirmed){return ts.ui.ButtonCollection.extend({$of:confirmed("(object|array)")(function(arg){return ts.ui.ActionModel})})}(gui.Arguments.confirmed),ts.ui.DatePickerModel=function(chained){return ts.ui.Model.extend({item:"date",title:null,isOpen:!1,value:null,min:null,max:null,onselect:null,onclosed:null,onconstruct:function(){ts.ui.Model.prototype.onconstruct.call(this),this.addObserver(this)},ondestruct:function(){ts.ui.Model.prototype.ondestruct.call(this),this.removeObserver(this)},open:chained(function(){this.isOpen=!0}),close:chained(function(){this.isOpen=!1}),onchange:function(changes){this.onselect&&changes.forEach(function(c){"value"===c.name&&setTimeout(function(){this.onselect(c.newValue,c.oldValue)}.bind(this))},this)},render:function(){return ts.ui.datepicker.edbml(this)}})}(gui.Combo.chained),ts.ui.TextModel=function(Markdown){return ts.ui.Model.extend({item:"text",text:"",render:function(tags){return Markdown.parse(this.text,tags||null)}})}(ts.ui.Markdown),ts.ui.DialogItemCollection=ts.ui.Collection.extend({item:"dialogitems"},{allow:["text","form","menu"]}),ts.ui.DialogModel=function(Dialog,chained,Type,GuiObject,Constants,primary,secondary,tertiary){function getbutton(json,id,label){return GuiObject.extendmissing(json||{},{type:"ts-secondary",label:label,tabindex:0,id:id})}return ts.ui.Model.extend({item:"dialog",type:null,items:ts.ui.DialogItemCollection,buttons:ts.ui.ButtonCollection,state:null,icon:null,isOpen:!1,isClicked:!1,onaccept:null,oncancel:null,onhelp:null,oninfo:null,onopen:null,onopened:null,onclose:null,onclosed:null,onclick:null,onlink:null,time:Dialog.DEFAULT_TIME,tags:null,focused:null,primary:null,onconstruct:function(){ts.ui.Model.prototype.onconstruct.call(this),this.items=this.items||[],this.buttons=this.buttons||[],this.addObserver(this),this.time=this._computetime(this.items.find(function(item){return ts.ui.TextModel.is(item)}))},onchange:function(changes){changes.forEach(function(c){if("state"===c.name){var method=c.newValue;this[method]&&this[method]()}},this)},acceptButton:chained(function(json){var label=Constants.LABEL_ACCEPT;null!==json&&this._addButton(0,getbutton(json,"accept",label))}),helpButton:chained(function(json){var label=Constants.LABEL_HELP;null!==json&&this._addButton(1,getbutton(json,"help",label))}),infoButton:chained(function(json){var label=Constants.LABEL_INFO;null!==json&&this._addButton(2,getbutton(json,"info",label))}),cancelButton:chained(function(json){var label=Constants.LABEL_CANCEL;null!==json&&this._addButton(3,getbutton(json,"cancel",label))}),open:function(){var then=new gui.Then;return ts.ui.ready(function(){this.isOpen=!0,gui.Tick.time(function(){then.now()},ts.ui.TRANSITION_FAST)},this),then},accept:function(){if(!this.buttons.length||this.buttons.get("accept"))return this._close(function(){this.onaccept&&this.onaccept()},this);throw new Error("This dialog cannot be accepted")},cancel:function(){if(this.buttons.get("cancel"))return this._close(function(){this.oncancel&&this.oncancel()},this);throw new Error("This dialog cannot be canceled. Try dialog.accept()")},$finalize:function(){this._validatestuff()&&(this._optimusprime(this.buttons,this.primary),this._focusdefault(this.buttons,this.focused))},_close:function(cb,thisp){var then=new gui.Then;return ts.ui.ready(function(){this.isOpen=!1,gui.Tick.time(function(){cb&&cb.call(thisp),then.now()},ts.ui.TRANSITION_FAST)},this),then},_addButton:function(index,json){var that=this,maxi=this.buttons.length;return index=index>maxi?maxi:index,index=index<0?0:index,this.buttons.splice(index,0,GuiObject.extend(json,{onclick:function(){var action=that["on"+json.id];that._close().then(function(){action&&action.call(that)})}})),index},_computetime:function(model){var timer=180*(model?model.text:"").split(" ").length;return timer<1500?1500:timer},_optimusprime:function(buttons,userset){if(!buttons.some(function(b){return"ts-primary"===b.type})){var b=buttons.get(userset);b||1!==buttons.length||(b=buttons.get(0)),b&&(b.type="ts-primary")}},_focusdefault:function(buttons,userset){var b=buttons.get(userset||"cancel")||buttons.get(0);b&&(b.autofocus=!0)},_validatestuff:function(){return!0}})}(ts.ui.Dialog,gui.Combo.chained,gui.Type,gui.Object,ts.ui.String,ts.ui.CLASS_PRIMARY,ts.ui.CLASS_SECONDARY,ts.ui.CLASS_TERTIARY),ts.ui.PagerModel=function(chained){return ts.ui.Model.extend({item:"pager",pages:-1,page:0,max:5,init:0,flex:1,visible:!0,onselect:null,onconstruct:function(){ts.ui.Model.prototype.onconstruct.call(this),this.addObserver(this)},ondestruct:function(){ts.ui.Model.prototype.ondestruct.call(this),this.removeObserver(this)},first:function(){this.page=0,this.init=0},last:function(){this.page=this.pages-1,this.init=this.pages-this.max},next:function(){this.page++,this._initup()},prev:function(){this.page--,this._initdown()},onchange:function(changes){this.onselect&&changes.forEach(function(c){"page"===c.name&&(this.onselect(c.newValue),c.newValue>c.oldValue?this._initup():this._initdown())},this)},render:function(){return ts.ui.pager.edbml(this)},hide:chained(function(){this.visible=!1}),show:chained(function(){this.visible=!0}),_initup:function(){for(var max=this.max,page=this.page,pages=this.pages;page>=this.init+max&&this.init<=pages-max;)this.init++},_initdown:function(){for(var page=this.page;page<this.init&&this.init>0;)this.init--}})}(gui.Combo.chained),ts.ui.NoteModel=ts.ui.Model.extend({item:"note",type:"",icon:"",text:"",open:!0,onclose:null,onlink:null,close:function(){return this.open=!1,this},buttons:ts.ui.ButtonCollection,$isTopNote:!1}),ts.ui.IconModel=ts.ui.Model.extend({type:null,color:"dark",value:null,render:function(){return ts.ui.icononly.edbml(this)}}),ts.ui.ImageModel=function(){var BLANK="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAQAAAAngNWGAAAAFElEQVR42mNkIBIwjiocVTiqEAQAJNYAFd868w4AAAAASUVORK5CYII=";return ts.ui.Model.extend({src:BLANK,alt:"",width:0,height:0,background:!1,value:null,onconstruct:function(){if(ts.ui.Model.prototype.onconstruct.call(this),!this.width||!this.height)throw new Error("Image must have both width and height")},render:function(){return ts.ui.image.edbml(this)}},{BLANK:BLANK})}(),gui.module("core-api@tradeshift.com"),ts.ui.Autocomplete=function(){return new ts.ui.AutocompleteDropdownModel},ts.ui.Autocomplete.toString=function(){return"[function ts.ui.Autocomplete]"},ts.ui.Autocomplete.localize=function(config){},function(){var locale=null;gui.Object.extend(ts.ui.Autocomplete,{localize:function(newlocale){if(!arguments.length)return locale;locale&&!Object.keys(locale).every(function(key){var has=newlocale.hasOwnProperty(key);return has||console.error("Missing translations for "+key),has})||(locale=newlocale)}})}(),ts.ui.Autocomplete.localize({matchString:function(count){return count?1===count?"1 match":count+" matches":""}}),ts.ui.Form=function(json){return ts.ui.FormModel.from(json)},ts.ui.ValidityChecker=gui.Class.create(Object.prototype,{checkValidity:function(input,state){switch(state.valid=!0,input.required&&""===input.value&&(state.valid=!1,state.valueMissing=!0),input.type){case"number":isNaN(input.value)&&(state.valid=!1,state.badInput=!0)}return state.valid}},{EMAIL:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,6}$./}),ts.ui.ValidityStateModel=edb.Object.extend({valid:!0,customError:!1,patternMismatch:!1,rangeOverflow:!1,rangeUnderflow:!1,stepMismatch:!1,tooLong:!1,typeMismatch:!1,badInput:!1,valueMissing:!1}),ts.ui.SelectModel=ts.ui.Model.extend({item:"select",onchange:null,select:function(what){switch(gui.Type.of(what)){case"number":this.options.selectedIndex=what;break;default:console.error("TODO: select option by value")}return this},render:function(){return ts.ui.select.edbml(this)},options:ts.ui.Collection({item:"options",selectedIndex:-1,$of:ts.ui.Model({item:"option",label:null,value:null})})}),ts.ui.InputModel=function(Client,chained){return ts.ui.Model.extend({item:"input",type:"text",name:"",value:"",label:"",placeholder:"",icon:"",idle:!1,enterkey:!1,idletime:Client.isTouchDevice?750:500,onidle:null,onenterkey:null,onfocus:null,onblur:null,required:!1,readonly:!1,disabled:!1,focused:!1,autofocus:!1,validationMessage:{getter:function(){return this._validationMessage}},validity:ts.ui.ValidityStateModel,onconstruct:function(){ts.ui.Model.prototype.onconstruct.call(this),this.validity={},this.addObserver(this)},ondestruct:function(){ts.ui.Model.prototype.ondestruct.call(this),this.removeObserver(this),this._checker=null},checkValidity:function(){return this._checker=this._checker||new ts.ui.ValidityChecker,this._checker.checkValidity(this,this.validity)},setCustomValidity:function(error){this.validity.customError=!!error,this.validity.valid=!error,this._validationMessage=error||""},onchange:function(changes){changes.forEach(function(c){this._onpropertychange(c.name,c.newValue)},this)},focus:function(){this.focused=!0},blur:function(){this.focused=!1},clear:function(){this.value=""},render:function(){return ts.ui.input.edbml(this)},_checker:null,_snapshot:null,_onpropertychange:function(name,value){var isTrue=!0===value;switch(name){case"idle":isTrue&&(this.idle=!1,(value=this.value)!==this._snapshot&&(this._maybeinvoke(this.onidle,value),this._snapshot=value));break;case"enterkey":isTrue&&(this.enterkey=!1,this._maybeinvoke(this.onenterkey,this.value));break;case"focused":isTrue?this._maybeinvoke(this.onfocus):this._maybeinvoke(this.onblur);break;case"value":this.checkValidity()}}})}(gui.Client,gui.Combo.chained),ts.ui.TextAreaModel=ts.ui.InputModel.extend({item:"textarea",entershift:!1,rows:3}),ts.ui.SearchModel=ts.ui.InputModel.extend({item:"search",type:"search",info:null,inset:!1,onsearch:null,flex:0,tip:{getter:function(){return this.info},setter:function(value){this.info=value,console.warn("SearchModel.tip: Deprecated API is deprecated. Please use `info`")}},clear:function(){ts.ui.InputModel.prototype.clear.call(this),this._bestcallback(this.value)},onenterkey:function(){this._bestcallback(this.value)},render:function(toolbar){return ts.ui.search.edbml(this)},_bestcallback:function(value){this._maybeinvoke(this.onsearch,value)||this._maybeinvoke(this.onidle,value)}}),ts.ui.FormItemCollection=ts.ui.Collection.extend({item:"formitems"},{allow:["text","input","textarea","select"]}),ts.ui.FormModel=function(chained){return ts.ui.Model.extend({item:"form",items:ts.ui.FormItemCollection,buttons:ts.ui.ButtonCollection,onsubmit:null,onconstruct:function(){ts.ui.Model.prototype.onconstruct.call(this),this.items=this.items||[],this.buttons=this.buttons||[],this.addObserver(this)},ondestruct:function(){ts.ui.Model.prototype.ondestruct.call(this),this.removeObserver(this)},onchange:function(changes){changes.forEach(function(c){"submitted"===c.name&&c.newValue&&(this.submitted=!1,this.onsubmit&&this.onsubmit())},this)},submit:chained(function(){this.submitted=!0}),render:function(){return ts.ui.form.edbml(this)},submitButton:chained(function(opt_label,opt_icon){this._button(opt_label||ts.ui.String.LABEL_SUBMIT,opt_icon||"ts-icon-proceed",this.submit)}),_button:function(label,icon,action){var that=this;this.buttons.push({label:label,icon:icon,onclick:function(){action&&action.call(that)}})}})}(gui.Combo.chained),ts.ui.SwitchModel=ts.ui.InputModel.extend({item:"switch",data:null,checked:!1,value:null,render:function(){return ts.ui.switch.edbml(this)}}),ts.ui.CheckBoxModel=function(chained){return ts.ui.Model.extend({info:"",checked:!1,visible:!0,onclick:null,check:chained(function(){this.checked=!0}),uncheck:chained(function(){this.checked=!1}),hide:chained(function(){this.visible=!1}),show:chained(function(){this.visible=!0})})}(gui.Combo.chained),ts.ui.AutocompleteDropdownModel=ts.ui.Model.extend({item:"autocompletedropdown",autocompleteList:null,filter:"",filteredAutocompleteList:null,onconstruct:function(){ts.ui.Model.prototype.onconstruct.call(this),this.autocompleteList=[],this.filteredAutocompleteList=[]},onfilter:function(filter){var filteredAutocompleteList=[];if(this.autocompleteList)for(var idx=-1,length=this.autocompleteList.length;++idx<length;){var item=this.autocompleteList[idx];-1!==item.value.indexOf(filter)&&filteredAutocompleteList.push(item)}return filteredAutocompleteList},onselect:function(item){return item.value}}),ts.ui.Card={TYPE_DEFAULT:"ts-default",TYPE_DETAILS:"ts-details",TYPE_COMPACT:"ts-compact",TYPE_INLINE:"ts-inline"},ts.ui.CompanyCard={render:function(arg){},get:function(id){},connectionTypes:[["Your company","ts-icon-network"],["Request sent","ts-icon-network"],["Connected","ts-icon-network"],["Registration in progress","ts-icon-network"],["In your Google Contacts","ts-icon-network"],["Via email only","ts-icon-network"]],industryTypes:["Airline","Corporation","Educational Organization","Government Organization","Local Business","NGO","Software & IT","Performing Group","Sports Team"],companySizes:["1","1\u201310","1\u2013100","100\u2013249","250-500","500-1000"]},function(GuiArray,GuiObject){var collection=null;GuiObject.extend(ts.ui.CompanyCard,{render:function(arg){var objects;arguments.length&&(objects=GuiArray.make(arg),collection?objects.forEach(function(o){collection.push(o)}):(collection=new ts.ui.CompanyCardCollection(objects)).output())},get:function(id){return collection?collection.get(id):null}})}(gui.Array,gui.Object),ts.ui.UserCard=function(json){var model=ts.ui.UserCardModel.from(json);return model.addObserver(ts.ui.UserCard),model},ts.ui.UserCard.toString=function(){return"[function ts.ui.UserCard]"},ts.ui.UserCard.localize=function(config){},function(api,hidden,chained){var locale=null;gui.Object.extend(ts.ui.UserCard,{onchange:hidden(function(changes){var that=this;changes.forEach(function(c){var model=c.object;switch(c.name){case"isOpen":var clone=ts.ui.UserCardModel.from(model);clone.type="ts-details",ts.ui.Aside({title:that.localize("userDetails"),items:[clone],onclosed:function(){this.dispose()}}).open()}})}),localize:api(chained(function(arg){if(!arguments.length)return locale;switch(gui.Type.of(arg)){case"object":var newlocale=arg;locale&&!Object.keys(locale).every(function(key){var has=newlocale.hasOwnProperty(key);return has||console.error("Missing translations for "+key),has})||(locale=newlocale);break;case"string":var key=arg;if(locale&&locale.hasOwnProperty(key))return locale[key];console.error("Missing translations for "+key)}}))})}(ts.ui.Greenfield.api,gui.Object.hidden,gui.Combo.chained),ts.ui.UserCard.localize({currentUserDisplayName:"You",userDetails:"User Details"}),ts.ui.ObjectModel=function(confirmed){return ts.ui.Model.extend({id:null,item:"object",mock:!1,data:Object,render:confirmed("(boolean)","(string)")(function(contentonly,classconfig){return this._edbml()(this,contentonly||!1,classconfig||"ts-default")}),onconstruct:function(){if(ts.ui.Model.prototype.onconstruct.call(this),!this.id)throw new Error(this+" requires a unique id")},_edbml:function(){console.error(this+" needs an EDBML function")}})}(gui.Arguments.confirmed),ts.ui.ObjectCollection=ts.ui.Collection.extend({$of:ts.ui.ObjectModel}),ts.ui.CardModel=ts.ui.ObjectModel.extend({type:null}),ts.ui.CompanyCardModel=function(Type,Card){function confirm(index,result){if(!Type.isDefined(result))throw new RangeError(index+" out of reach");return result}function connections(index){return Card.connectionTypes[index]}function industries(index){return Card.industryTypes[index]}function sizes(index){return Card.companySizes[index]}return ts.ui.CardModel.extend({item:"companycard",data:Object,$computeConnection:function(){var type,index=this.data.connection;if(Type.isDefined(index)){if(!Type.isNumber(index))throw new TypeError("The connectionType *must* be a number");if((type=connections(index))&&confirm(index,type))return{text:type[0],icon:type[1]}}return null},$computeIndustry:function(){var type=this.data.industry;switch(Type.of(type)){case"string":return type;case"number":return confirm(type,industries(type))}},$computeSize:function(){var type=this.data.size;switch(Type.of(type)){case"string":return type;case"number":return confirm(type,sizes(type))}},_edbml:function(){return ts.ui.companycard.edbml}})}(gui.Type,ts.ui.CompanyCard),ts.ui.CompanyCardCollection=ts.ui.ObjectCollection.extend({$of:ts.ui.CompanyCardModel}),ts.ui.UserImageModel=ts.ui.Model.extend({name:"",src:"",size:0,value:null,render:function(){return ts.ui.userimage.edbml(this)}}),ts.ui.UserCardModel=function(Card,CardModel){return CardModel.extend({type:ts.ui.Card.TYPE_DEFAULT,item:"user",data:Object,isOpen:!1,open:function(){return this.isOpen=!0,this},_edbml:function(){return ts.ui.usercard.edbml}})}(ts.ui.Card,ts.ui.CardModel),ts.ui.UserCardCollection=ts.ui.ObjectCollection.extend({$of:ts.ui.UserCardModel}),gui.module("objects-api@tradeshift.com"),ts.ui.BarModel=function(ButtonCollection){return ts.ui.Model.extend({$allbuttons:function(){return this.buttons.ascending().filter(function(thing){return ButtonCollection.is(thing)?thing.every(function(button){return button.visible}):thing.visible})},$allactions:function(){return this.actions.filter(function(action){return action.visible})},$specialbuttons:function(){return this._sortbuttons(this.$allbuttons(),!0)},$normalbuttons:function(){return this._sortbuttons(this.$allbuttons(),!1)},_sortbuttons:function(buttons,special){return buttons.filter(function(thing){var button=thing;return ButtonCollection.is(thing)&&(button=thing[0]),button.type.indexOf(ts.ui.CLASS_TERTIARY)>-1?!special||void 0:special})}})}(ts.ui.ButtonCollection),ts.ui.ToolBarModel=function(chained,ButtonModel,CheckBoxModel){return ts.ui.BarModel.extend({item:"toolbar",hascontent:!1,hadcontent:!1,color:ts.ui.CLASS_BG_LITE,title:null,status:null,search:null,compact:!0,linkable:!1,tabs:ts.ui.TabCollection,actions:ts.ui.ActionCollection,buttons:ts.ui.ButtonCollection,configbutton:{getter:function(){return this.actualconfigbutton},setter:function(json){json&&((json=ButtonModel.from(json)).icon="ts-icon-settings",json.type="ts-tertiary ts-noborder"),this.actualconfigbutton=json}},closebutton:{getter:function(){return this.actualclosebutton},setter:function(json){json&&((json=ButtonModel.from(json)).icon="ts-icon-close",json.type="ts-tertiary ts-noborder"),this.actualclosebutton=json}},checkbox:{getter:function(){return this.actualcheckbox},setter:function(json){this.actualcheckbox=json?CheckBoxModel.from(json):null}},actualconfigbutton:null,actualclosebutton:null,actualcheckbox:null,onconstruct:function(){ts.ui.BarModel.prototype.onconstruct.call(this),this.buttons=this.buttons||[],this.actions=this.actions||[],this.tabs=this.tabs||[],this._watchmodels(!0),this._updatehascontent()},ondestruct:function(){ts.ui.BarModel.prototype.ondestruct.call(this),this._watchmodels(!1)},onchange:function(changes){var has="hascontent";this.hadcontent||(this.hadcontent=changes.some(function(c){return c.name===has&&c.newValue})),changes.some(function(c){return c.name!==has&&"hadcontent"!==c.name},this)&&this._updatehascontent()},clear:chained(function(){this.tabs.clear(),this.buttons.clear(),this.search=null,this.title=null,this._updatehascontent()}),render:function(){return ts.ui.toolbar.edbml(this)},_watchmodels:function(doit){[this,this.buttons,this.tabs].forEach(function(model){doit?model.addObserver(this):model.removeObserver(this)},this)},_updatehascontent:function(){return this.hascontent=!!(this.tabs.length||this.buttons.length||this.title||this.status||this.search||this.closebutton),this.hascontent}})}(gui.Combo.chained,ts.ui.ButtonModel,ts.ui.CheckBoxModel),ts.ui.StatusBarModel=ts.ui.ToolBarModel.extend({pager:{getter:function(){return this.actualpager},setter:function(json){null===json||ts.ui.PagerModel.is(json)||(json=ts.ui.PagerModel.from(json)),this.actualpager=json}},actualpager:null,render:function(){return ts.ui.statusbar.edbml(this)},onchange:function(changes){ts.ui.ToolBarModel.prototype.onchange.call(this,changes),changes.forEach(function(c){"pager"===c.name&&this._updatehascontent()},this)},_updatehascontent:function(){return ts.ui.ToolBarModel.prototype._updatehascontent.call(this)||(this.hascontent=!!this.actualpager),this.hascontent}}),ts.ui.TopBarModel=function(chained){var UPDATE_DEFAULT_TITLE=ts.ui.BROADCAST_GLOBAL_TOPBAR_UPDATE_DEFAULT_TITLE;return ts.ui.ToolBarModel.extend({navigate:null,navigation:ts.ui.ButtonCollection,menubutton:ts.ui.ButtonModel,color:ts.ui.CLASS_BG_DARK,visible:!0,onconstruct:function(){this.navigation=this.navigaton||[],ts.ui.ToolBarModel.prototype.onconstruct.call(this),gui.Broadcast.addGlobal([UPDATE_DEFAULT_TITLE],this),this.menubutton={id:"ts-button-menuswitch",icon:"ts-icon-menuswitch",type:"ts-tertiary ts-topbar-menubutton",onclick:function(){ts.ui.openMenu()}}},onbroadcast:function(b){switch(b.type){case UPDATE_DEFAULT_TITLE:this.defaultTitle=b.data}},onchange:function(changes){ts.ui.ToolBarModel.prototype.onchange.call(this,changes),changes.some(function(c){return"defaultTitle"===c.name})&&this._updatehascontent()},clear:chained(function(){this.navigation.clear(),ts.ui.ToolBarModel.prototype.clear.call(this)}),_watchmodels:function(doit){ts.ui.ToolBarModel.prototype._watchmodels.call(this,doit);var nav=this.navigation;doit?nav.addObserver(this):nav.removeObserver(this)},_updatehascontent:function(){return ts.ui.ToolBarModel.prototype._updatehascontent.call(this)||(this.hascontent=!!this.navigation.length),this.hascontent}})}(gui.Combo.chained),ts.ui.FooterBarModel=function(PagerModel,ActionModel,chained){return ts.ui.Model.extend({item:"footerbar",bufferbar:ts.ui.ToolBarModel,actionbar:ts.ui.ToolBarModel,centerbar:ts.ui.StatusBarModel,backupbar:ts.ui.ToolBarModel,checkbox:{getter:function(){return this.actionbar.checkbox},setter:function(json){this.actionbar.checkbox=json}},status:{getter:function(){return this.actionbar.status},setter:function(string){this.actionbar.status=string}},actions:{getter:function(){return this.actionbar.actions},setter:function(json){this.actionbar.actions=json}},buttons:{getter:function(){return this.bufferbar.buttons},setter:function(json){this.bufferbar.buttons=json}},pager:{getter:function(){return this.centerbar.pager},setter:function(json){this.centerbar.pager=json}},onconstruct:function(){ts.ui.Model.prototype.onconstruct.call(this),this.bufferbar={},this.actionbar={},this.centerbar={},this.backupbar={}},render:function(){return ts.ui.footer.edbml(this)},clear:chained(function(){this.pager=null,this.status=null,this.checkbox=null,this.configbutton(null),this.collabbutton(null),this.bufferbar.buttons.clear(),this.actionbar.actions.clear(),this.centerbar.actions.clear()}),configbutton:chained(function(onclick){if(null===onclick)this.bufferbar.configbutton=this.centerbar.configbutton=null;else{if(!onclick)return this.centerbar.configbutton;this.bufferbar.configbutton=this.centerbar.configbutton={onclick:onclick}}}),collabbutton:chained(function(onclick){var actions=this.bufferbar.actions;if(!arguments.length)return actions[0]||null;actions.clear(),null!==onclick&&actions.push({label:"Collaborate On This",icon:"ts-icon-collaboration",onclick:onclick})}),linkable:chained(function(is){this.actionbar.linkable=!!is}),$show:function(){return this.$showActionBar(this.actionbar)||this.$showCenterBar(this.centerbar)||this.$showBackupBar(this.backupbar)},$showActionBar:function(model){return!!(model.actions.getLength()||model.status||model.checkbox)},$showCenterBar:function(model){return!!(model.pager||model.configbutton||model.actions.getLength()||model.buttons.getLength())},$showBackupBar:function(model){return!(!model.buttons.getLength()&&!model.actions.getLength())}})}(ts.ui.PagerModel,ts.ui.ActionModel,gui.Combo.chained),ts.ui.TopBar={setup:function(opt_json){},tabs:function(opt_json){},buttons:function(opt_json){},title:function(title){},defaultTitle:function(defaultTitle){},showBack:function(callback){},showNext:function(callback){},hideBack:function(){},hideNext:function(){},show:function(){},hide:function(){},dark:function(){},green:function(){},blue:function(){},purple:function(){},toString:function(){return"[object ts.ui.TopBar]"},localize:function(config){}},function(api,hidden,chained,confirmed,Type){function init(base){return function(){return topbar=topbar||new ts.ui.TopBarModel,base.apply(null,arguments)}}function navigation(insert,button){var nav=topbar.navigation,but=nav.get(button.id),add=null!==button.onclick;but&&nav.remove(but),add&&nav[insert](button)}var topbar=null,locale=null;gui.Object.extend(ts.ui.TopBar,{setup:api(chained(function(opt_json){console.error("Deprecated API is deprected")})),tabs:api(chained(confirmed("(array)")(init(function(opt_json){if(opt_json&&(topbar.tabs.clear(),opt_json.forEach(function(json){topbar.tabs.push(json)})),!arguments.length)return topbar.tabs})))),buttons:api(chained(confirmed("(array)")(init(function(opt_json){if(opt_json&&(topbar.buttons.clear(),opt_json.forEach(function(json){topbar.buttons.push(json)})),!arguments.length)return topbar.buttons})))),title:api(chained(confirmed("(string)")(init(function(title){if(!arguments.length)return topbar.title;topbar.title=title})))),defaultTitle:api(chained(confirmed("(string)")(init(function(defaultTitle){if(!arguments.length)return topbar.defaultTitle;topbar.defaultTitle=defaultTitle})))),showBack:api(chained(confirmed("function|null")(init(function(callback){navigation("unshift",{icon:"ts-icon-back",onclick:callback,id:"back"})})))),showNext:api(chained(confirmed("function|null")(init(function(callback){navigation("push",{icon:"ts-icon-next",onclick:callback,id:"next"})})))),hideBack:api(chained(function(){this.showBack(null)})),hideNext:api(chained(function(){this.showNext(null)})),show:api(chained(function(){topbar.visible=!0})),hide:api(chained(function(){topbar.visible=!1,topbar.clear()})),clear:api(chained(function(){topbar.clear()})),$getmodel:init(function(){return topbar}),localize:api(chained(function(arg){if(!arguments.length)return locale;switch(gui.Type.of(arg)){case"object":var newlocale=arg;locale&&!Object.keys(locale).every(function(key){var has=newlocale.hasOwnProperty(key);return has||console.error("Missing translations for "+key),has})||(locale=newlocale);break;case"string":var key=arg;if(locale&&locale.hasOwnProperty(key))return locale[key];console.error("Missing translations for "+key)}}))}),gui.Object.each(ts.ui.BACKGROUND_COLORS,function(methodname,classname){ts.ui.TopBar[methodname]=init(function(){return topbar.color=classname,ts.ui.TopBar})})}(ts.ui.Greenfield.api,gui.Object.hidden,gui.Combo.chained,gui.Arguments.confirmed,gui.Type),ts.ui.TopBar.localize({options:"Options",more:"More..."}),gui.module("bars-api@tradeshift.com"),ts.ui.TableRowCollection=function(Collection,GuiArray,confirmed){function deepclone(thing){return JSON.parse(JSON.stringify(thing))}var Super=Collection.prototype;return Collection.extend({$of:confirmed("object|array")(function(json){return json}),push:function(){var args=GuiArray.from(arguments),list=this._suspended?args:deepclone(args);return Super.push.apply(this,list)},unshift:function(){var args=GuiArray.from(arguments),list=this._suspended?args:deepclone(args);return Super.unshift.apply(this,list)},splice:function(){if(!this._suspended){var args=GuiArray.from(arguments);return Super.splice.apply(this,args.map(function(arg,index){return index>1?deepclone(arg):arg}))}Super.splice.apply(this,arguments)},$suspend:function(action,thisp){this._suspended=!0;var res=action.call(thisp);return this._suspended=!1,res},_suspended:!1})}(ts.ui.Collection,gui.Array,gui.Arguments.confirmed),ts.ui.TableColModel=function(chained){function sortnum(n1,n2,ascending){return n1<n2?ascending?-1:1:n1>n2?ascending?1:-1:0}function sortalpha(a,b,ascending){var com=compare(normalize(a),normalize(b));return com<0?ascending?-1:1:com>0?ascending?1:-1:0}function normalize(string){return string.toLowerCase().replace(SPECIAL,"")}function compare(string1,string2){return string1.localeCompare?string1.localeCompare(string2):string1>string2}var SPECIAL=/[^A-z\d ]/gi;return ts.ui.Model.extend({item:"tablecol",type:"ts-text",visible:!0,selected:!1,ascending:!0,editable:!0,flex:1,wrap:!1,minwidth:0,width:0,search:ts.ui.SearchModel,button:ts.ui.ButtonModel,hide:chained(function(){this.visible=!1}),show:chained(function(){this.visible=!0}),sort:null,isNumber:function(){return this.type.split(" ").indexOf("ts-number")>-1},onconstruct:function(){ts.ui.Model.prototype.onconstruct.call(this);var type=this.type;"text"!==type&&"number"!==type||(this.type="ts-"+type,console.warn('The column `type` property must be changed from "'+type+'" to "ts-'+type+'"'))},$sort:function(val1,val2,numerically){var ascending=this.ascending;return numerically?sortnum(val1,val2,ascending):sortalpha(val1,val2,ascending)}})}(gui.Combo.chained),ts.ui.TableColCollection=ts.ui.Collection.extend({$of:ts.ui.TableColModel}),ts.ui.TableModel=function(RowCollection,Type,Model){function isvisible(thing){return!1!==thing.visible}function validcell(thing){var is=void 0!==thing&&null!==thing;return is||console.error("Cell content cannot be of type "+Type.of(thing)),is}function rowify(x,i){return Array.isArray(x)&&(x={cells:x,selected:!!x.selected}),x.cells=x.cells.map(cellify),void 0!==i&&(x.$index=i),x}function cellify(x,i){return validcell(x)&&(primitive(x)&&(x={value:x,text:String(x)}),Model.is(x)||(x.valid=!1!==x.valid,x.message=x.message||null),void 0!==i&&(x.$index=i)),x}function modelify(table,row){var ModelC,rowindex,celindex;return row.cells=row.cells.map(function(cell){return cell.item&&!Model.is(cell)&&(ModelC=getmodel(cell.item),rowindex=row.$index,celindex=cell.$index,(cell=new ModelC(cell)).$index=celindex,table.setcell(rowindex,celindex,cell)),cell}),row}function getmodel(item){return{image:ts.ui.ImageModel,button:ts.ui.ButtonModel,switch:ts.ui.SwitchModel,userimage:ts.ui.UserImageModel,icon:ts.ui.IconModel}[item.toLowerCase()]||(console.error('"'+item+'" not matched to nothing'),null)}function primitive(x){switch(Type.of(x)){case"string":case"number":case"boolean":return!0}return!1}function selected(x){return!!x.selected}function getsortvalue(row,index){var cel,txt,val;return Type.isArray(row)?(cel=row[index],val=Type.isObject(cel)?cel.value:cel):(cel=row.cells[index],txt=cel.text,void 0!==(val=cel.value)?val:txt)}return ts.ui.Model.extend({item:"table",maxrows:0,page:0,total:0,selectable:!1,sortable:!1,linkable:!1,editable:!1,numbered:!1,cols:ts.ui.TableColCollection,rows:ts.ui.TableRowCollection,pager:ts.ui.PagerModel,toolbar:ts.ui.FooterBarModel,menuopen:!1,tempdirtyflag:-1,onconstruct:function(){ts.ui.Model.prototype.onconstruct.call(this),this.cols=this.cols||[],this.rows=this.rows||[],this.toolbar={}},visibleCols:function(){return this.cols.filter(isvisible)},visibleRows:function(){var all=this.rows,vis=this._layoutrows(),fix=this.maxrows>0,min=this.maxrows*this.page,max=min+this.maxrows;return vis.filter(function(row,i){return!fix||i>=min&&i<max}).map(function(row){return rowify(row,all.indexOf(row))}).map(function(row){return modelify(this,row)},this)},visibleCells:function(row){var cols=this.cols;return rowify(row).cells.filter(function(cell,i){return cols[i].visible})},firstVisibleRow:function(){return this.visibleRows()[0]||null},isWrapping:function(){return this.cols.some(function(col){return col.wrap})},isVisibleRowSelected:function(){return this.visibleRows().filter(function(row){return!1!==row.selectable}).some(selected)},search:function(index,value){this._ownsearch(index,value)},sort:function(col){col&&(this._sortcol=col)},togglerow:function(index){this.rowselected(index)?this.unselectrow(index):this.selectrow(index)},rowselected:function(index){return!0===!!this.getrow(index).selected},selectrow:function(index){var row=this.getrow(index);return!1===!!row.selected&&(row=this.getrow(index,!0,!0),row.selected=!0,this.$dirty(),!0)},unselectrow:function(index){var row=this.getrow(index);return!0===!!row.selected&&(row.selected=!1,this.$dirty(),!0)},selectedrows:function(){var indexes=[];return this.rows.forEach(function(row,i){!0===!!row.selected&&!1!==row.selectable&&indexes.push(i)}),indexes},pageCount:function(){if(this.maxrows){var rows=this.rows.filter(isvisible).length;return Math.ceil(rows/this.maxrows)}return 0},getPage:function(index){var fit=this.maxrows,row=this.rows[index],now=-1;return this._layoutrows().reduce(function(result,next,i){return-1===result&&(now+=i%fit==0?1:0,next===row&&(result=now)),result},-1)},getrow:function(rowindex,asobject,persist){var row=this.rows[rowindex];if(!row)throw new RangeError("Row index "+rowindex+" is out of reach");return asobject&&Array.isArray(row)&&(persist?(row=rowify(row,rowindex),this.rows.$suspend(function(){this.rows.splice(rowindex,1,row)},this)):row=rowify(row)),row},setrow:function(rowindex,row){this.getrow(rowindex)&&(this.rows.$suspend(function(){this.rows.splice(rowindex,1,row)},this),this.$dirty())},getcell:function(rowindex,cellindex){var cell=this.getrow(rowindex,!0).cells[cellindex];if(cell)return delete cell.$index,cell;throw new RangeError("Cell index "+cellindex+" is out of reach")},setcell:function(rowindex,cellindex,json){this.getrow(rowindex,!0,!0).cells.splice(cellindex,1,json),this.$dirty()},setvalidity:function(valid,rowindex,cellindex,message){var cell=this.getrow(rowindex,!0,!0).cells[cellindex];valid!==!!cell.valid&&(cell.message=valid?null:message||null,cell.valid=valid,this.$dirty())},moveposition:function(arg){switch(Type.of(arg)){case"object":this.position=arg;break;case"string":this._moverelative(arg.toLowerCase());break;case"null":this.position=null}return this.position},$cellid:function(rowindex,celindex){return[this.$instanceid,"cell",rowindex,celindex].join("-")},_searches:null,_sortcol:null,_layoutrows:function(){var shown=this.rows.filter(isvisible);return this._sort(shown,this._sortcol)},_sort:function(rows,col){if(col){var i=col.$index,vals=rows.map(function(r){return getsortvalue(r,i)});if(vals.some(function(v){return void 0===v||null===v}))throw new Error("Expected all columns cells to have a `value` or `text`");var n=!vals.some(isNaN);rows.sort(function(r1,r2){var c1=getsortvalue(r1,i),c2=getsortvalue(r2,i);return col.sort?col.sort(c1,c2,col.ascending):col.$sort(c1,c2,n)})}return rows},_ownsearch:function(index,value){value=String(value).toLowerCase(),this._searches=this._searches||{},value.length?this._searches[index]=value:delete this._searches[index];var indexes=Object.keys(this._searches),showall=!indexes.length;this.rows.forEach(function(row){row.visible=showall||this._showrow(row,indexes)},this)},_showrow:function(row,indexes){return indexes.every(function(index){var value=this._searches[index];return this._rowcontains(row,index,value)},this)},_rowcontains:function(row,index,value){var is=Array.isArray(row),cell=is?row[index]:row.cells[index];return String(is?cell:cell.value).toLowerCase().includes(value)}})}(ts.ui.TableRowCollection,gui.Type,ts.ui.Model),gui.module("tables-api@tradeshift.com")}(self),function(){!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):global.moment=factory()}(this,function(){"use strict";function utils_hooks__hooks(){return hookCallback.apply(null,arguments)}function isArray(input){return input instanceof Array||"[object Array]"===Object.prototype.toString.call(input)}function isDate(input){return input instanceof Date||"[object Date]"===Object.prototype.toString.call(input)}function map(arr,fn){var i,res=[];for(i=0;i<arr.length;++i)res.push(fn(arr[i],i));return res}function hasOwnProp(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function extend(a,b){for(var i in b)hasOwnProp(b,i)&&(a[i]=b[i]);return hasOwnProp(b,"toString")&&(a.toString=b.toString),hasOwnProp(b,"valueOf")&&(a.valueOf=b.valueOf),a}function create_utc__createUTC(input,format,locale,strict){return createLocalOrUTC(input,format,locale,strict,!0).utc()}function defaultParsingFlags(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function getParsingFlags(m){return null==m._pf&&(m._pf=defaultParsingFlags()),m._pf}function valid__isValid(m){if(null==m._isValid){var flags=getParsingFlags(m);m._isValid=!(isNaN(m._d.getTime())||!(flags.overflow<0)||flags.empty||flags.invalidMonth||flags.invalidWeekday||flags.nullInput||flags.invalidFormat||flags.userInvalidated),m._strict&&(m._isValid=m._isValid&&0===flags.charsLeftOver&&0===flags.unusedTokens.length&&void 0===flags.bigHour)}return m._isValid}function valid__createInvalid(flags){var m=create_utc__createUTC(NaN);return null!=flags?extend(getParsingFlags(m),flags):getParsingFlags(m).userInvalidated=!0,m}function isUndefined(input){return void 0===input}function copyConfig(to,from){var i,prop,val;if(isUndefined(from._isAMomentObject)||(to._isAMomentObject=from._isAMomentObject),isUndefined(from._i)||(to._i=from._i),isUndefined(from._f)||(to._f=from._f),isUndefined(from._l)||(to._l=from._l),isUndefined(from._strict)||(to._strict=from._strict),isUndefined(from._tzm)||(to._tzm=from._tzm),isUndefined(from._isUTC)||(to._isUTC=from._isUTC),isUndefined(from._offset)||(to._offset=from._offset),isUndefined(from._pf)||(to._pf=getParsingFlags(from)),isUndefined(from._locale)||(to._locale=from._locale),momentProperties.length>0)for(i in momentProperties)isUndefined(val=from[prop=momentProperties[i]])||(to[prop]=val);return to}function Moment(config){copyConfig(this,config),this._d=new Date(null!=config._d?config._d.getTime():NaN),!1===updateInProgress&&(updateInProgress=!0,utils_hooks__hooks.updateOffset(this),updateInProgress=!1)}function isMoment(obj){return obj instanceof Moment||null!=obj&&null!=obj._isAMomentObject}function absFloor(number){return number<0?Math.ceil(number):Math.floor(number)}function toInt(argumentForCoercion){var coercedNumber=+argumentForCoercion,value=0;return 0!==coercedNumber&&isFinite(coercedNumber)&&(value=absFloor(coercedNumber)),value}function compareArrays(array1,array2,dontConvert){var i,len=Math.min(array1.length,array2.length),lengthDiff=Math.abs(array1.length-array2.length),diffs=0;for(i=0;i<len;i++)(dontConvert&&array1[i]!==array2[i]||!dontConvert&&toInt(array1[i])!==toInt(array2[i]))&&diffs++;return diffs+lengthDiff}function warn(msg){!1===utils_hooks__hooks.suppressDeprecationWarnings&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+msg)}function deprecate(msg,fn){var firstTime=!0;return extend(function(){return firstTime&&(warn(msg+"\nArguments: "+Array.prototype.slice.call(arguments).join(", ")+"\n"+(new Error).stack),firstTime=!1),fn.apply(this,arguments)},fn)}function deprecateSimple(name,msg){deprecations[name]||(warn(msg),deprecations[name]=!0)}function isFunction(input){return input instanceof Function||"[object Function]"===Object.prototype.toString.call(input)}function isObject(input){return"[object Object]"===Object.prototype.toString.call(input)}function mergeConfigs(parentConfig,childConfig){var prop,res=extend({},parentConfig);for(prop in childConfig)hasOwnProp(childConfig,prop)&&(isObject(parentConfig[prop])&&isObject(childConfig[prop])?(res[prop]={},extend(res[prop],parentConfig[prop]),extend(res[prop],childConfig[prop])):null!=childConfig[prop]?res[prop]=childConfig[prop]:delete res[prop]);return res}function Locale(config){null!=config&&this.set(config)}function normalizeLocale(key){return key?key.toLowerCase().replace("_","-"):key}function chooseLocale(names){for(var j,next,locale,split,i=0;i<names.length;){for(j=(split=normalizeLocale(names[i]).split("-")).length,next=(next=normalizeLocale(names[i+1]))?next.split("-"):null;j>0;){if(locale=loadLocale(split.slice(0,j).join("-")))return locale;if(next&&next.length>=j&&compareArrays(split,next,!0)>=j-1)break;j--}i++}return null}function loadLocale(name){var oldLocale=null;if(!locales[name]&&"undefined"!=typeof module&&module&&module.exports)try{oldLocale=globalLocale._abbr,require("./locale/"+name),locale_locales__getSetGlobalLocale(oldLocale)}catch(e){}return locales[name]}function locale_locales__getSetGlobalLocale(key,values){var data;return key&&(data=isUndefined(values)?locale_locales__getLocale(key):defineLocale(key,values))&&(globalLocale=data),globalLocale._abbr}function defineLocale(name,config){return null!==config?(config.abbr=name,null!=locales[name]?(deprecateSimple("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale"),config=mergeConfigs(locales[name]._config,config)):null!=config.parentLocale&&(null!=locales[config.parentLocale]?config=mergeConfigs(locales[config.parentLocale]._config,config):deprecateSimple("parentLocaleUndefined","specified parentLocale is not defined yet")),locales[name]=new Locale(config),locale_locales__getSetGlobalLocale(name),locales[name]):(delete locales[name],null)}function locale_locales__getLocale(key){var locale;if(key&&key._locale&&key._locale._abbr&&(key=key._locale._abbr),!key)return globalLocale;if(!isArray(key)){if(locale=loadLocale(key))return locale;key=[key]}return chooseLocale(key)}function addUnitAlias(unit,shorthand){var lowerCase=unit.toLowerCase();aliases[lowerCase]=aliases[lowerCase+"s"]=aliases[shorthand]=unit}function normalizeUnits(units){return"string"==typeof units?aliases[units]||aliases[units.toLowerCase()]:void 0}function normalizeObjectUnits(inputObject){var normalizedProp,prop,normalizedInput={};for(prop in inputObject)hasOwnProp(inputObject,prop)&&(normalizedProp=normalizeUnits(prop))&&(normalizedInput[normalizedProp]=inputObject[prop]);return normalizedInput}function makeGetSet(unit,keepTime){return function(value){return null!=value?(get_set__set(this,unit,value),utils_hooks__hooks.updateOffset(this,keepTime),this):get_set__get(this,unit)}}function get_set__get(mom,unit){return mom.isValid()?mom._d["get"+(mom._isUTC?"UTC":"")+unit]():NaN}function get_set__set(mom,unit,value){mom.isValid()&&mom._d["set"+(mom._isUTC?"UTC":"")+unit](value)}function getSet(units,value){var unit;if("object"==typeof units)for(unit in units)this.set(unit,units[unit]);else if(units=normalizeUnits(units),isFunction(this[units]))return this[units](value);return this}function zeroFill(number,targetLength,forceSign){var absNumber=""+Math.abs(number),zerosToFill=targetLength-absNumber.length;return(number>=0?forceSign?"+":"":"-")+Math.pow(10,Math.max(0,zerosToFill)).toString().substr(1)+absNumber}function addFormatToken(token,padded,ordinal,callback){var func=callback;"string"==typeof callback&&(func=function(){return this[callback]()}),token&&(formatTokenFunctions[token]=func),padded&&(formatTokenFunctions[padded[0]]=function(){return zeroFill(func.apply(this,arguments),padded[1],padded[2])}),ordinal&&(formatTokenFunctions[ordinal]=function(){return this.localeData().ordinal(func.apply(this,arguments),token)})}function removeFormattingTokens(input){return input.match(/\[[\s\S]/)?input.replace(/^\[|\]$/g,""):input.replace(/\\/g,"")}function makeFormatFunction(format){var i,length,array=format.match(formattingTokens);for(i=0,length=array.length;i<length;i++)formatTokenFunctions[array[i]]?array[i]=formatTokenFunctions[array[i]]:array[i]=removeFormattingTokens(array[i]);return function(mom){var output="";for(i=0;i<length;i++)output+=array[i]instanceof Function?array[i].call(mom,format):array[i];return output}}function formatMoment(m,format){return m.isValid()?(format=expandFormat(format,m.localeData()),formatFunctions[format]=formatFunctions[format]||makeFormatFunction(format),formatFunctions[format](m)):m.localeData().invalidDate()}function expandFormat(format,locale){var i=5;for(localFormattingTokens.lastIndex=0;i>=0&&localFormattingTokens.test(format);)format=format.replace(localFormattingTokens,function(input){return locale.longDateFormat(input)||input}),localFormattingTokens.lastIndex=0,i-=1;return format}function addRegexToken(token,regex,strictRegex){regexes[token]=isFunction(regex)?regex:function(isStrict,localeData){return isStrict&&strictRegex?strictRegex:regex}}function getParseRegexForToken(token,config){return hasOwnProp(regexes,token)?regexes[token](config._strict,config._locale):new RegExp(unescapeFormat(token))}function unescapeFormat(s){return regexEscape(s.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(matched,p1,p2,p3,p4){return p1||p2||p3||p4}))}function regexEscape(s){return s.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function addParseToken(token,callback){var i,func=callback;for("string"==typeof token&&(token=[token]),"number"==typeof callback&&(func=function(input,array){array[callback]=toInt(input)}),i=0;i<token.length;i++)tokens[token[i]]=func}function addWeekParseToken(token,callback){addParseToken(token,function(input,array,config,token){config._w=config._w||{},callback(input,config._w,config,token)})}function addTimeToArrayFromToken(token,input,config){null!=input&&hasOwnProp(tokens,token)&&tokens[token](input,config._a,config,token)}function daysInMonth(year,month){return new Date(Date.UTC(year,month+1,0)).getUTCDate()}function setMonth(mom,value){var dayOfMonth;if(!mom.isValid())return mom;if("string"==typeof value)if(/^\d+$/.test(value))value=toInt(value);else if("number"!=typeof(value=mom.localeData().monthsParse(value)))return mom;return dayOfMonth=Math.min(mom.date(),daysInMonth(mom.year(),value)),mom._d["set"+(mom._isUTC?"UTC":"")+"Month"](value,dayOfMonth),mom}function getSetMonth(value){return null!=value?(setMonth(this,value),utils_hooks__hooks.updateOffset(this,!0),this):get_set__get(this,"Month")}function computeMonthsParse(){function cmpLenRev(a,b){return b.length-a.length}var i,mom,shortPieces=[],longPieces=[],mixedPieces=[];for(i=0;i<12;i++)mom=create_utc__createUTC([2e3,i]),shortPieces.push(this.monthsShort(mom,"")),longPieces.push(this.months(mom,"")),mixedPieces.push(this.months(mom,"")),mixedPieces.push(this.monthsShort(mom,""));for(shortPieces.sort(cmpLenRev),longPieces.sort(cmpLenRev),mixedPieces.sort(cmpLenRev),i=0;i<12;i++)shortPieces[i]=regexEscape(shortPieces[i]),longPieces[i]=regexEscape(longPieces[i]),mixedPieces[i]=regexEscape(mixedPieces[i]);this._monthsRegex=new RegExp("^("+mixedPieces.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+longPieces.join("|")+")$","i"),this._monthsShortStrictRegex=new RegExp("^("+shortPieces.join("|")+")$","i")}function checkOverflow(m){var overflow,a=m._a;return a&&-2===getParsingFlags(m).overflow&&(overflow=a[MONTH]<0||a[MONTH]>11?MONTH:a[DATE]<1||a[DATE]>daysInMonth(a[YEAR],a[MONTH])?DATE:a[HOUR]<0||a[HOUR]>24||24===a[HOUR]&&(0!==a[MINUTE]||0!==a[SECOND]||0!==a[MILLISECOND])?HOUR:a[MINUTE]<0||a[MINUTE]>59?MINUTE:a[SECOND]<0||a[SECOND]>59?SECOND:a[MILLISECOND]<0||a[MILLISECOND]>999?MILLISECOND:-1,getParsingFlags(m)._overflowDayOfYear&&(overflow<YEAR||overflow>DATE)&&(overflow=DATE),getParsingFlags(m)._overflowWeeks&&-1===overflow&&(overflow=WEEK),getParsingFlags(m)._overflowWeekday&&-1===overflow&&(overflow=WEEKDAY),getParsingFlags(m).overflow=overflow),m}function configFromISO(config){var i,l,allowTime,dateFormat,timeFormat,tzFormat,string=config._i,match=extendedIsoRegex.exec(string)||basicIsoRegex.exec(string);if(match){for(getParsingFlags(config).iso=!0,i=0,l=isoDates.length;i<l;i++)if(isoDates[i][1].exec(match[1])){dateFormat=isoDates[i][0],allowTime=!1!==isoDates[i][2];break}if(null==dateFormat)return void(config._isValid=!1);if(match[3]){for(i=0,l=isoTimes.length;i<l;i++)if(isoTimes[i][1].exec(match[3])){timeFormat=(match[2]||" ")+isoTimes[i][0];break}if(null==timeFormat)return void(config._isValid=!1)}if(!allowTime&&null!=timeFormat)return void(config._isValid=!1);if(match[4]){if(!tzRegex.exec(match[4]))return void(config._isValid=!1);tzFormat="Z"}config._f=dateFormat+(timeFormat||"")+(tzFormat||""),configFromStringAndFormat(config)}else config._isValid=!1}function configFromString(config){var matched=aspNetJsonRegex.exec(config._i);null===matched?(configFromISO(config),!1===config._isValid&&(delete config._isValid,utils_hooks__hooks.createFromInputFallback(config))):config._d=new Date(+matched[1])}function createDate(y,m,d,h,M,s,ms){var date=new Date(y,m,d,h,M,s,ms);return y<100&&y>=0&&isFinite(date.getFullYear())&&date.setFullYear(y),date}function createUTCDate(y){var date=new Date(Date.UTC.apply(null,arguments));return y<100&&y>=0&&isFinite(date.getUTCFullYear())&&date.setUTCFullYear(y),date}function daysInYear(year){return isLeapYear(year)?366:365}function isLeapYear(year){return year%4==0&&year%100!=0||year%400==0}function firstWeekOffset(year,dow,doy){var fwd=7+dow-doy;return-((7+createUTCDate(year,0,fwd).getUTCDay()-dow)%7)+fwd-1}function dayOfYearFromWeeks(year,week,weekday,dow,doy){var resYear,resDayOfYear,dayOfYear=1+7*(week-1)+(7+weekday-dow)%7+firstWeekOffset(year,dow,doy);return dayOfYear<=0?resDayOfYear=daysInYear(resYear=year-1)+dayOfYear:dayOfYear>daysInYear(year)?(resYear=year+1,resDayOfYear=dayOfYear-daysInYear(year)):(resYear=year,resDayOfYear=dayOfYear),{year:resYear,dayOfYear:resDayOfYear}}function weekOfYear(mom,dow,doy){var resWeek,resYear,weekOffset=firstWeekOffset(mom.year(),dow,doy),week=Math.floor((mom.dayOfYear()-weekOffset-1)/7)+1;return week<1?resWeek=week+weeksInYear(resYear=mom.year()-1,dow,doy):week>weeksInYear(mom.year(),dow,doy)?(resWeek=week-weeksInYear(mom.year(),dow,doy),resYear=mom.year()+1):(resYear=mom.year(),resWeek=week),{week:resWeek,year:resYear}}function weeksInYear(year,dow,doy){var weekOffset=firstWeekOffset(year,dow,doy),weekOffsetNext=firstWeekOffset(year+1,dow,doy);return(daysInYear(year)-weekOffset+weekOffsetNext)/7}function defaults(a,b,c){return null!=a?a:null!=b?b:c}function currentDateArray(config){var nowValue=new Date(utils_hooks__hooks.now());return config._useUTC?[nowValue.getUTCFullYear(),nowValue.getUTCMonth(),nowValue.getUTCDate()]:[nowValue.getFullYear(),nowValue.getMonth(),nowValue.getDate()]}function configFromArray(config){var i,date,currentDate,yearToUse,input=[];if(!config._d){for(currentDate=currentDateArray(config),config._w&&null==config._a[DATE]&&null==config._a[MONTH]&&dayOfYearFromWeekInfo(config),config._dayOfYear&&(yearToUse=defaults(config._a[YEAR],currentDate[YEAR]),config._dayOfYear>daysInYear(yearToUse)&&(getParsingFlags(config)._overflowDayOfYear=!0),date=createUTCDate(yearToUse,0,config._dayOfYear),config._a[MONTH]=date.getUTCMonth(),config._a[DATE]=date.getUTCDate()),i=0;i<3&&null==config._a[i];++i)config._a[i]=input[i]=currentDate[i];for(;i<7;i++)config._a[i]=input[i]=null==config._a[i]?2===i?1:0:config._a[i];24===config._a[HOUR]&&0===config._a[MINUTE]&&0===config._a[SECOND]&&0===config._a[MILLISECOND]&&(config._nextDay=!0,config._a[HOUR]=0),config._d=(config._useUTC?createUTCDate:createDate).apply(null,input),null!=config._tzm&&config._d.setUTCMinutes(config._d.getUTCMinutes()-config._tzm),config._nextDay&&(config._a[HOUR]=24)}}function dayOfYearFromWeekInfo(config){var w,weekYear,week,weekday,dow,doy,temp,weekdayOverflow;null!=(w=config._w).GG||null!=w.W||null!=w.E?(dow=1,doy=4,weekYear=defaults(w.GG,config._a[YEAR],weekOfYear(local__createLocal(),1,4).year),week=defaults(w.W,1),((weekday=defaults(w.E,1))<1||weekday>7)&&(weekdayOverflow=!0)):(dow=config._locale._week.dow,doy=config._locale._week.doy,weekYear=defaults(w.gg,config._a[YEAR],weekOfYear(local__createLocal(),dow,doy).year),week=defaults(w.w,1),null!=w.d?((weekday=w.d)<0||weekday>6)&&(weekdayOverflow=!0):null!=w.e?(weekday=w.e+dow,(w.e<0||w.e>6)&&(weekdayOverflow=!0)):weekday=dow),week<1||week>weeksInYear(weekYear,dow,doy)?getParsingFlags(config)._overflowWeeks=!0:null!=weekdayOverflow?getParsingFlags(config)._overflowWeekday=!0:(temp=dayOfYearFromWeeks(weekYear,week,weekday,dow,doy),config._a[YEAR]=temp.year,config._dayOfYear=temp.dayOfYear)}function configFromStringAndFormat(config){if(config._f!==utils_hooks__hooks.ISO_8601){config._a=[],getParsingFlags(config).empty=!0;var i,parsedInput,tokens,token,skipped,string=""+config._i,stringLength=string.length,totalParsedInputLength=0;for(tokens=expandFormat(config._f,config._locale).match(formattingTokens)||[],i=0;i<tokens.length;i++)token=tokens[i],(parsedInput=(string.match(getParseRegexForToken(token,config))||[])[0])&&((skipped=string.substr(0,string.indexOf(parsedInput))).length>0&&getParsingFlags(config).unusedInput.push(skipped),string=string.slice(string.indexOf(parsedInput)+parsedInput.length),totalParsedInputLength+=parsedInput.length),formatTokenFunctions[token]?(parsedInput?getParsingFlags(config).empty=!1:getParsingFlags(config).unusedTokens.push(token),addTimeToArrayFromToken(token,parsedInput,config)):config._strict&&!parsedInput&&getParsingFlags(config).unusedTokens.push(token);getParsingFlags(config).charsLeftOver=stringLength-totalParsedInputLength,string.length>0&&getParsingFlags(config).unusedInput.push(string),!0===getParsingFlags(config).bigHour&&config._a[HOUR]<=12&&config._a[HOUR]>0&&(getParsingFlags(config).bigHour=void 0),config._a[HOUR]=meridiemFixWrap(config._locale,config._a[HOUR],config._meridiem),configFromArray(config),checkOverflow(config)}else configFromISO(config)}function meridiemFixWrap(locale,hour,meridiem){var isPm;return null==meridiem?hour:null!=locale.meridiemHour?locale.meridiemHour(hour,meridiem):null!=locale.isPM?((isPm=locale.isPM(meridiem))&&hour<12&&(hour+=12),isPm||12!==hour||(hour=0),hour):hour}function configFromStringAndArray(config){var tempConfig,bestMoment,scoreToBeat,i,currentScore;if(0===config._f.length)return getParsingFlags(config).invalidFormat=!0,void(config._d=new Date(NaN));for(i=0;i<config._f.length;i++)currentScore=0,tempConfig=copyConfig({},config),null!=config._useUTC&&(tempConfig._useUTC=config._useUTC),tempConfig._f=config._f[i],configFromStringAndFormat(tempConfig),valid__isValid(tempConfig)&&(currentScore+=getParsingFlags(tempConfig).charsLeftOver,currentScore+=10*getParsingFlags(tempConfig).unusedTokens.length,getParsingFlags(tempConfig).score=currentScore,(null==scoreToBeat||currentScore<scoreToBeat)&&(scoreToBeat=currentScore,bestMoment=tempConfig));extend(config,bestMoment||tempConfig)}function configFromObject(config){if(!config._d){var i=normalizeObjectUnits(config._i);config._a=map([i.year,i.month,i.day||i.date,i.hour,i.minute,i.second,i.millisecond],function(obj){return obj&&parseInt(obj,10)}),configFromArray(config)}}function createFromConfig(config){var res=new Moment(checkOverflow(prepareConfig(config)));return res._nextDay&&(res.add(1,"d"),res._nextDay=void 0),res}function prepareConfig(config){var input=config._i,format=config._f;return config._locale=config._locale||locale_locales__getLocale(config._l),null===input||void 0===format&&""===input?valid__createInvalid({nullInput:!0}):("string"==typeof input&&(config._i=input=config._locale.preparse(input)),isMoment(input)?new Moment(checkOverflow(input)):(isArray(format)?configFromStringAndArray(config):format?configFromStringAndFormat(config):isDate(input)?config._d=input:configFromInput(config),valid__isValid(config)||(config._d=null),config))}function configFromInput(config){var input=config._i;void 0===input?config._d=new Date(utils_hooks__hooks.now()):isDate(input)?config._d=new Date(+input):"string"==typeof input?configFromString(config):isArray(input)?(config._a=map(input.slice(0),function(obj){return parseInt(obj,10)}),configFromArray(config)):"object"==typeof input?configFromObject(config):"number"==typeof input?config._d=new Date(input):utils_hooks__hooks.createFromInputFallback(config)}function createLocalOrUTC(input,format,locale,strict,isUTC){var c={};return"boolean"==typeof locale&&(strict=locale,locale=void 0),c._isAMomentObject=!0,c._useUTC=c._isUTC=isUTC,c._l=locale,c._i=input,c._f=format,c._strict=strict,createFromConfig(c)}function local__createLocal(input,format,locale,strict){return createLocalOrUTC(input,format,locale,strict,!1)}function pickBy(fn,moments){var res,i;if(1===moments.length&&isArray(moments[0])&&(moments=moments[0]),!moments.length)return local__createLocal();for(res=moments[0],i=1;i<moments.length;++i)moments[i].isValid()&&!moments[i][fn](res)||(res=moments[i]);return res}function Duration(duration){var normalizedInput=normalizeObjectUnits(duration),years=normalizedInput.year||0,quarters=normalizedInput.quarter||0,months=normalizedInput.month||0,weeks=normalizedInput.week||0,days=normalizedInput.day||0,hours=normalizedInput.hour||0,minutes=normalizedInput.minute||0,seconds=normalizedInput.second||0,milliseconds=normalizedInput.millisecond||0;this._milliseconds=+milliseconds+1e3*seconds+6e4*minutes+36e5*hours,this._days=+days+7*weeks,this._months=+months+3*quarters+12*years,this._data={},this._locale=locale_locales__getLocale(),this._bubble()}function isDuration(obj){return obj instanceof Duration}function offset(token,separator){addFormatToken(token,0,0,function(){var offset=this.utcOffset(),sign="+";return offset<0&&(offset=-offset,sign="-"),sign+zeroFill(~~(offset/60),2)+separator+zeroFill(~~offset%60,2)})}function offsetFromString(matcher,string){var matches=(string||"").match(matcher)||[],parts=((matches[matches.length-1]||[])+"").match(chunkOffset)||["-",0,0],minutes=60*parts[1]+toInt(parts[2]);return"+"===parts[0]?minutes:-minutes}function cloneWithOffset(input,model){var res,diff;return model._isUTC?(res=model.clone(),diff=(isMoment(input)||isDate(input)?+input:+local__createLocal(input))-+res,res._d.setTime(+res._d+diff),utils_hooks__hooks.updateOffset(res,!1),res):local__createLocal(input).local()}function getDateOffset(m){return 15*-Math.round(m._d.getTimezoneOffset()/15)}function isUtc(){return!!this.isValid()&&(this._isUTC&&0===this._offset)}function create__createDuration(input,key){var sign,ret,diffRes,duration=input,match=null;return isDuration(input)?duration={ms:input._milliseconds,d:input._days,M:input._months}:"number"==typeof input?(duration={},key?duration[key]=input:duration.milliseconds=input):(match=aspNetRegex.exec(input))?(sign="-"===match[1]?-1:1,duration={y:0,d:toInt(match[DATE])*sign,h:toInt(match[HOUR])*sign,m:toInt(match[MINUTE])*sign,s:toInt(match[SECOND])*sign,ms:toInt(match[MILLISECOND])*sign}):(match=isoRegex.exec(input))?(sign="-"===match[1]?-1:1,duration={y:parseIso(match[2],sign),M:parseIso(match[3],sign),w:parseIso(match[4],sign),d:parseIso(match[5],sign),h:parseIso(match[6],sign),m:parseIso(match[7],sign),s:parseIso(match[8],sign)}):null==duration?duration={}:"object"==typeof duration&&("from"in duration||"to"in duration)&&(diffRes=momentsDifference(local__createLocal(duration.from),local__createLocal(duration.to)),(duration={}).ms=diffRes.milliseconds,duration.M=diffRes.months),ret=new Duration(duration),isDuration(input)&&hasOwnProp(input,"_locale")&&(ret._locale=input._locale),ret}function parseIso(inp,sign){var res=inp&&parseFloat(inp.replace(",","."));return(isNaN(res)?0:res)*sign}function positiveMomentsDifference(base,other){var res={milliseconds:0,months:0};return res.months=other.month()-base.month()+12*(other.year()-base.year()),base.clone().add(res.months,"M").isAfter(other)&&--res.months,res.milliseconds=+other-+base.clone().add(res.months,"M"),res}function momentsDifference(base,other){var res;return base.isValid()&&other.isValid()?(other=cloneWithOffset(other,base),base.isBefore(other)?res=positiveMomentsDifference(base,other):((res=positiveMomentsDifference(other,base)).milliseconds=-res.milliseconds,res.months=-res.months),res):{milliseconds:0,months:0}}function absRound(number){return number<0?-1*Math.round(-1*number):Math.round(number)}function createAdder(direction,name){return function(val,period){var dur,tmp;return null===period||isNaN(+period)||(deprecateSimple(name,"moment()."+name+"(period, number) is deprecated. Please use moment()."+name+"(number, period)."),tmp=val,val=period,period=tmp),val="string"==typeof val?+val:val,dur=create__createDuration(val,period),add_subtract__addSubtract(this,dur,direction),this}}function add_subtract__addSubtract(mom,duration,isAdding,updateOffset){var milliseconds=duration._milliseconds,days=absRound(duration._days),months=absRound(duration._months);mom.isValid()&&(updateOffset=null==updateOffset||updateOffset,milliseconds&&mom._d.setTime(+mom._d+milliseconds*isAdding),days&&get_set__set(mom,"Date",get_set__get(mom,"Date")+days*isAdding),months&&setMonth(mom,get_set__get(mom,"Month")+months*isAdding),updateOffset&&utils_hooks__hooks.updateOffset(mom,days||months))}function monthDiff(a,b){var adjust,wholeMonthDiff=12*(b.year()-a.year())+(b.month()-a.month()),anchor=a.clone().add(wholeMonthDiff,"months");return adjust=b-anchor<0?(b-anchor)/(anchor-a.clone().add(wholeMonthDiff-1,"months")):(b-anchor)/(a.clone().add(wholeMonthDiff+1,"months")-anchor),-(wholeMonthDiff+adjust)}function locale(key){var newLocaleData;return void 0===key?this._locale._abbr:(null!=(newLocaleData=locale_locales__getLocale(key))&&(this._locale=newLocaleData),this)}function localeData(){return this._locale}function addWeekYearFormatToken(token,getter){addFormatToken(0,[token,token.length],0,getter)}function getSetWeekYearHelper(input,week,weekday,dow,doy){var weeksTarget;return null==input?weekOfYear(this,dow,doy).year:(weeksTarget=weeksInYear(input,dow,doy),week>weeksTarget&&(week=weeksTarget),setWeekAll.call(this,input,week,weekday,dow,doy))}function setWeekAll(weekYear,week,weekday,dow,doy){var dayOfYearData=dayOfYearFromWeeks(weekYear,week,weekday,dow,doy),date=createUTCDate(dayOfYearData.year,0,dayOfYearData.dayOfYear);return this.year(date.getUTCFullYear()),this.month(date.getUTCMonth()),this.date(date.getUTCDate()),this}function parseWeekday(input,locale){return"string"!=typeof input?input:isNaN(input)?"number"==typeof(input=locale.weekdaysParse(input))?input:null:parseInt(input,10)}function hFormat(){return this.hours()%12||12}function meridiem(token,lowercase){addFormatToken(token,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),lowercase)})}function matchMeridiem(isStrict,locale){return locale._meridiemParse}function preParsePostFormat(string){return string}function lists__get(format,index,field,setter){var locale=locale_locales__getLocale(),utc=create_utc__createUTC().set(setter,index);return locale[field](utc,format)}function list(format,index,field,count,setter){if("number"==typeof format&&(index=format,format=void 0),format=format||"",null!=index)return lists__get(format,index,field,setter);var i,out=[];for(i=0;i<count;i++)out[i]=lists__get(format,i,field,setter);return out}function duration_add_subtract__addSubtract(duration,input,value,direction){var other=create__createDuration(input,value);return duration._milliseconds+=direction*other._milliseconds,duration._days+=direction*other._days,duration._months+=direction*other._months,duration._bubble()}function absCeil(number){return number<0?Math.floor(number):Math.ceil(number)}function daysToMonths(days){return 4800*days/146097}function monthsToDays(months){return 146097*months/4800}function makeAs(alias){return function(){return this.as(alias)}}function makeGetter(name){return function(){return this._data[name]}}function substituteTimeAgo(string,number,withoutSuffix,isFuture,locale){return locale.relativeTime(number||1,!!withoutSuffix,string,isFuture)}function duration_humanize__relativeTime(posNegDuration,withoutSuffix,locale){var duration=create__createDuration(posNegDuration).abs(),seconds=round(duration.as("s")),minutes=round(duration.as("m")),hours=round(duration.as("h")),days=round(duration.as("d")),months=round(duration.as("M")),years=round(duration.as("y")),a=seconds<thresholds.s&&["s",seconds]||minutes<=1&&["m"]||minutes<thresholds.m&&["mm",minutes]||hours<=1&&["h"]||hours<thresholds.h&&["hh",hours]||days<=1&&["d"]||days<thresholds.d&&["dd",days]||months<=1&&["M"]||months<thresholds.M&&["MM",months]||years<=1&&["y"]||["yy",years];return a[2]=withoutSuffix,a[3]=+posNegDuration>0,a[4]=locale,substituteTimeAgo.apply(null,a)}function iso_string__toISOString(){var minutes,hours,years,seconds=iso_string__abs(this._milliseconds)/1e3,days=iso_string__abs(this._days),months=iso_string__abs(this._months);hours=absFloor((minutes=absFloor(seconds/60))/60),seconds%=60,minutes%=60;var Y=years=absFloor(months/12),M=months%=12,D=days,h=hours,m=minutes,s=seconds,total=this.asSeconds();return total?(total<0?"-":"")+"P"+(Y?Y+"Y":"")+(M?M+"M":"")+(D?D+"D":"")+(h||m||s?"T":"")+(h?h+"H":"")+(m?m+"M":"")+(s?s+"S":""):"P0D"}var hookCallback,momentProperties=utils_hooks__hooks.momentProperties=[],updateInProgress=!1,deprecations={};utils_hooks__hooks.suppressDeprecationWarnings=!1;var globalLocale,locales={},aliases={},formattingTokens=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,localFormattingTokens=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,formatFunctions={},formatTokenFunctions={},match1=/\d/,match2=/\d\d/,match3=/\d{3}/,match4=/\d{4}/,match6=/[+-]?\d{6}/,match1to2=/\d\d?/,match3to4=/\d\d\d\d?/,match5to6=/\d\d\d\d\d\d?/,match1to3=/\d{1,3}/,match1to4=/\d{1,4}/,match1to6=/[+-]?\d{1,6}/,matchUnsigned=/\d+/,matchSigned=/[+-]?\d+/,matchOffset=/Z|[+-]\d\d:?\d\d/gi,matchShortOffset=/Z|[+-]\d\d(?::?\d\d)?/gi,matchTimestamp=/[+-]?\d+(\.\d{1,3})?/,matchWord=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,regexes={},tokens={},YEAR=0,MONTH=1,DATE=2,HOUR=3,MINUTE=4,SECOND=5,MILLISECOND=6,WEEK=7,WEEKDAY=8;addFormatToken("M",["MM",2],"Mo",function(){return this.month()+1}),addFormatToken("MMM",0,0,function(format){return this.localeData().monthsShort(this,format)}),addFormatToken("MMMM",0,0,function(format){return this.localeData().months(this,format)}),addUnitAlias("month","M"),addRegexToken("M",match1to2),addRegexToken("MM",match1to2,match2),addRegexToken("MMM",function(isStrict,locale){return locale.monthsShortRegex(isStrict)}),addRegexToken("MMMM",function(isStrict,locale){return locale.monthsRegex(isStrict)}),addParseToken(["M","MM"],function(input,array){array[MONTH]=toInt(input)-1}),addParseToken(["MMM","MMMM"],function(input,array,config,token){var month=config._locale.monthsParse(input,token,config._strict);null!=month?array[MONTH]=month:getParsingFlags(config).invalidMonth=input});var MONTHS_IN_FORMAT=/D[oD]?(\[[^\[\]]*\]|\s+)+MMMM?/,defaultLocaleMonths="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),defaultLocaleMonthsShort="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),defaultMonthsShortRegex=matchWord,defaultMonthsRegex=matchWord,extendedIsoRegex=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?/,basicIsoRegex=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?/,tzRegex=/Z|[+-]\d\d(?::?\d\d)?/,isoDates=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/]],isoTimes=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],aspNetJsonRegex=/^\/?Date\((\-?\d+)/i;utils_hooks__hooks.createFromInputFallback=deprecate("moment construction falls back to js Date. This is discouraged and will be removed in upcoming major release. Please refer to https://github.com/moment/moment/issues/1407 for more info.",function(config){config._d=new Date(config._i+(config._useUTC?" UTC":""))}),addFormatToken("Y",0,0,function(){var y=this.year();return y<=9999?""+y:"+"+y}),addFormatToken(0,["YY",2],0,function(){return this.year()%100}),addFormatToken(0,["YYYY",4],0,"year"),addFormatToken(0,["YYYYY",5],0,"year"),addFormatToken(0,["YYYYYY",6,!0],0,"year"),addUnitAlias("year","y"),addRegexToken("Y",matchSigned),addRegexToken("YY",match1to2,match2),addRegexToken("YYYY",match1to4,match4),addRegexToken("YYYYY",match1to6,match6),addRegexToken("YYYYYY",match1to6,match6),addParseToken(["YYYYY","YYYYYY"],YEAR),addParseToken("YYYY",function(input,array){array[YEAR]=2===input.length?utils_hooks__hooks.parseTwoDigitYear(input):toInt(input)}),addParseToken("YY",function(input,array){array[YEAR]=utils_hooks__hooks.parseTwoDigitYear(input)}),addParseToken("Y",function(input,array){array[YEAR]=parseInt(input,10)}),utils_hooks__hooks.parseTwoDigitYear=function(input){return toInt(input)+(toInt(input)>68?1900:2e3)};var getSetYear=makeGetSet("FullYear",!1);utils_hooks__hooks.ISO_8601=function(){};var prototypeMin=deprecate("moment().min is deprecated, use moment.max instead. https://github.com/moment/moment/issues/1548",function(){var other=local__createLocal.apply(null,arguments);return this.isValid()&&other.isValid()?other<this?this:other:valid__createInvalid()}),prototypeMax=deprecate("moment().max is deprecated, use moment.min instead. https://github.com/moment/moment/issues/1548",function(){var other=local__createLocal.apply(null,arguments);return this.isValid()&&other.isValid()?other>this?this:other:valid__createInvalid()});offset("Z",":"),offset("ZZ",""),addRegexToken("Z",matchShortOffset),addRegexToken("ZZ",matchShortOffset),addParseToken(["Z","ZZ"],function(input,array,config){config._useUTC=!0,config._tzm=offsetFromString(matchShortOffset,input)});var chunkOffset=/([\+\-]|\d\d)/gi;utils_hooks__hooks.updateOffset=function(){};var aspNetRegex=/^(\-)?(?:(\d*)[. ])?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?\d*)?$/,isoRegex=/^(-)?P(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)W)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?$/;create__createDuration.fn=Duration.prototype;var add_subtract__add=createAdder(1,"add"),add_subtract__subtract=createAdder(-1,"subtract");utils_hooks__hooks.defaultFormat="YYYY-MM-DDTHH:mm:ssZ";var lang=deprecate("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(key){return void 0===key?this.localeData():this.locale(key)});addFormatToken(0,["gg",2],0,function(){return this.weekYear()%100}),addFormatToken(0,["GG",2],0,function(){return this.isoWeekYear()%100}),addWeekYearFormatToken("gggg","weekYear"),addWeekYearFormatToken("ggggg","weekYear"),addWeekYearFormatToken("GGGG","isoWeekYear"),addWeekYearFormatToken("GGGGG","isoWeekYear"),addUnitAlias("weekYear","gg"),addUnitAlias("isoWeekYear","GG"),addRegexToken("G",matchSigned),addRegexToken("g",matchSigned),addRegexToken("GG",match1to2,match2),addRegexToken("gg",match1to2,match2),addRegexToken("GGGG",match1to4,match4),addRegexToken("gggg",match1to4,match4),addRegexToken("GGGGG",match1to6,match6),addRegexToken("ggggg",match1to6,match6),addWeekParseToken(["gggg","ggggg","GGGG","GGGGG"],function(input,week,config,token){week[token.substr(0,2)]=toInt(input)}),addWeekParseToken(["gg","GG"],function(input,week,config,token){week[token]=utils_hooks__hooks.parseTwoDigitYear(input)}),addFormatToken("Q",0,"Qo","quarter"),addUnitAlias("quarter","Q"),addRegexToken("Q",match1),addParseToken("Q",function(input,array){array[MONTH]=3*(toInt(input)-1)}),addFormatToken("w",["ww",2],"wo","week"),addFormatToken("W",["WW",2],"Wo","isoWeek"),addUnitAlias("week","w"),addUnitAlias("isoWeek","W"),addRegexToken("w",match1to2),addRegexToken("ww",match1to2,match2),addRegexToken("W",match1to2),addRegexToken("WW",match1to2,match2),addWeekParseToken(["w","ww","W","WW"],function(input,week,config,token){week[token.substr(0,1)]=toInt(input)});var defaultLocaleWeek={dow:0,doy:6};addFormatToken("D",["DD",2],"Do","date"),addUnitAlias("date","D"),addRegexToken("D",match1to2),addRegexToken("DD",match1to2,match2),addRegexToken("Do",function(isStrict,locale){return isStrict?locale._ordinalParse:locale._ordinalParseLenient}),addParseToken(["D","DD"],DATE),addParseToken("Do",function(input,array){array[DATE]=toInt(input.match(match1to2)[0],10)});var getSetDayOfMonth=makeGetSet("Date",!0);addFormatToken("d",0,"do","day"),addFormatToken("dd",0,0,function(format){return this.localeData().weekdaysMin(this,format)}),addFormatToken("ddd",0,0,function(format){return this.localeData().weekdaysShort(this,format)}),addFormatToken("dddd",0,0,function(format){return this.localeData().weekdays(this,format)}),addFormatToken("e",0,0,"weekday"),addFormatToken("E",0,0,"isoWeekday"),addUnitAlias("day","d"),addUnitAlias("weekday","e"),addUnitAlias("isoWeekday","E"),addRegexToken("d",match1to2),addRegexToken("e",match1to2),addRegexToken("E",match1to2),addRegexToken("dd",matchWord),addRegexToken("ddd",matchWord),addRegexToken("dddd",matchWord),addWeekParseToken(["dd","ddd","dddd"],function(input,week,config,token){var weekday=config._locale.weekdaysParse(input,token,config._strict);null!=weekday?week.d=weekday:getParsingFlags(config).invalidWeekday=input}),addWeekParseToken(["d","e","E"],function(input,week,config,token){week[token]=toInt(input)});var defaultLocaleWeekdays="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),defaultLocaleWeekdaysShort="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),defaultLocaleWeekdaysMin="Su_Mo_Tu_We_Th_Fr_Sa".split("_");addFormatToken("DDD",["DDDD",3],"DDDo","dayOfYear"),addUnitAlias("dayOfYear","DDD"),addRegexToken("DDD",match1to3),addRegexToken("DDDD",match3),addParseToken(["DDD","DDDD"],function(input,array,config){config._dayOfYear=toInt(input)}),addFormatToken("H",["HH",2],0,"hour"),addFormatToken("h",["hh",2],0,hFormat),addFormatToken("hmm",0,0,function(){return""+hFormat.apply(this)+zeroFill(this.minutes(),2)}),addFormatToken("hmmss",0,0,function(){return""+hFormat.apply(this)+zeroFill(this.minutes(),2)+zeroFill(this.seconds(),2)}),addFormatToken("Hmm",0,0,function(){return""+this.hours()+zeroFill(this.minutes(),2)}),addFormatToken("Hmmss",0,0,function(){return""+this.hours()+zeroFill(this.minutes(),2)+zeroFill(this.seconds(),2)}),meridiem("a",!0),meridiem("A",!1),addUnitAlias("hour","h"),addRegexToken("a",matchMeridiem),addRegexToken("A",matchMeridiem),addRegexToken("H",match1to2),addRegexToken("h",match1to2),addRegexToken("HH",match1to2,match2),addRegexToken("hh",match1to2,match2),addRegexToken("hmm",match3to4),addRegexToken("hmmss",match5to6),addRegexToken("Hmm",match3to4),addRegexToken("Hmmss",match5to6),addParseToken(["H","HH"],HOUR),addParseToken(["a","A"],function(input,array,config){config._isPm=config._locale.isPM(input),config._meridiem=input}),addParseToken(["h","hh"],function(input,array,config){array[HOUR]=toInt(input),getParsingFlags(config).bigHour=!0}),addParseToken("hmm",function(input,array,config){var pos=input.length-2;array[HOUR]=toInt(input.substr(0,pos)),array[MINUTE]=toInt(input.substr(pos)),getParsingFlags(config).bigHour=!0}),addParseToken("hmmss",function(input,array,config){var pos1=input.length-4,pos2=input.length-2;array[HOUR]=toInt(input.substr(0,pos1)),array[MINUTE]=toInt(input.substr(pos1,2)),array[SECOND]=toInt(input.substr(pos2)),getParsingFlags(config).bigHour=!0}),addParseToken("Hmm",function(input,array,config){var pos=input.length-2;array[HOUR]=toInt(input.substr(0,pos)),array[MINUTE]=toInt(input.substr(pos))}),addParseToken("Hmmss",function(input,array,config){var pos1=input.length-4,pos2=input.length-2;array[HOUR]=toInt(input.substr(0,pos1)),array[MINUTE]=toInt(input.substr(pos1,2)),array[SECOND]=toInt(input.substr(pos2))});var defaultLocaleMeridiemParse=/[ap]\.?m?\.?/i,getSetHour=makeGetSet("Hours",!0);addFormatToken("m",["mm",2],0,"minute"),addUnitAlias("minute","m"),addRegexToken("m",match1to2),addRegexToken("mm",match1to2,match2),addParseToken(["m","mm"],MINUTE);var getSetMinute=makeGetSet("Minutes",!1);addFormatToken("s",["ss",2],0,"second"),addUnitAlias("second","s"),addRegexToken("s",match1to2),addRegexToken("ss",match1to2,match2),addParseToken(["s","ss"],SECOND);var getSetSecond=makeGetSet("Seconds",!1);addFormatToken("S",0,0,function(){return~~(this.millisecond()/100)}),addFormatToken(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),addFormatToken(0,["SSS",3],0,"millisecond"),addFormatToken(0,["SSSS",4],0,function(){return 10*this.millisecond()}),addFormatToken(0,["SSSSS",5],0,function(){return 100*this.millisecond()}),addFormatToken(0,["SSSSSS",6],0,function(){return 1e3*this.millisecond()}),addFormatToken(0,["SSSSSSS",7],0,function(){return 1e4*this.millisecond()}),addFormatToken(0,["SSSSSSSS",8],0,function(){return 1e5*this.millisecond()}),addFormatToken(0,["SSSSSSSSS",9],0,function(){return 1e6*this.millisecond()}),addUnitAlias("millisecond","ms"),addRegexToken("S",match1to3,match1),addRegexToken("SS",match1to3,match2),addRegexToken("SSS",match1to3,match3);var token;for(token="SSSS";token.length<=9;token+="S")addRegexToken(token,matchUnsigned);for(token="S";token.length<=9;token+="S")addParseToken(token,function(input,array){array[MILLISECOND]=toInt(1e3*("0."+input))});var getSetMillisecond=makeGetSet("Milliseconds",!1);addFormatToken("z",0,0,"zoneAbbr"),addFormatToken("zz",0,0,"zoneName");var momentPrototype__proto=Moment.prototype;momentPrototype__proto.add=add_subtract__add,momentPrototype__proto.calendar=function(time,formats){var now=time||local__createLocal(),sod=cloneWithOffset(now,this).startOf("day"),diff=this.diff(sod,"days",!0),format=diff<-6?"sameElse":diff<-1?"lastWeek":diff<0?"lastDay":diff<1?"sameDay":diff<2?"nextDay":diff<7?"nextWeek":"sameElse",output=formats&&(isFunction(formats[format])?formats[format]():formats[format]);return this.format(output||this.localeData().calendar(format,this,local__createLocal(now)))},momentPrototype__proto.clone=function(){return new Moment(this)},momentPrototype__proto.diff=function(input,units,asFloat){var that,zoneDelta,delta,output;return this.isValid()&&(that=cloneWithOffset(input,this)).isValid()?(zoneDelta=6e4*(that.utcOffset()-this.utcOffset()),"year"===(units=normalizeUnits(units))||"month"===units||"quarter"===units?(output=monthDiff(this,that),"quarter"===units?output/=3:"year"===units&&(output/=12)):(delta=this-that,output="second"===units?delta/1e3:"minute"===units?delta/6e4:"hour"===units?delta/36e5:"day"===units?(delta-zoneDelta)/864e5:"week"===units?(delta-zoneDelta)/6048e5:delta),asFloat?output:absFloor(output)):NaN},momentPrototype__proto.endOf=function(units){return void 0===(units=normalizeUnits(units))||"millisecond"===units?this:this.startOf(units).add(1,"isoWeek"===units?"week":units).subtract(1,"ms")},momentPrototype__proto.format=function(inputString){var output=formatMoment(this,inputString||utils_hooks__hooks.defaultFormat);return this.localeData().postformat(output)},momentPrototype__proto.from=function(time,withoutSuffix){return this.isValid()&&(isMoment(time)&&time.isValid()||local__createLocal(time).isValid())?create__createDuration({to:this,from:time}).locale(this.locale()).humanize(!withoutSuffix):this.localeData().invalidDate()},momentPrototype__proto.fromNow=function(withoutSuffix){return this.from(local__createLocal(),withoutSuffix)},momentPrototype__proto.to=function(time,withoutSuffix){return this.isValid()&&(isMoment(time)&&time.isValid()||local__createLocal(time).isValid())?create__createDuration({from:this,to:time}).locale(this.locale()).humanize(!withoutSuffix):this.localeData().invalidDate()},momentPrototype__proto.toNow=function(withoutSuffix){return this.to(local__createLocal(),withoutSuffix)},momentPrototype__proto.get=getSet,momentPrototype__proto.invalidAt=function(){return getParsingFlags(this).overflow},momentPrototype__proto.isAfter=function(input,units){var localInput=isMoment(input)?input:local__createLocal(input);return!(!this.isValid()||!localInput.isValid())&&("millisecond"===(units=normalizeUnits(isUndefined(units)?"millisecond":units))?+this>+localInput:+localInput<+this.clone().startOf(units))},momentPrototype__proto.isBefore=function(input,units){var localInput=isMoment(input)?input:local__createLocal(input);return!(!this.isValid()||!localInput.isValid())&&("millisecond"===(units=normalizeUnits(isUndefined(units)?"millisecond":units))?+this<+localInput:+this.clone().endOf(units)<+localInput)},momentPrototype__proto.isBetween=function(from,to,units){return this.isAfter(from,units)&&this.isBefore(to,units)},momentPrototype__proto.isSame=function(input,units){var inputMs,localInput=isMoment(input)?input:local__createLocal(input);return!(!this.isValid()||!localInput.isValid())&&("millisecond"===(units=normalizeUnits(units||"millisecond"))?+this==+localInput:(inputMs=+localInput,+this.clone().startOf(units)<=inputMs&&inputMs<=+this.clone().endOf(units)))},momentPrototype__proto.isSameOrAfter=function(input,units){return this.isSame(input,units)||this.isAfter(input,units)},momentPrototype__proto.isSameOrBefore=function(input,units){return this.isSame(input,units)||this.isBefore(input,units)},momentPrototype__proto.isValid=function(){return valid__isValid(this)},momentPrototype__proto.lang=lang,momentPrototype__proto.locale=locale,momentPrototype__proto.localeData=localeData,momentPrototype__proto.max=prototypeMax,momentPrototype__proto.min=prototypeMin,momentPrototype__proto.parsingFlags=function(){return extend({},getParsingFlags(this))},momentPrototype__proto.set=getSet,momentPrototype__proto.startOf=function(units){switch(units=normalizeUnits(units)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===units&&this.weekday(0),"isoWeek"===units&&this.isoWeekday(1),"quarter"===units&&this.month(3*Math.floor(this.month()/3)),this},momentPrototype__proto.subtract=add_subtract__subtract,momentPrototype__proto.toArray=function(){var m=this;return[m.year(),m.month(),m.date(),m.hour(),m.minute(),m.second(),m.millisecond()]},momentPrototype__proto.toObject=function(){var m=this;return{years:m.year(),months:m.month(),date:m.date(),hours:m.hours(),minutes:m.minutes(),seconds:m.seconds(),milliseconds:m.milliseconds()}},momentPrototype__proto.toDate=function(){return this._offset?new Date(+this):this._d},momentPrototype__proto.toISOString=function(){var m=this.clone().utc();return m.year()>0&&m.year()<=9999?isFunction(Date.prototype.toISOString)?this.toDate().toISOString():formatMoment(m,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):formatMoment(m,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},momentPrototype__proto.toJSON=function(){return this.isValid()?this.toISOString():null},momentPrototype__proto.toString=function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},momentPrototype__proto.unix=function(){return Math.floor(+this/1e3)},momentPrototype__proto.valueOf=function(){return+this._d-6e4*(this._offset||0)},momentPrototype__proto.creationData=function(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}},momentPrototype__proto.year=getSetYear,momentPrototype__proto.isLeapYear=function(){return isLeapYear(this.year())},momentPrototype__proto.weekYear=function(input){return getSetWeekYearHelper.call(this,input,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)},momentPrototype__proto.isoWeekYear=function(input){return getSetWeekYearHelper.call(this,input,this.isoWeek(),this.isoWeekday(),1,4)},momentPrototype__proto.quarter=momentPrototype__proto.quarters=function(input){return null==input?Math.ceil((this.month()+1)/3):this.month(3*(input-1)+this.month()%3)},momentPrototype__proto.month=getSetMonth,momentPrototype__proto.daysInMonth=function(){return daysInMonth(this.year(),this.month())},momentPrototype__proto.week=momentPrototype__proto.weeks=function(input){var week=this.localeData().week(this);return null==input?week:this.add(7*(input-week),"d")},momentPrototype__proto.isoWeek=momentPrototype__proto.isoWeeks=function(input){var week=weekOfYear(this,1,4).week;return null==input?week:this.add(7*(input-week),"d")},momentPrototype__proto.weeksInYear=function(){var weekInfo=this.localeData()._week;return weeksInYear(this.year(),weekInfo.dow,weekInfo.doy)},momentPrototype__proto.isoWeeksInYear=function(){return weeksInYear(this.year(),1,4)},momentPrototype__proto.date=getSetDayOfMonth,momentPrototype__proto.day=momentPrototype__proto.days=function(input){if(!this.isValid())return null!=input?this:NaN;var day=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=input?(input=parseWeekday(input,this.localeData()),this.add(input-day,"d")):day},momentPrototype__proto.weekday=function(input){if(!this.isValid())return null!=input?this:NaN;var weekday=(this.day()+7-this.localeData()._week.dow)%7;return null==input?weekday:this.add(input-weekday,"d")},momentPrototype__proto.isoWeekday=function(input){return this.isValid()?null==input?this.day()||7:this.day(this.day()%7?input:input-7):null!=input?this:NaN},momentPrototype__proto.dayOfYear=function(input){var dayOfYear=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return null==input?dayOfYear:this.add(input-dayOfYear,"d")},momentPrototype__proto.hour=momentPrototype__proto.hours=getSetHour,momentPrototype__proto.minute=momentPrototype__proto.minutes=getSetMinute,momentPrototype__proto.second=momentPrototype__proto.seconds=getSetSecond,momentPrototype__proto.millisecond=momentPrototype__proto.milliseconds=getSetMillisecond,momentPrototype__proto.utcOffset=function(input,keepLocalTime){var localAdjust,offset=this._offset||0;return this.isValid()?null!=input?("string"==typeof input?input=offsetFromString(matchShortOffset,input):Math.abs(input)<16&&(input*=60),!this._isUTC&&keepLocalTime&&(localAdjust=getDateOffset(this)),this._offset=input,this._isUTC=!0,null!=localAdjust&&this.add(localAdjust,"m"),offset!==input&&(!keepLocalTime||this._changeInProgress?add_subtract__addSubtract(this,create__createDuration(input-offset,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,utils_hooks__hooks.updateOffset(this,!0),this._changeInProgress=null)),this):this._isUTC?offset:getDateOffset(this):null!=input?this:NaN},momentPrototype__proto.utc=function(keepLocalTime){return this.utcOffset(0,keepLocalTime)},momentPrototype__proto.local=function(keepLocalTime){return this._isUTC&&(this.utcOffset(0,keepLocalTime),this._isUTC=!1,keepLocalTime&&this.subtract(getDateOffset(this),"m")),this},momentPrototype__proto.parseZone=function(){return this._tzm?this.utcOffset(this._tzm):"string"==typeof this._i&&this.utcOffset(offsetFromString(matchOffset,this._i)),this},momentPrototype__proto.hasAlignedHourOffset=function(input){return!!this.isValid()&&(input=input?local__createLocal(input).utcOffset():0,(this.utcOffset()-input)%60==0)},momentPrototype__proto.isDST=function(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()},momentPrototype__proto.isDSTShifted=function(){if(!isUndefined(this._isDSTShifted))return this._isDSTShifted;var c={};if(copyConfig(c,this),(c=prepareConfig(c))._a){var other=c._isUTC?create_utc__createUTC(c._a):local__createLocal(c._a);this._isDSTShifted=this.isValid()&&compareArrays(c._a,other.toArray())>0}else this._isDSTShifted=!1;return this._isDSTShifted},momentPrototype__proto.isLocal=function(){return!!this.isValid()&&!this._isUTC},momentPrototype__proto.isUtcOffset=function(){return!!this.isValid()&&this._isUTC},momentPrototype__proto.isUtc=isUtc,momentPrototype__proto.isUTC=isUtc,momentPrototype__proto.zoneAbbr=function(){return this._isUTC?"UTC":""},momentPrototype__proto.zoneName=function(){return this._isUTC?"Coordinated Universal Time":""},momentPrototype__proto.dates=deprecate("dates accessor is deprecated. Use date instead.",getSetDayOfMonth),momentPrototype__proto.months=deprecate("months accessor is deprecated. Use month instead",getSetMonth),momentPrototype__proto.years=deprecate("years accessor is deprecated. Use year instead",getSetYear),momentPrototype__proto.zone=deprecate("moment().zone is deprecated, use moment().utcOffset instead. https://github.com/moment/moment/issues/1779",function(input,keepLocalTime){return null!=input?("string"!=typeof input&&(input=-input),this.utcOffset(input,keepLocalTime),this):-this.utcOffset()});var momentPrototype=momentPrototype__proto,defaultCalendar={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},defaultLongDateFormat={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},defaultOrdinalParse=/\d{1,2}/,defaultRelativeTime={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},prototype__proto=Locale.prototype;prototype__proto._calendar=defaultCalendar,prototype__proto.calendar=function(key,mom,now){var output=this._calendar[key];return isFunction(output)?output.call(mom,now):output},prototype__proto._longDateFormat=defaultLongDateFormat,prototype__proto.longDateFormat=function(key){var format=this._longDateFormat[key],formatUpper=this._longDateFormat[key.toUpperCase()];return format||!formatUpper?format:(this._longDateFormat[key]=formatUpper.replace(/MMMM|MM|DD|dddd/g,function(val){return val.slice(1)}),this._longDateFormat[key])},prototype__proto._invalidDate="Invalid date",prototype__proto.invalidDate=function(){return this._invalidDate},prototype__proto._ordinal="%d",prototype__proto.ordinal=function(number){return this._ordinal.replace("%d",number)},prototype__proto._ordinalParse=defaultOrdinalParse,prototype__proto.preparse=preParsePostFormat,prototype__proto.postformat=preParsePostFormat,prototype__proto._relativeTime=defaultRelativeTime,prototype__proto.relativeTime=function(number,withoutSuffix,string,isFuture){var output=this._relativeTime[string];return isFunction(output)?output(number,withoutSuffix,string,isFuture):output.replace(/%d/i,number)},prototype__proto.pastFuture=function(diff,output){var format=this._relativeTime[diff>0?"future":"past"];return isFunction(format)?format(output):format.replace(/%s/i,output)},prototype__proto.set=function(config){var prop,i;for(i in config)isFunction(prop=config[i])?this[i]=prop:this["_"+i]=prop;this._config=config,this._ordinalParseLenient=new RegExp(this._ordinalParse.source+"|"+/\d{1,2}/.source)},prototype__proto.months=function(m,format){return isArray(this._months)?this._months[m.month()]:this._months[MONTHS_IN_FORMAT.test(format)?"format":"standalone"][m.month()]},prototype__proto._months=defaultLocaleMonths,prototype__proto.monthsShort=function(m,format){return isArray(this._monthsShort)?this._monthsShort[m.month()]:this._monthsShort[MONTHS_IN_FORMAT.test(format)?"format":"standalone"][m.month()]},prototype__proto._monthsShort=defaultLocaleMonthsShort,prototype__proto.monthsParse=function(monthName,format,strict){var i,mom,regex;for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),i=0;i<12;i++){if(mom=create_utc__createUTC([2e3,i]),strict&&!this._longMonthsParse[i]&&(this._longMonthsParse[i]=new RegExp("^"+this.months(mom,"").replace(".","")+"$","i"),this._shortMonthsParse[i]=new RegExp("^"+this.monthsShort(mom,"").replace(".","")+"$","i")),strict||this._monthsParse[i]||(regex="^"+this.months(mom,"")+"|^"+this.monthsShort(mom,""),this._monthsParse[i]=new RegExp(regex.replace(".",""),"i")),strict&&"MMMM"===format&&this._longMonthsParse[i].test(monthName))return i;if(strict&&"MMM"===format&&this._shortMonthsParse[i].test(monthName))return i;if(!strict&&this._monthsParse[i].test(monthName))return i}},prototype__proto._monthsRegex=defaultMonthsRegex,prototype__proto.monthsRegex=function(isStrict){return this._monthsParseExact?(hasOwnProp(this,"_monthsRegex")||computeMonthsParse.call(this),isStrict?this._monthsStrictRegex:this._monthsRegex):this._monthsStrictRegex&&isStrict?this._monthsStrictRegex:this._monthsRegex},prototype__proto._monthsShortRegex=defaultMonthsShortRegex,prototype__proto.monthsShortRegex=function(isStrict){return this._monthsParseExact?(hasOwnProp(this,"_monthsRegex")||computeMonthsParse.call(this),isStrict?this._monthsShortStrictRegex:this._monthsShortRegex):this._monthsShortStrictRegex&&isStrict?this._monthsShortStrictRegex:this._monthsShortRegex},prototype__proto.week=function(mom){return weekOfYear(mom,this._week.dow,this._week.doy).week},prototype__proto._week=defaultLocaleWeek,prototype__proto.firstDayOfYear=function(){return this._week.doy},prototype__proto.firstDayOfWeek=function(){return this._week.dow},prototype__proto.weekdays=function(m,format){return isArray(this._weekdays)?this._weekdays[m.day()]:this._weekdays[this._weekdays.isFormat.test(format)?"format":"standalone"][m.day()]},prototype__proto._weekdays=defaultLocaleWeekdays,prototype__proto.weekdaysMin=function(m){return this._weekdaysMin[m.day()]},prototype__proto._weekdaysMin=defaultLocaleWeekdaysMin,prototype__proto.weekdaysShort=function(m){return this._weekdaysShort[m.day()]},prototype__proto._weekdaysShort=defaultLocaleWeekdaysShort,prototype__proto.weekdaysParse=function(weekdayName,format,strict){var i,mom,regex;for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),i=0;i<7;i++){if(mom=local__createLocal([2e3,1]).day(i),strict&&!this._fullWeekdaysParse[i]&&(this._fullWeekdaysParse[i]=new RegExp("^"+this.weekdays(mom,"").replace(".",".?")+"$","i"),this._shortWeekdaysParse[i]=new RegExp("^"+this.weekdaysShort(mom,"").replace(".",".?")+"$","i"),this._minWeekdaysParse[i]=new RegExp("^"+this.weekdaysMin(mom,"").replace(".",".?")+"$","i")),this._weekdaysParse[i]||(regex="^"+this.weekdays(mom,"")+"|^"+this.weekdaysShort(mom,"")+"|^"+this.weekdaysMin(mom,""),this._weekdaysParse[i]=new RegExp(regex.replace(".",""),"i")),strict&&"dddd"===format&&this._fullWeekdaysParse[i].test(weekdayName))return i;if(strict&&"ddd"===format&&this._shortWeekdaysParse[i].test(weekdayName))return i;if(strict&&"dd"===format&&this._minWeekdaysParse[i].test(weekdayName))return i;if(!strict&&this._weekdaysParse[i].test(weekdayName))return i}},prototype__proto.isPM=function(input){return"p"===(input+"").toLowerCase().charAt(0)},prototype__proto._meridiemParse=defaultLocaleMeridiemParse,prototype__proto.meridiem=function(hours,minutes,isLower){return hours>11?isLower?"pm":"PM":isLower?"am":"AM"},locale_locales__getSetGlobalLocale("en",{ordinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(number){var b=number%10;return number+(1===toInt(number%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th")}}),utils_hooks__hooks.lang=deprecate("moment.lang is deprecated. Use moment.locale instead.",locale_locales__getSetGlobalLocale),utils_hooks__hooks.langData=deprecate("moment.langData is deprecated. Use moment.localeData instead.",locale_locales__getLocale);var mathAbs=Math.abs,asMilliseconds=makeAs("ms"),asSeconds=makeAs("s"),asMinutes=makeAs("m"),asHours=makeAs("h"),asDays=makeAs("d"),asWeeks=makeAs("w"),asMonths=makeAs("M"),asYears=makeAs("y"),milliseconds=makeGetter("milliseconds"),seconds=makeGetter("seconds"),minutes=makeGetter("minutes"),hours=makeGetter("hours"),days=makeGetter("days"),months=makeGetter("months"),years=makeGetter("years"),round=Math.round,thresholds={s:45,m:45,h:22,d:26,M:11},iso_string__abs=Math.abs,duration_prototype__proto=Duration.prototype;return duration_prototype__proto.abs=function(){var data=this._data;return this._milliseconds=mathAbs(this._milliseconds),this._days=mathAbs(this._days),this._months=mathAbs(this._months),data.milliseconds=mathAbs(data.milliseconds),data.seconds=mathAbs(data.seconds),data.minutes=mathAbs(data.minutes),data.hours=mathAbs(data.hours),data.months=mathAbs(data.months),data.years=mathAbs(data.years),this},duration_prototype__proto.add=function(input,value){return duration_add_subtract__addSubtract(this,input,value,1)},duration_prototype__proto.subtract=function(input,value){return duration_add_subtract__addSubtract(this,input,value,-1)},duration_prototype__proto.as=function(units){var days,months,milliseconds=this._milliseconds;if("month"===(units=normalizeUnits(units))||"year"===units)return days=this._days+milliseconds/864e5,months=this._months+daysToMonths(days),"month"===units?months:months/12;switch(days=this._days+Math.round(monthsToDays(this._months)),units){case"week":return days/7+milliseconds/6048e5;case"day":return days+milliseconds/864e5;case"hour":return 24*days+milliseconds/36e5;case"minute":return 1440*days+milliseconds/6e4;case"second":return 86400*days+milliseconds/1e3;case"millisecond":return Math.floor(864e5*days)+milliseconds;default:throw new Error("Unknown unit "+units)}},duration_prototype__proto.asMilliseconds=asMilliseconds,duration_prototype__proto.asSeconds=asSeconds,duration_prototype__proto.asMinutes=asMinutes,duration_prototype__proto.asHours=asHours,duration_prototype__proto.asDays=asDays,duration_prototype__proto.asWeeks=asWeeks,duration_prototype__proto.asMonths=asMonths,duration_prototype__proto.asYears=asYears,duration_prototype__proto.valueOf=function(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*toInt(this._months/12)},duration_prototype__proto._bubble=function(){var seconds,minutes,hours,years,monthsFromDays,milliseconds=this._milliseconds,days=this._days,months=this._months,data=this._data;return milliseconds>=0&&days>=0&&months>=0||milliseconds<=0&&days<=0&&months<=0||(milliseconds+=864e5*absCeil(monthsToDays(months)+days),days=0,months=0),data.milliseconds=milliseconds%1e3,seconds=absFloor(milliseconds/1e3),data.seconds=seconds%60,minutes=absFloor(seconds/60),data.minutes=minutes%60,hours=absFloor(minutes/60),data.hours=hours%24,days+=absFloor(hours/24),monthsFromDays=absFloor(daysToMonths(days)),months+=monthsFromDays,days-=absCeil(monthsToDays(monthsFromDays)),years=absFloor(months/12),months%=12,data.days=days,data.months=months,data.years=years,this},duration_prototype__proto.get=function(units){return units=normalizeUnits(units),this[units+"s"]()},duration_prototype__proto.milliseconds=milliseconds,duration_prototype__proto.seconds=seconds,duration_prototype__proto.minutes=minutes,duration_prototype__proto.hours=hours,duration_prototype__proto.days=days,duration_prototype__proto.weeks=function(){return absFloor(this.days()/7)},duration_prototype__proto.months=months,duration_prototype__proto.years=years,duration_prototype__proto.humanize=function(withSuffix){var locale=this.localeData(),output=duration_humanize__relativeTime(this,!withSuffix,locale);return withSuffix&&(output=locale.pastFuture(+this,output)),locale.postformat(output)},duration_prototype__proto.toISOString=iso_string__toISOString,duration_prototype__proto.toString=iso_string__toISOString,duration_prototype__proto.toJSON=iso_string__toISOString,duration_prototype__proto.locale=locale,duration_prototype__proto.localeData=localeData,duration_prototype__proto.toIsoString=deprecate("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",iso_string__toISOString),duration_prototype__proto.lang=lang,addFormatToken("X",0,0,"unix"),addFormatToken("x",0,0,"valueOf"),addRegexToken("x",matchSigned),addRegexToken("X",matchTimestamp),addParseToken("X",function(input,array,config){config._d=new Date(1e3*parseFloat(input,10))}),addParseToken("x",function(input,array,config){config._d=new Date(toInt(input))}),utils_hooks__hooks.version="2.12.0",function(callback){hookCallback=callback}(local__createLocal),utils_hooks__hooks.fn=momentPrototype,utils_hooks__hooks.min=function(){return pickBy("isBefore",[].slice.call(arguments,0))},utils_hooks__hooks.max=function(){return pickBy("isAfter",[].slice.call(arguments,0))},utils_hooks__hooks.now=function(){return Date.now?Date.now():+new Date},utils_hooks__hooks.utc=create_utc__createUTC,utils_hooks__hooks.unix=function(input){return local__createLocal(1e3*input)},utils_hooks__hooks.months=function(format,index){return list(format,index,"months",12,"month")},utils_hooks__hooks.isDate=isDate,utils_hooks__hooks.locale=locale_locales__getSetGlobalLocale,utils_hooks__hooks.invalid=valid__createInvalid,utils_hooks__hooks.duration=create__createDuration,utils_hooks__hooks.isMoment=isMoment,utils_hooks__hooks.weekdays=function(format,index){return list(format,index,"weekdays",7,"day")},utils_hooks__hooks.parseZone=function(){return local__createLocal.apply(null,arguments).parseZone()},utils_hooks__hooks.localeData=locale_locales__getLocale,utils_hooks__hooks.isDuration=isDuration,utils_hooks__hooks.monthsShort=function(format,index){return list(format,index,"monthsShort",12,"month")},utils_hooks__hooks.weekdaysMin=function(format,index){return list(format,index,"weekdaysMin",7,"day")},utils_hooks__hooks.defineLocale=defineLocale,utils_hooks__hooks.updateLocale=function(name,config){if(null!=config){var locale;null!=locales[name]&&(config=mergeConfigs(locales[name]._config,config)),(locale=new Locale(config)).parentLocale=locales[name],locales[name]=locale,locale_locales__getSetGlobalLocale(name)}else null!=locales[name]&&(null!=locales[name].parentLocale?locales[name]=locales[name].parentLocale:null!=locales[name]&&delete locales[name]);return locales[name]},utils_hooks__hooks.locales=function(){return Object.keys(locales)},utils_hooks__hooks.weekdaysShort=function(format,index){return list(format,index,"weekdaysShort",7,"day")},utils_hooks__hooks.normalizeUnits=normalizeUnits,utils_hooks__hooks.relativeTimeThreshold=function(threshold,limit){return void 0!==thresholds[threshold]&&(void 0===limit?thresholds[threshold]:(thresholds[threshold]=limit,!0))},utils_hooks__hooks.prototype=momentPrototype,utils_hooks__hooks})}.call(ts.ui),function(){!function(root,factory){"object"==typeof module&&module.exports?module.exports=factory():"function"==typeof define&&define.amd?define(factory):root.Spinner=factory()}(this,function(){"use strict";function createEl(tag,prop){var n,el=document.createElement(tag||"div");for(n in prop)el[n]=prop[n];return el}function ins(parent){for(var i=1,n=arguments.length;i<n;i++)parent.appendChild(arguments[i]);return parent}function addAnimation(alpha,trail,i,lines){var name=["opacity",trail,~~(100*alpha),i,lines].join("-"),start=.01+i/lines*100,z=Math.max(1-(1-alpha)/trail*(100-start),alpha),prefix=useCssAnimations.substring(0,useCssAnimations.indexOf("Animation")).toLowerCase(),pre=prefix&&"-"+prefix+"-"||"";return animations[name]||(sheet.insertRule("@"+pre+"keyframes "+name+"{0%{opacity:"+z+"}"+start+"%{opacity:"+alpha+"}"+(start+.01)+"%{opacity:1}"+(start+trail)%100+"%{opacity:"+alpha+"}100%{opacity:"+z+"}}",sheet.cssRules.length),animations[name]=1),name}function vendor(el,prop){var pp,i,s=el.style;if(prop=prop.charAt(0).toUpperCase()+prop.slice(1),void 0!==s[prop])return prop;for(i=0;i<prefixes.length;i++)if(pp=prefixes[i]+prop,void 0!==s[pp])return pp}function css(el,prop){for(var n in prop)el.style[vendor(el,n)||n]=prop[n];return el}function merge(obj){for(var i=1;i<arguments.length;i++){var def=arguments[i];for(var n in def)void 0===obj[n]&&(obj[n]=def[n])}return obj}function getColor(color,idx){return"string"==typeof color?color:color[idx%color.length]}function Spinner(o){this.opts=merge(o||{},Spinner.defaults,defaults)}var useCssAnimations,sheet,prefixes=["webkit","Moz","ms","O"],animations={},defaults={lines:12,length:7,width:5,radius:10,scale:1,corners:1,color:"#000",opacity:.25,rotate:0,direction:1,speed:1,trail:100,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"};if(Spinner.defaults={},merge(Spinner.prototype,{spin:function(target){this.stop();var self=this,o=self.opts,el=self.el=createEl(null,{className:o.className});if(css(el,{position:o.position,width:0,zIndex:o.zIndex,left:o.left,top:o.top}),target&&target.insertBefore(el,target.firstChild||null),el.setAttribute("role","progressbar"),self.lines(el,self.opts),!useCssAnimations){var alpha,i=0,start=(o.lines-1)*(1-o.direction)/2,fps=o.fps,f=fps/o.speed,ostep=(1-o.opacity)/(f*o.trail/100),astep=f/o.lines;!function anim(){i++;for(var j=0;j<o.lines;j++)alpha=Math.max(1-(i+(o.lines-j)*astep)%f*ostep,o.opacity),self.opacity(el,j*o.direction+start,alpha,o);self.timeout=self.el&&setTimeout(anim,~~(1e3/fps))}()}return self},stop:function(){var el=this.el;return el&&(clearTimeout(this.timeout),el.parentNode&&el.parentNode.removeChild(el),this.el=void 0),this},lines:function(el,o){function fill(color,shadow){return css(createEl(),{position:"absolute",width:o.scale*(o.length+o.width)+"px",height:o.scale*o.width+"px",background:color,boxShadow:shadow,transformOrigin:"left",transform:"rotate("+~~(360/o.lines*i+o.rotate)+"deg) translate("+o.scale*o.radius+"px,0)",borderRadius:(o.corners*o.scale*o.width>>1)+"px"})}for(var seg,i=0,start=(o.lines-1)*(1-o.direction)/2;i<o.lines;i++)seg=css(createEl(),{position:"absolute",top:1+~(o.scale*o.width/2)+"px",transform:o.hwaccel?"translate3d(0,0,0)":"",opacity:o.opacity,animation:useCssAnimations&&addAnimation(o.opacity,o.trail,start+i*o.direction,o.lines)+" "+1/o.speed+"s linear infinite"}),o.shadow&&ins(seg,css(fill("#000","0 0 4px #000"),{top:"2px"})),ins(el,ins(seg,fill(getColor(o.color,i),"0 0 1px rgba(0,0,0,.1)")));return el},opacity:function(el,i,val){i<el.childNodes.length&&(el.childNodes[i].style.opacity=val)}}),"undefined"!=typeof document){sheet=function(){var el=createEl("style",{type:"text/css"});return ins(document.getElementsByTagName("head")[0],el),el.sheet||el.styleSheet}();var probe=css(createEl("group"),{behavior:"url(#default#VML)"});!vendor(probe,"transform")&&probe.adj?function(){function vml(tag,attr){return createEl("<"+tag+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',attr)}sheet.addRule(".spin-vml","behavior:url(#default#VML)"),Spinner.prototype.lines=function(el,o){function grp(){return css(vml("group",{coordsize:s+" "+s,coordorigin:-r+" "+-r}),{width:s,height:s})}function seg(i,dx,filter){ins(g,ins(css(grp(),{rotation:360/o.lines*i+"deg",left:~~dx}),ins(css(vml("roundrect",{arcsize:o.corners}),{width:r,height:o.scale*o.width,left:o.scale*o.radius,top:-o.scale*o.width>>1,filter:filter}),vml("fill",{color:getColor(o.color,i),opacity:o.opacity}),vml("stroke",{opacity:0}))))}var i,r=o.scale*(o.length+o.width),s=2*o.scale*r,margin=-(o.width+o.length)*o.scale*2+"px",g=css(grp(),{position:"absolute",top:margin,left:margin});if(o.shadow)for(i=1;i<=o.lines;i++)seg(i,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(i=1;i<=o.lines;i++)seg(i);return ins(el,g)},Spinner.prototype.opacity=function(el,i,val,o){var c=el.firstChild;o=o.shadow&&o.lines||0,c&&i+o<c.childNodes.length&&(c=(c=(c=c.childNodes[i+o])&&c.firstChild)&&c.firstChild)&&(c.opacity=val)}}():useCssAnimations=vendor(probe,"animation")}return Spinner})}.call(ts.ui),function(){!function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;((g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).ts||(g.ts={}))._app=f()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n||e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();exports.broadcast=function(appIds,key,data){var content=stringify(appIds,key,data);parent.postMessage(content,"*")},exports.subscribe=function(appIds){return new Listener(appIds)};var Listener=function(){function Listener(appIds){_classCallCheck(this,Listener),this.events=new Map,this.appIds=appIds}return _createClass(Listener,[{key:"on",value:function(key,callback){var _this=this;if(!key||!callback)return console.warn("We need two parameters key and callback"),this;if(this.events.has(key))return this.off(key),this;var handler=function(e){if("string"!=typeof e.data||!e.data.includes("app-broadcast:")||!e.data.includes(key))return _this;var content=JSON.parse(e.data.replace("app-broadcast:",""));if(content.key!==key||"*"!==_this.appIds&&content.appIds!==_this.appIds)return _this;callback&&callback(content.data)};return window.addEventListener("message",handler),this.events.set(key,handler),this}},{key:"off",value:function(key){if(!key)return console.warn("We need the parameter of key"),this;if(this.events.has(key)){var handler=this.events.get(key);window.removeEventListener("message",handler),this.events.delete(key)}return this}},{key:"pause",value:function(key){if(!key)return console.warn("We need the parameter of key"),this;if(!this.events.has(key))return console.warn("Can't find the message of "+key),this;var handler=this.events.get(key);return window.removeEventListener("message",handler),this}},{key:"resume",value:function(key){if(!key)return console.warn("We need the parameter of key"),this;if(!this.events.has(key))return console.warn("Can't find the message of "+key),this;var handler=this.events.get(key);return window.addEventListener("message",handler),this}},{key:"clear",value:function(){var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=this.events.keys()[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var key=_step.value;this.off(key)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}return this}}]),Listener}(),stringify=function(appIds,key,data){var content={};content.appIds=appIds||"",content.key=key||"",content.data=data||{};var subfix="";try{subfix=JSON.stringify(content)}catch(e){console.warn(e)}return"app-broadcast:"+subfix}},{}]},{},[1])(1)}),ts.app=gui.Object.extend(ts.app||{},ts._app)}.call(ts._app),function(window){!function(){"use strict";function FastClick(layer,options){var oldOnClick;if(options=options||{},this.trackingClick=!1,this.trackingClickStart=0,this.targetElement=null,this.touchStartX=0,this.touchStartY=0,this.lastTouchIdentifier=0,this.touchBoundary=options.touchBoundary||10,this.layer=layer,this.tapDelay=options.tapDelay||200,this.tapTimeout=options.tapTimeout||700,!FastClick.notNeeded(layer)){for(var methods=["onMouse","onClick","onTouchStart","onTouchMove","onTouchEnd","onTouchCancel"],context=this,i=0,l=methods.length;i<l;i++)context[methods[i]]=function(method,context){return function(){return method.apply(context,arguments)}}(context[methods[i]],context);deviceIsAndroid&&(layer.addEventListener("mouseover",this.onMouse,!0),layer.addEventListener("mousedown",this.onMouse,!0),layer.addEventListener("mouseup",this.onMouse,!0)),layer.addEventListener("click",this.onClick,!0),layer.addEventListener("touchstart",this.onTouchStart,!1),layer.addEventListener("touchmove",this.onTouchMove,!1),layer.addEventListener("touchend",this.onTouchEnd,!1),layer.addEventListener("touchcancel",this.onTouchCancel,!1),Event.prototype.stopImmediatePropagation||(layer.removeEventListener=function(type,callback,capture){var rmv=Node.prototype.removeEventListener;"click"===type?rmv.call(layer,type,callback.hijacked||callback,capture):rmv.call(layer,type,callback,capture)},layer.addEventListener=function(type,callback,capture){var adv=Node.prototype.addEventListener;"click"===type?adv.call(layer,type,callback.hijacked||(callback.hijacked=function(event){event.propagationStopped||callback(event)}),capture):adv.call(layer,type,callback,capture)}),"function"==typeof layer.onclick&&(oldOnClick=layer.onclick,layer.addEventListener("click",function(event){oldOnClick(event)},!1),layer.onclick=null)}}var deviceIsWindowsPhone=navigator.userAgent.indexOf("Windows Phone")>=0,deviceIsAndroid=navigator.userAgent.indexOf("Android")>0&&!deviceIsWindowsPhone,deviceIsIOS=/iP(ad|hone|od)/.test(navigator.userAgent)&&!deviceIsWindowsPhone,deviceIsIOS4=deviceIsIOS&&/OS 4_\d(_\d)?/.test(navigator.userAgent),deviceIsIOSWithBadTarget=deviceIsIOS&&/OS [6-7]_\d/.test(navigator.userAgent),deviceIsBlackBerry10=navigator.userAgent.indexOf("BB10")>0;FastClick.prototype.needsClick=function(target){switch(target.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(target.disabled)return!0;break;case"input":if(deviceIsIOS&&"file"===target.type||target.disabled)return!0;break;case"label":case"iframe":case"video":return!0}return/\bneedsclick\b/.test(target.className)},FastClick.prototype.needsFocus=function(target){switch(target.nodeName.toLowerCase()){case"textarea":return!0;case"select":return!deviceIsAndroid;case"input":switch(target.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!target.disabled&&!target.readOnly;default:return/\bneedsfocus\b/.test(target.className)}},FastClick.prototype.sendClick=function(targetElement,event){var clickEvent,touch;document.activeElement&&document.activeElement!==targetElement&&document.activeElement.blur(),touch=event.changedTouches[0],(clickEvent=document.createEvent("MouseEvents")).initMouseEvent(this.determineEventType(targetElement),!0,!0,window,1,touch.screenX,touch.screenY,touch.clientX,touch.clientY,!1,!1,!1,!1,0,null),clickEvent.forwardedTouchEvent=!0,targetElement.dispatchEvent(clickEvent)},FastClick.prototype.determineEventType=function(targetElement){return deviceIsAndroid&&"select"===targetElement.tagName.toLowerCase()?"mousedown":"click"},FastClick.prototype.focus=function(targetElement){var length;deviceIsIOS&&targetElement.setSelectionRange&&0!==targetElement.type.indexOf("date")&&"time"!==targetElement.type&&"month"!==targetElement.type?(length=targetElement.value.length,targetElement.setSelectionRange(length,length)):targetElement.focus()},FastClick.prototype.updateScrollParent=function(targetElement){var scrollParent,parentElement;if(!(scrollParent=targetElement.fastClickScrollParent)||!scrollParent.contains(targetElement)){parentElement=targetElement;do{if(parentElement.scrollHeight>parentElement.offsetHeight){scrollParent=parentElement,targetElement.fastClickScrollParent=parentElement;break}parentElement=parentElement.parentElement}while(parentElement)}scrollParent&&(scrollParent.fastClickLastScrollTop=scrollParent.scrollTop)},FastClick.prototype.getTargetElementFromEventTarget=function(eventTarget){return eventTarget.nodeType===Node.TEXT_NODE?eventTarget.parentNode:eventTarget},FastClick.prototype.onTouchStart=function(event){var targetElement,touch,selection;if(event.targetTouches.length>1)return!0;if(targetElement=this.getTargetElementFromEventTarget(event.target),touch=event.targetTouches[0],deviceIsIOS){if((selection=window.getSelection()).rangeCount&&!selection.isCollapsed)return!0;if(!deviceIsIOS4){if(touch.identifier&&touch.identifier===this.lastTouchIdentifier)return event.preventDefault(),!1;this.lastTouchIdentifier=touch.identifier,this.updateScrollParent(targetElement)}}return this.trackingClick=!0,this.trackingClickStart=event.timeStamp,this.targetElement=targetElement,this.touchStartX=touch.pageX,this.touchStartY=touch.pageY,event.timeStamp-this.lastClickTime<this.tapDelay&&event.preventDefault(),!0},FastClick.prototype.touchHasMoved=function(event){var touch=event.changedTouches[0],boundary=this.touchBoundary;return Math.abs(touch.pageX-this.touchStartX)>boundary||Math.abs(touch.pageY-this.touchStartY)>boundary},FastClick.prototype.onTouchMove=function(event){return!this.trackingClick||((this.targetElement!==this.getTargetElementFromEventTarget(event.target)||this.touchHasMoved(event))&&(this.trackingClick=!1,this.targetElement=null),!0)},FastClick.prototype.findControl=function(labelElement){return void 0!==labelElement.control?labelElement.control:labelElement.htmlFor?document.getElementById(labelElement.htmlFor):labelElement.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")},FastClick.prototype.onTouchEnd=function(event){var forElement,trackingClickStart,targetTagName,scrollParent,touch,targetElement=this.targetElement;if(!this.trackingClick)return!0;if(event.timeStamp-this.lastClickTime<this.tapDelay)return this.cancelNextClick=!0,!0;if(event.timeStamp-this.trackingClickStart>this.tapTimeout)return!0;if(this.cancelNextClick=!1,this.lastClickTime=event.timeStamp,trackingClickStart=this.trackingClickStart,this.trackingClick=!1,this.trackingClickStart=0,deviceIsIOSWithBadTarget&&(touch=event.changedTouches[0],(targetElement=document.elementFromPoint(touch.pageX-window.pageXOffset,touch.pageY-window.pageYOffset)||targetElement).fastClickScrollParent=this.targetElement.fastClickScrollParent),"label"===(targetTagName=targetElement.tagName.toLowerCase())){if(forElement=this.findControl(targetElement)){if(this.focus(targetElement),deviceIsAndroid)return!1;targetElement=forElement}}else if(this.needsFocus(targetElement))return event.timeStamp-trackingClickStart>100||deviceIsIOS&&window.top!==window&&"input"===targetTagName?(this.targetElement=null,!1):(this.focus(targetElement),this.sendClick(targetElement,event),deviceIsIOS&&"select"===targetTagName||(this.targetElement=null,event.preventDefault()),!1);return!(!deviceIsIOS||deviceIsIOS4||!(scrollParent=targetElement.fastClickScrollParent)||scrollParent.fastClickLastScrollTop===scrollParent.scrollTop)||(this.needsClick(targetElement)||(event.preventDefault(),this.sendClick(targetElement,event)),!1)},FastClick.prototype.onTouchCancel=function(){this.trackingClick=!1,this.targetElement=null},FastClick.prototype.onMouse=function(event){return!this.targetElement||(!!event.forwardedTouchEvent||(!event.cancelable||(!(!this.needsClick(this.targetElement)||this.cancelNextClick)||(event.stopImmediatePropagation?event.stopImmediatePropagation():event.propagationStopped=!0,event.stopPropagation(),event.preventDefault(),!1))))},FastClick.prototype.onClick=function(event){var permitted;return this.trackingClick?(this.targetElement=null,this.trackingClick=!1,!0):"submit"===event.target.type&&0===event.detail||((permitted=this.onMouse(event))||(this.targetElement=null),permitted)},FastClick.prototype.destroy=function(){var layer=this.layer;deviceIsAndroid&&(layer.removeEventListener("mouseover",this.onMouse,!0),layer.removeEventListener("mousedown",this.onMouse,!0),layer.removeEventListener("mouseup",this.onMouse,!0)),layer.removeEventListener("click",this.onClick,!0),layer.removeEventListener("touchstart",this.onTouchStart,!1),layer.removeEventListener("touchmove",this.onTouchMove,!1),layer.removeEventListener("touchend",this.onTouchEnd,!1),layer.removeEventListener("touchcancel",this.onTouchCancel,!1)},FastClick.notNeeded=function(layer){var metaViewport,chromeVersion,blackberryVersion;if(void 0===window.ontouchstart)return!0;if(chromeVersion=+(/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1]){if(!deviceIsAndroid)return!0;if(metaViewport=document.querySelector("meta[name=viewport]")){if(-1!==metaViewport.content.indexOf("user-scalable=no"))return!0;if(chromeVersion>31&&document.documentElement.scrollWidth<=window.outerWidth)return!0}}if(deviceIsBlackBerry10&&(blackberryVersion=navigator.userAgent.match(/Version\/([0-9]*)\.([0-9]*)/))[1]>=10&&blackberryVersion[2]>=3&&(metaViewport=document.querySelector("meta[name=viewport]"))){if(-1!==metaViewport.content.indexOf("user-scalable=no"))return!0;if(document.documentElement.scrollWidth<=window.outerWidth)return!0}return"none"===layer.style.msTouchAction||"manipulation"===layer.style.touchAction||(!!(+(/Firefox\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1]>=27&&(metaViewport=document.querySelector("meta[name=viewport]"))&&(-1!==metaViewport.content.indexOf("user-scalable=no")||document.documentElement.scrollWidth<=window.outerWidth))||"none"===layer.style.touchAction||"manipulation"===layer.style.touchAction)},FastClick.attach=function(layer,options){return new FastClick(layer,options)},"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return FastClick}):"undefined"!=typeof module&&module.exports?(module.exports=FastClick.attach,module.exports.FastClick=FastClick):window.FastClick=FastClick}()}(self),function(window){"use strict";gui.Tween=(gui.Arguments.confirmed,gui.Combo.chained,gui.Class.create(Object.prototype,{type:null,duration:200,delay:0,timing:"ease",data:null,value:0,init:!0,done:!1,onconstruct:function(type,config,data){this.type=type,this.data=void 0!==data?data:null,config&&(void 0!==config.duration&&(this.duration=config.duration),void 0!==config.timing&&(this.timing=config.timing),void 0!==config.delay&&(this.delay=config.delay))}},{},{$easing:{linear:[0,0,1,1],ease:[.25,.1,.25,1],"ease-in":[.42,0,1,1],"ease-out":[0,0,.58,1],"ease-in-out":[.42,0,.58,1],"ease-in-back":[.6,-.28,.735,.045],"ease-out-back":[.175,.885,.32,1.275],"ease-in-out-back":[.68,-.55,.265,1.55]},dispatch:function(type,config,data){function step(){var now=timer.now(),progress=now-start;if(tween.init&&progress>tween.delay&&(tween.init=!1,start=now,progress=0),!tween.init){var t=progress/tween.duration;t<1?tween.value=curve.solve(t):(tween.done=!0,tween.value=1),gui.Broadcast.dispatch(gui.BROADCAST_TWEEN,tween)}tween.done||requestAnimationFrame(step)}var tween=new gui.Tween(type,config,data),timer=gui.Client.hasPerformance?window.performance:Date,start=timer.now(),easingCurve=gui.Tween.$easing.ease;"string"==typeof tween.timing&&-1!==Object.keys(gui.Tween.$easing).indexOf(tween.timing)?easingCurve=gui.Tween.$easing[tween.timing]:Array.isArray(tween.timing)&&(easingCurve=tween.timing);var curve=new gui.UnitBezier(easingCurve[0],easingCurve[1],easingCurve[2],easingCurve[3]);return step(),tween}})),gui.TweenPlugin=function(chained,confirmed){return gui.TrackerPlugin.extend({add:chained(confirmed("string")(function(type){gui.Array.make(type).forEach(function(_type){this._addchecks(_type)&&gui.Broadcast.add(gui.BROADCAST_TWEEN,this)},this)})),remove:chained(confirmed("string")(function(type){gui.Array.make(type).forEach(function(_type){this._removechecks(_type)&&gui.Broadcast.remove(gui.BROADCAST_TWEEN,this)},this)})),dispatch:confirmed("string")(function(type,options,data){var result=null;return gui.Array.make(type).forEach(function(_type){result=gui.Tween.dispatch(_type,options,data)},this),result}),addDispatch:function(type,options,data){return this.add(type).dispatch(type,options,data)},onbroadcast:function(b){switch(b.type){case gui.BROADCAST_TWEEN:var tween=b.data;this._containschecks(tween.type)&&(this.spirit.life.destructed||this.spirit.ontween(tween))}},ondestruct:function(){gui.Broadcast.remove(gui.BROADCAST_TWEEN,this),gui.TrackerPlugin.prototype.ondestruct.call(this)}})}(gui.Combo.chained,gui.Arguments.confirmed),gui.TransitionPlugin=gui.Plugin.extend({onevent:function(e){e.type===this._endevent&&e.target===this.spirit.element&&this._transitionend(e)},property:function(props){return props&&this.spirit.css.set("-beta-transition-property",props),this._init()},duration:function(time){return time&&(time=gui.Type.isNumber(time)?this._convert(time):time,this.spirit.css.set("-beta-transition-duration",time)),this._init()},timing:function(timing){return timing&&this.spirit.css.set("-beta-transition-timing-function",timing),this._init()},easeIn:function(){return this.timing("ease-in")},easeOut:function(){return this.timing("ease-out")},easeInOut:function(){return this.timing("ease-in-out")},cubicBezier:function(n1,n2,n3,n4){return this.timing("cubic-bezier("+n1+","+n2+","+n3+","+n4+")")},none:function(){return this.property("none")},reset:function(){this.property(""),this.timing("")},run:function(config){var css=Object.create(null);this._count=0,gui.Object.each(config,function(key,value){gui.Type.isFunction(this[key])?this[key](value):css[key]=value},this);var now="none"===this.spirit.css.compute("-beta-transition-property"),then=this._then=new gui.Then,spirit=this.spirit;return(this._count=Object.keys(css).length)&&setImmediate(function(){spirit.css.style(css),now&&then&&setImmediate(function(){then.now(null)})}),then},_default:1e3,_endevent:null,_count:0,_init:function(){if(null===this._endevent){var names={webkit:"webkitTransitionEnd",explorer:"transitionend",gecko:"transitionend",opera:"oTransitionEnd"};this._endevent=names[gui.Client.agent]||"transitionend",this.spirit.event.add(this._endevent,this.spirit.element,this)}return this},_transitionend:function(e){var t=new gui.Transition(e.propertyName,e.elapsedTime);this._ontransition(t),this.spirit.ontransition(t)},_ontransition:function(t){0==--this._count&&this._now()},_now:function(){var then=this._then;then&&then.now(null)},_convert:function(ms){return(ms=ms||this._default)/1e3+"s"}}),gui.Transition=function(propertyName,elapsedTime){this.duration=Math.round(elapsedTime/1e3),this.type=propertyName},gui.Transition.prototype={type:null,duration:0},gui.VisibilityPlugin=function(chained){return gui.Plugin.extend({on:chained(function(){gui.VisibilityPlugin.on(this.spirit)}),off:chained(function(){gui.VisibilityPlugin.off(this.spirit)})},{},{on:function(spirit){var classname=gui.CLASS_INVISIBLE;(void 0===spirit.life.visible||spirit.css.contains(classname))&&(spirit.css.remove(classname),this._go(spirit,!0))},off:function(spirit){var classname=gui.CLASS_INVISIBLE;switch(spirit.life.visible){case!0:case void 0:spirit.css.add(classname),this._go(spirit,!1)}},$init:function(spirit){spirit.$destructed||this._go(spirit,!this._invisible(spirit))},_invisible:function(spirit){return spirit.css.contains(gui.CLASS_INVISIBLE)||spirit.css.matches("."+gui.CLASS_INVISIBLE+" *")},_go:function(first,visible){var type=visible?gui.CRAWLER_VISIBLE:gui.CRAWLER_INVISIBLE;new gui.Crawler(type).descendGlobal(first,{handleSpirit:function(spirit){var init=void 0===spirit.life.visible;if(spirit!==first&&spirit.css.contains(gui.CLASS_INVISIBLE))return gui.Crawler.SKIP_CHILDREN;visible?spirit.life.visible&&!init||(spirit.life.visible=!0,spirit.life.dispatch(gui.LIFE_VISIBLE),spirit.onvisible()):(spirit.life.visible||init)&&(spirit.life.visible=!1,spirit.life.dispatch(gui.LIFE_INVISIBLE),spirit.oninvisible())}})}})}(gui.Combo.chained),gui.module("gui-layout@wunderbyte.com",{plugin:{tween:gui.TweenPlugin,transition:gui.TransitionPlugin,visibility:gui.VisibilityPlugin},mixin:{ontween:function(tween){},ontransition:function(transition){},onvisible:function(){},oninvisible:function(){}}}),gui.Key=function(down,type,isglobal){this.down=down,this.type=type,this.global=isglobal},gui.Key.prototype={down:!1,type:null,global:!1},gui.Object.each({shiftDown:!1,ctrlDown:!1,altDown:!1,metaDown:!1,accelDown:!1,accessDown:!1},function(key,value){gui.Key[key]=value}),gui.Key.$key=gui.Object.extend({33:"PageUp",34:"PageDown",38:"Up",40:"Down",37:"Left",39:"Right",18:"Alt",17:"Control",16:"Shift",32:"Space",27:"Esc",13:"Enter"},Object.create(null)),gui.Object.each(gui.Key.$key,function(key,value){gui.Key[value.toUpperCase()]=value}),gui.KeyPlugin=function(confirmed,chained){return gui.TrackerPlugin.extend({add:confirmed("array|string","(object|function)")(chained(function(arg,handler){handler=handler||this.spirit,gui.Interface.validate(gui.IKeyHandler,handler)&&gui.Array.make(arg).forEach(function(a){this._addchecks(String(a),[handler,this._global])&&this._setupbroadcast(!0)},this)})),remove:confirmed("array|string","(object|function)")(chained(function(arg,handler){handler=handler||this.spirit,gui.Interface.validate(gui.IKeyHandler,handler)&&gui.Array.make(arg).forEach(function(a){this._removechecks(String(a),[handler,this._global])&&(this._hashandlers()||this._setupbroadcast(!1))},this)})),addGlobal:function(arg,handler){return this._globalize(function(){return this.add(arg,handler)})},removeGlobal:function(arg,handler){return this._globalize(function(){return this.remove(arg,handler)})},onbroadcast:function(b){var list,handler,isglobal;if(b.type===gui.BROADCAST_KEYEVENT){var down=b.data.down,type=b.data.type;(list=this._trackedtypes[type])&&list.forEach(function(checks){handler=checks[0],(isglobal=checks[1])===b.global&&handler.onkey(new gui.Key(down,type,isglobal))})}},_setupbroadcast:function(add){var act,sig=this.context.gui.$contextid,type=gui.BROADCAST_KEYEVENT;this._global?(act=add?"addGlobal":"removeGlobal",gui.Broadcast[act](type,this)):(act=add?"add":"remove",gui.Broadcast[act](type,this,sig))},_cleanup:function(type,checks){var handler=checks[0];checks[1]?this.removeGlobal(type,handler):this.remove(type,handler)}})}(gui.Arguments.confirmed,gui.Combo.chained),gui.IKeyHandler={toString:function(){return"[object IKeyHandler]"},onkey:function(key){}},gui.$stop("- parse spiritual"),gui.KeysModule=gui.module("gui-keys@wunderbyte.com",{plugin:{key:gui.KeyPlugin},mixin:{onkey:function(key){}},oncontextinitialize:function(context){this._keymap=Object.create(null),["keydown","keypress","keyup"].forEach(function(type){context.document.addEventListener(type,this,!1)},this)},handleEvent:function(e){this._modifiers(e),this._oldschool(e)},_keymap:null,_snapshot:null,_newschool:function(e){},_oldschool:function(e){var n=e.keyCode,c=this._keymap[n],id=e.currentTarget.defaultView.gui.$contextid;switch(e.type){case"keydown":void 0===c&&(this._keycode=n,this._keymap[n]=null,this._keymap[n]=String.fromCharCode(e.which).toLowerCase(),gui.Tick.next(function(){c=this._keymap[n],this._maybebroadcast(!0,null,c,n,id),this._keycode=null},this));break;case"keypress":this._keycode&&(c=this._keychar(e.keyCode,e.charCode,e.which),this._keymap[this._keycode]=c);break;case"keyup":void 0!==c&&(this._maybebroadcast(!1,null,c,n,id),delete this._keymap[n])}},_maybebroadcast:function(down,key,c,code,sig){c||this._broadcast(down,key,c,code,sig)},_broadcast:function(down,key,c,code,sig){var type,msg,arg;type=" "===(type=gui.Key.$key[code]||c)?gui.Key.SPACE:type,msg=gui.BROADCAST_KEYEVENT,arg={down:down,type:type};var snapshot=JSON.stringify(arg);snapshot!==this._snapshot&&(gui.Broadcast.dispatch(msg,arg,sig),gui.Broadcast.dispatchGlobal(msg,arg),this._snapshot=snapshot)},_modifiers:function(e){gui.Key.ctrlDown=e.ctrlKey,gui.Key.shiftDown=e.shiftKey,gui.Key.altDown=e.altKey,gui.Key.metaDown=e.metaKey},_keychar:function(n,c,which){return null===which||void 0===which?String.fromCharCode(n):0!==which&&c?String.fromCharCode(which):null}}),gui.BROADCAST_KEYEVENT="gui-broadcast-keyevent"}(self),function(window){"use strict";window.edbml=gui.namespace("edbml",{ACTION_RENDER:"edbml-action-render",bootload:!1,declare:function(id){var configured;return{as:function($edbml){return configured=edbml.$runtimeconfigure($edbml),configured=gui.Object.assert(id,configured),configured.lock=function(out){return function(){return $edbml.$out=out,configured.apply(this,arguments)}},this},withInstructions:function(pis){configured.$instructions=pis}}},safetext:function(string){return edbml.Security.$safetext(string)},safeattr:function(string){return edbml.Security.$safeattr(string)},$set:function(action,thisp){return edbml._assign(action,thisp)},$get:function(key){return edbml._request(key)},$run:function(elm,key){this._invoke(key,elm.value,elm.checked)},$revoke:function(key){this._invokables[key]=null,delete this._invokables[key]},$runtimeconfigure:function(){function setupbefore($edbml,spirit){$edbml.$out=$edbml.$out||new edbml.Out,$edbml.$att=new edbml.Att,spirit&&($edbml.$input=function(Type){return spirit.script.$input.get(Type)})}function cleanupafter($edbml,spirit){$edbml.$out=null,$edbml.$att=null,spirit&&($edbml.$input=null)}return function($edbml){return function($in){setupbefore($edbml,this);var res=$edbml.apply(this,arguments);return cleanupafter($edbml,this),res}}}(),_invokables:{},_assign:function(func,thisp){var key=gui.KeyMaster.generateKey();return this._invokables[key]=function(value,checked){return func.apply(thisp,[gui.Type.cast(value),checked])},key},_invoke:function(key,value,checked){var func=this._invokables[key];func?gui.Tick.time(function(){func(value,checked)}):console.error("Out of synch")},_request:function(key,sig){var func;if(sig)console.error("Not supported");else{if(func=this._invokables[key])return func();console.error("Out of synch")}}}),edbml.Att=function(atts){atts&&gui.Object.extend(this,atts)},edbml.Att.prototype=gui.Object.create(null,{toString:function(){return"[object edbml.Att]"},$:function(att){var val=this[att],html="";switch(gui.Type.of(val)){case"null":case"undefined":break;default:html+=att+'="'+(val=edbml.Att.$encode(this[att]))+'" '}return html},$pop:function(att){var html=this.$(att);return delete this[att],html},$all:function(){var html="";return gui.Object.nonmethods(this).forEach(function(att){html+=this.$(att)},this),html}}),edbml.Att.$encode=function(data){var type=gui.Type.of(data);switch(type){case"string":data=edbml.safeattr(data);break;case"number":case"boolean":data=String(data);break;case"object":case"array":try{data=encodeURIComponent(JSON.stringify(data))}catch(jsonex){throw new Error("Could not create HTML attribute: "+jsonex)}break;case"date":throw new Error("TODO: edbml.Att.encode standard date format?");default:throw new Error("Could not create HTML attribute for "+type)}return data},edbml.Out=function(){},edbml.Out.prototype={html:"",toString:function(){return"[object edbml.Out]"},write:function(){return this.html}},edbml.Update=gui.Class.create(Object.prototype,{type:null,id:null,ids:null,window:null,document:null,onconstruct:function(){this._summary=[]},update:function(){},element:function(cb,thisp){var spirit,element=null;return gui.KeyMaster.isKey(this.id)&&(spirit=gui.get(this.id))&&(element=spirit.element),element||(element=document.querySelectorAll("#"+this.id)),element?cb&&(element.length?gui.Array.from(element).forEach(function(e){cb.call(this,e)},this):cb.call(this,element)):edbml.debug&&console.error("No element to match @id: "+this.id),element},dispose:function(){this._summary=null},_summary:null,_beforeUpdate:function(element){var event="x-beforeupdate-"+this.type;return this._dispatch(element,event)},_afterUpdate:function(element){var event="x-afterupdate-"+this.type;return this._dispatch(element,event)},_dispatch:function(element,name){if(element){var event=document.createEvent("UIEvents");return event.initEvent(name,!0,!0),element.dispatchEvent(event)}console.error("Occasional EDBML dysfunction just happened")},_report:function(report){edbml.debug&&(gui.KeyMaster.isKey(this.id)&&(report=report.replace(this.id,"(anonymous)")),console.debug(report,this.element()))}},{},{TYPE_HARD:"hard",TYPE_ATTS:"atts",TYPE_INSERT:"insert",TYPE_APPEND:"append",TYPE_REMOVE:"remove",TYPE_FUNCTION:"function"}),edbml.AttsUpdate=function(CSSPlugin){return edbml.Update.extend({type:edbml.Update.TYPE_ATTS,onconstruct:function(id,xnew,xold){edbml.Update.prototype.onconstruct.call(this),this.id=id,this._xnew=xnew,this._xold=xold},update:function(){edbml.Update.prototype.update.call(this),this.element(function(element){this._beforeUpdate(element)&&(this._update(element),this._afterUpdate(element),this._report())})},dispose:function(){edbml.Update.prototype.dispose.call(this),delete this._xold,delete this._xnew},_xold:null,_xnew:null,_update:function(element){Array.forEach(this._xnew.attributes,function(newatt){var oldatt=this._xold.getAttribute(newatt.name);null!==oldatt&&oldatt===newatt.value||("class"===newatt.name?this._classlist(element,this._xold,newatt.value):this._set(element,newatt.name,newatt.value),this._summary.push("@"+newatt.name+'="'+newatt.value+'"'+(element.id?" (#"+element.id+")":"")))},this),Array.forEach(this._xold.attributes,function(oldatt){this._xnew.hasAttribute(oldatt.name)||("class"===oldatt.name?this._classlist(element,this._xold,""):this._del(element,oldatt.name,null),this._summary.push("removed @"+oldatt.name+(element.id?" (#"+element.id+")":"")))},this)},_set:function(element,name,value){var spirit=element.spirit;if(spirit)spirit.att.set(name,value);else switch(element.setAttribute(name,value),name){case"checked":element.checked||(element.checked=!0);break;case"value":element.value!==value&&(element.value=String(value))}},_del:function(element,name){var spirit=element.spirit;if(spirit)spirit.att.del(name);else switch(name){case"checked":element.checked=!1;break;default:element.removeAttribute(name)}},_classlist:function(element,xelement,classname){var newnames=classname.split(" "),oldnames=xelement.className.split(" ");oldnames.forEach(function(oldname){oldname&&-1===newnames.indexOf(oldname)&&CSSPlugin.remove(element,oldname)}),newnames.forEach(function(newname){newname&&-1===oldnames.indexOf(newname)&&CSSPlugin.add(element,newname)})},_report:function(){var summary=this._summary.join(", "),message='edbml.AttsUpdate "#'+this.id+'" '+summary;edbml.Update.prototype._report.call(this,message)}})}(gui.CSSPlugin),edbml.HardUpdate=(gui.DOMPlugin,edbml.Update.extend({type:edbml.Update.TYPE_HARD,xelement:null,onconstruct:function(id,xelement){edbml.Update.prototype.onconstruct.call(this),this.id=id,this.xelement=xelement},update:function(){edbml.Update.prototype.update.call(this),this.element(function(element){this._beforeUpdate(element)&&(gui.DOMPlugin.html(element,this.xelement.innerHTML),this._afterUpdate(element),this._report())})},dispose:function(){edbml.Update.prototype.dispose.call(this),delete this.xelement},_report:function(){var message="edbml.HardUpdate #"+this.id;edbml.Update.prototype._report.call(this,message)}})),edbml.SoftUpdate=edbml.Update.extend({xelement:null,type:null,dispose:function(){edbml.Update.prototype.dispose.call(this),delete this.xelement},_import:function(parent){var temp=document.createElement(parent.nodeName);return temp.innerHTML=this.xelement.outerHTML,temp.firstChild}}),edbml.InsertUpdate=edbml.SoftUpdate.extend({type:edbml.Update.TYPE_INSERT,xelement:null,onconstruct:function(id,xelement){this.id=id,this.xelement=xelement},update:function(){var parent,child;this.element(function(sibling){parent=sibling.parentNode,child=this._import(parent),this._beforeUpdate(parent)&&(parent.insertBefore(child,sibling),this._afterUpdate(child),this._report())})},_report:function(){var message="edbml.InsertUpdate #"+this.xelement.getAttribute("id");edbml.SoftUpdate.prototype._report.call(this,message)}}),edbml.AppendUpdate=edbml.SoftUpdate.extend({type:edbml.Update.TYPE_APPEND,onconstruct:function(id,xelement){this.id=id,this.xelement=xelement},update:function(){this.element(function(parent){var child=this._import(parent);this._beforeUpdate(parent)&&(parent.appendChild(child),this._afterUpdate(child),this._report())})},_report:function(){var message="edbml.AppendUpdate #"+this.xelement.getAttribute("id");edbml.SoftUpdate.prototype._report.call(this,message)}}),edbml.RemoveUpdate=edbml.SoftUpdate.extend({type:edbml.Update.TYPE_REMOVE,onconstruct:function(id){this.id=id},update:function(){this.element(function(element){var parent=element.parentNode;this._beforeUpdate(element)&&(parent.removeChild(element),this._afterUpdate(parent),this._report())})},_report:function(){var message="edbml.RemoveUpdate #"+this.id;edbml.SoftUpdate.prototype._report.call(this,message)}}),edbml.FunctionUpdate=edbml.Update.extend({type:edbml.Update.TYPE_FUNCTION,onconstruct:function(id,map){edbml.Update.prototype.onconstruct.call(this),this.id=id,this._map=map||null},update:function(){var count=0;this.element(function(elm){this._map?(count=edbml.FunctionUpdate._remap(elm,this._map))&&this._report("remapped "+count+" keys"):(count=edbml.FunctionUpdate._revoke(elm))&&this._report("revoked "+count+" keys")})},_report:function(report){var message="edbml.FunctionUpdate "+report+" ("+this.$instanceid+")";edbml.Update.prototype._report.call(this,message)}},{_revoke:function(element){var att,keys,count=0;return this._getatts(element).forEach(function(x){att=x[1],(keys=gui.KeyMaster.extractKey(att.value))&&keys.forEach(function(key){edbml.$revoke(key),count++})}),count},_remap:function(element,map){var oldkeys,newkey,newval,count=0;return Object.keys(map).length&&this._getatts(element).forEach(function(x){var elm=x[0],att=x[1];(oldkeys=gui.KeyMaster.extractKey(att.value))&&oldkeys.forEach(function(oldkey){(newkey=map[oldkey])&&(newval=att.value.replace(oldkey,newkey),elm.setAttribute(att.name,newval),edbml.$revoke(oldkey),count++)})}),count},_getatts:function(element){var val,atts=[];return new gui.Crawler("edbml-crawler-functionupdate").descend(element,{handleElement:function(elm){if(elm!==element&&(Array.forEach(elm.attributes,function(att){((val=att.value).includes("edbml.$run")||val.includes("edbml.$get"))&&atts.push([elm,att])}),elm.spirit&&elm.spirit.script.loaded))return gui.Crawler.SKIP_CHILDREN}}),atts}}),edbml.UpdateCollector=gui.Class.create(Object.prototype,{onconstruct:function(){this._updates=[],this._hardupdates={}},collect:function(update,ids){return this._updates.push(update),update.type===edbml.Update.TYPE_HARD?this._hardupdates[update.id]=!0:update.ids=ids||{},this},hardupdates:function(id){return!!this._hardupdates[id]},eachRelevant:function(action){var hardupdates=this._hardupdates;this._updates.filter(function(update){return update.type===edbml.Update.TYPE_HARD||Object.keys(update.ids).every(function(id){return!hardupdates.hasOwnProperty(id)})}).forEach(function(update){action(update)})},dispose:function(){this._hardupdates=null,this._updates=null},_updates:null,_hardupdates:null}),edbml.UpdateAssistant={parse:function(markup,id,element){(element=document.createElement(element.localName)).innerHTML=markup,element.id=id,Array.forEach(element.querySelectorAll("option"),function(option){switch(option.getAttribute("selected")){case"true":option.setAttribute("selected","selected");break;case"false":option.removeAttribute("selected")}});return Array.forEach(element.querySelectorAll("input[type=checkbox],input[type=radio]"),function(option){switch(option.getAttribute("checked")){case"true":option.setAttribute("checked","checked");break;case"false":option.removeAttribute("checked")}}),element},order:function(nodes){var order={};return Array.forEach(nodes,function(node,index){node.nodeType===Node.ELEMENT_NODE&&(order[node.id]=index)},this),order},index:function(nodes){var result=Object.create(null);return Array.forEach(nodes,function(node,index){node.nodeType===Node.ELEMENT_NODE&&(result[node.id]=node)},this),result}},edbml.UpdateManager=function(UpdateCollector,HardUpdate,AttsUpdate,InsertUpdate,RemoveUpdate,AppendUpdate,FunctionUpdate,GuiObject,KeyMaster){return gui.Class.create(Object.prototype,{onconstruct:function(spirit){this._keyid=spirit.dom.id()||spirit.$instanceid,this._spirit=spirit},update:function(html){this._spirit.life.destructed||(this._updates=new UpdateCollector,this._functions={},this._olddom?(this._next(html),this._updates.collect(new FunctionUpdate(this._keyid,this._functions))):this._first(html),this._updates.eachRelevant(function(update){update.update(),update.dispose()}),this._updates&&this._updates.dispose(),this._updates=null)},_keyid:null,_doc:null,_spirit:null,_olddom:null,_nedwdom:null,_updates:null,_assistant:edbml.UpdateAssistant,_first:function(html){this._olddom=this._parse(html),this._updates.collect(new HardUpdate(this._keyid,this._olddom))},_next:function(html){this._newdom=this._parse(html),this._crawl(this._newdom,this._olddom,this._newdom,this._keyid,{}),this._olddom=this._newdom},_parse:function(html){return this._assistant.parse(html,this._keyid,this._spirit.element)},_crawl:function(newchild,oldchild,lastnode,id,ids){for(var result=!0;newchild&&oldchild&&!this._updates.hardupdates(id);){switch(newchild.nodeType){case Node.TEXT_NODE:result=this._check(newchild,oldchild,lastnode,id,ids);break;case Node.ELEMENT_NODE:result=this._scan(newchild,oldchild,lastnode,id,ids)}newchild=newchild.nextSibling,oldchild=oldchild.nextSibling}return result},_scan:function(newnode,oldnode,lastnode,id,ids){var result=!0,oldid=oldnode.id;return(result=this._check(newnode,oldnode,lastnode,id,ids))&&(oldid&&(lastnode=newnode,(ids=GuiObject.copy(ids))[oldid]=!0,id=oldid),result=this._crawl(newnode.firstChild,oldnode.firstChild,lastnode,id,ids)),result},_check:function(newnode,oldnode,lastnode,id,ids){var result=!0,isSoftUpdate=!1;if(newnode&&!oldnode||!newnode&&oldnode)result=!1;else if(result=newnode.nodeType===oldnode.nodeType)switch(oldnode.nodeType){case Node.TEXT_NODE:newnode.data!==oldnode.data&&(result=!1);break;case Node.ELEMENT_NODE:(result=this._familiar(newnode,oldnode))&&(result=this._checkatts(newnode,oldnode,ids))&&(this._maybesoft(newnode,oldnode)?(this._confirmsoft(newnode,oldnode)&&(this._updatesoft(newnode,oldnode,ids),isSoftUpdate=!0),result=!1):"textarea"!==oldnode.localName&&!(result=newnode.childNodes.length===oldnode.childNodes.length)&&oldnode.id&&(lastnode=newnode,id=oldnode.id))}return result||isSoftUpdate||(this._updates.collect(new FunctionUpdate(id)),this._updates.collect(new HardUpdate(id,lastnode))),result},_familiar:function(newnode,oldnode){return["namespaceURI","localName"].every(function(prop){return newnode[prop]===oldnode[prop]})},_checkatts:function(newnode,oldnode,ids){var result=!0,update=null;if(this._attschanged(newnode.attributes,oldnode.attributes,ids)){var newid=newnode.id,oldid=oldnode.id;newid&&newid===oldid?(update=new AttsUpdate(oldid,newnode,oldnode),this._updates.collect(update,ids)):result=!1}return result},_attschanged:function(newatts,oldatts,ids){var changed=newatts.length!==oldatts.length;return changed||(changed=!Array.every(newatts,function(newatt){var oldatt=oldatts.getNamedItem(newatt.name);return oldatt&&(oldatt.value===newatt.value||this._onlyedbmlchange(newatt.value,oldatt.value))},this)),changed},_onlyedbmlchange:function(newval,oldval){if([newval,oldval].every(function(val){return val.includes("edbml.$")})){var newkey,newkeys=KeyMaster.extractKey(newval),oldkeys=KeyMaster.extractKey(oldval);if(newkeys&&oldkeys)return oldkeys.forEach(function(oldkey,i){newkey=newkeys[i],newval=newval.replace(newkey,""),oldval=oldval.replace(oldkey,""),this._functions[oldkey]=newkey},this),newval===oldval}return!1},_maybesoft:function(newnode,oldnode){return newnode&&oldnode?newnode.id&&newnode.id===oldnode.id&&this._maybesoft(newnode)&&this._maybesoft(oldnode):Array.every(newnode.childNodes,function(node){var res=!0;switch(node.nodeType){case Node.TEXT_NODE:res=""===node.data.trim();break;case Node.ELEMENT_NODE:res=""!==node.id}return res},this)},_confirmsoft:function(newnode,oldnode){var res=!0,prev=null,oldorder=this._assistant.order(oldnode.childNodes);return Array.every(newnode.childNodes,function(node,index){if(node.nodeType===Node.ELEMENT_NODE){var id=node.id;oldorder.hasOwnProperty(id)&&oldorder.hasOwnProperty(prev)&&(res=oldorder[id]>oldorder[prev]),prev=id}return res},this)},_updatesoft:function(newnode,oldnode,ids){for(var updates=[],news=this._assistant.index(newnode.childNodes),olds=this._assistant.index(oldnode.childNodes),child=newnode.lastElementChild,topid=oldnode.id,oldid=null,newid=null;child;)newid=child.id,olds[newid]?oldid=newid:oldid?updates.push(new InsertUpdate(oldid,child)):updates.push(new AppendUpdate(topid,child)),child=child.previousElementSibling;Object.keys(olds).forEach(function(id){if(news[id]){var n1=news[id],n2=olds[id];this._scan(n1,n2,n1,id,ids)}else updates.push(new RemoveUpdate(id)),updates.push(new FunctionUpdate(id))},this),updates.reverse().forEach(function(update){this._updates.collect(update,ids)},this)}})}(edbml.UpdateCollector,edbml.HardUpdate,edbml.AttsUpdate,edbml.InsertUpdate,edbml.RemoveUpdate,edbml.AppendUpdate,edbml.FunctionUpdate,gui.Object,gui.KeyMaster),edbml.ScriptPlugin=function(chained,confirmed,Type,Tick,guiObject,guiArray,DOMPlugin,Broadcast){return gui.Plugin.extend({loaded:!1,ran:!1,debug:!1,suspended:!1,onconstruct:function(){gui.Plugin.prototype.onconstruct.call(this),this._oldprops={},this._newprops={}},ondestruct:function(){if(gui.Plugin.prototype.ondestruct.call(this),this.loaded){Tick.cancelFrame(this._frameindex),this.spirit.life.remove(gui.LIFE_ENTER,this),Broadcast.remove(edb.BROADCAST_ACCESS,this),this.$input&&(this.$input.ondestruct(),this.$input.$ondestruct());var oldprops=this._oldprops;Object.keys(oldprops).forEach(function(id){try{oldprops[id].object.removeObserver(this)}catch(exception){console.error("Please tell jmo@ that you got this exception")}},this)}},load:chained(confirmed("function|string")(function(script){(script=Type.isFunction(script)?script:guiObject.lookup(script))&&(this.loaded=!0,this._script=script,this._updater=new edbml.UpdateManager(this.spirit),this._process(script.$instructions),this.$input||this.run())})),oninput:function(input){this.loaded?input.revoked?this.write(""):this.$input&&!this.$input.done||this._schedule():this._notloaded()},run:function(){Tick.cancelFrame(this._frameindex),this.loaded?!this.$input||this.$input.done?this.spirit.life.entered?this.write(this._run.apply(this,arguments)):(this.spirit.life.add(gui.LIFE_ENTER,this),this._arguments=arguments):this._notready():this._notloaded()},write:function(html){if(this.suspended)edbml.debug&&console.debug("(ScriptPlugin was suspended)",this.$instanceid);else{var changed=this._html!==html,focused=this._focusedfield();changed&&(this._html=html,this._updater.update(html),focused&&this._restorefocus(focused)),this._status(this.spirit),this.ran=!0}},input:function(){var inputs,input;if(input=this.$input){if(this.loaded)return inputs=guiArray.make(arguments).map(function(type){return new edb.Input(type.constructor,type)}),this.$destructed||inputs.forEach(function(i){input.$oninput(i)}),inputs.length>1?inputs:inputs[0];this._notloaded()}else this._noinputexpected()},revoke:function(){guiArray.make(arguments).forEach(function(type){var edbType=edb.Type.is(type)?type.constructor:type;this.$input.$oninput(new edb.Input(edbType,null))},this)},onbroadcast:function(b){var keys=this._newprops;switch(b.type){case edb.BROADCAST_ACCESS:var type=b.data[0],name=b.data[1],id=type.$instanceid;keys[id]||(keys[id]={object:type}),name&&(keys[id].properties||(keys[id].properties={}),keys[id].properties[name]=!0)}},onchange:function(changes){changes.some(function(c){var id=c.object.$instanceid,clas=c.object.$classname,name=c.name;if(edbml.$rendering&&edbml.$rendering[id])console.error("Don't update \""+name+'" of the '+clas+" while rendering, it will cause the rendering to run in an endless loop. ");else{if(this._oldprops[id]){var props=this._oldprops[id].properties;try{if(!name||props[name])return!0}catch(todoexception){}return!1}console.error("Out of synch: "+id)}},this)&&this._schedule()},onlife:function(l){l.type===gui.LIFE_ENTER&&(this.spirit.life.rendered||this.run.apply(this,this._arguments||[]),this.spirit.life.remove(l.type,this),this._arguments=null)},suspend:chained(function(){this.suspended=!0,edbml.debug&&console.debug("(Supending ScriptPlugin)",this.$instanceid)}),unsuspend:chained(function(run){this.suspended=!1,edbml.debug&&console.debug("(Unsupending ScriptPlugin)",this.$instanceid)}),$input:null,_src:null,_script:null,_updater:null,_oldprops:null,_newprops:null,_arguments:null,_html:null,_frameindex:-1,_process:function(pis){if(pis){var optional=[],required=[];pis.reduce(function(hasinput,pi){var name=Object.keys(pi)[0],atts=pi[name];return"input"===name?((!1===atts.required?optional:required).push(guiObject.lookup(atts.type)),!0):hasinput},!1)&&(this.$input=new edb.InputPlugin,this.$input.connect(required,this,!0),this.$input.connect(optional,this,!1))}},_start:function(){edbml.$rendering=this._oldprops||{},Broadcast.add(edb.BROADCAST_ACCESS,this),edb.$accessaware=!0,this._newprops={}},_stop:function(){var oldprops=this._oldprops,newprops=this._newprops;edbml.$rendering=null,Broadcast.remove(edb.BROADCAST_ACCESS,this),edb.$accessaware=!1,Object.keys(oldprops).forEach(function(id){newprops[id]||(oldprops[id].object.removeObserver(this),delete oldprops[id])},this),Object.keys(newprops).forEach(function(id){var oldx=oldprops[id],newx=newprops[id];oldx?newx.properties&&(oldx.properties=newx.properties):(oldprops[id]=newprops[id],oldprops[id].object.addObserver(this),delete newprops[id])},this),this._newprops=null},_schedule:function(){Tick.cancelFrame(this._frameindex);var spirit=this.spirit,input=this.$input,runnow=function(){spirit.life.destructed||input&&!input.done||this.run()}.bind(this);spirit.life.entered?spirit.life.rendered?this._frameindex=Tick.nextFrame(runnow):runnow():spirit.life.add(gui.LIFE_ENTER,this)},_status:function(spirit){spirit.life.rendered=!0,spirit.onrender({first:!this.ran}),spirit.life.dispatch(gui.LIFE_RENDER),spirit.action.dispatch(edbml.ACTION_RENDER)},_run:function(){this._start();var html=this._script.apply(this.spirit,arguments);return this._stop(),html},_notready:function(){var type,input=this.$input;(input._watches||[]).forEach(function(edbType){(type=edb.get(edbType))&&input.$oninput(new edb.Input(edbType,type))},this)},_notloaded:function(){console.error("Spiritual EDBML: No script loaded for "+this.spirit)},_noinputexpected:function(){console.error("Spiritual EDBML: No input expected for "+this.spirit)},_focusedfield:function(){var focused;try{focused=document.activeElement}catch(ieException){focused=null}return focused&&Type.isElement(focused)&&DOMPlugin.contains(this.spirit.element,focused)?this._focusselector(focused):null},_focusselector:function(elm){for(var index=-1,parts=[];elm&&elm.nodeType===Node.ELEMENT_NODE;)!function(elem){if(elem.id)try{return DOMPlugin.q(elem.parentNode,elem.id),!0}catch(malformedexception){}return!1}(elm)?"body"===elm.localName?(parts.push("body"),elm=null):(index=DOMPlugin.ordinal(elm)+1,parts.push(">"+elm.localName+":nth-child("+index+")"),elm=elm.parentNode):(parts.push("#"+elm.id),elm=null);return parts.reverse().join("")},_restorefocus:function(selector){var focus,field=DOMPlugin.qdoc(selector);try{focus=document.activeElement}catch(ieException){focus=null}field&&field!==focus&&(field.focus(),gui.CSSPlugin.matches(field,"textarea, input:not([type=checkbox]):not([type=radio])")&&field.setSelectionRange(field.value.length,field.value.length))}})}(gui.Combo.chained,gui.Arguments.confirmed,gui.Type,gui.Tick,gui.Object,gui.Array,gui.DOMPlugin,gui.Broadcast),edbml.ScriptSpirit=gui.Spirit.extend({scriptid:null,onconfigure:function(){if(gui.Spirit.prototype.onconfigure.call(this),this.dom.embedded()){var id,parent=this.dom.parent(gui.Spirit);parent&&(id=this.scriptid)&&parent.script.load(gui.Object.lookup(id))}}}),edbml.Security=function(safeelm,safemap,unsafexp){return{$safetext:function(string){return safeelm.firstChild.data=String(string),safeelm.innerHTML},$safeattr:function(string){return String(string).replace(unsafexp,function(c){return safemap[c]})}}}(function(){var div=document.createElement("div"),txt=document.createTextNode("");return div.appendChild(txt),div}(),{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},/[&<>'"]/g),gui.module("edbml@wunderbyte.com",{mixin:{src:function(script){if(gui.Type.isString(script)){var func=gui.Object.lookup(script);if(!func)throw new Error(this+' could not locate "'+script+'"');script=func}if(!gui.Type.isFunction(script))throw new TypeError(this+" could not load script");this.script.load(script)},onrender:function(summary){},onchange:function(changes){},oninput:function(input){},$oninput:function(input){this.script.input.match(input)}},plugin:{script:edbml.ScriptPlugin},channel:[[".gui-script","edbml.ScriptSpirit"]],oncontextinitialize:function(){var edbmlscript,basespirit=gui.Spirit.prototype;if(gui.Function.decorateAfter(basespirit,"onconfigure",function(){edbml.bootload&&!this.script.loaded&&(edbmlscript=gui.Object.lookup(this.$classname+".edbml"),gui.Type.isFunction(edbmlscript)&&this.script.load(edbmlscript))}),!window.event)try{window.event=null}catch(ieexception){}}})}(self),function(window){"use strict";ts.ui.greenfield=!1,ts.ui.Plugin=gui.Plugin.extend(),ts.ui.EventPlugin=gui.EventPlugin.extend({handleEvent:function(e){gui.EventPlugin.prototype.handleEvent.call(this,e);var fake,time,spirit=this.spirit;switch(e.type){case"mouseenter":this._hoverintent&&(fake=this._getfakeevent(e,"hoverintent"),time=ts.ui.EventPlugin.HOVER_INTENT_TIME,this._hovercountdown=gui.Tick.time(function(){spirit.onevent(fake)},time));break;case"mouseleave":this._hoverintent&&gui.Tick.cancelTime(this._hovercountdown)}},_hoverintent:!1,_hovercountdown:-1,_shiftEventListener:function(add,target,type,handler,capture){switch(type){case"hoverintent":this._shiftHoverListener(add,target,type,handler,capture);break;default:gui.EventPlugin.prototype._shiftEventListener.call(this,add,target,type,handler,capture)}},_shiftHoverListener:function(add,target,type,handler,capture){if(this._hoverintent=add,(target=this._getelementtarget(target))!==this.spirit.element)throw new Error("Not supported just yet");add&&["mouseenter","mouseleave"].forEach(function(t){target.addEventListener(t,this)},this)}},{},{HOVER_INTENT_TIME:123}),ts.ui.StatusPlugin=function(confirmed){var BUSY1=ts.ui.BROADCAST_GLOBAL_STATUS_BUSY,DONE1=ts.ui.BROADCAST_GLOBAL_STATUS_DONE,BUSY2=ts.ui.BROADCAST_GLOBAL_STATUS_BUSY_BLOCKING,DONE2=ts.ui.BROADCAST_GLOBAL_STATUS_DONE_BLOCKING;return ts.ui.Plugin.extend({onconstruct:function(){ts.ui.Plugin.prototype.onconstruct.call(this),this._bookmarks={}},ondestruct:function(){ts.ui.Plugin.prototype.ondestruct.call(this);var exit={};this.isBusy()&&(exit[BUSY1]=DONE1,exit[BUSY2]=DONE2,Object.keys(this._bookmarks).forEach(function(key){var cuts=key.split(this._SEPARATOR);this._done(exit[cuts[0]],cuts[1])},this))},isBusy:function(doingwhat){return arguments.length?Object.keys(this._bookmarks).some(function(activity){return activity.includes(doingwhat)}):Object.keys(this._bookmarks).length>0},busy:function(message){this._busy(BUSY1,message)},done:function(message){this._done(DONE1,message)},busyBlocking:function(message){this._busy(BUSY2,message)},doneBlocking:function(message){this._done(DONE2,message)},_SEPARATOR:":::",_bookmarks:null,_stamp:function(message){return"["+this.spirit.constructor.$classname+"] "+message},_busy:confirmed("string")(function(broadcast,message){this._bookmarks[broadcast+this._SEPARATOR+message]=!0,message=this._stamp(message),this.spirit.life.dispatch(ts.ui.LIFE_STATUS_BUSY,message),gui.Broadcast.dispatchGlobal(broadcast,message)}),_done:confirmed("string")(function(broadcast,message){delete this._bookmarks[broadcast+this._SEPARATOR+message],message=this._stamp(message),gui.Tick.next(function(){gui.Broadcast.dispatchGlobal(broadcast,message),this.spirit&&this.spirit.life.dispatch(ts.ui.LIFE_STATUS_DONE,this._stamp(message))},this)})},{busy:confirmed("string")(function(message){gui.Broadcast.dispatchGlobal(BUSY1,message)}),done:confirmed("string")(function(message){gui.Tick.next(function(){gui.Broadcast.dispatchGlobal(DONE1,message)})}),busyBlocking:confirmed("string")(function(message){gui.Broadcast.dispatchGlobal(BUSY2,message)}),doneBlocking:confirmed("string")(function(message){gui.Tick.next(function(){gui.Broadcast.dispatchGlobal(DONE2,message)})})})}(gui.Arguments.confirmed),ts.ui.LayoutPlugin=function(GuiArray,DOMPlugin,CSSPlugin,chained){var LEVELS=[1,1.5,2,2.5,3,3.5,4,4.5,5,5.5,6,6.5,7,7.5,8,8.5,9];return ts.ui.Plugin.extend({outsideMain:function(){return!this.spirit.css.matches("[data-ts=Main] *")},beforeMain:function(){var is=!1,elm=this.spirit.element;if(!this._isinaside()&&!this._isinmain())for(;!is&&(elm=elm.nextElementSibling);)is=CSSPlugin.contains(elm,"ts-main");return is},afterMain:function(){var is=!1,elm=this.spirit.element;if(!this._isinaside()&&!this._isinmain())for(;!is&&(elm=elm.previousElementSibling);)is=CSSPlugin.contains(elm,"ts-main");return is},shiftGlobal:chained(function(on,cnames){this.spirit.action.dispatch(ts.ui.ACTION_ROOT_CLASSNAMES,{classes:GuiArray.make(cnames),enabled:!!on})}),flexGlobal:chained(function(){ts.ui.get(document.documentElement).reflex()}),gotoLevel:function(level,prefix){var css=this.spirit.css;prefix=prefix||"ts-level",LEVELS.forEach(function(number){var string=String(number).replace(".","-");css.shift(number===level,prefix+"-"+string)})},_isinaside:function(){return this.spirit.css.matches(".ts-sideshow *")},_isinmain:function(){return this.spirit.css.matches(".ts-main *")}},{shift:chained(function(on,cnames){console.error("Deprecated API is deprecated: LayoutPlugin.shift")}),contains:function(cname){return gui.debug&&console.log("TODO: this must be synced to root panels setup"),ts.ui.get(document.documentElement).css.contains(cname)}})}(gui.Array,gui.DOMPlugin,gui.CSSPlugin,gui.Combo.chained),ts.ui.AttentionPlugin=function(GuiArray,chained,notontouch){return ts.ui.Plugin.extend({trapping:!1,ondestruct:function(){ts.ui.Plugin.prototype.ondestruct.call(this),this.trapping&&(ts.ui.LayoutModel.output.get().attention.removeObserver(this),gui.Tick.cancelTime(this._timeout),this._listen(!1))},trap:chained(notontouch(function(opt_elm){var elm=this._getelement(opt_elm);this.trapping||(this.trapping=!0,this._listen(!0),this._trap(elm))})),enter:notontouch(function(opt_elm){function find(informs){return all.reduce(function(result,next){return!result&&that._isfocus(next,informs)&&(result=next),result},null)}var hit=null,elm=this._getelement(opt_elm),all=GuiArray.from(elm.getElementsByTagName("*")),that=this;return(hit=find(!0)||find(!1))&&hit.focus(),null!==hit}),exit:function(opt_elm){if(this._entered){var elm=this._getelement(opt_elm),dom=gui.DOMPlugin,act=document.activeElement,def=act===document.body;act&&!act.nodeType&&(act=null),def&&act?act.blur():act&&(act===elm||dom.contains(elm,act))&&act.blur(),this._attention("exit")}},handleEvent:function(e){var elm=e.target;if(this._isfocus(elm))switch(e.type){case"focus":this._onfocus(elm);break;case"blur":this._onblur(elm)}},onbroadcast:function(b){b.type===ts.ui.BROADCAST_ATTENTION_MOVE&&b.data===this.spirit.$instanceid&&this.enter()},onchange:function(changes){var list=ts.ui.LayoutModel.output.get().attention,inst=this.spirit.$instanceid,last=this._latest;last&&changes.forEach(function(change){change.object===list&&change.removed.length&&list[list.length-1]===inst&&this._restorefocus(last)},this)},_timeout:-1,_entered:!1,_latest:null,_getelement:function(elm){return(elm=elm||this.spirit.element).nodeType?elm:elm.element},_trap:function(elm){[!0,!1].map(function(before){return elm.parentNode.insertBefore(document.createElement("kbd"),before?elm:elm.nextElementSibling)}).forEach(function(kbd,last){kbd.tabIndex=0,kbd.onfocus=function(){this._tryfocus(elm,!last)}.bind(this)},this)},_tryfocus:function(elm,reverse){var did=!1,elms=elm.getElementsByTagName("*");return(elms=GuiArray.from(elms)).length&&(elms=reverse?elms.reverse():elms,did=this._didfocus(elms.filter(function(elem){return elem.tabIndex>-1&&!elem.disabled}))),did},_didfocus:function(elms){return elms.every(function(elm){return!this._isfocus(elm)||!this._dofocus(elm)},this)},_dofocus:function(elm){return elm.focus(),document.activeElement===elm},_isfocus:function(elm,forms){if(forms||1===arguments.length)switch(elm.localName){case"input":case"textarea":case"select":return"hidden"!==elm.type&&!elm.readonly&&!elm.disabled}if(!forms){switch(elm.localName){case"button":case"a":return!elm.disabled}if(elm.tabIndex>-1&&elm.hasAttribute("tabindex"))return!0}return!1},_listen:function(listen){var element=this.spirit.element,action1=listen?"addEventListener":"removeEventListener",action2=listen?"addGlobal":"removeGlobal";element[action1]("focus",this,!0),element[action1]("blur",this,!0),gui.Broadcast[action2](ts.ui.BROADCAST_ATTENTION_MOVE,this)},_onfocus:function(elm){clearTimeout(this._timeout),this._focused=!0,this._latest=elm,this._entered||(this._entered=!0,this._attention("enter"))},_onblur:function(){this._focused=!1,this._timeout=gui.Tick.time(function(){this._focused||(this._entered=!1)},0,this)},_restorefocus:function(last){gui.Tick.time(function(){var act=document.activeElement;act!==document.body&&-1!==act.tabIndex||gui.DOMPlugin.embedded(last)&&last.focus()})},_attention:function(scenario){var inst=this.spirit.$instanceid,list=ts.ui.LayoutModel.output.get().attention,last=list[list.length-1];switch(scenario){case"enter":last!==inst&&(list.push(inst),list.addObserver(this));break;case"exit":list.length&&(list.removeObserver(this),list.pop())}}})}(gui.Array,gui.Combo.chained,function(base){return function(){if(!gui.Client.isTouchDevice)return base.apply(this,arguments)}}),ts.ui.PanelsPlugin=function(PANEL_ATTACH,PANEL_DETACH){function gettab(spirit,panel){return{label:panel.label,selected:panel.selected,$onselect:function(){select(spirit,panel)}}}function select(spirit,panel){spirit.$destructed||spirit.dom.children(ts.ui.PanelSpirit).forEach(function(p){p===panel?(p.show(),p.$onselect(),spirit.$selectTab(p)):(p.hide(),p.$onunselect())})}return ts.ui.Plugin.extend({init:function(){if(!this._initialized){if(!this.spirit.$insertTab)throw new Error("$insertTab :(");this._initialized=!0,this._index(this.spirit.dom.children(ts.ui.PanelSpirit)),this.spirit.action.add([PANEL_ATTACH,PANEL_DETACH],this)}},current:function(){var panels=this._panels();return panels.find(function(p){return p.selected})||panels[0]},onaction:function(a){switch(a.type){case PANEL_ATTACH:case PANEL_DETACH:var panel=a.target,added=a.type===PANEL_ATTACH;panel.label&&this._reindex(panel,added),a.consume()}},_panels:function(){return this.spirit.dom.children(ts.ui.PanelSpirit)},_index:function(panels){var spirit=this.spirit;if(panels.length>1){if(!panels.every(function(panel){return!!panel.label}))throw new Error("Multiple panels inside the "+this.spirit.$classname+" must have a label");panels.forEach(function(panel,index){var json=gettab(spirit,panel);spirit.$insertTab(json,panels.length)})}},_reindex:function(panel,added){var spirit=this.spirit,index=this._panels().indexOf(panel);if(added){var json=gettab(spirit,panel);spirit.$insertTab(json,index),panel.selected||panel.hide()}}})}(ts.ui.ACTION_PANEL_ATTACH,ts.ui.ACTION_PANEL_DETACH),ts.ui.DoorManPlugin=function(Type){var domevent={WILLOPEN:ts.ui.EVENT_ASIDE_WILL_OPEN,DIDOPEN:ts.ui.EVENT_ASIDE_DID_OPEN,WILLCLOSE:ts.ui.EVENT_ASIDE_WILL_CLOSE,DIDCLOSE:ts.ui.EVENT_ASIDE_DID_CLOSE};return ts.ui.Plugin.extend({onconstruct:function(){ts.ui.Plugin.prototype.onconstruct.call(this),gui.debug&&this._confirminterface()},open:function(opt_open){var spirit=this.spirit;if(Type.isBoolean(opt_open)||(opt_open=!0),this._shouldattempt(opt_open))if(opt_open){if(!spirit.isOpen)return this._maybeopen(spirit.life.async)}else if(spirit.isOpen)return this._maybeclose(spirit.life.async);return!1},didopen:function(){this._execute("onopened"),this.spirit.event.dispatch(domevent.DIDOPEN,{bubbles:!0})},didclose:function(){this._execute("onclosed"),this.spirit.event.dispatch(domevent.DIDCLOSE,{bubbles:!0})},_shouldattempt:function(open){var events=this.spirit.event;return open!==this.spirit.isOpen&&events.dispatch(open?domevent.WILLOPEN:domevent.WILLCLOSE,{bubbles:!0,cancelable:!0})},_execute:function(callback){var spirit=this.spirit;if(callback=spirit[callback])switch(gui.Type.of(callback)){case"string":return new Function(callback).call(spirit);case"function":return callback.call(spirit)}return!0},_maybeopen:function(animated){var ok=!1!==this._execute("onopen");return ok&&(this.spirit.isOpen=!0,this.spirit.att.set("data-ts.open",!0),this.spirit.$onopen(animated)),ok},_maybeclose:function(animated){var ok=!1!==this._execute("onclose");return ok&&(this.spirit.isOpen=!1,this.spirit.att.set("data-ts.open",!1),this.spirit.$onclose(animated)),ok},_confirminterface:function(){var host=this.spirit;"isOpen onopen onopened onclose onclosed $onopen $onclose".split(" ").forEach(function(api){if(void 0===host[api])throw new Error('Missing interface "'+api+'"')})}},{lazy:!1})}(gui.Type),ts.ui.DocumentLayoutPlugin=ts.ui.Plugin.extend({managelayout:function(){this._points=this._computepoints(),new ts.ui.LayoutModel(this._computelayout()).output(),new ts.ui.DeviceModel(this._computedevice()).output(),this._updateBreakpoints(),gui.Broadcast.add(gui.BROADCAST_RESIZE_END,this)},onbroadcast:function(b){switch(b.type){case gui.BROADCAST_RESIZE_END:this._updateBreakpoints()}},_points:null,_timeout:-1,_computepoints:function(){var points=ts.ui.LayoutModel.BREAKPOINTS;return Object.keys(points).map(function(point){return parseInt(point,10)}).sort(function(a,b){return a-b})},_computelayout:function(){var point,next,points=[],width=window.innerWidth||0,presets=ts.ui.LayoutModel.BREAKPOINTS;return this._points.every(function(p){return(next=p<=width)&&(point=presets[p],points.push(point)),next}),{breakpoints:points,breakpoint:point}},_computedevice:function(){return{}},_updateBreakpoints:function(){var layout=this._computelayout(),model=ts.ui.LayoutModel.output.get();model.breakpoint=layout.breakpoint,model.breakpoints=layout.breakpoints}}),ts.ui.DocumentDialogPlugin=function(){function announce(msg){gui.Broadcast.dispatchGlobal(msg)}var willopen=ts.ui.BROADCAST_DIALOG_WILL_OPEN,goopen=ts.ui.BROADCAST_DIALOG_GO_OPEN,willclose=ts.ui.BROADCAST_DIALOG_WILL_CLOSE,didclose=ts.ui.BROADCAST_DIALOG_DID_CLOSE,modal_willopen=ts.ui.BROADCAST_MODAL_WILL_OPEN,modal_willclose=ts.ui.BROADCAST_MODAL_WILL_CLOSE,globalon=ts.ui.BROADCAST_GLOBAL_DIALOGS_WILL_ON,globaloff=ts.ui.BROADCAST_GLOBAL_DIALOGS_DID_OFF,globalblock=ts.ui.BROADCAST_GLOBAL_DIALOGS_WILL_BLOCK,globalunblock=ts.ui.BROADCAST_GLOBAL_DIALOGS_DID_UNBLOCK;return ts.ui.Plugin.extend({managedialogs:function(){this._dialogs=[],gui.Broadcast.add([willopen,goopen,goopen,willclose,didclose,modal_willopen,modal_willclose],this)},onbroadcast:function(b){var queue=this._dialogs,dialog=b.target;switch(b.type){case willopen:queue.length?dialog.suspend():announce(globalon),queue.push(dialog);break;case goopen:dialog&&this._updateblocking(dialog.blocking);break;case didclose:queue.shift(),queue.length?queue[0].unsuspend():(this._updateblocking(!1),announce(globaloff));break;case modal_willopen:b.target.$fullscreen||this._updateblocking(!0);break;case modal_willclose:b.target.$fullscreen||this._updateblocking(!1)}},_blocking:!1,_dialogs:null,_coverid:"ts-dialogcover",_updateblocking:function(blocking){blocking?this._blocking||(announce(globalblock),this._cover().fadeIn(),this._blocking=!0):this._blocking&&(announce(globalunblock),this._cover().fadeOut(),this._blocking=!1)},_cover:function(){return ts.ui.CoverSpirit.getCover(this._coverid)}})}(),ts.ui.DocumentAsidePlugin=function(Tick){function announce(msg){gui.Broadcast.dispatchGlobal(msg)}function flip(first,last){first.length&&first.slice().forEach(function(spirit,index){spirit.$flip().then(function(){gui.Array.remove(first,index),!first.length&&last&&flip(last)})})}var willopen=ts.ui.ACTION_ASIDE_WILL_OPEN,didopen=ts.ui.ACTION_ASIDE_DID_OPEN,willclose=ts.ui.ACTION_ASIDE_WILL_CLOSE,didclose=ts.ui.ACTION_ASIDE_DID_CLOSE,globaltouchcover=ts.ui.BROADCAST_GLOBAL_COVER_TOUCH,globalwillon=ts.ui.BROADCAST_GLOBAL_ASIDES_WILL_ON,globaldidon=ts.ui.BROADCAST_GLOBAL_ASIDES_DID_ON,globalwilloff=ts.ui.BROADCAST_GLOBAL_ASIDES_WILL_OFF,globaldidoff=ts.ui.BROADCAST_GLOBAL_ASIDES_DID_OFF,globaldoclose=ts.ui.BROADCAST_GLOBAL_ASIDES_DO_CLOSE;return ts.ui.Plugin.extend({manageasides:function(){this._flipins=[],this._flipout=[],this.spirit.action.add([willopen,didopen,willclose,didclose,"FLIP"],this),gui.Broadcast.addGlobal([globaltouchcover],this)},onaction:function(a){var spirit=a.target;switch(a.type){case willopen:1==++this._asides&&(announce(globalwillon),this._cover().fadeIn());break;case didopen:1===this._asides&&announce(globaldidon);break;case willclose:0==--this._asides&&(announce(globalwilloff),this._cover().fadeOut());break;case didclose:0===this._asides&&announce(globaldidoff);break;case"FLIP":(a.data?this._flipins:this._flipout).push(spirit),Tick.add("xxx",this).dispatch("xxx",4)}},onbroadcast:function(b){switch(b.type){case globaltouchcover:b.data===this._coverid&&gui.Broadcast.dispatchGlobal(globaldoclose)}},ontick:function(t){var out=this._flipout,ins=this._flipins;"xxx"===t.type&&(out.length?flip(out,ins):flip(ins))},_asides:0,_coverid:"ts-asidecover",_cover:function(){return ts.ui.CoverSpirit.getCover(this._coverid)}})}(gui.Tick),ts.ui.DocumentPanelPlugin=function(MapList,GuiArray){function toggle(panel,root){pausetabs&&ts.ui.isMobilePoint()?gui.Tick.time(function(){update(panel,shownpanel,root)},ts.ui.TRANSITION_FAST):update(panel,shownpanel,root),pausetabs=!0}function update(newpanel,oldpanel,root){var main=newpanel.dom.q(".ts-main");oldpanel&&oldpanel.hide(),newpanel.show(),main&&(main.scrollTop=0,trackbars(newpanel,main,root))}function trackbars(panel,main,root){var topbar=root.dom.qdoc(".ts-topbar",ts.ui.TopBarSpirit);[panel.dom.q(".ts-toolbar-first",ts.ui.ToolBarSpirit),topbar].forEach(function(bar){bar&&bar.$setmain(main)})}function updatelist(list,c,on){var mod=on?1:-1;isNaN(list[c])&&(list[c]=0),list[c]+=mod,on?1===list[c]&&list.push(c):0===list[c]&&GuiArray.remove(list,list.indexOf(c))}var haspanels=!1,shownpanel=null,classnames=new MapList,pausetabs=!1;return ts.ui.Plugin.extend({managepanels:function(){classnames.set(this.spirit.$instanceid,[]),this.spirit.action.add([ts.ui.ACTION_PANEL_ATTACH,ts.ui.ACTION_PANEL_SHOW,ts.ui.ACTION_PANEL_HIDE,ts.ui.ACTION_ROOT_CLASSNAMES],this)},onaction:function(a){var isroot=!0===a.data;switch(a.type){case ts.ui.ACTION_PANEL_ATTACH:isroot&&this._enterpanel(a.target);break;case ts.ui.ACTION_PANEL_SHOW:isroot&&this._showpanel(a.target);break;case ts.ui.ACTION_PANEL_HIDE:isroot&&this._hidepanel(a.target);break;case ts.ui.ACTION_ROOT_CLASSNAMES:var data=a.data;this._togglecss(data.enabled,data.classes,data.relatedPanel)}},haspanels:function(){return haspanels},_enterpanel:function(panel){haspanels=!0,classnames.set(panel.$instanceid,[]);var index=panel.dom.ordinal(),shown=panel.selected;shown?shownpanel=panel:panel.hide(),(panel.label||panel.icon)&&(this._insertab(panel,index,shown),this._quickfixlayout())},_showpanel:function(panel){shownpanel=panel,this.spirit.css.add(classnames.get(panel.$instanceid))},_hidepanel:function(panel){shownpanel=shownpanel===panel?null:shownpanel,this.spirit.css.remove(classnames.get(panel.$instanceid))},_togglecss:function(on,classes,panel){var root=this.spirit,guid=panel?panel.$instanceid:root.$instanceid,list=classnames.get(guid),snap=GuiArray.from(list);classes.forEach(function(c){updatelist(list,c,on)}),list=on?list:snap.filter(function(clas){return-1===list.indexOf(clas)}),panel?panel===shownpanel&&root.css.shift(on,list):root.css.shift(on,list)},_insertab:function(panel,index,selected){var tabs=ts.ui.TopBar.tabs(),root=this.spirit;tabs.splice(index,0,{label:panel.label,icon:panel.icon,selected:selected,$onselect:function(){toggle(panel,root)}})},_quickfixlayout:function(){this.spirit.css.add("ts-has-topbar ts-has-topbar-tabs")}})}(gui.MapList,gui.Array),ts.ui.Spirit=function(Type,GuiArray,confirmed){return gui.Spirit.extend({onconstruct:function(){gui.Spirit.prototype.onconstruct.call(this),this._confirmattributes(gui.debug),this._configureclassnames(this.css)},_model:null,_ismodelled:function(){return null!==this._model},_confirmattributes:function(debug){debug&&this.att.all().some(function(att){return"gui"===att.name||att.name.startsWith("gui.")})&&console.warn('The "gui" attribute should not used. Use the "ts" attribute to configure the '+this.$classname)},_configureclassnames:function(css){var cssnames=this.constructor.$cssnames;cssnames&&this.css.add(cssnames)},_maybeinvoke:function(action,arg){if(action){var args=[];arguments.length>1&&args.push(arg),Type.isString(action)&&(action=new Function(action)),action.apply(this,args)}return!!action},$debug:function(construct){construct?this.att.set("data-ts-spirit",this.$classname):this.att.del("data-ts-spirit")}},{},{$nicename:null,$cssname:null,$cssnames:null,createModelMethod:confirmed("function","function|string","(function)")(function(Model,edbml,handle){return handle=handle||function(model){return model},function modelmethod(opt_json){var model=opt_json;return model?opt_json!==this._model&&(Model.is(model)||(model=new Model(opt_json)),this._model=model,this.script.loaded||this.script.load(edbml),this.script.input(model)):model=this._model||modelmethod.call(this,{}),handle.call(this,model)||model}})})}(gui.Type,gui.Array,gui.Arguments.confirmed),ts.ui.DocumentSpirit=function(Client){var APP_LOADING=ts.ui.BROADCAST_GLOBAL_APP_LOADING,APP_ABORTED=ts.ui.BROADCAST_GLOBAL_APP_ABORTED,APP_COMPLETE=ts.ui.BROADCAST_GLOBAL_APP_COMPLETE;return gui.DocumentSpirit.extend({onconstruct:function(){gui.DocumentSpirit.prototype.onconstruct.call(this),this.layoutplugin.managelayout(),this.dialogplugin.managedialogs(),this.asideplugin.manageasides(),this.panelplugin.managepanels(),this.input.connect(ts.ui.LayoutModel),this.broadcast.addGlobal([APP_LOADING,APP_ABORTED,APP_COMPLETE]),this.action.add(ts.ui.ACTION_FOOTER_LEVEL).addGlobal([ts.ui.ACTION_GLOBAL_MODELS_INITIALIZE,ts.ui.ACTION_GLOBAL_LOCATION_CHANGEHASH,ts.ui.ACTION_GLOBAL_LOCATION_HASHCHANGE,ts.ui.ACTION_GLOBAL_COMPLETED,ts.ui.ACTION_GLOBAL_TERMINATE]).dispatchGlobal(ts.ui.ACTION_GLOBAL_DOCUMENT_TITLE,document.title)},onconfigure:function(){gui.DocumentSpirit.prototype.onconfigure.call(this),this.css.add("ts-engine-"+Client.agent).shift(gui.hosted,"ts-iframe-hosted").shift(Client.isExplorer9,"ts-engine-explorer9").shift(Client.isTouchDevice,"ts-device-touch").shift(!Client.isTouchDevice,"ts-device-mouse")},onready:function(){gui.DocumentSpirit.prototype.onready.call(this),this.css.add(ts.ui.CLASS_READY)},onasync:function(){if(ts.ui.appframe){var main=this.dom.qdoc(".ts-main");main?main.addEventListener("touchstart",function(){},!!gui.Client.hasPassiveEventListeners&&{passive:!0}):console.warn("WARNING: This app needs a ts-main")}},onaction:function(a){switch(gui.DocumentSpirit.prototype.onaction.call(this,a),a.consume(),a.type){case ts.ui.ACTION_GLOBAL_LOCATION_CHANGEHASH:ts.lib.Location.assign(a.data);break;case ts.ui.ACTION_GLOBAL_MODELS_INITIALIZE:this._outputmodels(a.data),this.action.remove(a.type);break;case ts.ui.ACTION_GLOBAL_COMPLETED:this.broadcast.dispatch(ts.ui.BROADCAST_COMPLETED);break;case ts.ui.ACTION_GLOBAL_TERMINATE:this.broadcast.dispatch(ts.ui.BROADCAST_TERMINATE);break;case ts.ui.ACTION_FOOTER_LEVEL:this.guilayout.gotoLevel(a.data,"ts-footer-level")}},onbroadcast:function(b){gui.DocumentSpirit.prototype.onbroadcast.call(this,b);var cname=ts.ui.CLASS_LOADING;switch(b.type){case APP_LOADING:case APP_ABORTED:this.css.add(cname);break;case APP_COMPLETE:this.css.remove(cname)}},oninput:function(input){gui.DocumentSpirit.prototype.oninput.call(this,input);var model=input.data;switch(input.type){case ts.ui.LayoutModel:this._breakpoints(model.breakpoints),this._breakpoint(model.breakpoint),model.addObserver(this)}},onchange:function(changes){gui.DocumentSpirit.prototype.onchange.call(this,changes),changes.forEach(function(c){this._onmodelchange(c.object,c.name,c.newValue,c.oldValue)},this)},reflex:function(){this.tick.time(function(){gui.DocumentSpirit.prototype.reflex.call(this)})},shiftclassnames:function(on,cnames){this.layoutplugin.shiftclassnames(!!on,gui.Array.make(cnames))},_outputmodels:function(models){gui.Object.each(models,function(name,json){gui.Object.lookup(name).syncGlobal(json).output()},this)},_onmodelchange:function(model,prop,newval,oldval){switch(model.constructor){case ts.ui.LayoutModel:this._onlayoutchange(prop,newval,oldval)}},_onlayoutchange:function(prop,newval,oldval){switch(prop){case"breakpoints":this._breakpoints(newval,oldval);break;case"breakpoint":this._breakpoint(newval,oldval);break;case"menuopen":this.css.shift(newval,"ts-menu-open")}},_breakpoint:function(newpoint,opt_oldpoint){this.css.remove("ts-mobile-only ts-tablet-only ts-desktop-only"),this.css.add(function(p){return"ts-"+p+"-only"}(newpoint)),this.event.dispatch("ts-breakpoint",{bubbles:!0})},_breakpoints:function(newpoints,opt_oldpoints){function fix(p){return"ts-"+p}var css=this.css;(opt_oldpoints||[]).forEach(function(val){css.remove(fix(val))}),newpoints.forEach(function(val){css.add(fix(val))})}})}(gui.Client),ts.ui.MainSpirit=function(Type,chained,PANEL_ATTACH,PANEL_DETACH){function preceding(main,Bar){return main.dom.preceding(ts.ui.Spirit).find(function(spirit){return spirit.constructor===Bar})}function following(main,Bar){return main.dom.following(ts.ui.Spirit).find(function(spirit){return spirit.constructor===Bar})}function suspended(bar,action,thisp){var type="ts-life-toolbar-hascontent";return bar.life.add(type,{onlife:function(){bar.life.remove(type,this),action.call(thisp,bar)}}),bar}return ts.ui.Spirit.extend({spin:null,busy:chained(function(busy){var opts={message:gui.Type.isString(busy)?busy:""};this._initspin(busy,opts),busy?(this.guistatus.busy(this.$instanceid),this._isbusy=!0):(this.guistatus.done(this.$instanceid),this._isbusy=!1)}),done:chained(function(){this.busy(!1)}),blocking:chained(function(busyblocking){var opts={message:busyblocking,cover:!0,color:"#fff"};this._initspin(busyblocking,opts),busyblocking?this.guistatus.busy(this.$instanceid):this.guistatus.done(this.$instanceid)}),doneBlocking:chained(function(){this.blocking(!1)}),onconfigure:function(){ts.ui.Spirit.prototype.onconfigure.call(this),this.element.tabIndex=-1,this.attention.trap(),this.action.add([PANEL_ATTACH,PANEL_DETACH])},onaction:function(a){switch(ts.ui.Spirit.prototype.onaction.call(this,a),a.type){case PANEL_ATTACH:case PANEL_DETACH:var panel=a.target,index=panel.dom.ordinal(),added=a.type===PANEL_ATTACH;panel.label&&this._updatetab(panel,index,added),a.consume()}},onvisible:function(){ts.ui.Spirit.prototype.onvisible.call(this);var auto=this.dom.q("[autofocus]");auto&&document.activeElement!==auto&&auto.focus()},tabbar:function(){var TabBar=ts.ui.TabBarSpirit;return this._tabbar||(this._tabbar=preceding(this,TabBar)||suspended(TabBar.summon("header").lite(),function(tabbar){(preceding(this,ts.ui.ToolBarSpirit)||this).dom.before(tabbar)},this))},toolbar:function(){var ToolBar=ts.ui.ToolBarSpirit;return this._toolbar||(this._toolbar=preceding(this,ToolBar)||suspended(ToolBar.summon("header"),function(toolbar){var tabbar=preceding(this,ts.ui.TabBarSpirit);tabbar?tabbar.dom.after(toolbar):this.dom.before(toolbar)},this))},statusbar:function(){var StatusBar=ts.ui.StatusBarSpirit;return this._statusbar||(this._statusbar=following(this,StatusBar)||suspended(StatusBar.summon("footer"),function(statusbar){this.dom.after(statusbar)},this))},_tabbar:null,_toolbar:null,_statusbar:null,_updatetab:function(panel,index,added){var bar=this.tabbar(),elm=this.element,dom=this.dom;added?(index>0&&!panel.selected&&panel.hide(),bar.tabs().splice(index,0,{label:panel.label,selected:panel.selected||0===index,$onselect:function(){dom.qall(".ts-maincontent > .ts-panel",ts.ui.PanelSpirit).forEach(function(p){p===panel?(p.show(),elm.scrollTop=0,p.$onselect()):p.hide()})}})):bar.tabs().splice(index,1).forEach(function(tab){tab.dispose()}),bar.$hascontent()},_initspin:function(busy,opts){this.spin||(this.spin=ts.ui.SpinnerSpirit.summon()),busy?this.spin.spin(document.body,opts):this.spin.stop()}})}(gui.Type,gui.Combo.chained,ts.ui.ACTION_PANEL_ATTACH,ts.ui.ACTION_PANEL_DETACH),ts.ui.MainContentSpirit=ts.ui.Spirit.extend({onconfigure:function(){ts.ui.Spirit.prototype.onconfigure.call(this),this.element.tabIndex=-1},onready:function(){ts.ui.Spirit.prototype.onready.call(this),this.css.add("ts-maincontent"),gui.debug&&this.dom.qdocall(".ts-maincontent").length>1&&console.log("There should be only on .ts-maincontent at any given time :/")}}),ts.ui.IconSpirit=function(){var SVG_LINK="//d5wfroyti11sa.cloudfront.net/prod/client/svg-icons/",ICON_SUBSTITUTES={todo:"vote-flag-7",warning:"interface-alert-triangle"};return ts.ui.Spirit.extend({onenter:function(){ts.ui.Spirit.prototype.onenter.call(this),this.att.add("class")},onatt:function(att){ts.ui.Spirit.prototype.onatt.call(this,att),"class"===att.name&&this._loadsvg()},_loadsvg:function(){var icon=this.$geticon();if(icon){var ajax=null,spirit=this;gui.Client.isExplorer9?((ajax=new window.XDomainRequest).open("get",SVG_LINK+encodeURIComponent(icon)+".svg",!0),setTimeout(function(){ajax.send()},0)):((ajax=new XMLHttpRequest).open("get",SVG_LINK+encodeURIComponent(icon)+".svg",!0),ajax.send()),ajax.onload=function(){ajax.responseText&&(spirit.element.innerHTML=ajax.responseText+"\n\n",console.log(icon+"\n"+ajax.responseText),gui.Tick.nextFrame(function(){spirit.$fixsize.apply(spirit)}))},ajax.onerror=function(){console.error("Can not get the svg "+icon)}}},$geticon:function(){var result=null,klasses=this.element.className.split(" ");return klasses.length?(klasses.map(function(item){item.indexOf("ts-icon-")>-1&&(result=item.substring(8,item.length))}),this.$substitute(result)):result},$substitute:function(icon){return ICON_SUBSTITUTES[icon]?ICON_SUBSTITUTES[icon]:icon},$fixsize:function(){var fontSize=parseFloat(this.css.compute("fontSize")),svgElem=this.element.querySelector("svg");svgElem.setAttribute("width",fontSize),svgElem.setAttribute("height",fontSize)}})}(),ts.ui.NextIconSpirit=function(URL,Request,Client,Parser){var bundles={},icons={},queues={};return ts.ui.Spirit.extend({onconfigure:function(){ts.ui.Spirit.prototype.onconfigure.call(this),this.att.add("src")},onatt:function(att){if(ts.ui.Spirit.prototype.onatt.call(this,att),"src"===att.name){var src=att.value.trim();att.value.startsWith("{")||this._geticon(src).then(function(icon){this.dom.empty().append(icon.cloneNode(!0))},this)}},_geticon:function(src){var icon=icons[src],then=new gui.Then;if(!icon)if(src.startsWith("#")){if(!(icon=document.querySelector(src)))throw new Error(src+" not found");icons[src]=icon}else{if(!src.includes("#"))throw new Error("Missing #identifier in "+src);var gurl=new URL(document,src),path=gurl.pathname,hash=gurl.hash;this._getexternal(path,hash,then)}return icon&&then.now(icon),then},_getexternal:function getexternal(path,hash,then){var exist=bundles[path],loads=exist&&exist instanceof Request;if(!exist||loads)this._loadexternal(path,loads,function(){getexternal(path,hash,then)});else if(hash.length>1){var icon=exist.querySelector(hash);icon?then.now(icon):console.log(hash+" not found")}else console.error("Icon #id missing")},_loadexternal:function(path,loads,callback){var queue=queues[path]||(queues[path]=[]);queue.push(callback),loads||(bundles[path]=new Request(path)).accept("image/svg+xml").get().then(function(status,svg){if(200===status)for(bundles[path]=Parser.parseToDocument(svg);queue.length;)queue.shift()();else console.error(path+" status:"+status)},this)}})}(gui.URL,gui.Request,gui.Client,gui.HTMLParser),ts.ui.FrameSpirit=gui.IframeSpirit.extend({onenter:function(){gui.IframeSpirit.prototype.onenter.call(this),this._models=[],this.life.add([gui.LIFE_IFRAME_DOMCONTENT,gui.LIFE_IFRAME_ONLOAD,gui.LIFE_IFRAME_ONHASH,gui.LIFE_IFRAME_UNLOAD]),this.input.connect([ts.ui.LayoutModel,ts.ui.DeviceModel])},onlife:function(l){switch(gui.IframeSpirit.prototype.onlife.call(this,l),l.type){case gui.LIFE_IFRAME_DOMCONTENT:this.action.dispatch(ts.ui.ACTION_FRAME_ONDOM,this.contentLocation.href);break;case gui.LIFE_IFRAME_ONLOAD:this.action.dispatch(ts.ui.ACTION_FRAME_ONLOAD,this.contentLocation.href);break;case gui.LIFE_IFRAME_ONHASH:this.action.dispatch(ts.ui.ACTION_FRAME_ONHASH,this.contentLocation.hash);break;case gui.LIFE_IFRAME_UNLOAD:this.action.dispatch(ts.ui.ACTION_FRAME_UNLOAD,this.contentLocation.href)}},oninput:function(input){switch(gui.IframeSpirit.prototype.oninput.call(this,input),input.type){case ts.ui.LayoutModel:case ts.ui.DeviceModel:this._models.push(input.data)}},load:function(src){var then=new gui.Then;return src.startsWith("#")?this._updatehash(src,then):this._loadnewsrc(src,then),then},_models:null,_loadnewsrc:function(src,then){this.src(src),then.now()},_updatehash:function(hash,then){var action=ts.ui.ACTION_GLOBAL_LOCATION_CHANGEHASH;this.action.descendGlobal(action,hash),then.now()},_mapmodels:function(models){var map=Object.create(null);return this._models.forEach(function(model){map[model.$classname]=model.serializeToString()}),map}},{SANDBOX:"allow-scripts allow-forms allow-same-origin",summon:function(opt_src,opt_box){var iframe=document.createElement("iframe"),spirit=this.possess(iframe);return spirit.css.add(ts.ui.CLASS_IFRAME),opt_box&&(iframe.sandbox=opt_box),opt_src&&spirit.load(opt_src),spirit}}),ts.ui.MainFrameSpirit=ts.ui.Spirit.extend({loading:!1,onconfigure:function(){ts.ui.Spirit.prototype.onconfigure.call(this),this.event.add("message",window),this.css.add(ts.ui.CLASS_MAINFRAME),this.action.add([ts.ui.ACTION_FRAME_ONDOM,ts.ui.ACTION_FRAME_ONLOAD,ts.ui.ACTION_FRAME_ONHASH,ts.ui.ACTION_FRAME_UNLOAD]).addGlobal(ts.ui.ACTION_GLOBAL_DOCUMENT_TITLE),this.css.remove("ts-mainframe").add("ts-mainframe-renamed")},onaction:function(a){var target=a.target,newframe=this._newframe;switch(ts.ui.Spirit.prototype.onaction.call(this,a),a.type){case ts.ui.ACTION_GLOBAL_DOCUMENT_TITLE:target!==newframe&&a.consume();break;case ts.ui.ACTION_FRAME_ONDOM:target===newframe?this._prepareonload():a.consume();break;case ts.ui.ACTION_FRAME_ONLOAD:a.consume();break;case ts.ui.ACTION_FRAME_ONHASH:target!==newframe&&a.consume();break;case ts.ui.ACTION_FRAME_UNLOAD:target===newframe?(this._loading(!0),this._unload()):a.consume()}},onevent:function(e){if(ts.ui.Spirit.prototype.onevent.call(this,e),"message"===e.type&&this._newframe&&e.source===this._newframe.contentWindow)switch(e.data){case ts.ui.MESSAGE_BUSY:console.error("TODO: implement mechanism for delaying _onload()");break;case ts.ui.MESSAGE_DONE:this._prepareonload()}},load:function(href){return href!==this._href&&(this._href=href,this._loading(!0),this._load(this._href))},_COSMETIC_TIMEOUT:10,_href:null,_path:null,_newframe:null,_oldframe:null,_prepareonload:function(){var time=this._COSMETIC_TIMEOUT;this.tick.time(function(){this._onload()},time)},_createframe:function(){var frame=this._frameimplementation().summon();return this._showframe(frame,!1)},_frameimplementation:function(){return ts.ui.FrameSpirit},_load:function(href){var path=href.split("#")[0];return path!==this._path?(this._loadnew(href),this._path=path,!0):(this._sameold(href),!1)},_loadnew:function(href){this._switchframes(),this._newframe.load(href).then(function(){this.dom.append(this._newframe)},this)},_sameold:function(hash){this._newframe.load(hash).then(function(){this._loading(!1)},this)},_switchframes:function(){var oldframe=this._oldframe=this._newframe;this._newframe=this._createframe(),oldframe&&oldframe.action.descendGlobal(ts.ui.ACTION_GLOBAL_TERMINATE)},_onload:function(){this._loading(!1),this._toggle()},_unload:function(){this._showframe(this._newframe,!1)},_toggle:function(){var oldframe;this._showframe(this._newframe,!0),(oldframe=this._oldframe)&&(this._oldframe=null,this._showframe(oldframe,!1),this._cleanup(oldframe)),this._newframe.action.descendGlobal(ts.ui.ACTION_GLOBAL_COMPLETED)},_loading:function(is){this.loading=is;var status="loading "+this._href,classn=ts.ui.CLASS_READY;is?(this.guistatus.busyBlocking(status),this.css.remove(classn)):gui.Tick.time(function(){this.guistatus.doneBlocking(status),this.css.add(classn)},100,this)},_showframe:function(frame,show){return show?(frame.css.visibility="",frame.visibility.on()):(frame.css.visibility="hidden",frame.visibility.off()),frame},_cleanup:function(oldframe){gui.Client.isExplorer9?function(){var iframe=oldframe.element;gui.materialize(iframe),iframe.parentNode.removeChild(iframe)}():oldframe.dom.remove()}}),ts.ui.SideShowSpirit=function(chained,Client,Parser,GuiObject,Colors,PANEL_ATTACH,PANEL_DETACH){function getcolor(spirit){return Object.keys(Colors).map(function(key){return Colors[key]}).reduce(function(result,color){return result||(spirit.css.contains(color)?color:null)},null)}var BGCOLORS=function(colors){return Object.keys(colors).map(function(key){return colors[key]})}(ts.ui.BACKGROUND_COLORS);return ts.ui.Spirit.extend({isOpen:!1,onopen:null,onopened:null,onclose:null,onclosed:null,flipped:!1,spin:null,busy:function(busy){this._initspin(busy),busy?this.guistatus.busy(this.$instanceid):this.guistatus.done(this.$instanceid)},onconfigure:function(){ts.ui.Spirit.prototype.onconfigure.call(this),this.action.add([PANEL_ATTACH,PANEL_DETACH])},onenter:function(){ts.ui.Spirit.prototype.onenter.call(this),this.flipped&&(this.event.add("transitionend"),this.css.add("ts-flipping ts-flip-init"),this.tick.time(function(){this.css.add("ts-flip-out")}))},onasync:function(){ts.ui.Spirit.prototype.onasync.call(this),this._fixappearance()},onready:function(){ts.ui.Spirit.prototype.onready.call(this),this._confirmpanel(),this.css.add("ts-sideshow"),this._initfooter(window.MutationObserver||window.WebKitMutationObserver),this._inittabs()},onattach:function(){ts.ui.Spirit.prototype.onattach.call(this),this._reflex()},ondestruct:function(){ts.ui.Spirit.prototype.ondestruct.call(this),this._observer&&this._observer.disconnect()},onrender:function(){ts.ui.Spirit.prototype.onrender.call(this),this._confirmpanel(),this._reflex()},onflex:function(){ts.ui.Spirit.prototype.onflex.call(this),this._reflex()},ontick:function(t){ts.ui.Spirit.prototype.ontick.call(this,t),!this.$destructed&&"ts-sideshow-theme"===t.type&&this.dom.embedded()&&(this._theme=this._theme||this._extractcolor("ts-bg-blue"),this._transfercolor(this._theme,this.constructor.$bgmembers),this._themesupport(this.dom),this.tick.remove(t.type))},onevent:function(e){switch(ts.ui.Spirit.prototype.onevent.call(this,e),e.type){case"DOMSubtreeModified":this._reflex();break;case"transitionend":this._flipping&&this._ontransitionend(ts.ui.get(e.target))}},onaction:function(a){switch(ts.ui.Spirit.prototype.onaction.call(this,a),a.type){case PANEL_ATTACH:case PANEL_DETACH:var panel=a.target,added=a.type===PANEL_ATTACH;panel.label&&this._updatetab(panel,added),a.consume()}},onchange:function(changes){ts.ui.Spirit.prototype.onchange.call(this,changes);var splice=edb.ArrayChange.TYPE_SPLICE;changes.filter(function(c){return c.type===splice&&ts.ui.TabCollection.is(c.object)}).forEach(function(c){0===c.object.length&&this._removetabbar()},this)},title:chained(function(title){var header=this._headerspirit();if(!arguments.length)return header.title();this._reflex(function(){header.title(title)})}),search:chained(function(search){var header=this._headerspirit();if(!arguments.length)return header.search();header.search(search)}),header:function(opt_json){return this._headerspirit().model(opt_json)},open:chained(function(opt_open){this.doorman.open(opt_open)}),close:chained(function(){this.doorman.open(!1)}),toggle:chained(function(){this.open(!this.isOpen)}),flip:function(){this.action.dispatch("FLIP",this.flipped)},tabs:chained(function(){var tabbar=this._tabbarspirit();if(!arguments.length)return tabbar.tabs();tabbar.tabs.apply(tabbar,arguments)}),$onopen:function(){},$onclose:function(){},$flip:function(){return this._flipping||(this._flipping=new gui.Then,this.event.add("transitionend"),this.css.remove("ts-flipped").add("ts-flipping"),this.tick.time(function(){this.css.add(this.flipped?"ts-flip-in":"ts-flip-out")})),this._flipping},_theme:null,_tabbar:null,_observer:null,flipping:!1,_canclose:!1,_reflex:function(action){var panel,avail=this.box.height,height=0,thing=action?action.call(this):null;if(this.isOpen&&avail){var asides=[];this.dom.children(gui.Spirit).forEach(function(spirit){ts.ui.PanelSpirit.is(spirit)&&spirit.visible?panel=spirit:ts.ui.AsideSpirit.is(spirit)?asides.push(spirit):height+=spirit.box.height}),panel&&(panel.css.height=avail-height),asides.forEach(function(aside){aside._reflex()})}return thing},_confirmpanel:function(){if(!this.dom.q(".ts-panel",ts.ui.PanelSpirit))throw new Error("Expected a Panel")},_confirmposition:function(){if(!this.guilayout.outsideMain())throw new Error(this+" must be positioned outside Main",this.element)},_headerspirit:function(){return this.dom.q("this > .ts-header",ts.ui.ToolBarSpirit)||this._reflex(function(){var header=ts.ui.ToolBarSpirit.summon("header","ts-header");return this.dom.prepend(header),this._fixappearance(),header})},_tabbarspirit:function(){return this._tabbar||(this._tabbar=function(){var panel=this.dom.q("this > .ts-panel",ts.ui.PanelSpirit);return this._fixappearance(),this.css.add("ts-has-panels"),this._reflex(function(){var tabbar=ts.ui.TabBarSpirit.summon();return tabbar.tabs().addObserver(this),panel.dom.before(tabbar)})}.call(this))},_initfooter:function(Observer){var footer=this.dom.q(".ts-footer");footer&&(Observer?(this._observer=new Observer(function(){this._reflex()}.bind(this)),this._observer.observe(footer,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):this.event.add("DOMSubtreeModified",footer,this))},_ontransitionend:function(spirit){ts.ui.PanelSpirit.is(spirit)&&(this.event.remove("transitionend"),this.css.remove("ts-flipping ts-flip-in ts-flip-out"),this.css.contains("ts-flip-init")?this.css.remove("ts-flip-init").add("ts-flipped"):(this.flipped=!this.flipped,this.css.shift(this.flipped,"ts-flipped")),this._flipping.now(),this._flipping=null)},_closebutton:function(show){var that=this,tool=this._headerspirit();!1!==show?(this._canclose=!0,tool.showClose(function(){that.close()})):this._canclose&&(this._canclose=!1,tool.hideClose(),this.tick.time(function(){tool.life.hascontent||this.reflex(function(){tool.dom.remove(),this._fixappearance()},this)},50))},_initspin:function(busy){if(this.spin||(this.spin=ts.ui.SpinnerSpirit.summon()),busy){var opts={message:busy,top:"226px"};this.spin.spin(this.element,opts)}else this.spin.stop()},_inittabs:function(){var panels=this.dom.children(ts.ui.PanelSpirit);panels.length>1&&(panels.every(function(panel){return!!panel.label})?this._setuptabs(panels,this):console.warn("(Multiple) Panels in Aside must have a label in order to create the TabBar"))},_setuptabs:function(panels,that){var tabbar=this._tabbarspirit();panels.forEach(function(panel,index){tabbar.tabs().push({label:panel.label,selected:0===index,$onselect:function(){that.$destructed||(that.dom.children(ts.ui.PanelSpirit).forEach(function(p){p===panel?(p.show(),p.$onselect()):p.hide()}),that._reflex())}})})},_removetabbar:function(){var bar=this._tabbar;bar&&this._reflex(function(){bar.dom.remove(),bar.tabs().removeObserver(this),this.css.remove("ts-has-panels"),this._tabbar=null})},_updatetab:function(panel,added){var bar=this._tabbar,dom=this.dom,index=dom.children(ts.ui.PanelSpirit).indexOf(panel);bar&&(added?(0!==index&&panel.hide(),bar.tabs().splice(index,0,{label:panel.label,selected:panel.selected,$onselect:function(){dom.children(ts.ui.PanelSpirit).forEach(function(p){p===panel?(p.show(),p.$onselect()):p.hide()})}})):(bar.tabs().splice(index,1).forEach(function(tab){if(tab.selected){var selectedindex=index?index-1:index;bar.tabs()[selectedindex].select()}tab.dispose()}),1===bar.tabs().length&&this._removetabbar()),bar.$hascontent())},_fixappearance:function(){var tick="ts-sideshow-theme";this.tick.add(tick).dispatch(tick)},_extractcolor:function(color){return this._ismodelled()&&this._model.color?color=function(c){return c.match(/ts-bg-lite|ts-bg-white/)?"ts-bg-blue":c}(this._model.color):GuiObject.each(Colors,function(key,value){this.css.contains(value)&&this.css.remove(color=value)},this),color},_transfercolor:function(color,selectors){var dom=this.dom;selectors.forEach(function(selector){dom.qall(selector,ts.ui.Spirit).filter(function(){return!0}).forEach(function(spirit){switch(selector){case".ts-header":case".ts-tabbar":spirit.css.remove(BGCOLORS).add(color),spirit._ismodelled()&&(spirit._model.color=color);break;default:spirit.css.name().includes("ts-bg")||spirit.css.add(color)}})})},_themesupport:function(dom){var shade=Parser.parseToNode('<div class="ts-shadow"></div>'),panel=dom.q("this > .ts-panel",ts.ui.PanelSpirit),headr=dom.q("this > .ts-header",ts.ui.ToolBarSpirit),footr=dom.q("this > .ts-footer",ts.ui.AsideFooterSpirit),tabbs=dom.q("this > .ts-tabbar",ts.ui.TabBarSpirit);if(panel){var color=getcolor(panel)||"ts-bg-white";dom.qall(".ts-shadow").forEach(function(shadow){shadow.parentNode.removeChild(shadow)}),tabbs&&getcolor(tabbs)!==color?tabbs.white():[tabbs,headr].every(function(thing){return thing&&getcolor(thing)===color})?(panel.dom.before(shade.cloneNode()),headr.css.add("ts-inset")):headr&&getcolor(headr)===color&&panel.dom.before(shade.cloneNode()),footr&&getcolor(footr)===color&&footr.dom.before(shade.cloneNode())}},_execute:function(callback){if(callback=this[callback])switch(gui.Type.of(callback)){case"string":return new Function(callback).call(this);case"function":return callback.call(this)}return!0}},{$bgmembers:[".ts-header"]})}(gui.Combo.chained,gui.Client,gui.HTMLParser,gui.Object,ts.ui.BACKGROUND_COLORS,ts.ui.ACTION_PANEL_ATTACH,ts.ui.ACTION_PANEL_DETACH),ts.ui.AsideSpirit=function(chained,confirmed,Client,LayoutModel,notontouch){var willopen=ts.ui.ACTION_ASIDE_WILL_OPEN,didopen=ts.ui.ACTION_ASIDE_DID_OPEN,willclose=ts.ui.ACTION_ASIDE_WILL_CLOSE,didclose=ts.ui.ACTION_ASIDE_DID_CLOSE,doclose=ts.ui.BROADCAST_GLOBAL_ASIDES_DO_CLOSE,synctomenu=ts.ui.BROADCAST_PANEL_SYNC_MENU,classopening=ts.ui.CLASS_OPENING,classopen=ts.ui.CLASS_OPEN,classclosing=ts.ui.CLASS_CLOSING,classclosed=ts.ui.CLASS_CLOSED;return ts.ui.SideShowSpirit.extend({autofocus:!0,onconfigure:function(){ts.ui.SideShowSpirit.prototype.onconfigure.call(this),this._ismodelled()&&(this._model.addObserver(this),this.broadcast.add(synctomenu),this.autofocus=this._model.autofocus,this.script.load(ts.ui.AsideSpirit.edbml),this.script.input(this._model),this.dom.q(".ts-panel",ts.ui.PanelSpirit).exorcise()),this._position(100),this.dom.hide()},onready:function(){ts.ui.SideShowSpirit.prototype.onready.call(this),this.dom.q("this > .ts-footer")&&this.css.add("ts-hasfooter")},onvisible:function(){ts.ui.SideShowSpirit.prototype.onvisible.call(this),this.reflex()},onaction:function(a){switch(ts.ui.SideShowSpirit.prototype.onaction.call(this,a),a.type){case ts.ui.ACTION_CLOSE:this.isOpen&&this.open(!1),a.consume()}},onbroadcast:function(b){switch(ts.ui.SideShowSpirit.prototype.onbroadcast.call(this,b),b.type){case synctomenu:this._maybesynctomenu(b.data.menuid,b.data.offset);break;case doclose:this._isSideBarAside()||this.close()}},_maybesynctomenu:function(menuid,offset){this._model.items.some(function(item){return item.$instanceid===menuid})&&(this.dom.q(".ts-panel").scrollTop=offset)},onkey:function(k){ts.ui.SideShowSpirit.prototype.onkey.call(this,k),k.down&&"Esc"===k.type&&this.open(!1)},onchange:function(changes){if(ts.ui.SideShowSpirit.prototype.onchange.call(this,changes),!this.$destructed){var asides=LayoutModel.output.get().asides,id=this.$instanceid;changes.forEach(function(c){switch(c.object){case asides:var klass=ts.ui.CLASS_SECONDARY,stacked=this.css.contains(klass);this._index=asides.indexOf(id);var x=asides.length-this._index-1;x>0?stacked||this._stack(!0):stacked&&this._stack(!1),this.css.shift(x>0,klass);break;case this._model:this._onmodelchange(c.name,c.newValue)}},this)}},ondetach:function(){ts.ui.SideShowSpirit.prototype.ondetach.call(this),this._isreallyopen&&(this._updateworld(willclose),this._updateworld(didclose))},ondestruct:function(){ts.ui.SideShowSpirit.prototype.ondestruct.call(this),this._ismodelled()&&this._model.removeObserver(this)},focus:notontouch(function(){this._focusbest()}),_model:null,_index:-1,_offset:0,_width:0,_isreallyopen:!1,_suspendopen:!1,_hackInitialized:!1,_isSideBarAside:function(){return!!this.css.matches(".ts-sidebar .ts-aside")},_slideopen:function(open,callback){function getoffset(now){return deg=now/(end/90),deg=deg*Math.PI/180,100*(off=open?Math.sin(deg):Math.cos(deg))}var deg,off,then=new gui.Then,tick=this.tick,end=ts.ui.TRANSITION_FAST;return tick.time(function(){var time=0;tick.nextFrame(function paint(stamp){if(!this.$destructed)if(time){var now=stamp-time,pct=getoffset(now);now<end?(this._position(100-pct),tick.nextFrame(paint)):(this._position(open?0:100),then.now())}else time=stamp,tick.nextFrame(paint)})},ts.ui.TRANSITION_DELAY),then},_stack:function(stack){this._slideopen(!stack)},_position:function(pct){Client.isExplorer?(this._width=this._width||this.box.width,this.css.set("right",pct/-100*this._width+"px")):this.css.set("-beta-transform","translate3d("+pct+"%,0,0)")},_reflex:function(action){var thing;return this.css.contains("ts-hasfooter")?thing=ts.ui.SideShowSpirit.prototype._reflex.call(this,action):action&&(thing=action.call(this)),thing},_delayedAngularInitialization:function(){this._hackInitialized||(this._hackInitialized=!0,this._closebutton())},$onopen:function(animated){this._delayedAngularInitialization(),this._trapattention(),this._willopen(),this._slideopen(!0).then(function(){this._ontransitionend()}.bind(this))},$onclose:function(animated){this._willclose(),this._slideopen(!1).then(function(){this._ontransitionend()}.bind(this))},_onmodelchange:function(name,value){switch(name){case"gofocused":this.focus();break;case"suspendopen":this._suspendopen&&!1===value&&(this._suspendopen=!1,this._didopen())}},_ontransitionend:function(){this.isOpen?(this.css.remove(classopening).add(classopen),this._didopen()):(this.css.remove(classclosing).add(classclosed),this._didclose())},_trapattention:function(){this.attention.trapping||this.attention.trap(this.dom.q(".ts-panel"))},_willopen:function(){var index=0;this._confirmposition(),this._isreallyopen=!0,this.dom.show(),this.guistatus.busy("opening aside"),this._updateworld(willopen),this._register(!0),this._isSideBarAside()&&this._themesupport(this.dom),(index=this._zindex())&&(this.css.zIndex=index),this._ismodelled()&&(this._model.status="onopen")},_didopen:function(){if(this._ismodelled()){var model=this._model;if("onopen"===model.status&&model.suspendopen)return model.status="onbeforeopened",void(this._suspendopen=!0)}this._updateworld(didopen),this.action.add(ts.ui.ACTION_CLOSE),this.broadcast.addGlobal(doclose),this.key.addGlobal("Esc"),this.css.add(ts.ui.CLASS_OPEN),this.guistatus.done("opening aside"),this.doorman.didopen(),this.autofocus&&this.focus(),LayoutModel.output.get().asides.addObserver(this),this._ismodelled()&&(this._model.status="onopened")},_willclose:function(){this.guistatus.busy("closing aside"),this._updateworld(willclose),this.action.remove(ts.ui.ACTION_CLOSE),this.broadcast.removeGlobal(doclose),this.key.removeGlobal("Esc"),this._register(!1),this._ismodelled()&&(this._model.status="onclose")},_didclose:function(){var panel=this.dom.q(".ts-panel");this._isreallyopen=!1,this._offset=0,this.dom.hide(),this._updateworld(didclose),this.guistatus.done("closing aside"),this.att.del("data-ts-offset"),this.attention.exit(panel),this.css.remove(ts.ui.CLASS_SECONDARY),this.doorman.didclose(),this._ismodelled()&&(this._model.status="onclosed")},_register:chained(function(open){var asides=LayoutModel.output.get().asides,id=this.$instanceid;open?asides.push(id):(gui.Array.remove(asides,asides.indexOf(id)),asides.removeObserver(this)),this._index=asides.indexOf(id)}),_updateworld:function(type){this.action.dispatch(type)},_focusbest:notontouch(function(){var elm;if(!["[autofocus]",".ts-checked button"].some(function(selector){return(elm=this.dom.q(selector))&&elm.focus(),!!elm},this)){var panel=this.dom.q(".ts-panel");this.attention.enter(panel)||(panel.tabIndex=0,panel.focus())}}),_zindex:function(){return this._index+(this._isSideBarAside()?0:ts.ui.ZINDEX_ASIDE)},_confirmposition:function(){if(this._isSideBarAside()){var panel=this.dom.parent(ts.ui.PanelSpirit);if(panel&&this.dom.containedBy(panel))throw new Error("In the SideBar, Aside must be positioned outside the ts-panel",this.element)}else ts.ui.SideShowSpirit.prototype._confirmposition.call(this)}},{OFFSET_AMOUNT:3,summon:confirmed("(object)")(function(opt_model){var html=ts.ui.aside.edbml(opt_model),elem=gui.HTMLParser.parse(html);return this.possess(elem)})})}(gui.Combo.chained,gui.Arguments.confirmed,gui.Client,ts.ui.LayoutModel,function(base){return function(){gui.Client.isTouchDevice||base.apply(this,arguments)}}),ts.ui.SideBarSpirit=function(chained,Type,Client,GuiObject,Colors){var willopen=ts.ui.ACTION_ASIDE_WILL_OPEN,didopen=ts.ui.ACTION_ASIDE_DID_OPEN,willclose=ts.ui.ACTION_ASIDE_WILL_CLOSE,didclose=ts.ui.ACTION_ASIDE_DID_CLOSE;return ts.ui.SideShowSpirit.extend({isOpen:!0,autoclose:{getter:function(){return this._autoclose},setter:function(autoclose){Type.isBoolean(Type.cast(autoclose))&&(this.css.shift(autoclose,"ts-autoclose"),this._autoclose=!!autoclose,this.life.ready&&(this._autoclose?ts.ui.isMobilePoint()&&this._breakpoint():(this._closebutton(!1),this.isOpen=!0,this.reflex())))}},onconfigure:function(){ts.ui.SideShowSpirit.prototype.onconfigure.call(this),this.action.add([willopen,didopen,willclose,didclose])},onattach:function(){ts.ui.SideShowSpirit.prototype.onattach.call(this),this.action.dispatch("ts-action-attach"),this._layoutmain(!0),ts.ui.isMobilePoint()?this._breakpoint():this._reflex()},onenter:function(){ts.ui.SideShowSpirit.prototype.onenter.call(this),this._breakpointwatch(),this.css.shift(this._autoclose,"ts-autoclose")},ondetach:function(){ts.ui.SideShowSpirit.prototype.ondetach.call(this),this._layoutmain(!1)},onready:function(){ts.ui.SideShowSpirit.prototype.onready.call(this),this.input.connect(ts.ui.TopBarModel),this.tick.time(function(){this._confirmposition()},1e3)},oninput:function(i){ts.ui.SideShowSpirit.prototype.oninput.call(this,i),i.type===ts.ui.TopBarModel&&i.data.addObserver(this)},onchange:function(changes){ts.ui.SideShowSpirit.prototype.onchange.call(this,changes),changes.forEach(function(change){ts.ui.TopBarModel.is(change.object)&&"hascontent"===change.name&&this._reflex()},this)},onaction:function(a){switch(ts.ui.SideShowSpirit.prototype.onaction.call(this,a),a.type){case willopen:this._fitaside(a.target,this.dom.qall(".ts-footer",ts.ui.AsideFooterSpirit)),a.consume();break;case didopen:case willclose:case didclose:a.consume()}},ondestruct:function(){ts.ui.SideShowSpirit.prototype.ondestruct.call(this),ts.ui.removeBreakPointListener(this)},$onopen:function(){this.css.add(ts.ui.CLASS_OPENING),this._reflex(),this.tick.time(function(){this.css.add(ts.ui.CLASS_OPEN)})},$onclose:function(){this.css.remove(ts.ui.CLASS_OPEN),this.tick.time(function(){this.css.remove(ts.ui.CLASS_OPENING)},ts.ui.TRANSITION_FAST)},_autoclose:!0,_fixappearance:function(){ts.ui.SideShowSpirit.prototype._fixappearance.call(this);var has3D=gui.Client.has3D;this.css.shift(has3D,"ts-3d").shift(!has3D,"ts-2d")},_layoutmain:function(attaching){var layout=this.guilayout;if(layout.outsideMain()){layout.beforeMain()?(this.css.shift(attaching,"ts-sidebar-first"),layout.shiftGlobal(attaching,"ts-has-sidebar-first")):(this.css.shift(attaching,"ts-sidebar-last"),layout.shiftGlobal(attaching,"ts-has-sidebar-last"))}},_breakpointwatch:function(){ts.ui.addBreakPointListener(function(){this._breakpoint()}.bind(this))},_breakpoint:function(){var go=ts.ui.isMobilePoint();this._autoclose&&(this._closebutton(go),go?this.isOpen&&(this.close(),this.isOpen=!1):this.isOpen||(this.isOpen=!0,this.guilayout.flexGlobal()))},_fitaside:function(aside,footers){footers.length&&(aside.css.bottom=footers.reduce(function(totalheight,footer){return totalheight+footer.box.height},0))}},{$bgmembers:[".ts-header",".ts-tabbar",".ts-panel",".ts-footer"]})}(gui.Combo.chained,gui.Type,gui.Client,gui.Object,ts.ui.BACKGROUND_COLORS),ts.ui.PanelSpirit=function(chained,ACTION_ATTACH,ACTION_DETACH,ACTION_SHOW,ACTION_HIDE,ACTION_CLASS){return ts.ui.Spirit.extend({label:null,selected:!1,icon:null,visible:!0,onselect:null,onunselect:null,onconfigure:function(){ts.ui.Spirit.prototype.onconfigure.call(this),this.action.add([ACTION_ATTACH,ACTION_SHOW,ACTION_HIDE,ACTION_CLASS])},onattach:function(){ts.ui.Spirit.prototype.onattach.call(this),this.action.dispatch(ACTION_ATTACH,this._isroot())},ondetach:function(){ts.ui.Spirit.prototype.ondetach.call(this),this.action.dispatch(ACTION_DETACH,this._isroot())},onaction:function(a){switch(a.type){case ACTION_ATTACH:case ACTION_SHOW:case ACTION_HIDE:a.consume();break;case ACTION_CLASS:this._isroot()&&(a.data.relatedPanel=this);break;case ts.ui.ACTION_STATUSBAR_LEVEL:a.target.guilayout.outsideMain()&&this.guilayout.gotolevel(a.data)}},show:function(){this.visible=!0,this.dom.show(),this.reflex(),this.action.dispatch(ACTION_SHOW,this._isroot())},hide:function(){this.dom.hide(),this.visible=!1,this.action.dispatch(ACTION_HIDE,this._isroot())},naturalHeight:function(){return this.element.scrollHeight},hasOverflow:function(){return this.naturalHeight()>this.element.offsetHeight},childMain:function(){return this.dom.child(ts.ui.MainSpirit)},parentMain:function(){return this.dom.ancestor(ts.ui.MainSpirit)},busy:chained(function(){console.log("busy",this._cover().$instanceid),this._cover().show()}),done:chained(function(){console.log("Done",this._cover().$instanceid),this._cover().hide()}),spin:chained(function(message){this._cover().spin(message),this.busy()}),stop:chained(function(){this._cover().stop(),this.done()}),$onselect:function(){if(!this.selected)switch(this.selected=!0,gui.Type.of(this.onselect)){case"function":this.onselect();break;case"string":new Function(this.onselect).call(this)}},$onunselect:function(){if(this.selected)switch(this.selected=!1,gui.Type.of(this.onunselect)){case"function":this.onunselect();break;case"string":new Function(this.onunselect).call(this)}},_cover:function(){var Cover=ts.ui.CoverSpirit;return this.dom.child(Cover)||this.dom.append(Cover.summon())},_isroot:function(){return this.dom.parent()===document.body}})}(gui.Combo.chained,ts.ui.ACTION_PANEL_ATTACH,ts.ui.ACTION_PANEL_DETACH,ts.ui.ACTION_PANEL_SHOW,ts.ui.ACTION_PANEL_HIDE,ts.ui.ACTION_ROOT_CLASSNAMES),ts.ui.AsideFooterSpirit=ts.ui.Spirit.extend(),ts.ui.ButtonSpirit=function(chained,Client,Type,CSSPlugin,ie9){var classnames=[ts.ui.CLASS_PRIMARY,ts.ui.CLASS_SECONDARY,ts.ui.CLASS_TERTIARY,ts.ui.CLASS_DANGER],CLASS_READY=ts.ui.CLASS_READY,CLASS_LOADING=ts.ui.CLASS_IS_LOADING;return ts.ui.Spirit.extend({type:null,data:null,busy:chained(function(busy){busy=!arguments.length||busy;var css=this.css;Type.isString(busy)&&busy.trim().startsWith("{")||(ie9?this.element.disabled=!!busy:busy?(this._busymessage(busy),css.remove(CLASS_READY).add(CLASS_LOADING)):css.contains(CLASS_LOADING)&&(css.remove(CLASS_LOADING),this._nomorebusy(function(){css.shift(!css.contains(CLASS_LOADING),CLASS_READY)})))}),done:chained(function(){this.busy(!1)}),onconfigure:function(){ts.ui.Spirit.prototype.onconfigure.call(this),this.att.add("tabindex"),this.event.add("click dragstart"),Client.isTouchDevice||this.event.add("mousedown focus blur"),this.type===ts.ui.ACTION_SAFE_LINK&&this.data&&/^http(s?):\/\//.test(this.data)&&(this.element.target="_blank",this.element.rel="noopener",this.element.href=this.data)},onenter:function(){ts.ui.Spirit.prototype.onenter.call(this);var elm=this.element;this._keyboardclass(),this._defaultclass(this.element.parentNode.parentNode),this._defaulttype(elm.localName,this.att.get("type"),this.att.get("href"))},onasync:function(){ts.ui.Spirit.prototype.onasync.call(this),this.css.add(CLASS_READY)},onatt:function(a){ts.ui.Spirit.prototype.onatt.call(this,a),"tabindex"===a.name&&this._keyboardclass(a.value)},onevent:function(e){ts.ui.Spirit.prototype.onevent.call(this,e);var busy=this.css.contains(CLASS_LOADING);switch(e.type){case"mousedown":busy||(this._depressing=!0,this.tick.time(function(){this._depressing=!1}));break;case"focus":this._focusclass(!0,!this._depressing);break;case"blur":this._focusclass(!1);break;case"click":busy||(this._depressing=!1,this._dispatchaction(),this._focusclass(!0,!0));break;case"dragstart":e.preventDefault()}},icon:chained(function(classname){(this.dom.q("i")||this.dom.append(document.createElement("i"))).className=classname}),text:chained(function(text){var span=this.dom.q("span");if(!arguments.length)return span?span.textContent:null;(span=span||this.dom.append(document.createElement("span"))).textContent=text}),disable:chained(function(){this.element.disabled=!0}),enable:chained(function(){this.element.disabled=!1}),_depressing:!1,_donelabel:null,_defaulttype:function(name,type,href){"button"!==name||type?"a"!==name||href||(this.element.href=ts.ui.ButtonSpirit.HREF_DEFAULT):this.element.type="button"},_defaultclass:function(ancestor){ancestor&&CSSPlugin.contains(ancestor,"ts-buttons")&&(classnames.some(function(name){return this.css.contains(name)},this)||this.css.add(ts.ui.CLASS_TERTIARY))},_keyboardclass:function(){var ok=ts.ui.ButtonSpirit.hasfocusstyling&&this._isfocusable();this.css.shift(!ok,"ts-active").shift(!ok,"ts-nofocus")},_isfocusable:function(){return this.element.tabIndex>=0},_isnavigatable:function(){var elm=this.element,href=elm.href;return href&&!href.startsWith("javascript:")&&!elm.download},_focusclass:function(is,keyboard){this._isfocusable()&&(is?keyboard&&this.css.add("ts-active"):this.css.remove("ts-active"))},_dispatchaction:function(){this.action.dispatch(this.type||ts.ui.ACTION_CLICK,this.data)},_busymessage:function(message){Type.isString(message)&&(this.css.add("ts-loading-message"),this._donelabel=this.text(),this.text(message))},_nomorebusy:function(cb){this._donelabel&&(this.css.remove("ts-loading-message"),this.text(this._donelabel),this._donelabel=null),this.tick.time(function(){this.$destructed||cb.call(this)},50)}},{HREF_DEFAULT:"javascript:void(false);",summon:function(doc,config){var spirit=this.possess(doc.createElement("button"));return config&&gui.Object.each(config,function(key,value){switch(key){case"type":spirit.type=value;break;case"data":spirit.data=value;break;case"icon":spirit.icon(value)}}),spirit},getButton:function(elm,stop){for(;"button"!==elm.localName&&(elm=elm.parentNode);)if(stop&&elm===stop)return null;return elm},getSpirit:function(elm,stop){return(elm=this.getbutton(elm,stop))?ts.ui.get(elm):null}},{hasfocusstyling:!Client.isSafari&&!Client.isTouchDevice})}(gui.Combo.chained,gui.Client,gui.Type,gui.CSSPlugin,gui.Client.isExplorer9),ts.ui.ButtonMenuSpirit=ts.ui.Spirit.extend({onconstruct:function(){ts.ui.Spirit.prototype.onconstruct.call(this),ts.ui.CoreModule.channelComplexSelectors(!this.css.contains(ts.ui.CLASS_OPTIMIZED))}}),ts.ui.LinkSpirit=ts.ui.ButtonSpirit.extend({onconstruct:function(){ts.ui.ButtonSpirit.prototype.onconstruct.call(this),console.error("Deprecated spirit is deprecated: "+this,this)}}),ts.ui.CoverSpirit=function(chained,Client){var MOUSE_EVENTS=Client.isTouchDevice?"touchstart mouseenter":"mousedown mouseenter";return ts.ui.Spirit.extend({onconfigure:function(){ts.ui.Spirit.prototype.onconfigure.call(this),this.css.add(ts.ui.CLASS_COVER)},show:chained(function(){this.event.add(MOUSE_EVENTS),this.dom.show()}),hide:chained(function(){this.event.remove(MOUSE_EVENTS),this.dom.hide()}),spin:chained(function(message){this._spinner=this._spinner||ts.ui.SpinnerSpirit.summon(),this._spinner.spin(this.element,{message:message||""})}),stop:chained(function(){this._spinner&&this._spinner.stop()}),shift:chained(function(show){show?this.show():this.hide()}),position:chained(function(geo){this.css.style({top:geo.y,left:geo.x,width:geo.w,height:geo.h})}),fadeIn:function(){this.show(),this._shouldbevisible=!0,this._usetransitions&&(this.css.add(ts.ui.CLASS_TRANSITION),this.event.add("transitionend"),this.tick.time(function(){this.css.add(ts.ui.CLASS_VISIBLE)},ts.ui.TRANSITION_DELAY))},fadeOut:function(){this._shouldbevisible=!1,this._usetransitions?(this.event.add("transitionend"),this.tick.time(function(){this.css.remove(ts.ui.CLASS_VISIBLE)},ts.ui.TRANSITION_DELAY)):this.hide()},onevent:function(e){ts.ui.Spirit.prototype.onevent.call(this,e);var id=this.element.id;switch(e.type){case"mousedown":case"touchstart":id&&this.broadcast.dispatchGlobal(ts.ui.BROADCAST_GLOBAL_COVER_TOUCH,id);break;case"mouseenter":id&&this.broadcast.dispatchGlobal(ts.ui.BROADCAST_GLOBAL_COVER_HOVER,id);break;case"transitionend":e.target===this.element&&(this.event.remove(e.type),this._shouldbevisible||this.hide())}},_spinner:null,_usetransitions:ts.ui.usetransitions,_shouldbevisible:!1},{summon:function(opt_geo){var spirit=this.possess(document.createElement("div"));return spirit.css.add(ts.ui.CLASS_COVER),opt_geo&&spirit.position(opt_geo),spirit},getCover:function(token,target){return gui.DOMPlugin.qdoc("."+token,this)||function(){var spirit=ts.ui.CoverSpirit.summon();return spirit.dom.appendTo(target||document.body),spirit.css.add(token),spirit.dom.id(token),spirit}()}})}(gui.Combo.chained,gui.Client),ts.ui.DialogSpirit=function(Dialog,Client,chained,Type){var willopen=ts.ui.BROADCAST_DIALOG_WILL_OPEN,goopen=ts.ui.BROADCAST_DIALOG_GO_OPEN,didopen=ts.ui.BROADCAST_DIALOG_DID_OPEN,willclose=ts.ui.BROADCAST_DIALOG_WILL_CLOSE,didclose=ts.ui.BROADCAST_DIALOG_DID_CLOSE;return ts.ui.Spirit.extend({isOpen:!1,time:Dialog.DEFAULT_TIME,icon:null,blocking:{getter:function(){return!!this._buttons()}},onconfigure:function(){ts.ui.Spirit.prototype.onconfigure.call(this),this.css.add(ts.ui.CLASS_DIALOG),this._transition&&this.css.add(ts.ui.CLASS_TRANSITION),this.dom.hide()},ondestruct:function(){ts.ui.Spirit.prototype.ondestruct.call(this),this.isOpen&&this.broadcast.dispatch(didclose)},onready:function(){ts.ui.Spirit.prototype.onready.call(this),this._ismodelled()&&this._setupmodel(),this.isOpen&&this.open(!0,!0)},onaction:function(a){switch(ts.ui.Spirit.prototype.onaction.call(this,a),a.type){case ts.ui.ACTION_SAFE_LINK:this._ismodelled()&&Type.isFunction(this._model.onlink)&&this._model.onlink(a.data)}},open:chained(function(opt_open,opt_force){Type.isBoolean(opt_open)&&!opt_force||(opt_open=!0),this.att.set("gui.open",opt_open),opt_open?this.isOpen&&!opt_force||(this.isOpen=!0,this._open(this.life.async)):this.isOpen&&(this.isOpen=!1,this._close(this.life.async))}),close:chained(function(){this.open(!1)}),cancel:chained(function(){var model=this._model;model&&model.oncancel?model.oncancel.call(model):this.close()}),onevent:function(e){switch(ts.ui.Spirit.prototype.onevent.call(this,e),e.type){case"transitionend":e.target===this.element&&(this.event.remove(e.type),this._ontransitionend(),e.stopPropagation());break;case"click":this.blocking||(this.event.remove(e.type),this._ismodelled()?this._model.accept():this.accept())}},suspend:function(){this._suspended=!0},unsuspend:function(){this._suspended=!1,this._goopen()},onkey:function(k){if(ts.ui.Spirit.prototype.onkey.call(this,k),k.down&&"Esc"===k.type&&this._ismodelled()){var model=this._model,buttons=model.buttons,cancel=buttons.get("cancel");buttons.length&&cancel?model.cancel():model.accept()}},_model:null,_timeout:-1,_suspended:!1,_transition:gui.Client.hasTransitions,_setupmodel:function(){this.action.add(ts.ui.ACTION_SAFE_LINK),gui.Object.nonmethods(this._ismodelled()).forEach(function(key){void 0!==this[key]&&(this[key]=this._model[key])},this),this.script.load(ts.ui.DialogSpirit.edbml).input(this._model)},_open:chained(function(animated){var oldie=Client.isExplorer9||Client.isExplorer10;this.blocking||this.css.add(ts.ui.CLASS_NONBLOCKING),this._ismodelled()&&this._model.$finalize(),this.tick.time(function(){this._willopen()},oldie?100:10)}),_close:chained(function(animated){this._willclose()}),_willopen:function(){if(this._trapattention(),this._ismodelled())switch(this._model.type){case Dialog.INFO:case Dialog.CONFIRM:this.css.add("ts-bg-darkened");break;case Dialog.SUCCESS:this.css.add("ts-bg-green");break;case Dialog.WARNING:this.css.add("ts-bg-yellow");break;case Dialog.ERROR:case Dialog.DANGER:this.css.add("ts-bg-red")}this.broadcast.dispatch(willopen),this._suspended||this._goopen()},_goopen:function(){var model=this._model;this.broadcast.dispatch(goopen),this.dom.show(),this._transition?this.tick.time(function(){this.event.add("transitionend"),this.css.add(ts.ui.CLASS_OPENING)},ts.ui.TRANSITION_NOW):this._didopen(),this._ismodelled()&&(model.state="onopen",this._doclassnames(this._model),this._focusdefault(this._buttons()))},_didopen:function(){if(this.css.remove(ts.ui.CLASS_OPENING).add(ts.ui.CLASS_OPEN),this.broadcast.dispatch(didopen),this.key.addGlobal("Esc"),!this.blocking){this.event.add("click");var time=this._ismodelled()?this._model.time:this.time;this._timeout=this.tick.time(function(){this.close()},time)}this._ismodelled()&&(this._model.state="onopened")},_willclose:function(){this.tick.cancelTime(this._timeout),this.broadcast.dispatch(willclose),this.event.remove("click"),this.key.removeGlobal("Esc"),this._transition?(this.event.add("transitionend"),this.css.remove(ts.ui.CLASS_OPEN).add(ts.ui.CLASS_CLOSING)):this._didclose(),this._ismodelled()&&(this._model.state="onclose")},_didclose:function(){if(this.broadcast.dispatch(didclose),this.css.remove([ts.ui.CLASS_OPEN,ts.ui.CLASS_CLOSING]),this.attention.exit(),this.dom.remove(),this._ismodelled()){var model=this._model;model.state="onclosed",this.tick.time(function(){model.dispose()})}},_ontransitionend:function(){this.isOpen?this._didopen():this._didclose()},_doclassnames:function(model){var count=model.buttons.length;this.css.add(model.type).shift(model.icon,"ts-hasicon").shift(count,"ts-hasbuttons").shift(count>1,"ts-hasmorebuttons")},_trapattention:function(){var buttons=this._buttons();buttons&&!this.attention.trapping&&this.attention.trap(buttons)},_focusdefault:function(buttons){var button;buttons&&(button=buttons.querySelector("[autofocus]"))&&button.focus()},_buttons:function(index){var result=this.dom.q(".ts-dialog-buttons .ts-buttons");return result&&arguments.length&&(result=result.querySelectorAll(".ts-button")[index]),result}},{summon:function(opt_model){var spirit=this.possess(document.createElement("div"));return spirit._model=opt_model||null,spirit}})}(ts.ui.Dialog,gui.Client,gui.Combo.chained,gui.Type),ts.ui.MenuSpirit=function(Type,ButtonSpirit){return ts.ui.Spirit.extend({onready:function(){ts.ui.Spirit.prototype.onready.call(this),gui.Client.isTouchDevice||this.event.add("focus blur",this,this,!0),this._ismodelled()&&this.event.add("click")},onevent:function(e){switch(ts.ui.Spirit.prototype.onevent.call(this,e),e.type){case"focus":this.event.add("keydown",document);break;case"blur":this.event.remove("keydown",document);break;case"keydown":this._onkey(e);break;case"click":this._ismodelled()&&this._onclick(e.target)}},_model:null,_onkey:function(e){var button=document.activeElement;switch(e.keyCode){case 38:case 40:var item=button.parentNode;this._movefocus(item,40===e.keyCode),e.preventDefault()}},_onclick:function(elm){var button=ButtonSpirit.getButton(elm);if((!button||!button.disabled)&&this._ismodelled()){for(var item=elm,model=this._model;item&&"li"!==item.localName;)item=item.parentNode;item&&this._toggle(model,this._indexOf(item))}},_indexOf:function(item){var index=item.id.split("-")[1];if(Type.isDefined(index))return Type.cast(index);console.error("That ID was used for something")},_toggle:function(model,index){var current,idx;switch(model.select){case"one":model.selectedIndex===index&&this._hasplaceholder(model)?model.selectedIndex=0:model.selectedIndex=index;break;case"many":(idx=(current=model.selectedIndexes).indexOf(index))>-1?gui.Array.remove(current,idx):(current.push(index),current.sort(function(a,b){return a-b}))}},_hasplaceholder:function(model){return model.items.length&&!model.items[0].label},_movefocus:function(source,down){var target,button,elm=this.element;source&&"li"===source.localName&&(target=down?source.nextElementSibling||elm.querySelector("li:first-child"):source.previousElementSibling||elm.querySelector("li:last-child"))&&(button=target.querySelector("button, a"))&&button.focus()}},{$maxItemsCount:function(opt_elm){var avail=(opt_elm?opt_elm.offsetHeight:window.innerHeight)/44;return Math.ceil(avail)}})}(gui.Type,ts.ui.ButtonSpirit),ts.ui.ImageSpirit=function(fontcss){function getfontsheet(agent){switch(agent){case"gecko":case"webkit":return fontsheet;default:return null}}function getinitials(name){var regExp=/\(([^)]+)\)/;if(regExp.test(name))return regExp.exec(name)[1].toUpperCase();var names=name.split(/\s+/),first=names.shift(),last=names.pop()||"";return(first[0]+(last[0]||"")).toUpperCase()}function getcolorval(name,mod){var base=[245,245,245],r=base[0],g=base[1],b=base[2],red=color(name,3),green=color(name,5),blue=color(name,7);return"rgb("+darken([red=(red+r)/2,green=(green+g)/2,blue=(blue+b)/2].map(Math.floor),mod||0).join(",")+")"}function darken(c,n){return c.map(function(d){return(d+=n)<0?0:d>255?255:0|d})}function hash(word,n){for(var h=0,i=0;i<word.length;i++)h=word.charCodeAt(i)+((h<<n)-h);return Math.abs(h)}function color(word,n){return Math.floor(256*parseFloat("0."+hash(word,n)))}var fontsheet=gui.Client.hasBlob?URL.createObjectURL(new Blob([fontcss],{type:"text/css"})):null,getsource=gui.Combo.memoized(function(name,width,height){return"data:image/svg+xml;base64,"+window.btoa(ts.ui.svgname.edbml(getinitials(name),getcolorval(name,50),getcolorval(name,-180),width||height||ts.ui.UNIT_DOUBLE,getfontsheet(gui.Client.agent),fontcss))});return ts.ui.Spirit.extend({onconfigure:function(){ts.ui.Spirit.prototype.onconfigure.call(this);var src=this.att.get("src"),alt=this.att.get("alt"),tit=this.att.get("title");src?(this.element.naturalWidth?this._onload():this.event.add("load").add("error"),alt&&!tit&&this.att.set("title",alt)):(this.event.add("load"),this.att.add("alt"))},onevent:function(e){switch(ts.ui.Spirit.prototype.onevent.call(this,e),e.type){case"load":this.event.remove("load"),this._onload();break;case"error":this.event.remove("error"),this.att.add("alt")}},onatt:function(att){ts.ui.Spirit.prototype.onatt.call(this,att),"alt"===att.name&&(att.value.includes("{")||(this.att.has("title")||this.att.set("title",att.value),window.btoa?this.element.src=this._computesource(att.value):console.warn("TODO: Image fallback for IE9")))},_onload:function(){this.css.add("ts-loaded"),this.action.dispatch(ts.ui.ACTION_DID_LOAD)},_computesource:function(name){var w=this.att.get("width"),h=this.att.get("height");return(w||h)&&w!==h&&console.error("Height of the "+this+" must match the width"),getsource(name,w,h)}},{getColorForString:function(str){return getcolorval(str)}})}(["@font-face {",'\tfont-family: "Open Sans";'," font-style: normal;"," font-weight: 300;","\tsrc: url(data:font/woff;charset=utf-8;base64,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) format('woff');","}"].join("\n")),ts.ui.CalendarSpirit=function(){function getRelativeYear(year,diff){return parseInt(year,10)+diff}function getLocale(){return ts.ui.DatePicker.localize()}function getRelativeMonth(year,month,diff){return month=parseInt(month,10)+diff,year=parseInt(year,10),month<0?(year=getRelativeYear(year,-1),month=11):month>11&&(year=getRelativeYear(year,1),month=0),{year:year,month:month}}function actuallyGenerateDays(year,month,currentDay,numDays,numDaysInPrevMonth,startDay,numRows,selectedIsVisible,todayIsVisible){var row,col,cells=[];for(row=0;row<numRows;++row)for(col=0;col<7;++col){var newDate,day=7*row+col-startDay+1;0===col&&(cells[row]=[]),day>0&&day<=numDays?cells[row][col]=new Cell({today:todayIsVisible&&day===ts.lib.Date.getCurrentDay(),selected:selectedIsVisible&&day===currentDay,year:year,month:month,day:day}):day<=0?(newDate=getRelativeMonth(year,month,-1),cells[row][col]=new Cell({year:newDate.year,month:newDate.month,day:numDaysInPrevMonth+day,prev:!0})):day>numDays&&(newDate=getRelativeMonth(year,month,1),cells[row][col]=new Cell({year:newDate.year,month:newDate.month,day:day-numDays,next:!0}))}return cells}function Cell(data){gui.Object.extend(this,data)}return ts.ui.__generateDays=function(year,month,currentYear,currentMonth,currentDay){year=parseInt(year,10),month=parseInt(month,10),currentDay=parseInt(currentDay,10),currentYear=parseInt(currentYear,10),currentMonth=parseInt(currentMonth,10);var numDays=ts.lib.Date.getDaysInMonth(year,month),startDay=(ts.lib.Date.getFirstDayInMonth(year,month)-getLocale().firstDay+7)%7;return actuallyGenerateDays(year,month,currentDay,numDays,ts.lib.Date.getDaysInMonth(year,month-1),startDay,Math.ceil((numDays+startDay)/7),year===currentYear&&month===currentMonth,year===ts.lib.Date.getCurrentFullYear()&&month===ts.lib.Date.getCurrentMonth())},Cell.prototype={year:-1,month:-1,day:-1,today:!1,selected:!1,next:!1,prev:!1,stringify:function(){return JSON.stringify(this)}},Cell.parse=function(string){return new Cell(JSON.parse(string))},ts.ui.Spirit.extend({value:null,min:null,max:null,onselect:null,onconfigure:function(){if(ts.ui.Spirit.prototype.onconfigure.call(this),this.event.add("click"),this._ismodelled()&&["min","max","value"].forEach(function(key){this[key]=this._model[key]},this),!ts.lib.Date)throw new Error("Dysfunction");this._labels=this._generateLabels(),this._today=ts.lib.Date.getCurrentDay(),this._current=ts.lib.Date.dateStringToObject(this.value||"today"),this._year=this._current.year,this._month=this._current.month,this.min&&(this._min=ts.lib.Date.dateStringToObject(this.min)),this.max&&(this._max=ts.lib.Date.dateStringToObject(this.max)),this.script.loaded||(this.script.load(ts.ui.CalendarSpirit.edbml),this._render())},onevent:function(e){ts.ui.Spirit.prototype.onevent.call(this,e);var node=e.target;"click"===e.type&&this._doaction(node.parentNode,node)&&(e.stopPropagation(),e.preventDefault())},_model:null,_month:-1,_year:-1,_labels:null,_today:null,_current:null,_min:null,_max:null,_doaction:function(parent,child){var testnode="button"===parent.localName?parent:child;switch(testnode.name){case"accept":this._select(Cell.parse(testnode.value));break;case"nextMonth":this._nextMonth();break;case"prevMonth":this._prevMonth();break;case"prevYear":this._prevYear();break;case"nextYear":this._nextYear();break;default:return!1}return!0},_select:function(cell){var month=cell.month+1,day=cell.day;month<10&&(month="0"+month),day<10&&(day="0"+day),this.value=cell.year+"-"+month+"-"+day,this._current=ts.lib.Date.dateStringToObject(this.value),cell.prev?this._prevMonth():cell.next?this._nextMonth():this._render(),this.onselect&&new Function(["value"],this.onselect).call(this,this.value),this._ismodelled()&&(this._model.value=this.value)},_prevMonth:function(){var newDate=getRelativeMonth(this._year,this._month,-1);this._month=newDate.month,this._year=newDate.year,this._render()},_nextMonth:function(){var newDate=getRelativeMonth(this._year,this._month,1);this._month=newDate.month,this._year=newDate.year,this._render()},_prevYear:function(){this._year=getRelativeYear(this._year,-1),this._render()},_nextYear:function(){this._year=getRelativeYear(this._year,1),this._render()},_generateLabels:function(){var i,labels=[];for(i=0;i<7;++i)labels.push(getLocale().dayNamesMin[(i+getLocale().firstDay)%7]);return labels},_generateDays:function(year,month){return ts.ui.__generateDays(year,month,this._current.year,this._current.month,this._current.day)},_minDay:function(min,year,month){var day=0;return min&&year===min.year&&(month===min.month?day=min.day:month<min.month&&(day=Number.MAX_VALUE)),day},_maxDay:function(max,year,month){var day=0;return max&&year===max.year&&(month===max.month?day=max.day:month>max.month&&(day=1-Number.MAX_VALUE)),day},_render:function(){var names=getLocale().monthNamesShort,year=this._year,month=this._month,mname=names[month],labels=this._labels,min=this._min,max=this._max,view=this._generateDays(year,month),prevYear=!min||year>min.year?"prevYear":"",nextYear=!max||year<max.year?"nextYear":"",prevMonth=min&&year===min.year&&month<=min.month?"":"prevMonth",nextMonth=max&&year===max.year&&month>=max.month?"":"nextMonth",minDay=this._minDay(min,year,month),maxDay=this._maxDay(max,year,month);this.script.run(labels,mname,year,view,prevYear,nextYear,prevMonth,nextMonth,minDay,maxDay)}},{summon:function(opt_model){var html=ts.ui.datepicker.edbml(opt_model),elem=gui.HTMLParser.parse(html);return this.possess(elem)}})}(),ts.ui.PagerSpirit=function(Type,ButtonSpirit,CSSPlugin){return ts.ui.Spirit.extend({onconstruct:function(){ts.ui.Spirit.prototype.onconstruct.call(this),this._model=new ts.ui.PagerModel},ondestruct:function(){ts.ui.Spirit.prototype.ondestruct.call(this),this._model.removeObserver(this)},onconfigure:function(){ts.ui.Spirit.prototype.onconfigure.call(this),this._model.addObserver(this),this.script.load(ts.ui.PagerSpirit.edbml),this.script.input(this._model),this.event.add("click")},onevent:function(e){if(ts.ui.Spirit.prototype.onevent.call(this,e),"click"===e.type){var element=e.target,button=ButtonSpirit.getButton(element),model=this._model;button&&!button.disabled&&(this._update(button),this.tick.time(function(){this._navigate(button,model)},30))}},pages:{getter:function(){return this._model.pages},setter:function(n){this._model.pages=n}},page:{getter:function(){return this._model.page},setter:function(n){this._model.page=n}},onselect:null,onchange:function(changes){var model=this._model;changes.forEach(function(change){change.object===model&&"page"===change.name&&this._onchange(change.newValue)},this)},_model:null,_update:function(button){button.getAttribute("data-page")&&this.dom.qall("button").forEach(function(b){CSSPlugin.shift(b,b===button,"ts-selected")})},_onchange:function(index){var callb=this.onselect;this.page=index,this.action.dispatch(ts.ui.ACTION_PAGER_SELECT,index),callb&&(Type.isString(callb)&&(callb=new Function(["index"],callb)),callb.call(this,this.page))},_navigate:function(button,model){var page=button.getAttribute("data-page"),jump=button.getAttribute("data-jump");page?model.page=Type.cast(page):jump&&model[jump]()}})}(gui.Type,ts.ui.ButtonSpirit,gui.CSSPlugin),ts.ui.TimeSpirit=function(chained){var issame=!1,firsttime=null;return ts.ui.Spirit.extend({onenter:function(){ts.ui.Spirit.prototype.onenter.call(this),ts.ui.moment.suppressDeprecationWarnings=!0,this.tick.add("mytick").start("mytick",1e3),this.att.add("datetime")},ontick:function(tick){ts.ui.Spirit.prototype.ontick.call(this,tick),"mytick"===tick.type&&this._setText()},onatt:function(att){ts.ui.Spirit.prototype.onatt.call(this,att),"datetime"===att.name&&this._setText()},_setText:function(){var datetime=this.att.get("datetime"),realtime=this.att.get("realtime");if(datetime)return realtime&&!issame?(this.element.textContent=this._getTime(datetime,realtime),void(this.element.title=ts.ui.moment(datetime).format("MMM Do YYYY, h:mm:ss a"))):void(ts.ui.moment(datetime).isValid()?(this.element.textContent=ts.ui.moment(datetime).fromNow(),this.element.title=ts.ui.moment(datetime).format("MMM Do YYYY, h:mm:ss a")):parseInt(datetime,10)&&ts.ui.moment(parseInt(datetime,10)).isValid()?(datetime=parseInt(datetime,10),this.element.textContent=ts.ui.moment(datetime).fromNow(),this.element.title=ts.ui.moment(datetime).format("MMM Do YYYY, h:mm:ss a")):(this.element.textContent=datetime,this.element.title=datetime))},_getTime:function(datetime,realtime){var newdatetime=null,timespan=null;if(!ts.ui.moment(datetime).isValid()){if(!parseInt(datetime,10))return datetime;datetime=parseInt(datetime,10)}if(!ts.ui.moment(realtime).isValid()){if(!parseInt(realtime,10))return ts.ui.moment(datetime).fromNow();realtime=parseInt(realtime,10)}if(issame=ts.ui.moment().isSame(realtime,"minute"))return ts.ui.moment(datetime).fromNow();if(!firsttime)return firsttime=ts.ui.moment(),timespan=firsttime.diff(realtime),newdatetime=ts.ui.moment(datetime).add(timespan),ts.ui.moment(newdatetime).fromNow();var duration=ts.ui.moment().diff(firsttime);return timespan=ts.ui.moment().diff(realtime),newdatetime=ts.ui.moment(datetime).add(timespan).subtract(duration),ts.ui.moment(newdatetime).fromNow()}})}(gui.Combo.chained),ts.ui.SpinnerSpirit=function(chained){return ts.ui.Spirit.extend({spinning:function(is){if(is){var opt=ts.ui.SpinnerSpirit.topbar(),top=this.css.contains("ts-topbarspinner");this.spin(this.element,top?opt:null)}else this.stop()},spin:chained(function(element,options){element=element||this.element;var opts=ts.ui.SpinnerSpirit.defaults(options);this._spinner&&this.stop(),this._spinner=new ts.ui.Spinner(opts).spin(),element.appendChild(this._spinner.el),opts.message&&(this._textelement=document.createElement("div"),this._textelement.className="ts-spinner-text",this._textelement.style.top=opts.top,this._textelement.style.color=opts.color,this._textelement.innerHTML=opts.message,element.appendChild(this._textelement)),opts.cover&&this._updateblocking(!0)}),stop:chained(function(){this._updateblocking(!1),this._spinner&&(this._spinner.stop(),this._spinner=null),this._textelement&&(this._textelement.parentNode.removeChild(this._textelement),this._textelement=null)}),_spinner:null,_textelement:null,_coverid:"ts-spinnercover",_blocking:!1,_updateblocking:function(blocking){blocking?this._blocking||(this._cover().fadeIn(),this._blocking=!0):this._blocking&&(this._cover().fadeOut(),this._blocking=!1)},_cover:function(){return ts.ui.CoverSpirit.getCover(this._coverid)}},{defaults:function(options){var opts={lines:12,length:22,width:6,radius:22,scale:1,corners:1,color:"#555",opacity:.5,rotate:0,direction:1,speed:1,trail:60,fps:12,zIndex:4e4,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!0,position:"fixed",message:"",cover:!1};return options&&gui.Object.extend(opts,options),opts},topbar:function(){return{radius:5,length:5,width:2,position:"absolute",color:"rgb(255,255,255)"}}})}(gui.Combo.chained),ts.ui.NoteSpirit=function(Note,Type,Client,chained,confirmed){var CLASS_CLOSING=ts.ui.CLASS_CLOSING,CLASS_CLOSED=ts.ui.CLASS_CLOSED,CLASS_YELLOW_BG=ts.ui.CLASS_BG_YELLOW,CLASS_HIDDEN=ts.ui.CLASS_HIDDEN;return ts.ui.Spirit.extend({_closing:null,_prevIsVisible:null,onconfigure:function(){ts.ui.Spirit.prototype.onconfigure.call(this),this._ismodelled()&&(this.action.add(ts.ui.ACTION_SAFE_LINK),this.script.load(ts.ui.NoteSpirit.edbml),this.script.input(this._model),this._model.addObserver(this))},onready:function(){ts.ui.Spirit.prototype.onready.call(this),this.css.add(CLASS_YELLOW_BG),this._adjustVisible()},onrender:function(){ts.ui.Spirit.prototype.onrender.call(this),this._adjustVisible()},onevent:function(e){switch(ts.ui.Spirit.prototype.onevent.call(this,e),e.type){case"transitionend":this._closing&&(this._closing.now(),this._closing=null);break;case"click":this.$close(),gui.Tick.time(function(){this.css.add(CLASS_HIDDEN)},50,this)}},onaction:function(a){ts.ui.Spirit.prototype.onaction.call(this,a),a.type===ts.ui.ACTION_SAFE_LINK&&this._ismodelled()&&(Type.isFunction(this._model.onlink)&&this._model.onlink.call(this._model,a.data),a.consume())},onchange:function(changes){ts.ui.Spirit.prototype.onchange.call(this,changes),changes.forEach(function(c){c.object!==this._model||"open"!==c.name||c.newValue||this.close()},this)},closeable:function(closeable){if(closeable){var button=this.dom.prepend(ts.ui.ButtonSpirit.summon(document,{icon:"ts-icon-close"}));this.css.add("ts-has-close"),button.css.add("ts-note-close"),button.event.add("click",button,this)}},closable:function(){return this.closeable.apply(arguments)},icon:chained(function(classname){(this.dom.q("i")||this.dom.prepend(document.createElement("i"))).className=classname,this._adjustVisible()}),text:chained(function(text){(this.dom.q("p")||this.dom.append(document.createElement("p"))).textContent=text,this._adjustVisible()}),close:chained(function(){this.$close().then(function(){gui.Type.isFunction(this._model.onclose)&&this._model.onclose(),this._adjustPage(!0),this._model.removeObserver(this),this._model.dispose(),this._model===ts.ui.Note._model&&(ts.ui.Note._model=null),this._model=null,this.dom.remove()},this)}),buttons:confirmed("(array)")(chained(function(opt_json){var buttons=this.model().buttons;if(!arguments.length)return buttons;buttons.clear(),opt_json.forEach(function(json){buttons.push(json)})})),_adjustVisible:function(){this._ismodelled()&&this._model.onclose?this.css.add("ts-has-close"):this.css.remove("ts-has-close"),this.dom.q("p")&&this.dom.q("p").textContent||this.dom.q("i")&&this.dom.q("i").className||this.dom.q(".ts-note-buttons")?(this.dom.show(),this._prevIsVisible||this._adjustPage(),this._prevIsVisible=!0,this._adjustContentPadding()):(this._prevIsVisible&&this._adjustPage(!0),this._prevIsVisible=!1,this.dom.hide())},_adjustContentPadding:function(){var buttons=this.dom.q(".ts-note-buttons"),para=this.dom.q("p");buttons&&para&&(para.style.paddingRight=buttons.offsetWidth+"px")},_adjustPage:function(isRemove){if(this._ismodelled()&&this._model.$isTopNote){var height=isRemove?0:this.box.height;document.querySelector(".ts-maincontent").spirit.css.marginTop=height,ts.ui.get(document.documentElement).reflex()}},$close:function(){return this._closing||(this._closing=new gui.Then,this.event.add("transitionend"),this.css.add(CLASS_CLOSING),gui.Tick.time(function(){this.css.add(CLASS_CLOSED)},0,this)),this._closing}},{summon:function(opt_model){var spirit=this.possess(document.createElement("div"));return spirit._model=opt_model||null,spirit}})}(ts.ui.Note,gui.Type,gui.Client,gui.Combo.chained,gui.Arguments.confirmed),ts.ui.ModalSpirit=function(Client,transition,chained){var willopen=ts.ui.BROADCAST_MODAL_WILL_OPEN,didopen=ts.ui.BROADCAST_MODAL_DID_OPEN,willclose=ts.ui.BROADCAST_MODAL_WILL_CLOSE,didclose=ts.ui.BROADCAST_MODAL_DID_CLOSE;return ts.ui.Spirit.extend({isOpen:!1,onopen:null,onopened:null,onclose:null,onclosed:null,onready:function(){ts.ui.Spirit.prototype.onready.call(this),this.dom.hide(),this._setup(this._panel()),this.css.shift(transition,"ts-transition")},onaction:function(a){switch(ts.ui.Spirit.prototype.onaction.call(this,a),a.type){case ts.ui.ACTION_STATUSBAR_LEVEL:this.guilayout.gotoLevel(a.data),this.reflex()}},open:function(opt_open){var then=this._then=new gui.Then;return this.doorman.open(opt_open)||then.now(!1),then},close:function(){return this.open(!1)},busy:chained(function(){this._panel().busy()}),done:chained(function(){this.reflex(),this._panel().done()}),spin:chained(function(message){this._panel().spin(message),this.busy()}),stop:chained(function(){this._panel().stop(),this.done()}),html:chained(function(markup){var target=this._main()||this._panel();if(!arguments.length)return target.dom.html();target.dom.html(markup)}),onevent:function(e){ts.ui.Spirit.prototype.onevent.call(this,e),"transitionend"===e.type&&e.target===this.element&&(this.event.remove(e.type),this.isOpen?this._fadeIn(!0):this._fadeOut(!0))},onkey:function(key){ts.ui.Spirit.prototype.onkey.call(this,key),"Esc"===key.type&&this.close()},title:chained(function(title){var header=this._header();if(!arguments.length)return header.title();header.title(title)}),status:chained(function(message){var footer=this._footer();if(!arguments.length)return footer.message();footer.message(message)}),pager:chained(function(json){var footer=this._footer();if(!arguments.length)return footer.pager();footer.pager(json)}),tabs:chained(function(json){var tabbar=this._tabbar();if(!arguments.length)return tabbar.tabs();tabbar.tabs(json)}),buttons:chained(function(json){var footer=this._footer();if(!arguments.length)return footer.buttons();footer.buttons(json)}),onflex:function(callback,thisp){var avail=window.innerHeight,xxxxx=window.innerWidth;this._autosize(avail,xxxxx).then(function(height,breaks){this._position(height,avail,breaks),callback&&callback.call(thisp)},this)},$onopen:function(){this.css.shift(this.$fullscreen,"ts-fullscreen").shift(!this.$fullscreen,"ts-inscreen").shift(this.$fullscreen,"ts-overflow"),this._fadeIn()},$onclose:function(){this._fadeOut()},$fullscreen:!0,$insertTab:function(json,index){var tabs=this._tabbar().tabs();if(!this.$fullscreen)throw new Error("Tabs reserved for fullscreen modals :/");tabs.splice(index,0,json)},$selectTab:function(panel){this._autocenter(),this._focus()},_then:null,_panel:function(){return this.panels.current()},_main:function(){return this._panel().childMain()},_fadeIn:function(done){done?(this.key.add("Esc"),this.css.remove("ts-opening").add("ts-open"),this.broadcast.dispatch(didopen),this._then.now(!0),this.doorman.didopen(),this._focus()):(this.dom.show(),this.panels.init(),this._cloak(!0),this.broadcast.dispatch(willopen),this.att.set("data-ts.open",!0),"dialog"===this.dom.tag()&&this.att.set("open","open"),this.onflex(function(){this._cloak(!1),transition?(this.css.add("ts-opening"),this.event.add("transitionend")):this._fadeIn(!0)},this))},_fadeOut:function(done){done?(this.dom.hide(),this.css.remove("ts-closing"),this.broadcast.dispatch(didclose),this.att.set("data-ts.open",!1),"dialog"===this.dom.tag()&&this.att.del("open"),this._then.now(),this.tick.time(function(){this.$disposed||((this._main()||this).attention.exit(),this.doorman.didclose())})):(this.key.remove("Esc"),this.broadcast.dispatch(willclose),this.css.add("ts-closing").remove("ts-open"),transition?this.event.add("transitionend"):this._fadeOut(!0))},_focus:function(){var panel=this._panel(),focus=document.activeElement;focus&&panel.dom.contains(focus)||(this._main()||this).attention.enter()},_cloak:function(hidden){this.css.visibility=hidden?"hidden":"visible"},_autosize:function(avail,xxxxx){var then=new gui.Then;return this.$fullscreen?this._autosizefullscreen(then,avail,xxxxx):this._autosizeinscreen(then,avail,xxxxx),then},_autosizefullscreen:function(then,avail,xxxxx){this.css.height=avail,this.css.width=xxxxx,this._autocenter(),this.tick.time(function(){then.now(avail,!1)},Client.isWebKit?100:200)},_autocenter:function(){var panel=this._panel(),main=panel.childMain();if(main){var height=main.box.height,offset=.382*panel.box.height-.5*height;main.css.top=offset>0?offset:0}},_autosizeinscreen:function(then,avail,xxxxx){this.css.remove("ts-overflow");var height=this._panel().naturalHeight()+(this.css.contains("ts-hasheader")?66:0)+(this.css.contains("ts-hasheader")?66:0),breaks=height>avail;height=breaks?avail:height,this.css.height=height,this.css.shift(breaks,"ts-overflow"),this.tick.time(function(){then.now(height,breaks)},Client.isWebKit?100:200)},_position:function(height,avail,breaks){this.css.top=breaks?0:.5*(avail-height)},_setup:function(panel){var that=this;if(!panel)throw new Error("Expected a ts-panel");this.attention.trap(panel),this._header().showClose(function(){that.open(!1)})},_header:function(){var ToolBar=ts.ui.ToolBarSpirit;return this.css.add("ts-hasheader"),this.dom.q("header.ts-toolbar",ToolBar)||this.dom.prepend(ToolBar.summon("header","ts-bg-blue"))},_tabbar:function(){var TabBar=ts.ui.TabBarSpirit;return this.css.add("ts-hastabs"),this.dom.q("header.ts-tabbar",TabBar)||this._header().dom.after(TabBar.summon("header","ts-bg-white"))},_footer:function(){this.css.add("ts-hasfooter");var StatusBar=ts.ui.StatusBarSpirit;return this.action.add(ts.ui.ACTION_STATUSBAR_LEVEL),this.dom.q("footer.ts-toolbar",StatusBar)||this.dom.append(StatusBar.summon("footer"))},_confirmposition:function(){if(this.guilayout.outsideMain())return!0;throw new Error(this+" must be positioned outside Main",this.element)}})}(gui.Client,gui.Client.hasTransitions,gui.Combo.chained),ts.ui.CoreModule=gui.module("core-gui@tradeshift.com",{channel:[["html",ts.ui.DocumentSpirit],["[data-ts=Main]",ts.ui.MainSpirit],["[data-ts=MainContent]",ts.ui.MainContentSpirit],["[data-ts=Frame]",ts.ui.FrameSpirit],["[data-ts=Aside]",ts.ui.AsideSpirit],["[data-ts=SideBar]",ts.ui.SideBarSpirit],["[data-ts=Footer]",ts.ui.AsideFooterSpirit],["[data-ts=Panel]",ts.ui.PanelSpirit],["[data-ts=Menu]",ts.ui.MenuSpirit],["[data-ts=Button]",ts.ui.ButtonSpirit],["[data-ts=Buttons]",ts.ui.ButtonMenuSpirit],["[data-ts=Link]",ts.ui.LinkSpirit],["[data-ts=Pager]",ts.ui.PagerSpirit],["[data-ts=Time]",ts.ui.TimeSpirit],["[data-ts=Note]",ts.ui.NoteSpirit],["[data-ts=Icon]",ts.ui.NextIconSpirit],["[data-ts=Spinner]",ts.ui.SpinnerSpirit],["[data-ts=Modal]",ts.ui.ModalSpirit],["[data-ts=Spirit]",ts.ui.Spirit]],channelComplexSelectors:function(enabled){enabled&&!this._channeled&&(this._channeled=!0,gui.channel([[".ts-buttons button, .ts-buttons a",ts.ui.ButtonSpirit]]))},plugin:{guistatus:ts.ui.StatusPlugin,guilayout:ts.ui.LayoutPlugin,attention:ts.ui.AttentionPlugin},oncontextinitialize:function(){this._commonplugins(),this._specialplugins(),this._documentplugins(),this._guiattributes(),this._defaultcolors()},onbeforespiritualize:function(){function allcssnames(constructor){return gui.Class.ancestorsAndSelf(constructor).map(function(c){return c.$cssname||void 0}).filter(function(cssname){return!!cssname}).join(" ")}var ATTRIBUTE=/^\[data-ts=[a-zA-Z]+\]$/;gui.getChannels().map(function(channel){var cssselector=channel[0],constructor=channel[1];if(cssselector.trim().match(ATTRIBUTE)){if(constructor.$cssname)throw new Error(constructor+" appears to be channeled twice? "+constructor.$cssname);var attval=cssselector.replace("data-ts=","").slice(1,-1),fixval="ts-"+attval.toLowerCase();return constructor.$nicename=attval,constructor.$cssname=fixval,constructor}}).filter(function(constructor){return!!constructor}).forEach(function(constructor){constructor.$cssnames=allcssnames(constructor)})},_channeled:!1,_commonplugins:function(){ts.ui.Spirit.plugin("event",ts.ui.EventPlugin,!0)},_specialplugins:function(){ts.ui.ModalSpirit.plugin("panels",ts.ui.PanelsPlugin),ts.ui.ModalSpirit.plugin("doorman",ts.ui.DoorManPlugin),ts.ui.SideShowSpirit.plugin("doorman",ts.ui.DoorManPlugin)},_documentplugins:function(){ts.ui.DocumentSpirit.plugin("layoutplugin",ts.ui.DocumentLayoutPlugin).plugin("dialogplugin",ts.ui.DocumentDialogPlugin).plugin("asideplugin",ts.ui.DocumentAsidePlugin).plugin("panelplugin",ts.ui.DocumentPanelPlugin)},_guiattributes:function(){gui.attributes=["ts","data-ts"]},_defaultcolors:function(){var cssp=gui.CSSPlugin,html=document.documentElement;html.className.includes("ts-bg")||cssp.add(html,"ts-bg-lite")}}),ts.ui.FormSupportSpirit=ts.ui.Spirit.extend({onconstruct:function(){ts.ui.Spirit.prototype.onconstruct.call(this);var module=ts.ui.FormsModule,enable=!this.css.contains(ts.ui.CLASS_OPTIMIZED);module.channelComplexSelectors(enable)}}),ts.ui.FieldSpirit=function(chained){return ts.ui.Spirit.extend({value:{getter:function(){return this.element.value},setter:function(value){value=this._evaluated(value);var idx=-1,elm=this.element,foc=document.activeElement;foc&&foc===elm&&(idx=elm.value.slice(0,elm.selectionStart).length),elm.value=value,idx>-1&&"date"!==elm.type&&elm.setSelectionRange(idx,idx),this.$destructed||this._label(function(label){label.$empty(!value)})}},onattach:function(){ts.ui.Spirit.prototype.onattach.call(this),this.tick.addStart(ts.ui.FieldSpirit.TICK_SYNC,ts.ui.FieldSpirit.TICK_TIME,this),this.event.add("focus blur"),this.css.add(ts.ui.CLASS_FIELD),this.$updatestyling()},onasync:function(){ts.ui.Spirit.prototype.onasync.call(this),this.$updatestyling()},onevent:function(e){ts.ui.Spirit.prototype.onevent.call(this,e);var model=this._model;switch(e.type){case"focus":model&&(model.focused=!0);break;case"blur":model&&(model.focused=!1)}},ontick:function(t){ts.ui.Spirit.prototype.ontick.call(this,t),t.type===ts.ui.FieldSpirit.TICK_SYNC&&this.$updatestyling()},$updatestyling:function(){var required=this.att.has("required"),disabled=this.att.has("disabled"),readonly=this.att.has("readonly");this._label(function(label){label.$fieldlabel(),label.$required(required),label.$disabled(disabled),this.css.contains(ts.ui.CLASS_FAKE)||this.css.contains(ts.ui.CLASS_NOLOCK)||label.$readonly(readonly)})},focus:chained(function(){this.element.focus()}),blur:chained(function(){this.element.blur()}),_model:null,_evaluated:function(value){return String(value)},_label:function(action){var label,result;return this.dom.embedded()&&(label=this.dom.parent(ts.ui.LabelSpirit))&&action&&(result=action.call(this,label)),result},_fieldset:function(action){var fieldset,result;return this._label(function(label){(fieldset=label.dom.parent(ts.ui.FieldSetSpirit))&&action&&(result=action.call(this,fieldset))}),result}},{TICK_SYNC:"ts-tick-forms-sync",TICK_TIME:gui.Client.isTouchDevice?1e3:500})}(gui.Combo.chained),ts.ui.InputSpirit=function(chained,Type,Client){return ts.ui.FieldSpirit.extend({validity:null,icon:null,onidle:null,idletime:Client.isTouchDevice?750:500,onenterkey:null,disabled:{getter:function(){return this.att.has("disabled")},setter:function(is){this.att.set("disabled",is)}},readonly:{getter:function(){return this.att.has("readonly")},setter:function(is){this.att.set("readonly",is)}},onconfigure:function(){ts.ui.FieldSpirit.prototype.onconfigure.call(this),this._ismodelled()&&this._setupmodel(this._model,!0)},ondestruct:function(){ts.ui.FieldSpirit.prototype.ondestruct.call(this),this._discount(),this._ismodelled()&&this._setupmodel(this._model,!1)},onattach:function(){ts.ui.FieldSpirit.prototype.onattach.call(this),this.element.spellcheck=!1,this.element.autocomplete="off",this.disabled=this.att.has("disabled"),this.att.add("onidle idletime disabled"),this.event.add("input change invalid")},onevent:function(e){ts.ui.FieldSpirit.prototype.onevent.call(this,e);var model=this._model;switch(e.type){case"keydown":13===e.keyCode&&this._onenterkey(e);break;case"input":case"change":var value=this.value;value!==this._snapshot&&(this._snapshot=value,this._oninput(value));break;case"focus":this.event.add("keydown"),model&&(model.focused=!0);break;case"blur":this.event.remove("keydown"),this._oncount(),model&&(model.focused=!1)}},onchange:function(changes){ts.ui.FieldSpirit.prototype.onchange.call(this,changes),changes.forEach(function(c){this._onmodelchange(c.object,c.name,c.newValue,c.oldValue)},this)},onatt:function(att){switch(ts.ui.FieldSpirit.prototype.onatt.call(this,att),att.name){case"disabled":this.disabled=this.att.has("disabled")}},enable:chained(function(){this.disabled=!1}),disable:chained(function(){this.disabled=!0}),clear:chained(function(){this.value=""}),model:chained(function(model){if(!arguments.length)return this._model;if(!ts.ui.InputModel.is(model))throw new TypeError("InputModel expected");model!==this._model&&(this._model&&this._setupmodel(this._model,!1),this._model=model,this._setupmodel(model,!0))}),$updatestyling:function(){ts.ui.FieldSpirit.prototype.$updatestyling.call(this),this._label(function(label){label.$empty(!this.value),label.$customicon(this.icon,this.att.has("data-ts.icon"))})},_model:null,_snapshot:null,_timeout:-1,_suspendenterkey:!1,_setupmodel:function(model,setup){setup?model.addObserver(this):model.removeObserver(this),this.onidle=setup?function(){model.idle=!0}:null,this.onenterkey=setup?function(){model.enterkey=!0}:null,setup&&(model.value&&(this.value=model.value),model.focused&&this.element.focus())},_countdown:function(){this._discount(),this._timeout=this.tick.time(function(){this._oncount()},this.idletime)},_oncount:function(){this._discount(),this._maybeinvoke(this.onidle,this.value)},_discount:function(){clearTimeout(this._timeout),this._timeout=-1},_oninput:function(value){this._label(function(label){label.$empty(!value)}),this.onidle&&this._countdown(),this._ismodelled()&&(this._model.value=value)},_onmodelchange:function(model,name,value,oldvalue){if(model===this._model)switch(name){case"value":this.value=value,value||this._label(function(label){label.$empty(!0)});break;case"focused":value?this.element.focus():this.element.blur()}},_onenterkey:function(e){this._suspendenterkey||this._maybeinvoke(this.onenterkey,this.value)&&this._discount(),this.element.localName}},{summon:function(){return this.possess(document.createElement("input"))}})}(gui.Combo.chained,gui.Type,gui.Client),ts.ui.TextInputSpirit=ts.ui.InputSpirit.extend({onattach:function(){ts.ui.InputSpirit.prototype.onattach.call(this),this.css.add(ts.ui.CLASS_TEXT)},$updatestyling:function(){ts.ui.InputSpirit.prototype.$updatestyling.call(this),this._label(function(label){label.$textlabel()})}}),ts.ui.FakeInputSpirit=ts.ui.TextInputSpirit.extend({onconfigure:function(){ts.ui.TextInputSpirit.prototype.onconfigure.call(this),this.css.add(ts.ui.CLASS_FAKE),this.element.tabIndex=-1,this.element.type="text",this.element.name="",this.att.set("readonly",!0)},onattach:function(){ts.ui.TextInputSpirit.prototype.onattach.call(this);var label=this.dom.parent(ts.ui.LabelSpirit);label?label.event.add("click",label,this):this.event.add("click")},ondetach:function(){ts.ui.TextInputSpirit.prototype.ondetach.call(this),this._label(function(label){label.event.remove("click",label,this)})},proxy:function(element){this._proxyelement=element,this._proxyspirit=ts.ui.get(element),this.event.add("keydown keypress keyup",element,this)},onevent:function(e){switch(e.type){case"focus":e.target===this.element&&(this._inactive()||this._proxyelement.focus());break;case"click":this._inactive()||this._maybeopen();break;case"keydown":switch(e.keyCode){case 13:case 32:e.preventDefault(),this._inactive()||this._maybeopen()}}},$updatestyling:function(){ts.ui.TextInputSpirit.prototype.$updatestyling.call(this),this._label(function(label){label.$fakelabel()})},_inactive:function(){var elm=this._proxyelement;return!!(elm.disabled||elm.readOnly||elm.hasAttribute("readonly"))},_maybeopen:function(){this._isopen||(this._isopen=!0,this._label(function(label){label.css.add(ts.ui.CLASS_FOCUS_ON)}),this._openaside(function(){this._isopen=!1,this._proxyelement.focus(),this._label(function(label){label.css.remove(ts.ui.CLASS_FOCUS_ON)})}))},_triggerinput:function(){this._proxyelement.dispatchEvent(this._createEvent("input",!0))},_triggerchange:function(){this._proxyelement.dispatchEvent(this._createEvent("change",!0))},_restorefocus:function(){this._proxyelement.focus()},_createEvent:function(eventName,bubbles){var event=null;return"function"==typeof Event?event=new Event(eventName,{bubbles:bubbles}):(event=document.createEvent("Event")).initEvent(eventName,bubbles,!0),event}}),ts.ui.FakeDateInputSpirit=function(chained,tick,time){return ts.ui.FakeInputSpirit.extend({onattach:function(){ts.ui.FakeInputSpirit.prototype.onattach.call(this),this.css.add(ts.ui.CLASS_DATE)},ontick:function(t){ts.ui.FakeInputSpirit.prototype.ontick.call(this,t),this._proxyspirit.$destructed||t.type===tick&&this._syncfake()},proxy:chained(function(input){ts.ui.FakeInputSpirit.prototype.proxy.call(this,input),this.disabled=input.disabled,this._initialupdate()}),$updatestyling:function(){ts.ui.FakeInputSpirit.prototype.$updatestyling.call(this),this._label(function(label){label.$datelabel()})},_proxyspirit:null,_initialupdate:function(select,again){this._syncfake(),this.tick.add(tick).start(tick,time)},_openaside:function(onclosed){var spirit=this,real=this._proxyspirit,title=this._label(function(label){return label.text()});ts.ui.DatePicker({title:title||ts.ui.String.LABEL_DATEPICK,value:real.value,min:real.min,max:real.max,onselect:function(value){spirit._syncreal(value),spirit._syncfake(),this.close()},onclosed:function(){onclosed.call(spirit),this.dispose()}}).open()},_syncreal:function(value){var realspirit=this._proxyspirit;realspirit.value!==value&&(realspirit.value=value,gui.Client.isExplorer?this._triggerchange():this._triggerinput())},_syncfake:function(){var realspirit=this._proxyspirit;realspirit.value!==this.value&&(this.value=realspirit.value),realspirit.element.placeholder!==this.element.placeholder&&(this.element.placeholder=realspirit.element.placeholder)}})}(gui.Combo.chained,ts.ui.FieldSpirit.TICK_SYNC,ts.ui.FieldSpirit.TICK_TIME),ts.ui.DateInputSpirit=function(tick,time){return ts.ui.InputSpirit.extend({min:null,max:null,onconfigure:function(){ts.ui.InputSpirit.prototype.onconfigure.call(this),this.att.add("min max")},onready:function(){ts.ui.InputSpirit.prototype.onready.call(this),this.tick.add(tick).start(tick,time),this._createfake(ts.ui.FakeDateInputSpirit).proxy(this.element)},ontick:function(t){ts.ui.InputSpirit.prototype.ontick.call(this,t),t.type===tick&&this._revaluate(this.element.value)},onatt:function(att){ts.ui.InputSpirit.prototype.onatt.call(this,att);var value=att.value;switch(att.name){case"min":this.min=this._evaluated(value);break;case"max":this.max=this._evaluated(value)}},_snapshot:null,_createfake:function(FakeInput){var existing=this.dom.next(ts.ui.TextInputSpirit);return existing&&existing.dom.remove(),this.dom.after(FakeInput.summon())},_revaluate:function(newval){var oldval=this._snapshot;""!==newval&&newval!==oldval&&(this._snapshot=newval,this.value=newval)},_evaluated:function(value){return isNaN(new Date(value).getTime())?(console.warn("The specified value '"+value+"' does not conform to the required format, 'yyyy-MM-dd'."),""):value}})}(ts.ui.FieldSpirit.TICK_SYNC,ts.ui.FieldSpirit.TICK_TIME),ts.ui.TextAreaSpirit=function(Type,Client,unit,tick,time){return ts.ui.TextInputSpirit.extend({entershift:!1,onenter:function(){ts.ui.TextInputSpirit.prototype.onenter.call(this),this.css.add(ts.ui.CLASS_TEXTAREA),this.event.add("input keydown"),this._snapshot=this.element.value,this.tick.add(tick).start(tick,time),this.att.add("rows"),this._autosize()},onvisible:function(){ts.ui.TextInputSpirit.prototype.onvisible.call(this),"auto"===this.css.get("height")&&this._autosize()},onatt:function(att){if(ts.ui.TextInputSpirit.prototype.onatt.call(this,att),"rows"===att.name){var val=att.value;Type.isNumber(val)&&(this.css.minHeight=unit*val,val>=10&&(this.css.maxHeight=unit*val))}},onevent:function(e){var was=this._suspendenterkey;switch(e.type){case"input":ts.ui.TextInputSpirit.prototype.onevent.call(this,e),this._autosize();break;case"keydown":if(13===e.keyCode&&(this.entershift||"submit"===this.att.get("type")))if(e.shiftKey)this._suspendenterkey=!0;else{e.preventDefault();var elm=this.element;elm.form&&elm.form.submit(),this.tick.next(function(){document.activeElement===elm&&elm.blur()})}ts.ui.TextInputSpirit.prototype.onevent.call(this,e),this._suspendenterkey=was}},ontick:function(t){ts.ui.TextInputSpirit.prototype.ontick.call(this,t),t.type===tick&&(this.element.value!==this._snapshot?(this._snapshot=this.element.value,this._autosize()):"auto"===this.css.get("height")&&this._autosize())},_setupmodel:function(model,setup){ts.ui.TextInputSpirit.prototype._setupmodel.call(this,model,setup),this.entershift=!!setup&&model.entershift},_autosize:function(){var target,padding=.5*unit,current=this.css.height||this.box.height;this.css.height="auto",(target=Math.floor(this.element.scrollHeight/unit)*unit)>0&&(this.css.height=target+padding,current!==target&&(this._hotfixchrome(this.element),this.action.dispatch(ts.ui.ACTION_CHANGED,{oldheight:current,newheight:target})))},_hotfixchrome:function(elm){Client.isChrome&&elm.scrollHeight<=elm.offsetHeight&&this.tick.nextFrame(function(){this.css.display="none",this.css.display=""})}},{summon:function(){return this.possess(document.createElement("textarea"))}})}(gui.Type,gui.Client,ts.ui.UNIT,ts.ui.FieldSpirit.TICK_SYNC,ts.ui.FieldSpirit.TICK_TIME),ts.ui.OptionSpirit=ts.ui.FieldSpirit.extend({onconfigure:function(){ts.ui.FieldSpirit.prototype.onconfigure.call(this),this._confirmbasic(this.element.localName,this.element.type)},onattach:function(){ts.ui.FieldSpirit.prototype.onattach.call(this),this.css.add(ts.ui.CLASS_OPTION)},$updatestyling:function(){ts.ui.FieldSpirit.prototype.$updatestyling.call(this);var type=this.element.type;this._label(function(label){label.$option(type)}),this._fieldset(function(fieldset){fieldset.$options(type),"radio"===type&&fieldset.$disabled(this.att.has("disabled"))})},_confirmbasic:function(name,type){if(gui.debug){if("input"!==name)throw new Error(this+" must attach to an input field",this.element);if("checkbox"!==type&&"radio"!==type)throw new Error(this+" must attach to a checkbox or radio",this.element)}}}),ts.ui.SwitchSpirit=function(tick,time){return ts.ui.FieldSpirit.extend({onenter:function(){ts.ui.FieldSpirit.prototype.onenter.call(this),this._confirmbasic(this.element.localName,this.element.type)},onattach:function(){ts.ui.FieldSpirit.prototype.onattach.call(this),this.event.add("change"),this.css.add([ts.ui.CLASS_SWITCHBOX,ts.ui.CLASS_ENGINE]),this._switch=this._createswitch(),this._synchronize(!0)},onready:function(){ts.ui.FieldSpirit.prototype.onready.call(this),this.tick.add(tick).start(tick,time)},onevent:function(e){switch(ts.ui.FieldSpirit.prototype.onevent.call(this,e),e.type){case"change":this._synchronize()}},ontick:function(t){ts.ui.FieldSpirit.prototype.ontick.call(this,t),t.type===tick&&this._synchronize()},$updatestyling:function(){ts.ui.FieldSpirit.prototype.$updatestyling.call(this),this._label(function(label){label.$switch()}),this._fieldset(function(fieldset){fieldset.$options()})},_switch:null,_snapshot:null,_createswitch:function(){var oldswitch=this.dom.following(ts.ui.Spirit)[0];return oldswitch&&oldswitch.css.contains("ts-switcher")&&oldswitch.dom.remove(),ts.ui.get(this.dom.after(this.dom.parseToNode(ts.ui.switchonly.edbml())))},_synchronize:function(init){var checked=this.element.checked;(init||checked!==this._snapshot)&&(this._switch.css.shift(checked,ts.ui.CLASS_CHECKED),this._snapshot=checked,init||this.action.dispatch(ts.ui.ACTION_SWITCH,checked))},_confirmbasic:function(name,type){var elm=this.element;if(gui.debug){if("input"!==name)throw new Error(this+" must attach to an input field",elm);if("checkbox"!==type&&"radio"!==type)throw new Error(this+" must attach to a checkbox or radio",elm)}}})}(ts.ui.FieldSpirit.TICK_SYNC,ts.ui.FieldSpirit.TICK_TIME),ts.ui.LabelSpirit=function(Client,FieldSpirit,chained,tick,time,controlclass){function updatestyling(field){field.$updatestyling()}var class_switchlabel=ts.ui.CLASS_SWITCHLABEL,class_fieldlabel=ts.ui.CLASS_FIELDLABEL,class_textlabel=ts.ui.CLASS_TEXTLABEL,class_datelabel=ts.ui.CLASS_DATELABEL,class_fakelabel=ts.ui.CLASS_FAKELABEL,class_customiconlabel=ts.ui.CLASS_CUSTOMICONLABEL,class_haslabel=ts.ui.CLASS_HASLABEL,class_disabled=ts.ui.CLASS_DISABLED,class_readonly=ts.ui.CLASS_READONLY,class_required=ts.ui.CLASS_REQUIRED,class_option=ts.ui.CLASS_OPTION,class_error=ts.ui.CLASS_ERROR,class_focus=ts.ui.CLASS_FOCUS,class_empty=ts.ui.CLASS_EMPTY;return ts.ui.FormSupportSpirit.extend({onconstruct:function(){ts.ui.FormSupportSpirit.prototype.onconstruct.call(this),this._persisted=[]},onattach:function(){ts.ui.FormSupportSpirit.prototype.onattach.call(this),this.event.add("mousedown"),this.event.add("focus blur",this,this,!0),this.tick.add(tick).start(tick,time),this.css.add("ts-engine-"+Client.agent)},ontick:function(t){ts.ui.FormSupportSpirit.prototype.ontick.call(this,t),t.type===tick&&this._refreshstyling()},onevent:function(e){switch(ts.ui.FormSupportSpirit.prototype.onevent.call(this,e),e.type){case"focus":case"blur":switch(e.target.type){case"radio":break;default:this._focus("focus"===e.type)}break;case"mousedown":var boxes=this.dom.qall("input[type=checkbox]");boxes.length&&(boxes[0].focus(),e.preventDefault())}},text:function(){var span=this.dom.q("this > span");return span?span.textContent.trim():""},_disabled:!1,_option:!1,_focus:function(is){this.css.shift(is,class_focus)},_refreshstyling:function(){this.css.contains(controlclass)||this.dom.descendants(FieldSpirit).forEach(updatestyling)},$fieldlabel:chained(function(){this.css.add(class_fieldlabel)}),$invalid:chained(function(is){this.css.shift(is,class_error)}),$textlabel:chained(function(){this.css.add(class_textlabel)}),$haslabel:chained(function(has){this.css.shift(has,class_haslabel)}),$datelabel:chained(function(){this.css.add(class_datelabel)}),$fakelabel:chained(function(){this.css.add(class_fakelabel)}),$isFakelabel:function(){return this.css.contains(class_fakelabel)},$customicon:chained(function(customicon,hasCustomicon){if(hasCustomicon){var character=ts.ui.ICONS[customicon]||"";this.css.add(class_customiconlabel),this.att.set("data-ts-icon",character)}else this.css.remove(class_customiconlabel),this.att.remove("data-ts-icon")}),$option:chained(function(type){this.css.add(class_option),this.css.add("ts-"+type)}),$switch:chained(function(){this.css.add(class_switchlabel)}),$disabled:chained(function(disabled){(this.css.contains(class_disabled)?!disabled:disabled)&&this.css.shift(disabled,class_disabled)}),$readonly:chained(function(readonly){this.css.shift(readonly,class_readonly)}),$required:chained(function(required){(this.css.contains(class_required)?!required:required)&&this.css.shift(required,class_required)}),$empty:chained(function(empty){this.css.shift(empty,class_empty)})})}(gui.Client,ts.ui.FieldSpirit,gui.Combo.chained,ts.ui.FieldSpirit.TICK_SYNC,ts.ui.FieldSpirit.TICK_TIME,ts.ui.CLASS_FIELDLABEL),ts.ui.LabelTextSpirit=function(){function classname(spirit,on){var label,fieldset;(label=spirit.dom.parent(ts.ui.LabelSpirit))?label.$haslabel(on):(fieldset=spirit.dom.parent(ts.ui.FieldSetSpirit))&&fieldset.$haslabel(on)}return ts.ui.Spirit.extend({onattach:function(){ts.ui.Spirit.prototype.onattach.call(this),classname(this,!0)},ondetach:function(){ts.ui.Spirit.prototype.ondetach.call(this),classname(this,!1)}})}(),ts.ui.FieldSetSpirit=ts.ui.FormSupportSpirit.extend({onattach:function(){ts.ui.FormSupportSpirit.prototype.onattach.call(this),this.event.add("mousedown"),this.event.add("focus blur",this.element,this,!0)},onevent:function(e){switch(ts.ui.FormSupportSpirit.prototype.onevent.call(this,e),e.type){case"focusin":case"focusout":case"focus":case"blur":switch(e.target.type){case"radio":this._focus("focusin"===e.type||"focus"===e.type)}break;case"mousedown":(this._focusradio()||this._focusbox())&&e.preventDefault()}},onasync:function(){ts.ui.FormSupportSpirit.prototype.onasync.call(this);var form=this.dom.parent(ts.ui.FormSpirit);form&&form.css.contains(ts.ui.CLASS_PREVIEW)&&this.element.setAttribute("disabled","disabled")},$options:function(type){this.css.add(ts.ui.CLASS_OPTIONS).add("ts-"+type)},$disabled:function(disabled){this.css.shift(disabled,"ts-disabled")},$haslabel:function(has){this.css.shift(has,ts.ui.CLASS_HASLABEL)},_focusradio:function(){var radio=this.dom.q("input[type=radio]");return!!radio&&(radio.focus(),!0)},_focusbox:function(){var box=this.dom.q("input[type=checkbox]");return!(!box||this.dom.q("."+ts.ui.CLASS_FOCUS))&&(box.focus(),!0)},_focus:function(is){this.css.shift(is,ts.ui.CLASS_FOCUS)}}),ts.ui.SelectSpirit=ts.ui.FieldSpirit.extend({debugsync:!1,onready:function(){ts.ui.FieldSpirit.prototype.onready.call(this),this._debugsync(this.debugsync),this.css.add(ts.ui.CLASS_SELECT),this._createfake(ts.ui.FakeSelectInputSpirit).proxy(this.element)},_createfake:function(SelectInput){var oldfake=this.dom.following(ts.ui.TextInputSpirit);return oldfake[0]&&oldfake[0].dom.remove(),this.dom.after(SelectInput.summon())},_debugsync:function(enabled){var elm=this.element,ops=elm.options;enabled&&setInterval(function(){elm.multiple?console.log("indexes: "+gui.Array.from(ops).map(function(o,i){return o.selected=Math.random()>.5,o.selected?i:null}).filter(function(index){return null!==index})):(elm.selectedIndex=Math.floor(Math.random()*ops.length),console.log("index: "+elm.selectedIndex));var label="Option"+(ops.length+1);elm.add(new Option(label,Math.random()))},2e3)}}),ts.ui.FakeSelectInputSpirit=function(chained,confirmed,tick,time,guiArray){function selectedoptions(options){return guiArray.from(options).map(selectedindexes).filter(selectedonly)}function selectedindexes(option,index){return option.selected?index:-1}function selectedonly(index){return index>-1}return ts.ui.FakeInputSpirit.extend({proxy:chained(function(select){if(ts.ui.FakeInputSpirit.prototype.proxy.call(this,select),this.disabled=select.disabled,select.multiple&&(this._selectedIndexes=[]),this._initialupdate(select),select.spirit){var spirit=this;select.spirit.att.add("disabled",{onatt:function(att){spirit.disabled=select.disabled}})}}),ontick:function(t){ts.ui.FakeInputSpirit.prototype.ontick.call(this,t),t.type===tick&&(this._proxyspirit.$destructed||this._syncfake(this._proxyelement,this._menumodel))},search:confirmed("(object)")(chained(function(opt_json){var Model=ts.ui.SearchModel,model=this._searchmodel;if(!arguments.length)return model||this.search({}),this._searchmodel;model&&model.dispose(),this._searchmodel=new Model(opt_json)})),_aside:null,_select:null,_selectedIndex:-1,_selectedIndexes:null,_searchmodel:null,_optionslength:-1,_initialupdate:function(select,again){this._syncfake(select),this.tick.add(tick).start(tick,time)},_updatestatus:function(length){var multiple=this._proxyelement.multiple,options=this._proxyelement.options;if(this._optionslength=options.length,multiple){var indexes=this._getindexes(options);length=arguments.length?length:indexes.length,this.value=length+" selected",this._selectedIndexes=indexes}else{var index=this._selectedIndex=this._proxyelement.selectedIndex;this.value=options[index]?options[index].text:""}},_getindexes:function(options){return this._proxyelement.multiple?selectedoptions(options):[]},_doselectone:function(index){var select=this._proxyelement;index!==select.options.selectedIndex&&(select.options.selectedIndex=index,this._triggerchange())},_doselectmany:function(indexes){gui.Array.from(this._proxyelement.options).reduce(function(result,option,index){var was=option.selected;return option.selected=indexes.indexOf(index)>-1,result||option.selected!==was},!1)&&this._triggerchange()},_computemodelitems:function(select){return Array.map(select.options,function(option){return{label:option.text,visible:!!option.text,disabled:option.disabled}})},_openaside:function(onclosed){this._open(this._proxyelement,this._proxyelement.options,onclosed)},_open:function(select,options,onclosed){function when(action,wait){gui.Tick.time(action,wait||0)}var aside,menu,observer,that=this,multiple=select.multiple,oldindex=options.selectedIndex;if(aside=ts.ui.Aside({id:select.id||null,title:this._labeltitle(),autofocus:!1,suspendopen:!0,onbeforeopened:function(){aside.focus(),when(function(){menu.showallitems(),when(function(){aside.unsuspendopen()})},25)},onclose:function(){that._onasideclose(menu,observer)},onclosed:function(){that._onasideclosed(menu,observer),onclosed.call(that),menu.dispose(),this.dispose()}}),menu=this._menumodel=ts.ui.Menu({select:multiple?"many":"one",items:this._computemodelitems(select),selectedIndex:multiple?-1:oldindex,selectedIndexes:this._getindexes(options),maxItemsShown:this._getminimumitemscount(),search:function(item,value){return item.label.toLowerCase().startsWith(value.toLowerCase())}}),multiple){var button;this._label(function(label){(button=label.dom.q("button"))&&(menu.donebuttonlabel=button.textContent)})}observer={onchange:function(changes){changes.forEach(function(change){switch(change.object){case menu:"selectedIndex"===change.name&&change.newValue!==that._selectedIndex&&gui.Tick.time(function(){aside.close()},150),"donebuttonpressed"===change.name&&"many"===menu.select&&(that._updatestatus(menu.selectedIndexes.length),aside.close());break;case menu.selectedIndexes:menu.donebuttonenabled=!0}})}},menu.addObserver(observer),menu.selectedIndexes.addObserver(observer),aside.items.push(menu),aside.open()},_getminimumitemscount:function(){return ts.ui.MenuSpirit.$maxItemsCount()-2},_labeltitle:function(){return this._label(function(label){return label.text()})||""},_onasideclose:function(menu,observer){menu.removeObserver(observer),menu.selectedIndexes.removeObserver(observer),"one"===menu.select&&this._instantfeedback(menu.selectedIndex)},_instantfeedback:function(index){var options=this._proxyelement.options;options[index]&&(this.value=options[index].text)},_onasideclosed:function(menu,observer){switch(menu.select){case"one":this._doselectone(menu.selectedIndex);break;case"many":menu.donebuttonpressed&&this._doselectmany(menu.selectedIndexes)}this._menumodel=null},_syncfake:function(select,model){var cornercase=select.options.length&&!this.element.value;this.element.placeholder=select.getAttribute("placeholder")||"",this.element.disabled=!!select.disabled,(cornercase||[this._changedlength(select,this._optionslength,model),this._changedindex(select,this._selectedIndex,model),this._changedindexes(select,this._selectedIndexes,model)].some(function(didchange){return didchange}))&&this._updatestatus()},_changedlength:function(select,oldlength,model){var did=select.options.length!==oldlength;return did&&model&&(model.items=this._computemodelitems(select)),did},_changedindex:function(select,oldindex,model){var newindex,did=!1;return select.multiple||(did=(newindex=select.selectedIndex)!==oldindex)&&model&&(model.selectedIndex=newindex),did},_changedindexes:function(select,oldindexes,model){var newindexes,did=!1;if(select.multiple&&(newindexes=this._getindexes(select.options)).some(function(i,x){return oldindexes[x]!==i})&&(did=!0,model)){for(var list=model.selectedIndexes;list.length;)list.pop();newindexes.forEach(function(i){list.push(i)})}return did}})}(gui.Combo.chained,gui.Arguments.confirmed,ts.ui.FieldSpirit.TICK_SYNC,ts.ui.FieldSpirit.TICK_TIME,gui.Array),ts.ui.SearchSpirit=function(ButtonSpirit,CSSPlugin,Type,chained){var methodnames=["onsearch","onidle","onfocus","onblur"];return ts.ui.Spirit.extend({onconfigure:function(){ts.ui.Spirit.prototype.onconfigure.call(this),this.event.add("click").add("focus blur",this.element,this,!0),this._model||this.model(this._defaultmodel())},onevent:function(e){switch(ts.ui.Spirit.prototype.onevent.call(this,e),e.type){case"focus":case"blur":this._isfocused="focus"===e.type,this._update(this._model);break;case"click":var button=ButtonSpirit.getButton(e.target);button&&CSSPlugin.contains(button,"ts-button-clear")&&(this.dom.q(".ts-input").blur(),this.tick.time(function(){this._clear(this._model)},25))}},model:function(model){model!==this._model&&(this._model&&this._model.removeObserver(this),this._model=model,model.addObserver(this),this.script.loaded||this.script.load(ts.ui.SearchSpirit.edbml),this.script.input(model),this._update(this._model))},onchange:function(changes){ts.ui.Spirit.prototype.onchange.call(this,changes);var model=this._model;changes.forEach(function(c){if(c.object===model)switch(c.name){case"value":this._update(model)}},this)},value:{getter:function(){return this._model.value},setter:function(value){this._model.value=value}},idletime:{getter:function(){return this._model.idletime},setter:function(value){this._model.idletime=value}},onsearch:function(value){},onidle:function(value){},onfocus:function(){},onblur:function(){},focus:chained(function(){this._model.focus()}),blur:chained(function(){this._model.blur()}),info:chained(function(text){if(!arguments.length)return this._model.info;this._model.info=text}),_model:null,_defaultmodel:function(){var spirit=this,model=new ts.ui.SearchModel;return methodnames.forEach(function(method){model[method]=function(){Type.isFunction(spirit[method])&&spirit[method].apply(spirit,arguments)}}),model},_update:function(model){if(model.flex)this.css.add("ts-searching");else{var emptiness=!model.value,searching=model.value||this._isfocused,isalready=this.css.contains("ts-searching");this.css.shift(emptiness,"ts-empty").shift(searching,"ts-searching"),this.css.contains("ts-searching")!==isalready&&this.action.dispatch("ts-action-search",!isalready)}},_clear:function(model){model.flex||(this.action.dispatch("ts-action-search",!1),this.css.remove("ts-searching")),model.removeObserver(this),model.clear(),this.css.add("ts-empty"),this.tick.time(function(){model.addObserver(this)})}})}(ts.ui.ButtonSpirit,gui.CSSPlugin,gui.Type,gui.Combo.chained),ts.ui.FormSpirit=ts.ui.FormSupportSpirit.extend({onconstruct:function(){ts.ui.FormSupportSpirit.prototype.onconstruct.call(this),this.css.add(ts.ui.CLASS_FORM),this.element.getAttribute("novalidate")||this.element.setAttribute("novalidate","novalidate")},onconfigure:function(){ts.ui.FormSupportSpirit.prototype.onconfigure.call(this);var elm=this.element,method=(elm.method||"").toLowerCase();"form"!==elm.localName||this.att.get("action")||"post"===method||(elm.action=ts.ui.FormSpirit.ACTION_DEFAULT)},model:ts.ui.Spirit.createModelMethod(ts.ui.FormModel,"ts.ui.FormSpirit.edbml"),_model:null,preview:function(ispreview){ispreview="true"===ispreview,this.css.add(ts.ui.CLASS_PREVIEW)}},{summon:function(model){var spirit=this.possess(gui.HTMLParser.parse(ts.ui.form.edbml()));return model&&spirit.render(model),spirit}},{ACTION_DEFAULT:gui.IframeSpirit.SRC_DEFAULT}),ts.ui.AutocompleteDropdownSpirit=function(Client){function getLocale(){return ts.ui.Autocomplete.localize()}var KeyCodes={TAB:9,ENTER:13,ESC:27,UP:38,DOWN:40,getKeyCode:function(e){return window.event?event.keyCode:e.keyCode?e.keyCode:e.which}};return ts.ui.Spirit.extend({_isActive:!1,proxy:function(element){this._proxyelement=element,this._proxyspirit=ts.ui.get(element),["keyup","keydown","focus","input","blur","change"].forEach(function(event){this.event.add(event,element,this)},this)},data:function(d){this._model.autocompleteList=d},onfilter:function(f){this._model.onfilter=f},onselect:function(f){this._model.onselect=f},onconstruct:function(){ts.ui.Spirit.prototype.onconstruct.call(this),this._model=new ts.ui.AutocompleteDropdownModel,this._locale=getLocale()},onenter:function(){ts.ui.Spirit.prototype.onenter.call(this),this.script.load(ts.ui.AutocompleteDropdownSpirit.edbml),this.script.input(this._model)},ondestuct:function(){ts.ui.Spirit.prototype.prototype.call(this),delete this._model.autocompleteList,delete this._model.filteredAutocompleteList,this._model.dispose()},onevent:function(e){ts.ui.Spirit.prototype.onevent.call(this,e),["keyup","keydown","focus","input","blur"].indexOf(e.type)>-1&&this["on"+e.type](e)},onkeydown:function(e){var autocompleteElem=this._getelem();if(autocompleteElem){var selectedElem=this._getselected(),keyCode=KeyCodes.getKeyCode(e);keyCode===KeyCodes.UP&&selectedElem!==autocompleteElem.firstChild?this._select("previous"):keyCode===KeyCodes.DOWN&&selectedElem!==autocompleteElem.lastChild?this._select("next"):keyCode===KeyCodes.ENTER?-1===selectedElem.className.indexOf("ts-autocomplete-results")&&(this._selectelem(selectedElem),autocompleteElem.scrollTop=0,this._render()):keyCode!==KeyCodes.TAB&&keyCode!==KeyCodes.ESC||this.onblur(null,!0),keyCode!==KeyCodes.UP&&keyCode!==KeyCodes.DOWN&&keyCode!==KeyCodes.ENTER||e.preventDefault()}},onkeyup:function(e){if(this._getelem()&&this._isActive&&this._model.filteredAutocompleteList.length){var keyCode=KeyCodes.getKeyCode(e);keyCode!==KeyCodes.ESC&&keyCode!==KeyCodes.UP&&keyCode!==KeyCodes.DOWN||e.stopPropagation()}},onfocus:function(){this._isActive=!0,this._render()},oninput:function(){this.onfocus()},onblur:function(e,isNow){var onblurAction=function(){this._isActive=!1,this.script.run()}.bind(this);isNow?onblurAction():this.tick.time(onblurAction,Client.isExplorer?300:100)},_getelem:function(){return document.getElementById(this._model.$instanceid+"-list")},_getselected:function(){return this._getelem().querySelector(".ts-autocomplete-selected")},_scroll:function(elem){if(elem)for(var elemRect=elem.getBoundingClientRect(),elemHeight=elemRect.bottom-elemRect.top,elemSiblings=elem.parentNode.childNodes,elemIdx=0;elemIdx<elemSiblings.length;elemIdx++)if(elemSiblings[elemIdx]===elem)return void(this._getelem().scrollTop=elemIdx*elemHeight)},_select:function(direction){var selectedElem=this._getselected();this._unselect(),(selectedElem=selectedElem[direction+"Sibling"]).className+=" ts-autocomplete-selected",this._scroll(selectedElem)},_unselect:function(){var childrenItems=this._getelem().children;if(childrenItems.length>1)for(var i=0;i<childrenItems.length;i++)childrenItems[i].className=childrenItems[i].className.replace("ts-autocomplete-selected","")},_selectelem:function(elem){var item={key:"",value:""};try{item=JSON.parse(elem.getAttribute("data-item"))}catch(e){console.warn("Invalid JSON item!",e)}this._onselect(item,!1)},_onselect:function(item,noBlur){this._proxyelement.value=this._model.onselect(item),noBlur||this.onblur(null,!0)},_render:function(){var filter=this._proxyelement.value;this._model.onfilter?this._model.filteredAutocompleteList=this._model.onfilter(filter):this._model.filteredAutocompleteList=[],this.script.run(this._locale.matchString);var autocompleteElem=this._getelem();null!==autocompleteElem&&(this._model.filteredAutocompleteList.length>0&&(autocompleteElem.firstChild.className+=" ts-autocomplete-selected"),this._scroll(autocompleteElem.firstChild))}},{summon:function(){return this.possess(document.createElement("div"))}})}(gui.Client),ts.ui.AutocompleteInputSpirit=function(chained){return ts.ui.TextInputSpirit.extend({onready:function(){ts.ui.TextInputSpirit.prototype.onready.call(this),this._getdropdown().proxy(this.element),this._label(function(label){label.css.add("ts-autocompletelabel")})},data:chained(function(d){this._getdropdown().data(d)}),onfilter:chained(function(f){return this._getdropdown().onfilter(f),this}),onselect:chained(function(f){return this._getdropdown().onselect(f),this}),_getdropdown:function(){var AutocompleteDropdown=ts.ui.AutocompleteDropdownSpirit,dropdown=this.dom.following(AutocompleteDropdown);return dropdown[0]?dropdown[0]:this.dom.after(AutocompleteDropdown.summon())}})}(gui.Combo.chained),ts.ui.FormsModule=gui.module("forms-gui@tradeshift.com",{channel:[["[data-ts=Form]",ts.ui.FormSpirit],["[data-ts=FieldSet]",ts.ui.FieldSetSpirit],["[data-ts=Label]",ts.ui.LabelSpirit],["[data-ts=Switch]",ts.ui.SwitchSpirit],["[data-ts=Option]",ts.ui.OptionSpirit],["[data-ts=Input]",ts.ui.TextInputSpirit],["[data-ts=DateInput]",ts.ui.DateInputSpirit],["[data-ts=TextArea]",ts.ui.TextAreaSpirit],["[data-ts=Select]",ts.ui.SelectSpirit],["[data-ts=Search]",ts.ui.SearchSpirit],["[data-ts=AutoComplete]",ts.ui.AutocompleteInputSpirit],["[data-ts=Calendar]",ts.ui.CalendarSpirit],["fieldset.ts-form",ts.ui.FieldSetSpirit],["label.ts-form",ts.ui.LabelSpirit],["[data-ts=FakeDateInput]",ts.ui.FakeDateInputSpirit],["[data-ts=FakeSelectInput]",ts.ui.FakeSelectInputSpirit]],channelComplexSelectors:function(enabled){enabled&&!this._channeled&&(this._channeled=!0,gui.channel([[".ts-form fieldset",ts.ui.FieldSetSpirit],[".ts-form label",ts.ui.LabelSpirit],[".ts-form span",ts.ui.LabelTextSpirit],[".ts-form input[type=date]",ts.ui.DateInputSpirit],[".ts-form span + input[type=checkbox]",ts.ui.SwitchSpirit],[".ts-form input[type=checkbox], .ts-form input[type=radio]",ts.ui.OptionSpirit],[".ts-form input + input",ts.ui.Spirit],[".ts-form input",ts.ui.TextInputSpirit],[".ts-form textarea",ts.ui.TextAreaSpirit],[".ts-form select",ts.ui.SelectSpirit]]))},_channeled:!1}),ts.ui.ObjectSpirit=function(Type,chained,confirmed){return ts.ui.Spirit.extend({id:{getter:function(){return this._guid},setter:function(guid){this._guid=guid,this._model=null,this.input.connect(this.constructor.collection)}},details:{getter:function(){return this._details},setter:function(enable){""===enable&&(enable=!0),Type.isBoolean(enable)&&(this._toggledetails(enable,this.element),this._details=enable)}},onconfigure:function(){ts.ui.Spirit.prototype.onconfigure.call(this);var script;this.css.add("ts-object"),this.script.load(ts.ui.ObjectSpirit.edbml),(script=this.dom.q('script[type="application/json"]'))?this.render(JSON.parse(script.textContent)):this.script.run(this._model)},onevent:function(e){switch(ts.ui.Spirit.prototype.onevent.call(this,e),e.type){case"click":this._details&&this.open()}},render:confirmed("object")(chained(function(json){this._assignmodel(json)&&(this._guid=this._model.id,this.script.run(this._model))})),open:function(){},_assignmodel:function(data){var Model=this.constructor.model;return data&&(this._model&&this._model.dispose(),this._model=Model.from(data)),null!==this._model},oninput:function(input){ts.ui.Spirit.prototype.oninput.call(this,input);var Collection=this.constructor.collection;if(input.type===Collection){var thismodel=input.data.get(this.id);thismodel&&(this.input.disconnect(Collection),this._assignmodel(thismodel),this.script.loaded&&this.script.run(thismodel))}},_guid:null,_model:null,_details:!1,_toggledetails:function(on,elm){this.css.shift(on,"ts-has-details"),this.event.shift(on,"click"),this.dom.tag().match(/button|a/)||(elm.tabIndex=on?this.att.get("tabindex")||0:-1)}},{model:ts.ui.ObjectModel,collection:ts.ui.ObjectCollection})}(gui.Type,gui.Combo.chained,gui.Arguments.confirmed),ts.ui.CardSpirit=function(Card){var specialclasses=[Card.TYPE_COMPACT,Card.TYPE_INLINE,Card.TYPE_DETAILS];return ts.ui.ObjectSpirit.extend({onconfigure:function(){var mock=this.constructor.MOCK_MODEL;mock&&!this._model&&(this._model=mock),ts.ui.ObjectSpirit.prototype.onconfigure.call(this)},onenter:function(){ts.ui.ObjectSpirit.prototype.onenter.call(this),this._classnames(this.css)},_classnames:function(css){css.add("ts-card"),specialclasses.some(function(cname){return css.contains(cname)})||css.add(Card.TYPE_DEFAULT)}})}(ts.ui.Card),ts.ui.CompanyCardSpirit=ts.ui.CardSpirit.extend({onrender:function(){ts.ui.CardSpirit.prototype.onrender.call(this)},open:function(){if(!this._model)throw new Error(this+" has no data");this._openaside(ts.ui.CompanyCardModel.from(this._model)),console.warn("This is an experimental feature. Please don't use it.")},_openaside:function(clone){clone.type="ts-details";var aside=ts.ui.Aside({title:clone.data.name||"",items:[clone,{item:"menu",items:["Create Document\u2026","Invite","Categorize As\u2026","Properties\u2026","Remove Company"].map(function(label){return{label:label}})}]}).open();!function(menu){menu.addObserver({onchange:function(changes){"selectedIndex"===changes[0].name&&(aside.close(),aside.onclosed=function(){ts.ui.Notification.success("To be continued..."),menu.removeObserver(this),aside.dispose()})}})}(aside.items[1])}},{model:ts.ui.CompanyCardModel,collection:ts.ui.CompanyCardCollection,MOCK_MODEL:new ts.ui.CompanyCardModel({id:gui.KeyMaster.generateGUID(),mock:!0,data:{name:"Company Name",size:"123",location:"Company Location, Country",industry:"Company Industry"}})}),ts.ui.UserImageSpirit=ts.ui.ImageSpirit.extend({}),ts.ui.UserCardSpirit=function(UserCard){return ts.ui.CardSpirit.extend({open:function(){var clone=ts.ui.UserCardModel.from(this._model);clone.type="ts-details",ts.ui.Aside({title:UserCard.localize("userDetails"),items:[clone],onclosed:function(){this.dispose()}}).open()}},{model:ts.ui.UserCardModel,collection:ts.ui.UserCardCollection})}(ts.ui.UserCard),gui.module("objects-gui@tradeshift.com",{channel:[["[data-ts=CompanyCard]",ts.ui.CompanyCardSpirit],["[data-ts=UserImage]",ts.ui.UserImageSpirit],["[data-ts=UserCard]",ts.ui.UserCardSpirit]]}),ts.ui.BarSpirit=function(TopBar,Client,chained,UNIT_DOUBLE,UNIT_TRIPLE){return ts.ui.Spirit.extend({onevent:function(e){ts.ui.Spirit.prototype.onevent.call(this,e),"scroll"===e.type&&this._slide(e.target.scrollTop)},hide:function(){alert("TODO!")},show:function(){alert("TODO!")},$setmain:chained(function(main){this._main=main,this._onbreakpoint(),this._slide(main.scrollTop)}),$getmain:function(){return this._main||(this._main=this.dom.qdoc(".ts-main"))},_scroll:0,_main:null,_initbreakpoint:function(attach){this.$getmain()&&Client.has3D&&(this.sprite.y=0,attach?(this._onbreakpoint(),this._breakfunction=function(newpoint,oldpoint){this._onbreakpoint(),oldpoint&&"mobile"===oldpoint&&(this.sprite.y=0)}.bind(this),ts.ui.addBreakPointListener(this._breakfunction)):this._breakfunction&&ts.ui.removeBreakPointListener(this._breakfunction))},_onbreakpoint:function(){var main=this.$getmain(),mobi=ts.ui.isMobilePoint();this._scroll=main.scrollTop,this.event.shift(mobi,"scroll",main,this)},_slide:function(scroll){if(Client.has3D){var stop=0-this._offsetLimit(),delt=scroll-this._scroll,next=0;(delt>0?this.sprite.y>stop:this.sprite.y<0)&&(next=(next=(next=this.sprite.y-delt)<stop?stop:next)>0?0:next,this.sprite.y=next),this._scroll=scroll}},_offsetLimit:function(){return UNIT_TRIPLE+(TopBar.tabs().length?UNIT_DOUBLE:0)}})}(ts.ui.TopBar,gui.Client,gui.Combo.chained,ts.ui.UNIT_DOUBLE,ts.ui.UNIT_TRIPLE),function(methods){var proto=ts.ui.BarSpirit.prototype,names=Object.keys(methods).map(function(key){return methods[key]});gui.Object.each(methods,function(method,classname){proto[method]=function(){return(this._model||{}).color=classname,this.css.remove(names).add(classname),this}})}(ts.ui.BACKGROUND_COLORS),ts.ui.ToolBarSpirit=function(chained,confirmed,Client,Type,guiArray,CSSPlugin,DOMPlugin,TextModel,SearchModel,TopBar,ButtonModel,bgcolors){function hasflex(li){return CSSPlugin.contains(li,"ts-flex")}function nonflex(li){return!CSSPlugin.contains(li,"ts-flex")}function sumwidth(sum,li){return sum+li.offsetWidth}return ts.ui.BarSpirit.extend({visible:{getter:function(){return this._visible},setter:function(is){is!==this._visible&&((this._visible=is)?this.dom.show():this.dom.hide(),this._layoutmain(is))}},onenter:function(){this._validate(),ts.ui.BarSpirit.prototype.onenter.call(this),this.action.add([edbml.ACTION_RENDER,"ts-action-search"]),this.css.name().includes("ts-bg")||this.lite()},onready:function(){ts.ui.BarSpirit.prototype.onready.call(this),[ts.ui.CLASS_MICRO,ts.ui.CLASS_MACRO].some(function(cname){return this.css.contains(cname)},this)||this.macro()},onattach:function(){ts.ui.BarSpirit.prototype.onattach.call(this),this._layoutmain(!0)},ondetach:function(){ts.ui.BarSpirit.prototype.ondetach.call(this),this._layoutmain(!1)},onaction:function(a){switch(ts.ui.BarSpirit.prototype.onaction.call(this,a),a.type){case edbml.ACTION_RENDER:this._flex();break;case"ts-action-search":var li=this.dom.q(".ts-toolbar-search");CSSPlugin.shift(li,a.data,"ts-searching"),this._flex()}},onevent:function(e){ts.ui.BarSpirit.prototype.onevent.call(this,e);var title=this.dom.q(".ts-toolbar-title"),search=this.dom.q(".ts-search",ts.ui.SearchSpirit);title&&search&&DOMPlugin.contains(title,e.target)&&search.focus()},onchange:function(changes){ts.ui.BarSpirit.prototype.onchange.call(this,changes),changes.forEach(function(c){"hascontent"===c.name&&this.$hascontent(c.newValue)},this)},ondestruct:function(){ts.ui.BarSpirit.prototype.ondestruct.call(this),this._ismodelled()&&this._model.removeObserver(this)},puttabs:function(tabs){var self=this,model=this._model,selecteditem=null,aside=ts.ui.Aside({title:TopBar.localize("more"),onclosed:function(){this.dispose(),selecteditem&&self._arraymove(tabs,selecteditem,1)}});aside.items.push(ts.ui.Menu({onselect:function(index){var item=this.items[index];selecteditem=item.id,aside.close()},items:tabs.filter(function(tab){return!tab.$isontop}).map(function(tab){return{label:tab.label,id:tab.$instanceid}}).reverse()})),this._matchcolor(aside,model).open()},putaside:function(buttons,color){var selected=null,morphed=[];buttons.forEach(function transmorph(button){if(ts.ui.Collection.is(button))button.forEach(transmorph);else{var data=JSON.parse(JSON.stringify(button)),clone=new ButtonModel(data);clone.onclick=function(){selected=button,aside.close()},morphed.push(clone)}});var aside=ts.ui.Aside({title:TopBar.localize("options"),items:[ts.ui.Buttons({items:morphed.reverse()})],onclosed:function(){this.dispose(),selected&&selected.onclick&&selected.click()}});this._matchcolor(aside,this._model).open()},macro:chained(function(){this.css.remove(ts.ui.CLASS_MICRO).add(ts.ui.CLASS_MACRO)}),micro:chained(function(){this.css.remove(ts.ui.CLASS_MACRO).add(ts.ui.CLASS_MICRO)}),title:confirmed("(string|null)")(chained(function(opt_title){var model=this.model();if(!arguments.length)return model.title;0!==(opt_title=opt_title||"").trim().indexOf("{")&&(model.title=opt_title,this.event.add("click"),this.$hascontent())})),search:confirmed("(object)")(chained(function(opt_json){var model=this.model();if(!arguments.length)return model.search||this.search({}),model.search;this.$hascontent(),model.search&&model.search.dispose(),model.search=SearchModel.from(opt_json),model.search.inset=!0})),buttons:confirmed("(array)")(chained(function(opt_json){var buttons=this.model().buttons;if(!arguments.length)return buttons;this.$hascontent(),buttons.clear(),opt_json.forEach(function(json){buttons.push(json)})})),tabs:confirmed("(array)")(chained(function(opt_json){var tabs=this.model().tabs;if(!arguments.length)return tabs;this.$hascontent(),tabs.clear(),opt_json.forEach(function(json){tabs.push(json)})})),actions:chained(function(json){var model=this.model();if(!arguments.length)return model.actions;model.actions=json}),compact:chained(function(){this.model().compact=!0}),uncompact:chained(function(){this.model().compact=!1}),model:ts.ui.Spirit.createModelMethod(ts.ui.ToolBarModel,"ts.ui.ToolBarSpirit.edbml",function(model){model.addObserver(this)}),onrender:function(summary){ts.ui.BarSpirit.prototype.onrender.call(this,summary),this._layout()},onflex:function(){ts.ui.BarSpirit.prototype.onflex.call(this),this._layout()},hide:chained(function(){this.visible&&(this.visible=!1)}),show:chained(function(){this.visible||(this.visible=!0)}),clear:chained(function(){var model=this.model();model.buttons.clear(),model.tabs.clear(),model.search=null,model.pager=null,model.title=null}),showConfig:confirmed("(function)")(chained(function(onconfig){this.model().configbutton={onclick:onconfig}})),hideConfig:chained(function(){this.model().configbutton=null}),showClose:confirmed("(function)")(chained(function(onclose){this.model().closebutton={onclick:onclose}})),hideClose:chained(function(){this.model().closebutton=null}),$hascontent:function(has){this.life.hascontent=has=!arguments.length||has,this.life.dispatch(has?"ts-life-toolbar-hascontent":"ts-life-toolbar-nocontent")},_visible:!0,_validate:function(){this.element.childElementCount&&console.error("The "+this.$classname+" should not have HTML content.")},_layout:function(){this.element.offsetWidth&&(this._flex(),this._ismodelled()&&this._calculate(this._model.tabs))},_layoutmain:function(show){this.guilayout.outsideMain()&&(this.guilayout.beforeMain()?(this._looknormal(this.css),this._layoutbefore(show),this._initbreakpoint(show)):this.guilayout.afterMain()&&(this.dom.ancestor(ts.ui.FooterBarSpirit)||(this._looknormal(this.css),this._layoutafter(show))))},_layoutbefore:function(show){this.css.shift(show,"ts-toolbar-first");var klass="ts-has-toolbar-first-"+(this.css.contains(ts.ui.CLASS_MICRO)?"ts-micro":"ts-macro");this._outsidemodal()&&this.guilayout.shiftGlobal(show,klass)},_layoutafter:function(show){this.css.shift(show,"ts-toolbar-last"),this._outsidemodal()&&(this.guilayout.shiftGlobal(show,"ts-has-footer"),this.action.dispatch(ts.ui.ACTION_FOOTER_LEVEL,show?3:0))},_outsidemain:function(){return["ts-toolbar-first","ts-toolbar-last"].some(function(cname){return this.css.contains(cname)},this)},_outsidemodal:function(){return!this.css.matches(".ts-modal .ts-toolbar")},_looknormal:function(css){var mobile=ts.ui.isMobilePoint();["ts-toolbar-first","ts-toolbar-last"].some(function(klass){return css.contains(klass)})&&(css.right=mobile?Client.scrollBarSize:"")},_matchcolor:function(spirit,model){return gui.Object.each(bgcolors,function(methodname,classname){classname===model.color&&spirit[methodname]()}),spirit},_flex:function(){var avail=this.box.width,lefts=this.dom.qall(".ts-left > li"),right=this.dom.qall(".ts-right > li"),extra=this.dom.qall(".ts-center > li"),items=lefts.concat(right),small=avail<=768;this._cnames(small,lefts,right,extra),small&&this.css.contains("ts-statusbar")?this._flexnone(items.concat(extra)):extra.length?(avail=.5*(avail-extra.reduce(sumwidth,0)),this._flexnext(avail,lefts),this._flexnext(avail,right)):this._flexnext(avail,items)},_flexnext:function(avail,items){var flexitems=items.filter(hasflex),fixtitems=items.filter(nonflex);flexitems.length?(avail-=fixtitems.reduce(sumwidth,0),avail/=flexitems.length,flexitems.forEach(function(li){li.style.width=avail+"px"})):this._flexnone(items)},_flexnone:function(items){items.forEach(function(item){item.style.width=""})},_cnames:function(small,lefts,right,extra){var search=this.dom.q(".ts-toolbar-search");this._docss(this.css,small,lefts.length,right.length,extra.length,search)},_docss:function(css,small,lefts,right,extra,search){css.shift(small,"ts-small").shift(lefts,"ts-hasleft").shift(right,"ts-hasright").shift(extra,"ts-hascenter").shift(search,"ts-hassearch").shift(!search,"ts-nosearch")},_onbreakpoint:function(){ts.ui.BarSpirit.prototype._onbreakpoint.call(this),this._looknormal(this.css)},_calculate:function(tabs){var moretab,gonetab,avail,width,dofit;tabs&&tabs.getLength()&&(moretab=this.dom.q(".ts-tab-more",ts.ui.Spirit))&&(moretab.css.display="",avail=this._getavailwidth(22),this._setmaxwidth(avail),width=44,dofit=this._toggletabs(tabs,width,avail),moretab.css.display=dofit?"none":"",dofit||(gonetab=tabs.find(function(tab){return tab.selected&&!tab.$isontop}))&&this._arraymove(tabs,gonetab.$instanceid,1))},_setmaxwidth:function(avail){var maxwidth=(avail-95)/2;this.dom.qall(".ts-tab-label").forEach(function(tab){tab.style.maxWidth=maxwidth+"px"})},_arraymove:function(arr,id,toIndex){var fromIndex=-1,element=arr.find(function(item,index){return fromIndex=index,item.$instanceid===id});element.selected=!0,arr.splice(fromIndex,1),arr.splice(toIndex,0,element)},_toggletabs:function(tabs,moreoffset,availwidth){var tabspirit,taboffset,that=this,tabsoffset=0,oldie=Client.isExplorer9||Client.isExplorer10,getspirit=function(tabmodel){return that.dom.q("#"+tabmodel.$instanceid,ts.ui.Spirit)};return tabs.filter(function(tabmodel){return!!getspirit(tabmodel)}).reduce(function(isontop,tabmodel){return tabspirit=getspirit(tabmodel),isontop&&(tabspirit.css.display="",taboffset=tabspirit.box.width+(oldie?1:0),isontop=tabsoffset+taboffset<availwidth-moreoffset),isontop?(tabsoffset+=taboffset,tabmodel.$isontop=!0):(tabspirit.css.display="none",tabmodel.$isontop=!1),tabmodel.$isontop},!0)},_getavailwidth:function(buffer){var right=this.dom.q(".ts-right"),center=this.dom.q(".ts-center");return this.box.width-(right?right.offsetWidth:0)-(center?center.offsetWidth:0)-(buffer||0)}},{summon:function(tagname,classname){var tag=tagname?tagname.toLowerCase():"menu",elm=document.createElement(tag);return elm.className=classname||"",this.possess(elm)}})}(gui.Combo.chained,gui.Arguments.confirmed,gui.Client,gui.Type,gui.Array,gui.CSSPlugin,gui.DOMPlugin,ts.ui.TextModel,ts.ui.SearchModel,ts.ui.TopBar,ts.ui.ButtonModel,ts.ui.BACKGROUND_COLORS),ts.ui.TopBarSpirit=function(TopBar,Client,chained,confirmed){var HAS_TOPBAR=ts.ui.CLASS_HAS_TOPBAR,HAS_TOPBAR_TABS=ts.ui.CLASS_HAS_TOPBAR_TABS,TOPBAR_READY=ts.ui.BROADCAST_GLOBAL_TOPBAR_READY,CLASS_HIDDEN=ts.ui.CLASS_HIDDEN;return ts.ui.ToolBarSpirit.extend({onconstruct:function(){ts.ui.ToolBarSpirit.prototype.onconstruct.call(this),this.life.hascontent=!1,this._model=ts.ui.TopBar.$getmodel(),this._matchcolor(this,this._model),this.script.load(ts.ui.ToolBarSpirit.edbml),this.script.input(this._model),this._model.addObserver(this)},ondestruct:function(){ts.ui.ToolBarSpirit.prototype.ondestruct.call(this),this.model().removeObserver(this)},onconfigure:function(){ts.ui.ToolBarSpirit.prototype.onconfigure.call(this),this.sprite.y=0,this.css.remove(ts.ui.CLASS_MICRO).add(ts.ui.CLASS_MACRO)},onenter:function(){this.css.name().includes("ts-bg")||this.dark(),ts.ui.ToolBarSpirit.prototype.onenter.call(this)},onattach:function(){ts.ui.Spirit.prototype.onattach.call(this),this._initbreakpoint(!0)},ondetach:function(){ts.ui.Spirit.prototype.ondetach.call(this),this._initbreakpoint(!1);var root=ts.ui.get(document.documentElement);root.css.remove(HAS_TOPBAR),root.css.remove(HAS_TOPBAR_TABS),root.reflex()},onready:function(){ts.ui.ToolBarSpirit.prototype.onready.call(this),this.broadcast.dispatchGlobal(TOPBAR_READY)},onrender:function(summary){ts.ui.ToolBarSpirit.prototype.onrender.call(this,summary);var tbar=this._model;if(this._setclasses(),this.element.offsetWidth&&this._calculate(tbar.tabs),gui.spiritualized&&tbar.hascontent&&!this._reflexfixed){var root=document.documentElement;ts.ui.get(root).reflex(),this._reflexfixed=!0}},onchange:function(changes){ts.ui.ToolBarSpirit.prototype.onchange.call(this,changes),changes.forEach(function(c){switch(c.name){case"color":this._matchcolor(this,this._model);break;case"visible":this._setclasses()}},this)},title:confirmed("(string)")(chained(function(opt_string){if(!arguments.length)return ts.ui.TopBar.title();0!==opt_string.trim().indexOf("{")&&(this.$hascontent(),ts.ui.TopBar.title(opt_string),this.event.add("click"),this.$hascontent())})),model:function(){if(arguments.length)throw new Error("Cannot assign :/");return this._model},hide:function(){throw new Error("Please use ts.ui.TopBar.hide()")},show:function(){throw new Error("Please use ts.ui.TopBar.show()")},_reflexfixed:!1,_layoutinit:function(attaching){},_looknormal:function(css){css.right=ts.ui.isMobilePoint()?Client.scrollBarSize:""},_offsetLimit:function(){var stop=ts.ui.ToolBarSpirit.prototype._offsetLimit.call(this);if(ts.ui.isMobilePoint()){var tabs=this.dom.q(".ts-toolbar-tabs",ts.ui.TopBarTabsSpirit);tabs&&tabs.isOpen&&(stop=tabs.$offsetLimit())}return stop},_setclasses:function(){var tbar=this._model,show=this._shouldshow(tbar,ts.ui.breakpoint),tabs=this.dom.q(".ts-topbar-tabs"),root=ts.ui.get(document.documentElement);root.css.shift(show,HAS_TOPBAR),root.css.shift(tabs,HAS_TOPBAR_TABS),this.css.shift(!show,CLASS_HIDDEN)},_shouldshow:function(tbar,breakpoint){return"mobile"===breakpoint||tbar.visible&&(this.life.hascontent||tbar.hascontent||tbar.hadcontent)}})}(ts.ui.TopBar,gui.Client,gui.Combo.chained,gui.Arguments.confirmed),ts.ui.TopBarTabsSpirit=ts.ui.Spirit.extend({isOpen:!1,onready:function(){ts.ui.Spirit.prototype.onready.call(this),this.input.connect(ts.ui.LayoutModel)},ondestruct:function(){ts.ui.Spirit.prototype.ondestruct.call(this),this.input.disconnect(ts.ui.LayoutModel)},oninput:function(input){ts.ui.Spirit.prototype.oninput.call(this,input),input.type===ts.ui.LayoutModel&&(this._onbreakpoint(input.data.isMobilePoint()),input.data.addObserver(this))},onchange:function(changes){ts.ui.Spirit.prototype.onchange.call(this,changes),changes.forEach(function(c){c.object instanceof ts.ui.LayoutModel&&this._onbreakpoint(c.object.isMobilePoint())},this)},onevent:function(e){switch(ts.ui.Spirit.prototype.onevent.call(this,e),e.type){case"click":this.event.remove("click"),ts.ui.isMobilePoint()&&this._toggle()}},ontween:function(t){ts.ui.Spirit.prototype.ontween.call(this,t),"ts-tween-tabs"===t.type&&(this._expand(t.value),t.done&&(this.tween.remove(t.type),this._ontoggle()))},onbroadcast:function(b){switch(ts.ui.Spirit.prototype.onbroadcast.call(this,b),b.type){case gui.BROADCAST_MOUSECLICK:this.broadcast.removeGlobal(b.type),this._time=this.tick.time(function(){this.isOpen&&this._toggle()},100)}},onaction:function(a){ts.ui.Spirit.prototype.onaction.call(this,a),a.type===ts.ui.ACTION_GLOBAL_LOAD&&(this._loadargs=a.data,a.consume())},$offsetLimit:function(){var items=this.dom.qall("li",ts.ui.Spirit),stops=Number.MAX_VALUE;if(items.length){var last=items.pop(),init=ts.ui.UNIT_TRIPLE;stops=last.sprite.y+last.box.height+init-window.innerHeight}return stops},_items:null,_time:-1,_down:!1,_loadargs:null,_toggle:function(reset){this._items=this.dom.qall("li",ts.ui.Spirit),this._items.length>1&&this.css.shift(this.isOpen=!this.isOpen,ts.ui.CLASS_OPEN),reset?(this._expand(1),this._ontoggle()):(this.tick.cancelTime(this._time),this.broadcast.removeGlobal(gui.BROADCAST_MOUSECLICK),this.tween.addDispatch("ts-tween-tabs",{duration:ts.ui.TRANSITION_NOW,timing:"ease-out"}))},_ontoggle:function(){var root=ts.ui.get("html"),load=ts.ui.ACTION_GLOBAL_LOAD,args=this._loadargs;this.isOpen?(this.broadcast.addGlobal(gui.BROADCAST_MOUSECLICK),root.action.addGlobal(load,this)):(root.action.removeGlobal(load,this),args&&(root.action.dispatchGlobal(load,args),this._loadargs=null),this.tick.time(function(){this.event.add("click")}))},_expand:function(value){value=this.isOpen?value:1-value,this._items.forEach(function(spirit,index){spirit.life.destructed||(spirit.sprite.y=44*value*index)})},_onbreakpoint:function(mobile){this.event.shift(mobile,"click"),!mobile&&this.isOpen&&this._toggle(!0)}}),ts.ui.TabBarSpirit=function(CLASS_MACRO,CLASS_MICRO){return ts.ui.ToolBarSpirit.extend({onconfigure:function(){ts.ui.ToolBarSpirit.prototype.onconfigure.call(this),this.css.contains(CLASS_MACRO)||this.micro()},title:function(){console.error("The TabBar doesn't support a title :(")}})}(ts.ui.CLASS_MACRO,ts.ui.CLASS_MICRO),ts.ui.StatusBarSpirit=function(PagerModel,Type,chained,confirmed){return ts.ui.ToolBarSpirit.extend({onlink:null,onlayout:null,message:confirmed("(string)")(function(text){return this.title.apply(this,arguments)}),checkbox:chained(function(json){var model=this.model();if(!arguments.length)return model.checkbox;model.checkbox=json}),pager:confirmed("(object|null)")(chained(function(opt_json){var model=this.model();if(!arguments.length)return model.pager||this.pager({}),model.pager;model.pager&&model.pager.dispose(),model.pager=null===opt_json?null:PagerModel.from(opt_json)})),tabs:function(){throw new Error("The StatusBar doesn't support tabs :(")},model:ts.ui.Spirit.createModelMethod(ts.ui.StatusBarModel,"ts.ui.ToolBarSpirit.edbml",function(model){model.addObserver(this)})})}(ts.ui.PagerModel,gui.Type,gui.Combo.chained,gui.Arguments.confirmed),ts.ui.HeaderBarSpirit=ts.ui.Spirit.extend({_topbar:null,_tabbar:null,_toolbar:null}),ts.ui.FooterBarSpirit=function(chained,confirmed,GuiArray,PagerModel,ToolBarSpirit,Type){function box(elm){return elm.getBoundingClientRect()}return ts.ui.Spirit.extend({visible:{getter:function(){return this._visible},setter:function(is){is!==this._visible&&((this._visible=is)?this.dom.show():this.dom.hide(),this._layout())}},onlink:null,model:ts.ui.Spirit.createModelMethod(ts.ui.FooterBarModel,"ts.ui.FooterBarSpirit.edbml"),onenter:function(){ts.ui.Spirit.prototype.onenter.call(this),this.guilayout.outsideMain()&&(this.css.add("ts-mainfooter ts-bg-lite"),this.guilayout.shiftGlobal(!0,"ts-has-footer"))},onflex:function(){ts.ui.Spirit.prototype.onflex.call(this),this._optimize(!0)},onaction:function(a){ts.ui.Spirit.prototype.onaction.call(this,a),a.type===ts.ui.ACTION_SAFE_LINK&&((this.onlink||function(){}).call(this,a.data),a.consume())},buttons:chained(function(json){var model=this.model();if(!arguments.length)return model.buttons;null===json?model.buttons.clear():model.buttons=json}),actions:chained(function(json){var model=this.model();if(!arguments.length)return model.actions;null===json?model.actions.clear():model.actions=json}),pager:chained(function(json){var model=this.model();if(!arguments.length)return model.pager;model.pager=json,this._pagerchanged=!0}),checkbox:chained(function(json){var model=this.model();if(!arguments.length)return model.checkbox;model.checkbox=json}),status:chained(function(message){var model=this.model();if(!arguments.length)return model.status;model.status=message}),configbutton:chained(function(onclick){return this.model().configbutton.apply(this.model(),arguments)}),collabbutton:chained(function(onclick){return this.model().collabbutton.apply(this.model(),arguments)}),onrender:function(summary){ts.ui.Spirit.prototype.onrender.call(this,summary),summary.first&&([this._actionbar=this._getbar(".ts-footerbar-actionbar"),this._centerbar=this._getbar(".ts-footerbar-centerbar"),this._backupbar=this._getbar(".ts-footerbar-backupbar"),this._bufferbar=this._getbar(".ts-footerbar-bufferbar")].forEach(function(spirit){spirit.life.add(gui.LIFE_RENDER,this)},this),this._layout()),this._refresh()},onlife:function(l){if(ts.ui.Spirit.prototype.onlife.call(this,l),l.type===gui.LIFE_RENDER){switch(l.target){case this._bufferbar:this._optimize();break;case this._centerbar:this._pagerchanged&&(this._pagerchanged=!1,this._optimize())}this._layout()}},hide:chained(function(){this.visible&&(this._hidden=!0,this.visible=!1)}),show:chained(function(){this.visible||(this._hidden=!1,this.visible=!0)}),clear:chained(function(){this.model().clear()}),linkable:confirmed("(function)")(chained(function(onlink){this.model().linkable(!0),this.action.add(ts.ui.ACTION_SAFE_LINK),this.onlink=onlink||null})),unlinkable:chained(function(){this.model().linkable(!1),this.remove.add(ts.ui.ACTION_SAFE_LINK),this.onlink=null}),_visible:!0,_hidden:!1,_buffer:null,_conflict:!1,_oncheckboxclick:null,_pagerchanged:!1,_bufferbar:null,_actionbar:null,_centerbar:null,_backupbar:null,_getbar:function(selector){return this.dom.q(selector,ToolBarSpirit)},_optimize:function(flexing){var model=this.model(),buttons=model.bufferbar.buttons,actions=model.bufferbar.actions;if(!flexing||buttons.length){var hits=this._hittest();this._optimizebuttons(model,gui.Array.from(buttons),hits),this._optimizeactions(model,gui.Array.from(actions),hits)}},_optimizebuttons:function(model,clone,hits){hits?(model.backupbar.buttons=clone,model.centerbar.buttons.clear()):(model.centerbar.buttons=clone,model.backupbar.buttons.clear())},_optimizeactions:function(model,clone,hits){hits?(model.centerbar.actions.clear(),model.backupbar.actions=clone):(model.backupbar.actions.clear(),model.centerbar.actions=clone)},_hittest:function(){var pager=this._centerbar.dom.q(".ts-toolbar-pager"),butts=this._bufferbar.dom.q(".ts-toolbar-menu.ts-right");return!(!pager||!butts)&&(this._conflict=box(pager).right>box(butts).left)},_layout:function(){if(this._hidden)this.action.dispatch(ts.ui.ACTION_FOOTER_LEVEL,0);else{var offset=this._offset([this._actionbar,this._centerbar,this._backupbar]);this.action.dispatch(ts.ui.ACTION_FOOTER_LEVEL,offset),this.visible=!!offset}},_offset:function(bars){return bars.reduce(function(offset,bar,index){return offset+(bar.visible?index?3:2:0)},0)},_refresh:function(){[this._centerbar,this._backupbar].reduce(function(was,bar){var is=bar.visible;return bar.css.shift(is&&was,"ts-toolbar-divider"),was||is},this._actionbar.visible)}})}(gui.Combo.chained,gui.Arguments.confirmed,gui.Array,ts.ui.PagerModel,ts.ui.ToolBarSpirit,gui.Type),ts.ui.Bar=function(DOMPlugin,MainSpirit){return gui.Class.create(Object,{onconstruct:function(index){this._main=DOMPlugin.qall(document,".ts-main",MainSpirit)[index]},$getbar:function(){}},{get:function(index){var Bar=this,all=this.$bars;return all[index]||(all[index]=new Bar(index))},first:function(method,args){var bar=this.get(0),res=bar[method].apply(bar,args);return ts.ui.Bar.is(res)?this:res}},{$bars:[],$protomethods:function(names){var protos=Object.create(null);return names.forEach(function(name){protos[name]=this.$protomethod(name)},this),protos},$staticmethods:function(names){var statix=Object.create(null);return names.forEach(function(name){statix[name]=this.$staticmethod(name)},this),statix},$protomethod:function(name){return function(){var bar=this.$getbar(),res=bar[name].apply(bar,arguments);return ts.ui.Spirit.is(res)?this:res}},$staticmethod:function(name){return function(){return this.first(name,arguments)}}})}(gui.DOMPlugin,ts.ui.MainSpirit),ts.ui.ToolBar=function(methods){var statics={$bars:[]},xstatics=ts.ui.Bar.$staticmethods(methods),protos=gui.Object.extend(ts.ui.Bar.$protomethods(methods),{$getbar:function(){return this._main.toolbar()}});return ts.ui.Bar.extend(protos,xstatics,statics)}(["title","buttons","tabs","search","hide","show","clear","green","blue","purple","dark","lite","white","showClose","hideClose"]),ts.ui.TabBar=function(methods){var statics={$bars:[]},xstatics=ts.ui.Bar.$staticmethods(methods),protos=gui.Object.extend(ts.ui.Bar.$protomethods(methods),{$getbar:function(){return this._main.tabbar()}});return ts.ui.ToolBar.extend(protos,xstatics,statics)}([]),ts.ui.StatusBar=function(chained){function deprecated(action){return function(){return console.warn("Deprecated API is deprecated: The StatusBar has been replaced with the Footer as seen on http://ui.tradeshift.com/#components/footer/"),action.apply(this,arguments)}}function footer(){return ts.ui.Footer}return{buttons:chained(deprecated(function(){var res=footer().buttons.apply(footer(),arguments);if(arguments.length)return res})),pager:chained(deprecated(function(){var res=footer().pager.apply(footer(),arguments);if(arguments.length)return res})),show:chained(deprecated(function(){ts.ui.Footer.show()})),hide:chained(deprecated(function(){ts.ui.Footer.hide()})),message:chained(deprecated(function(){var res=footer().status.apply(footer(),arguments);if(arguments.length)return res})),linkable:chained(deprecated(function(onlink){footer().linkable(onlink)})),unlinkable:chained(deprecated(function(onlink){footer().unlinkable()}))}}(gui.Combo.chained),ts.ui.Header=function(TopBar,TabBar,ToolBar){return{buttons:function(){return TopBar.buttons.apply(TopBar,arguments)},tabs:function(){return TabBar.buttons.apply(TabBar,arguments)}}}(ts.ui.TopBar,ts.ui.TabBar,ts.ui.ToolBar),ts.ui.Footer=function(chained){function bar(){if(!bar.spirit){var spirit=ts.ui.FooterBarSpirit.summon();spirit.dom.appendTo(document.body),bar.spirit=spirit}return bar.spirit}var Footer={toString:function(){return"[object ts.ui.Footer]"},checkbox:chained(function(json){if(!arguments.length)return bar().checkbox();bar().checkbox(json)}),status:chained(function(message){if(!arguments.length)return bar().status();bar().status(message)}),linkable:chained(function(onlink){bar().linkable(onlink)}),unlinkable:chained(function(){bar().unlinkable()}),buttons:chained(function(buttons){if(!arguments.length)return bar().buttons();bar().buttons(buttons)}),actions:chained(function(buttons){if(!arguments.length)return bar().actions();bar().actions(buttons)}),pager:chained(function(pager){if(!arguments.length)return bar().pager();bar().pager(pager)}),configbutton:chained(function(onclick){return bar().configbutton.apply(bar(),arguments)}),collabbutton:chained(function(onclick){return bar().collabbutton.apply(bar(),arguments)}),hide:chained(function(){bar().hide()}),show:chained(function(){bar().show()}),clear:chained(function(){bar().clear()}),$check:function(checked){bar().checkbox().checked=checked}};return["hideActions","showActions","hidePager","showPager"].forEach(function(method){Footer[method]=chained(function(){bar()[method]()})}),Footer}(gui.Combo.chained),gui.module("bars-gui@tradeshift.com",{channel:[["[data-ts=TopBar]",ts.ui.TopBarSpirit],["[data-ts=TabBar]",ts.ui.TabBarSpirit],["[data-ts=ToolBar]",ts.ui.ToolBarSpirit],["[data-ts=StatusBar]",ts.ui.StatusBarSpirit],["[data-ts=FooterBar]",ts.ui.FooterBarSpirit]]}),ts.ui.TableSpirit=function(Type,Client,guiArray,DOMPlugin,CSSPlugin,ConfigPlugin,Position,chained,confirmed,TableRowModel,ButtonSpirit,PagerModel){function primitive(x){switch(Type.of(x)){case"string":case"number":case"boolean":return!0}return!1}function colify(x,i){return primitive(x)&&(x={label:x}),x.search||(x.search={hidden:!0}),x.button||(x.button={hidden:!0}),x.$index=i,x.search.$index=i,x.button.type="ts-default",x}function visible(x){return!!x.visible}function indexes(x,i){return i}function maxerror(){throw new Error(["You shouldn't set max() rows when the table is maximized."].join(""))}function makearray(args){var first=args[0];return first&&Array.isArray(first)?first:guiArray.from(args)}function deepclone(thing){return JSON.parse(JSON.stringify(thing))}function perfwarning(required){required&&console.warn("The client will freeze while we sort this many rows. If you see this warning, please remind us to sort the data in a Worker process.")}return ts.ui.Spirit.extend({busy:function(busy){var opts={message:busy,position:"absolute"},that=this;this.box.height&&this.dom.q(".ts-table-body")?(this._initspin(opts),busy?this.guistatus.busy(this.$instanceid):this.guistatus.done(this.$instanceid)):this.life.add(gui.LIFE_RENDER,{onlife:function(){that.life.remove(gui.LIFE_RENDER),that.busy(busy)}})},onclick:null,onselect:null,onresize:null,onlink:null,onedit:null,onpage:null,onsort:function(index,ascending){this.sort(index,ascending)},onconstruct:function(){ts.ui.Spirit.prototype.onconstruct.call(this),this._model=new ts.ui.TableModel,this._model.rows.addObserver(this),this._renderqueue=[]},onconfigure:function(){if(ts.ui.Spirit.prototype.onconfigure.call(this),this.action.add([ts.ui.ACTION_CLICK,ts.ui.ACTION_SWITCH]),this.event.add("click"),this._rowsadd=[],this._rowsoff=[],this._scroll=new Position,this.action.add([ts.ui.ACTION_FOOTER_LEVEL,ts.ui.ACTION_PAGER_SELECT,ts.ui.ACTION_SAFE_LINK]),"table"===this.dom.tag())throw new SyntaxError("Contrary to common belief, the ts.ui.Table component must not be attached to a TABLE.")},onenter:function(){ts.ui.Spirit.prototype.onenter.call(this),this.script.load(ts.ui.TableSpirit.edbml),this.script.input(this._model)},ondestruct:function(){ts.ui.Spirit.prototype.ondestruct.call(this),this._model.dispose()},onevent:function(e){ts.ui.Spirit.prototype.onevent.call(this,e);var elm=e.target;switch(e.type){case"click":this._onclick(elm);break;case"scroll":this._noscrolling?this._scrollfixing&&(this.queryplugin.getrows().querySelector("table").style.left=0):this._hackscrolling()}},onbroadcast:function(b){ts.ui.Spirit.prototype.onbroadcast.call(this,b),b.type===gui.BROADCAST_RESIZE_END&&this._ismaximized()&&this._onbeforeresize(this._model)},onflex:function(){ts.ui.Spirit.prototype.onflex.call(this),this._crashproof()&&(this._ismaximized()?(this._onafterresize(this._target),this._maxpages()):(this._layouteverything(),this._maxpages()))},onaction:function(a){switch(ts.ui.Spirit.prototype.onaction.call(this,a),a.type){case ts.ui.ACTION_FOOTER_LEVEL:this.guilayout.gotoLevel(a.data),this._onafterresize(),a.consume();break;case ts.ui.ACTION_PAGER_SELECT:this._flag="paging",this._resetscrolling(),a.consume();break;case ts.ui.ACTION_SAFE_LINK:Type.isFunction(this.onlink)&&this.onlink.call(this,a.data),a.consume();break;case ts.ui.ACTION_CLICK:this._onextra(this.onbutton,a.target),a.consume();break;case ts.ui.ACTION_SWITCH:this._onextra(this.onswitch,a.target,a.data),a.consume()}},_onextra:function(action,spirit){var name,value,elm=spirit.element;if(Type.isFunction(action)){var args=gui.Array.from(arguments).slice(2),posi=this.queryplugin.getpos(elm);(name=elm.getAttribute("name"))&&((value=elm.getAttribute("value"))&&(value=Type.cast(value),Type.isString(value)&&(value=ConfigPlugin.jsonvaluate(value))),action.apply(this,[name,value||void 0].concat(args).concat([posi.y,posi.x])))}},onbutton:function(name,value){console.log(name,value)},onswitch:function(name,value,checked){console.log(name,value,checked)},ontick:function(t){ts.ui.Spirit.prototype.ontick.call(this,t),t.type===this._TICKSELECT&&this.onselect&&(this.onselect.call(this,this._rowsadd,this._rowsoff),this._rowsadd=[],this._rowsoff=[])},onchange:function(changes){if(ts.ui.Spirit.prototype.onchange.call(this,changes),this._model.maxrows&&!this._rowsmutated){var type=edb.ArrayChange.TYPE_SPLICE,rows=this._model.rows;changes.forEach(function(c){c.object===rows&&c.type===type&&(this._rowsmutated=!0)},this)}},cols:confirmed("(array)")(chained(function(input){var cols=this._model.cols;if(!arguments.length)return cols;input=input.map(colify),this._model.cols=input})),rows:confirmed("(array)")(chained(function(json){var model=this._model;if(!arguments.length)return model.rows;model.removeObserver(this),model.rows=deepclone(json),model.addObserver(this),this._resetpager()})),row:confirmed("number","(object|array)")(chained(function(rowindex,json){var model=this._model;if(!(arguments.length>1))return model.getrow(rowindex,!0);model.setrow(rowindex,json)})),cell:confirmed("number","number","(*)")(chained(function(rowindex,cellindex,newcell){var model=this._model;if(!(arguments.length>2))return model.getcell(rowindex,cellindex,!0);model.setcell(rowindex,cellindex,newcell)})),invalid:confirmed("number","number","(string)")(chained(function(rowindex,cellindex,message){this._model.setvalidity(!1,rowindex,cellindex,message),this._model.editable&&this.editorplugin.failfast(rowindex,cellindex)})),valid:confirmed("number","number")(chained(function(rowindex,cellindex){this._model.setvalidity(!0,rowindex,cellindex)})),maximize:confirmed("(function)")(chained(function(onresize){var ended=gui.BROADCAST_RESIZE_END;this.css.add("ts-maximized"),this.onresize=onresize||this.onresize,this.broadcast.add(ended);var maxrows=this.max();this._createpager(),onresize&&onresize(maxrows)})),max:confirmed("(number)")(chained(function(n){var ismax=this._ismaximized(),model=this._model;if(!arguments.length)return ismax?this._automax():model.maxrows;ismax?maxerror():(model.maxrows=n,this._createpager(),this._renderqueue.push(function(){this.css.shift(n,"ts-hasrows ts-maxrows")}))})),size:confirmed("(number)")(chained(function(n){this.$fixedsize=n,this.max(n)})),pager:chained(function(json){var pager=this._model.toolbar.pager;if(!arguments.length)return pager;this._createpager(json),this._ownpager=!1}),style:chained(function(config){config&&config.type&&this.css.add(config.type)}),buttons:chained(function(json){var toolb=this._model.toolbar;if(!arguments.length)return toolb.buttons;toolb.buttons=json}),actions:chained(function(json){var toolb=this._model.toolbar;if(!arguments.length)return toolb.actions;toolb.actions=json}),configurable:confirmed("(function)")(chained(function(onconf){return console.warn(String(this),"The method `configurable` has been renamed to `configbutton`"),this.configbutton.apply(this,arguments)})),unconfigurable:chained(function(){return console.warn(String(this),'"unconfigurable" should now be implemented via `configbutton(null)`'),this.configbutton.apply(this,null)}),configbutton:chained(function(onclick){var toolb=this._model.toolbar,value=toolb.configbutton.apply(toolb,arguments);if(!arguments.length)return value}),selectable:confirmed("(function)","(function)","(function)")(chained(function(onselect,onselectall,onunselectall){this.tick.add(this._TICKSELECT=this.$instanceid+":onselect"),this._model.selectable=!0,this.onselect=onselect||this.onselect,this.onselectall=onselectall||this.onselectall,this.onunselectall=onunselectall||this.onunselectall,this._renderqueue.push(function(){this.css.add("ts-selectable")})})),unselectable:chained(function(){this._model.selectable=!1,this.onselect=null,this.onselectall=null,this.onunselectall=null,this._renderqueue.push(function(){this.css.remove("ts-selectable")})}),selected:function(){var model=this._model;return arguments.length?makearray(arguments).every(function(index){return model.rowselected(index)}):model.selectedrows()},select:confirmed("(number|array)")(chained(function(){this._select(!0,this._rowsadd,arguments)})),unselect:confirmed("(number|array)")(chained(function(){this._select(!1,this._rowsoff,arguments)})),toggle:confirmed("(number|array)")(chained(function(){var given=arguments,model=this._model;makearray(given.length?given:model.rows.map(indexes)).forEach(function(i){model.rowselected(i)?this.unselect(i):this.select(i)},this)})),searchable:chained(function(){console.error("Not implemented just yet")}),unsearchable:chained(function(){console.error("Not implemented just yet")}),numbered:confirmed("(function)")(chained(function(){this._model.numbered=!0})),unnumbered:confirmed("(function)")(chained(function(){this._model.numbered=!1})),clickable:confirmed("(function)")(chained(function(onclick){this.css.add("ts-clickable"),this._clickable=!0,onclick&&(this.onclick=onclick)})),unclickable:chained(function(){this.css.remove("ts-clickable"),this._clickable=!1}),sortable:confirmed("(function)")(chained(function(onsort){this._model.sortable=!0,onsort&&(this.onsort=onsort)})),unsortable:chained(function(){this._model.sortable=!1}),sort:chained(function(colindex,ascending){var model=this._model,col=model.cols[colindex];if(!this._model.sortable)throw new Error("Table must be sortable()");if(!col)throw new Error("Could not sort column at "+colindex+". Does it exist?");Type.isBoolean(ascending)&&(col.ascending=ascending),model.sort(col),this.tick.next(function(){col.selected=!0})}),search:chained(function(colindex,value){var model=this._model;model.search(colindex,value),this._resetpager(),this._resetscrolling(),model.compiled||model.$dirty()}),onrender:function(summary){if(ts.ui.Spirit.prototype.onrender.call(this,summary),this._layouteverything(),summary.first&&(this.attention.trapping||this.attention.trap(this.queryplugin.getrows())),this._rowsmutated){this._rowsmutated=!1;var first=this._model.firstVisibleRow(),index=first?first.$index:0;this._bestpage(index)}},editable:confirmed("(function)")(chained(function(onedit){this._model.editable=!0,this.editorplugin.init(!0),onedit&&(this.onedit=onedit)})),uneditable:chained(function(){this.editorplugin.init(!1),this._model.editable=!1,this.onedit=null}),focus:chained(function(rowindex,cellindex){if(!this._model.editable)throw new Error("Cannot focus non-editable Table");this.editorplugin.focus(rowindex,cellindex)}),status:chained(function(message){var toolbar=this._model.toolbar;if(!arguments.length)return toolbar.status;this._statusmessage=message,this._errormessage||(toolbar.status=message)}),linkable:confirmed("(function)")(chained(function(onlink){this._model.linkable=!0,arguments.length&&(this.onlink=onlink)})),unlinkable:chained(function(){this._model.linkable=!1}),collabbutton:chained(function(onclick){var toolb=this._model.toolbar,value=toolb.collabbutton.apply(toolb,arguments);if(!arguments.length)return value}),$fixedsize:0,$errormessage:function(message){var toolbar=this._model.toolbar;message?toolbar.title=this._errormessage=message:this._errormessage&&(toolbar.title=this._statusmessage||"",this._errormessage=null)},_TICKSELECT:null,_model:null,_renderqueue:null,_scroll:null,_noscrolling:!1,_target:-1,_ownpager:!0,_scrollfixing:Client.isWebKit,_rowsadd:null,_rowsoff:null,_flag:null,_statusmessage:null,_errormessage:null,_spinner:null,_cover:null,_layouteverything:function(){var model=this._model;this._crashproof()&&(this.layoutplugin.layout(this,model),this._clip(this.queryplugin.getguts(!0)),this.layoutplugin.flex(this,model)),this._flush(),this._cnames(model,model.cols,model.rows,model.toolbar)},_crashproof:function(){var rows=this.queryplugin.getrows();return!rows||!!rows.offsetHeight},_ismaximized:function(){return this.css.contains("ts-maximized")},_clearrows:function(model){var rows=model.rows;return model.compiled&&(this._observerows(!1),model.compiled=!1,rows.clear()),rows},_select:function(select,collect,args){var model=this._model,changed=makearray(!args.length?model.rows.map(indexes):args).filter(function(i){return select?model.selectrow(i):model.unselectrow(i)});changed.length&&this.onselect&&(collect.push.apply(collect,changed),this.tick.dispatch(this._TICKSELECT))},_selectall:function(on){!1===on?(this._unselectfast(),this.tick.time(function(){this.unselect()})):this.select()},_unselectfast:function(on){var path=".ts-table-checkbox button",guts=this.queryplugin.getguts(!0),menu=this.queryplugin.getmenu(!0),buts=guts.dom.qall(path),butt=menu.dom.qall(path);buts.concat(butt).map(function(but){return but.querySelector("i")}).forEach(function(icon){icon.className="ts-icon-checkbox"})},_selectpage:function(on){var idxs=this._model.visibleRows().filter(function(row){return!1!==row.selectable}).map(function(row){return row.$index});!1===on?this.unselect(idxs):this.select(idxs)},_createpager:function(json){var model=this._model,toolbar=model.toolbar,oldpager=toolbar.pager,newpager=null;arguments.length?newpager=this._createcustompager(json):this._ownpager&&(newpager=this._createownpager(model,this)),newpager&&(toolbar.pager=newpager,this._maxpages(),oldpager&&oldpager.dispose())},_createcustompager:function(json){return PagerModel.from(json)},_createownpager:function(model,spirit){return PagerModel.from({page:0,pages:model.pageCount(),onselect:function(index){spirit._pageselected(index)}})},_maxpages:function(){var pager=this._model.toolbar.pager;if(pager){var width=this.box.width;pager.max=width<600?3:5}},_resetpager:function(){var model=this._model,pager=this.pager();this._ownpager&&model.maxrows&&(pager.pages=model.pageCount(),pager.page=0)},_resetscrolling:function(){this._renderqueue.push(function(){var rows=this.queryplugin.getrows();rows&&(rows.scrollTop=0)})},_pageselected:function(index){this._model.page=index,this._resizing?this._resizing=!1:this._target=-1,this.script.suspended&&(this.script.unsuspend(),this.script.run()),this.onpage&&this.onpage.call(this,index)},_bestpage:function(index){var model=this._model,pager=this.pager();pager&&(pager.pages=model.pageCount(),pager.page=model.getPage(index))},_onclick:function(elm){this._model.menuopen?this._specialclick(elm):this._regularclick(elm)},_specialclick:function(elm){var menu=this.queryplugin.getmenu();this._contains(menu,elm)?this._onmenuclick(elm):this._openmenu(!1)},_regularclick:function(elm){var model=this._model,edits=this._editable(model);if(model.sortable||model.selectable){var cols=this.queryplugin.getcols();this._contains(cols,elm)&&this._oncolsclick(elm,model)}if(this._clickable&&this.onclick||edits){var rows=this.queryplugin.getrows();this._contains(rows,elm)&&this._onrowsclick(elm,edits)}model.selectable&&(Client.isEdge&&elm.className.startsWith("ts-icon-checkbox")&&(elm=elm.parentNode),CSSPlugin.contains(elm,"ts-table-checkbox-button")?this._ongutsclick(elm):this._contains(this.queryplugin.getmenu(),elm)&&this._onmenuclick(elm))},_editable:function(model){return model.editable&&model.cols.some(function(col){return!1!==col.editable})},_onbeforeresize:function(model){if(this._ownpager&&-1===this._target){var first=model.firstVisibleRow(),index=first?first.$index:0;this._target=index>0?index:-1}},_onafterresize:function(index){this._layouteverything(),this._hackscrolling();var max=this.max();this._ownpager&&index>-1&&(this._resizing=!0,this.script.suspend(),this._bestpage(index)),this.onresize&&this.onresize.call(this,max)},_contains:function(parent,child){return parent&&DOMPlugin.contains(parent,child)},_hasclass:function(elm,classname){return elm&&CSSPlugin.contains(elm,classname)},_onscroll:function(x,y,cols,guts){this._scroll.x=x,this._scroll.y=y,cols&&(cols.sprite.x=0-x),guts&&(guts.sprite.y=0-y)},_hackscrolling:function(){var plug=this.queryplugin,rows=plug.getrows(),cols=plug.getcols(!0),guts=plug.getguts(!0);this._clip(guts),rows&&cols&&this._onscroll(rows.scrollLeft,rows.scrollTop,cols,guts)},_clip:function(guts){var bsize=Client.scrollBarSize;if(guts&&bsize){var avail=this.queryplugin.getbody().offsetHeight,scrol=this.queryplugin.getrows().scrollTop;guts.css.maxHeight=avail+scrol-bsize}},_oncolsclick:function(elm,model){if(elm=ButtonSpirit.getButton(elm,this)){var length=model.rows.length;if(model.sortable&&this._hasclass(elm,"ts-button-sort")){var i=this.queryplugin.getindex(elm),c=model.cols[i];c.selected&&(c.ascending=!c.ascending),this.onsort&&(perfwarning(length>3e3),this.onsort(i,c.ascending)),this._selectcol(c),this._flag="sorting",this._resetscrolling()}}},_selectcol:function(col){this._model.cols.forEach(function(c){c.selected=c===col})},_onrowsclick:function(elem,editable){var area,pos=this.queryplugin.getpos(elem);if(pos&&(this.onclick&&this.onclick(pos.y,pos.x),editable)){for(;"td"!==elem.localName;)elem=elem.parentNode;(area=elem.querySelector(".ts-table-input"))&&area.focus()}},_ongutsclick:function(elm){elm=ButtonSpirit.getButton(elm),this.toggle(this.queryplugin.getindex(elm))},_onmenuclick:function(elm){if(elm=ButtonSpirit.getButton(elm))switch(this.queryplugin.getaction(elm)){case"selection-menu":this._maybeclearall()?this.onunselectall&&this.onunselectall.call(this):(this._openmenu(!0),this._selectpage());break;case"selection-menu-close":case"select-page":this._openmenu(!1);break;case"select-all":this._openmenu(!1),this._renderqueue.push(function(){this._selectall(),this.onselectall&&this.onselectall()})}},_maybeclearall:function(hasselections){return!!this._model.isVisibleRowSelected()&&(this.event.remove("click",document),this._openmenu(!1),this._selectall(!1),this._model.$dirty(),!0)},_openmenu:function(open){var model=this._model,pager=model.toolbar.pager;pager&&pager.pages>1&&open!==model.menuopen&&(this._model.menuopen=open,this.tick.time(function(){this.event.shift(open,"click",document)}))},_onbeforerender:function(){this.queryplugin.getrows()&&(this._noscrolling=!0)},_automax:function(){var max=this._calcmax();return this._model.maxrows=max,max},_calcmax:function(){var availsize=this.queryplugin.getbody().offsetHeight;return Math.ceil(availsize/44)},_floatgutter:function(){return!Client.isExplorer9&&this._model.selectable&&this.css.contains("ts-scroll-x")},_flush:function(){this.tick.next(function(){for(var list=this._renderqueue;list.length;)list.shift().call(this)})},_cnames:function(model,cols,rows,toolbar){var show=!cols.length||cols.some(visible);this.css.shift(rows.length&&show,"ts-hasrows"),this.css.shift(cols.length&&show,"ts-hascols")},_initspin:function(opts){this._spinner||(this._spinner=ts.ui.SpinnerSpirit.summon());var rect=this.element.getBoundingClientRect();rect.height>=267?opts.top="116px":(opts.length=22*rect.height/267,opts.radius=22*rect.height/267,opts.width=6*rect.height/267),opts.message?(this._createCover(rect),this._spinner.spin(this.dom.q(".ts-table-body"),opts)):this._cover&&(this._spinner.stop(),this._cover.remove(),this._cover=null)},_createCover:function(rect){if(!this._cover){var cover=document.createElement("div");cover.className+="ts-cover ts-tablecover",this.element.appendChild(cover),this._cover=cover}}})}(gui.Type,gui.Client,gui.Array,gui.DOMPlugin,gui.CSSPlugin,gui.ConfigPlugin,gui.Position,gui.Combo.chained,gui.Arguments.confirmed,ts.ui.TableRowModel,ts.ui.ButtonSpirit,ts.ui.PagerModel),ts.ui.TableQueryPlugin=function(Type){return ts.ui.Plugin.extend({getrows:function(getspirit){return this._get(".ts-table-rows",getspirit)},getcols:function(getspirit){return this._get(".ts-table-cols",getspirit)},getguts:function(getspirit){return this._get(".ts-table-gutter",getspirit)},getmenu:function(getspirit){return this._get(".ts-table-menu",getspirit)},getbody:function(){return this._get(".ts-table-body")},getcell:function(pos){var rowindex=pos.y,celindex=pos.x,id=this.spirit._model.$cellid(rowindex,celindex);return this.spirit.dom.q("#"+id)},getpos:function(elm){for(var pos=new gui.Position,rows=this.getrows();elm&&elm!==rows;){switch(elm.localName){case"tr":pos.y=this.getindex(elm);break;case"td":pos.x=this.getindex(elm)}elm=elm.parentNode}return null!==pos.y&&null!==pos.x?pos:null},getindex:function(elm){var i=elm.getAttribute("data-index");return null!==i?Type.cast(i):i},getaction:function(elm){return elm.getAttribute("data-action")},_get:function(selector,getspirit){var elem=this.spirit.dom.q(selector);return getspirit?elem?ts.ui.get(elem):null:elem}})}(gui.Type),ts.ui.TableEditPlugin=function(CSSPlugin,DOMPlugin,Position,Client,Key){function query(elm,classname){return elm.querySelector("."+classname)}function hasclass(elm,classname){return CSSPlugin.contains(elm,classname)}return ts.ui.Plugin.extend({init:function(on){var spirit=this.spirit,element=spirit.element;spirit.event.shift(on,"focus blur",element,this,!0),spirit.action.shift(on,ts.ui.ACTION_CHANGED,this),spirit.life.shift(on,gui.LIFE_RENDER,this)},failfast:function(rowindex,cellindex){var td=this._getcellat(rowindex,cellindex);td&&CSSPlugin.add(td,"ts-table-invalid")},focus:function(rowindex,cellindex){this._focuscell(this._getcellat(rowindex,cellindex),!0)},blur:function(rowindex,cellindex){this._focuscell(!1,this._getcellat(rowindex,cellindex),!0)},onevent:function(e){var target=e.target,spirit=this.spirit;switch(e.type){case"focus":case"blur":hasclass(target,"ts-table-input")?this._areaupdate(target,"focus"===e.type):this._navimode&&this._maybereset(spirit,target);break;case"keypress":case"keydown":if(this._noscroll)switch(e.keyCode){case 38:case 40:e.preventDefault(),e.stopPropagation()}}},onaction:function(a){if(a.type===ts.ui.ACTION_CHANGED&&ts.ui.TextAreaSpirit.is(a.target)){var area=a.target.element,cont=area.parentNode,next=a.data.newheight;document.activeElement===area&&this._sync(!0,area,cont,next)}},onkey:function(key){var spirit=this.spirit;if(key.down)switch(key.type){case"Enter":Key.shiftDown||((this._navimode=!this._navimode)?this._gonavimode(spirit):this._goeditmode(spirit));break;case"Esc":this._editmode&&(this._escape(this._cell),this._editmode=!1,this._navimode=!0,this._gonavimode(spirit));break;default:this._movecell(key.type.toLowerCase())}},onlife:function(life){life.type===gui.LIFE_RENDER&&(this._syncinvalid(),this._cell&&this._resolveinvalid(this._cell))},_cell:null,_editmode:!1,_navimode:!1,_snapshot:null,_position:null,_noscroll:!1,_getcellat:function(rowindex,cellindex){var pos=new Position(cellindex,rowindex);return this.spirit.queryplugin.getcell(pos)},_areaupdate:function(area,focused){var cont=area.parentNode,cell=cont.parentNode;this._sync(focused,area,cont),CSSPlugin.shift(cell,focused,"ts-table-editmode"),this.spirit.css.shift(focused,"ts-table-editmode"),focused?this._areafocus(this.spirit,area,cell):this._areablur(area)},_areafocus:function(spirit,area,cell){this._resetall(spirit),this._editmode=!0,this._resolveinvalid(cell),spirit.key.add("Enter Esc",this),this._snapshot=area.value.trim(),this._cell=cell},_areablur:function(area){this._editmode=!1,this._evalchange(area,area.value.trim(),this._snapshot),this._snapshot=null,this._syncinvalid()},_movecell:function(dir,skip){var plug=this.spirit.queryplugin,icel=DOMPlugin.ordinal(this._cell),irow=DOMPlugin.ordinal(this._cell.parentNode),rows=plug.getrows(!0).dom.qall("tr");this._focuscell(this._nextcell(dir,rows,irow,icel))},_nextcell:function(dir,rows,irow,icel){var row=rows[irow],cels=row.cells,cell=cels[icel],selects=this.spirit._model.selectable,initrow=rows[0],lastrow=rows[rows.length-1],initcel=cels[selects?1:0],lastcel=cels[cels.length-1];switch(dir){case"up":return(row===initrow?lastrow:rows[--irow]).cells[icel];case"down":return(row===lastrow?initrow:rows[++irow]).cells[icel];case"left":return cell===initcel?lastcel:cels[--icel];case"right":return cell===lastcel?initcel:cels[++icel]}},_focuscell:function(cell,edit){var current=this._cell,target=edit?"ts-table-input":"ts-table-line";(this._cell=cell)?(this._resolveinvalid(cell),gui.Tick.time(function(){query(cell,target).focus()})):current&&query(current,target).blur()},_gonavimode:function(spirit){spirit.css.add("ts-table-navimode"),spirit.key.add("Up Down Left Right",this),this._scrollsuppress(!0),this._focuscell(this._cell)},_goeditmode:function(spirit){var area=query(this._cell,"ts-table-input");area&&(this._resetall(spirit),area.focus())},_evalchange:function(area,newval,oldval){var spirit=this.spirit,onedit=spirit.onedit;if(onedit&&newval!==oldval){var pos=spirit.queryplugin.getpos(area);onedit.call(spirit,pos.y,pos.x,newval,oldval)}},_scrollsuppress:function(enabled){this.spirit.event.shift(this._noscroll=enabled,"keypress keydown",document,this)},_sync:function(sync,area,cont,height){height=(height||area.offsetHeight)-1,height=22*Math.round(height/22)-1,sync?(cont.style.minHeight=height+"px",this._shrink(area,height)):(cont.style.minHeight="",this._shrink(area,0))},_shrink:function(area,height){Client.isExplorer11||Client.isEdge||(area.style.clip=height?"rect(auto,auto,"+height+"px,auto)":"")},_syncinvalid:function(){this.spirit.dom.qall(".ts-table-invalid").forEach(function(td){var cont=query(td,"ts-table-cell"),area=query(td,"ts-table-input");this._sync(!0,area,cont)},this)},_maybereset:function(spirit,elm){hasclass(elm,"ts-table-line")&&gui.Tick.next(function(){var rows=spirit.queryplugin.getrows(),curr=document.activeElement;DOMPlugin.contains(rows,curr)&&curr||this._resetall(spirit)},this)},_resetall:function(spirit){spirit.key.remove("Up Down Left Right Enter Esc",this),spirit.css.remove(["ts-table-navimode","ts-table-editmode"]),this._scrollsuppress(!1),this._navimode=!1,this._editmode=!1},_resolveinvalid:function(cell){var spirit=this.spirit,model=spirit._model;if(cell=this._getcellmodel(spirit,model,cell)){if(!cell.valid&&cell.message)return spirit.$errormessage(cell.message),!0;spirit.$errormessage(null)}return!1},_getcellmodel:function(spirit,model,cell){var pos=spirit.queryplugin.getpos(cell);return model.getcell(pos.y,pos.x)},_escape:function(cell){var area=query(cell,"ts-table-input");null!==this._snapshot?area.value=this._snapshot:console.error("Out of synch")}})}(gui.CSSPlugin,gui.DOMPlugin,gui.Position,gui.Client,gui.Key),ts.ui.TableLayoutPlugin=function(Client,Tick){function getheight(elm){return elm.getBoundingClientRect().height}function setheight(td,height){var div=td.querySelector(".ts-table-cell");div&&(div.style.height=height+"px")}function ismultiline(col){return col.wrap&&col.visible}return ts.ui.Plugin.extend({layout:function(spirit,model){var plug=spirit.queryplugin,cols=plug.getcols(),rows=plug.getrows(),guts=plug.getguts();this._layout1(spirit,model,cols,rows,guts),this._layout2(spirit,model.cols)},flex:function(spirit,model){this._hflex(spirit,model),model.cols.some(ismultiline)&&this._vfix(spirit,model)},_layout1:function(spirit,model,cols,rows,guts){spirit.event.add("scroll",rows);var fixed=model.maxrows&&spirit.$fixedsize;rows.style.height=fixed?44*model.maxrows+"px":"",model.isWrapping()&&(cols.style.paddingRight=Client.scrollBarSize+"px"),Tick.nextFrame(function(){this._layoutasync(spirit,model,rows,guts,spirit._flag),spirit._hackscrolling(),spirit._flag=null},this)},_layout2:function(spirit,cols){spirit.css.shift(cols.some(function(col){return col.wrap}),"ts-wrapping")},_layoutasync:function(spirit,model,rows,guts,flag){var x=spirit._scroll.x,y=spirit._scroll.y;if(rows){switch(flag){case"paging":case"sorting":y=0}rows.scrollLeft=x,rows.scrollTop=y}Tick.time(function(){spirit._noscrolling=!1})},_hflex:function(spirit,model){spirit.css.width="auto";var cols=model.visibleCols(),ths=spirit.dom.qall(".ts-table-cols th:not(.ts-table-addition)"),tds=spirit.dom.qall(".ts-table-rows tr:first-child td:not(.ts-table-addition)"),width=spirit.box.width;this._hflex1(spirit,model,width,cols,ths,tds),spirit.css.width=width,this._hflex3(spirit,model,width,cols,ths,tds)},_hflex1:function(spirit,model,width,cols,ths,tds){var avail=this._hflexavail(cols,width),total=this._hflextotal(cols),adjust=this._hflexadjust(model),unit=(avail-adjust)/total,sum=this._hflex2(cols,ths,tds,unit);spirit.css.shift(sum+adjust>width,"ts-scroll-x")},_hflex2:function(cols,ths,tds,unit){return cols.reduce(function(sum,col,i){var td,th,span=col.flex*unit,fixt=col.width,mins=col.minwidth;return fixt?span=fixt:mins&&span<mins&&(span=mins),(th=ths[i])&&(th.style.width=span+"px"),(td=tds[i])&&(td.style.width=span+"px"),sum+span},0)},_hflex3:function(spirit,model,width,cols,ths,tds){if(model.rows.length){var result=spirit.queryplugin.getrows().scrollWidth;result>width&&(width=width-(result-width)-63,this._hflex1(spirit,model,width,cols,ths,tds))}},_hflexavail:function(cols,width){return cols.reduce(function(result,col){return result-col.width},width)},_hflextotal:function(cols){return cols.reduce(function(sum,col){return sum+(col.width?0:col.flex)},0)},_hflexadjust:function(model){var adjust=model.selectable?44:0;return model.isWrapping()&&model.maxrows&&(adjust+=Client.scrollBarSize),adjust},_vfix:function(spirit,model){var floats=spirit._floatgutter(),edits=model.editable,plug=spirit.queryplugin;(floats||edits)&&this._vfix2(plug.getrows(!0),plug.getguts(!0),floats,edits)},_vfix2:function(rows,guts,floats,edits){rows.css.add("ts-table-vfix"),this._vfix3(rows,guts,floats,edits),rows.css.remove("ts-table-vfix")},_vfix3:function(rows,guts,floats,edits){rows=rows.dom.qall("tr"),guts=floats?guts.dom.qall("tr"):null,rows.map(function(row,index){var border=index?1:Client.isGecko?1:0;return getheight(row)-border}).forEach(function(height,index){var row=rows[index];floats&&setheight(guts[index],height),edits&&Array.forEach(row.cells,function(td){setheight(td,height)})})}})}(gui.Client,gui.Tick),gui.module("tables-gui@tradeshift.com",{channel:[["[data-ts=Table]",ts.ui.TableSpirit]],oncontextinitialize:function(){ts.ui.TableSpirit.plugin("editorplugin",ts.ui.TableEditPlugin).plugin("layoutplugin",ts.ui.TableLayoutPlugin).plugin("queryplugin",ts.ui.TableQueryPlugin)}}),gui.$stop("- parse runtime"),gui.$mark("- idle time ...")}(self),edbml.declare("ts.ui.aside.edbml").as(function $edbml(aside){"use strict";var out=$edbml.$out,$set=edbml.$set,$val=edbml.safeattr,title=aside?aside.title||"":"",$1=$set(function(){return aside},this);return out.html+='<aside data-ts="Aside" data-ts.title="'+$val(title)+'" data-ts._model="edbml.$get(&quot;'+$1+'&quot;);"><div data-ts="Panel"></div></aside>',out.write()}),edbml.declare("ts.ui.button.edbml").as(function $edbml(button,isButtonMenu,isMobile){"use strict";var out=$edbml.$out,$att=$edbml.$att,$set=edbml.$set,$txt=edbml.safetext,$val=edbml.safeattr;$att.id="button"+button.$instanceid,$att.title=button.info||null,$att.class=(button.isAction?"ts-action ":"")+(button.type||""),$att.name=button.name||"",$att.value=button.value||"",$att.autofocus=button.autofocus?"autofocus":null,$att.tabindex=0===button.tabindex||isButtonMenu?null:button.tabindex,$att.disabled=button.disabled?"disabled":null,$att["data-ts.type"]=button.action||null,$att["data-ts.data"]=button.data||null,$att["data-ts.busy"]=button.busystatus||null;var $1=$set(function(){button.click()},this);return out.html+='<button data-ts="Button" '+$att.$("name")+" "+$att.$("value")+" "+$att.$("title")+" "+$att.$("class")+" "+$att.$("id")+" "+$att.$("tabindex")+" "+$att.$("autofocus")+" "+$att.$("disabled")+" "+$att.$("data-ts.busy")+" "+$att.$("data-ts.type")+" "+$att.$("data-ts.data")+" onclick=\"edbml.$run(this, '"+$1+"');\">",isMobile&&button.icon&&!button.isPrimary()?out.html+='<i class="'+$val(button.icon)+'"></i>':(button.isAction&&button.icon&&(out.html+='<i class="'+$val(button.icon)+'"></i>'),button.label?out.html+="<span>"+$txt(button.label)+"</span>":isButtonMenu&&button.info?out.html+="<span>"+$txt(button.info)+"</span>":button.icon&&!button.isAction&&(out.html+='<i class="'+$val(button.icon)+'"></i>')),out.html+="</button>",out.write()}),edbml.declare("ts.ui.buttons.edbml").as(function $edbml(buttons){"use strict";var out=$edbml.$out;return out.html+='<span class="ts-join">'+buttons.map(function(button){return button.render()}).join(""),out.html+="</span>",out.write()}),edbml.declare("ts.ui.buttonsmenu.edbml").as(function $edbml(menu){"use strict";var out=$edbml.$out,$val=edbml.safeattr,id=menu.$instanceid,buttons=menu.items;return buttons.length&&(out.html+='<menu data-ts="Buttons" id="'+$val(id)+'-buttons">',buttons.forEach(function(button,index){out.html+='<li id="'+$val(id)+"-"+$val(index)+'">'+button.render(!0)+"</li>"}),out.html+="</menu>"),out.write()}),edbml.declare("ts.ui.companycard.edbml").as(function $edbml(card,contentonly,classconfig){"use strict";var out=$edbml.$out,$att=$edbml.$att,$set=edbml.$set,$txt=edbml.safetext,$val=edbml.safeattr,data=card.data,mock=card.mock,conn=card.$computeConnection(),bizz=card.$computeIndustry(),size=card.$computeSize();if(contentonly)$att.class=mock?"ts-mockup":null,out.html+="<div "+$att.$("class")+'><div class="ts-companycard-main"><h3 class="ts-companycard-name"><span>'+$txt(data.name||"")+'</h3><ul class="ts-companycard-details">',data.location&&(out.html+='<li class="ts-companycard-location"><i class="ts-icon ts-icon-location"></i><span>'+$txt(data.location)+"</span></li>"),bizz&&(out.html+='<li class="ts-companycard-industry"><i class="ts-icon ts-icon-industry"></i><span>'+$txt(bizz)+"</span></li>"),size&&(out.html+='<li class="ts-companycard-users"><i class="ts-icon ts-icon-users"></i><span>'+$txt(size)+"</span></li>"),out.html+='</ul></div><div class="ts-card-connection">',conn&&(out.html+='<i class="ts-card-connection-icon '+$val(conn.icon)+'"></i><span class="ts-card-connectiont-ext">'+$txt(conn.text)+"</span>"),out.html+='</div><div class="ts-companycard-branding">',data.logo&&(out.html+='<img class="ts-companycard-logo" src="'+$val(data.logo)+'" width="88" alt=""/>'),out.html+="</div></div>";else{$att.class=card.type||null;var $1=$set(function(){return card},this);out.html+='<div data-ts="CompanyCard" data-ts._model="edbml.$get(&quot;'+$1+'&quot;);" '+$att.$("class")+"></div>"}return out.write()}),edbml.declare("ts.ui.datepicker.edbml").as(function $edbml(picker){"use strict";var out=$edbml.$out,$1=(0,edbml.$set)(function(){return picker},this);return out.html+='<div data-ts="Calendar" data-ts._model="edbml.$get(&quot;'+$1+'&quot;);"></div>',out.write()}),edbml.declare("ts.ui.footer.edbml").as(function $edbml(footer){"use strict";var out=$edbml.$out,$set=edbml.$set,$val=edbml.safeattr,$1=$set(function(){return footer},this);return out.html+='<footer data-ts="FooterBar" id="'+$val(footer.$instanceid)+'" data-ts.model="edbml.$get(&quot;'+$1+'&quot;);"></footer>',out.write()}),edbml.declare("ts.ui.form.edbml").as(function $edbml(form){"use strict";var out=$edbml.$out;return out.html+='<form data-ts="Form">',form&&(form.items.getLength()&&(out.html+=form.items.render()),form.buttons.getLength()&&(out.html+=form.buttons.render())),out.html+="</form>",out.write()}),edbml.declare("ts.ui.icononly.edbml").as(function $edbml(icon){"use strict";var out=$edbml.$out,$att=$edbml.$att;if($att.class=icon.type,icon.color&&!$att.class.includes("ts-color-")){var color=ts.ui.COLORS[icon.color];if(!color)throw new Error('The color "" does is not defined');$att.class+=" "+color}return out.html+="<i "+$att.$("class")+"></i>",out.write()}),edbml.declare("ts.ui.image.edbml").as(function $edbml(image){"use strict";var out=$edbml.$out,$att=$edbml.$att,$val=edbml.safeattr;return $att.src=image.background?ts.ui.ImageModel.BLANK:image.src,$att.style=image.background?'background-image:url("'+image.src+'")':null,$att.alt=image.alt||null,out.html+='<img class="ts-image" '+$att.$("src")+" "+$att.$("alt")+" "+$att.$("style")+' id="'+$val(image.$instanceid)+'" width="'+$val(image.width)+'" height="'+$val(image.height)+'"/>',out.write()}),edbml.declare("ts.ui.input.edbml").as(function $edbml(input){"use strict";var out=$edbml.$out,$txt=edbml.safetext,$val=edbml.safeattr,id=input.$instanceid;return out.html+='<fieldset id="ts-group-'+$val(id)+'"><label data-ts="Label" id="ts-label-'+$val(id)+'"><span>'+$txt(input.label)+"</span>"+ts.ui.inputonly.edbml(input)+"</label></fieldset>",out.write()}),edbml.declare("ts.ui.inputonly.edbml").as(function $edbml(input){"use strict";var out=$edbml.$out,$att=$edbml.$att,$set=edbml.$set,$txt=edbml.safetext,$val=edbml.safeattr;if($att.class=input.validity.valid?null:"ts-error",$att.id="ts-field-"+input.$instanceid,$att.readonly=input.readonly?"readonly":null,$att.disabled=input.disabled?"disabled":null,$att.autofocus=input.autofocus?"autofocus":null,$att.required=input.required?"required":null,$att.placeholder=input.placeholder||null,ts.ui.TextAreaModel.is(input)){var $1=$set(function(){return input},this);out.html+='<textarea data-ts="TextArea" '+$att.$("id")+' rows="'+$val(input.rows)+'" data-ts._model="edbml.$get(&quot;'+$1+'&quot;);" data-ts.entershift="'+$val(input.entershift)+'" '+$att.$("readonly")+" "+$att.$("disabled")+" "+$att.$("autofocus")+" "+$att.$("required")+" "+$att.$("placeholder")+' data-ts.idletime="'+$val(input.idletime)+'">'+$txt(input.value)+"</textarea>"}else{var $2=$set(function(){return input},this);out.html+='<input data-ts="Input" '+$att.$("id")+' value="'+$val(input.value)+'" data-ts._model="edbml.$get(&quot;'+$2+'&quot;);" '+$att.$("readonly")+" "+$att.$("disabled")+" "+$att.$("autofocus")+" "+$att.$("required")+" "+$att.$("placeholder")+' data-ts.idletime="'+$val(input.idletime)+'"/>'}return out.write()}),edbml.declare("ts.ui.menu.edbml").as(function $edbml(menu){"use strict";function isSelected(item){switch(menu.select){case"one":return item.index===index;case"many":return indxs.indexOf(item.index)>-1}}function declarations(total,start,yspan){return["padding-top:"+start*yspan+"px;","height:"+total*yspan+"px;"].join("")}var out=$edbml.$out,$att=$edbml.$att,$set=edbml.$set,$txt=edbml.safetext,$val=edbml.safeattr;menu.random;var id=menu.$instanceid,index=menu.selectedIndex,indxs=menu.selectedIndexes,shown=menu.maxItemsShown,items=function(items$2){return items$2.map(function(item,i){return item.index=i,item}).filter(function(item,i){return!1!==item.visible})}(menu.items),minis=function(items$2,shown$2){var start,stops,length=items$2.length;return shown$2>-1?(start=index>shown$2-1?index:0,stops=shown$2+start,stops=stops>length-1?length:stops,start=stops-index<shown$2?stops-shown$2:start,items$2.slice(start,stops)):items$2}(items,shown);if(items.length){var isoptimizing=shown>-1;$att.style=function(optimized){if(optimized){var total=items.length,start=items.indexOf(minis[0]);return menu.scrollContainingPanel(44*start),declarations(total,start,44)}return null}(isoptimizing);var $1=$set(function(){return menu},this);out.html+='<menu data-ts="Menu" id="'+$val(id)+'-menu" data-ts._model="edbml.$get(&quot;'+$1+'&quot;);" '+$att.$("style")+" tempname>",minis.forEach(function(item){var selected=isSelected(item);$att.disabled=item.disabled?"disabled":null,$att.class=selected?"ts-checked":null,out.html+='<li id="'+$val(id)+"-"+$val(item.index)+'" '+$att.$("class")+"><button "+$att.$("disabled")+">",item.icon&&!item.reverse&&(out.html+='<i class="'+$val(item.icon)+'"></i>'),item.label&&(out.html+="<span>"+$txt(item.label)+"</span>"),item.icon&&item.reverse&&(out.html+='<i class="'+$val(item.icon)+'"></i>'),selected&&(out.html+='<i class="ts-icon-checked"></i>'),out.html+="</button></li>"}),out.html+="</menu>","many"===menu.select&&function(menu$2){out.html+='<menu data-ts="Buttons"><li>',$att.disabled=menu$2.donebuttonenabled?null:"disabled";var $2=$set(function(){menu$2.done()},this);out.html+="<button "+$att.$("disabled")+' id="'+$val(id)+'-button" class="ts-primary" onclick="edbml.$run(this, \''+$2+"');\"><span>"+$txt(menu$2.donebuttonlabel)+"</span></button></li></menu>"}(menu)}return out.write()}),edbml.declare("ts.ui.pager.edbml").as(function $edbml(pager){"use strict";var out=$edbml.$out,$set=edbml.$set,$val=edbml.safeattr,$1=$set(function(){return pager},this);return out.html+='<div data-ts="Pager" id="'+$val(pager.$instanceid)+'" data-ts._model="edbml.$get(&quot;'+$1+'&quot;);"></div>',out.write()}),edbml.declare("ts.ui.search.edbml").as(function $edbml(search){"use strict";var out=$edbml.$out,$att=$edbml.$att,$set=edbml.$set;$att.class=search.inset?"ts-inset":null;var $1=$set(function(){return search},this);return out.html+='<span data-ts="Search" '+$att.$("class")+' data-ts.model="edbml.$get(&quot;'+$1+'&quot;);"></span>',out.write()}),edbml.declare("ts.ui.select.edbml").as(function $edbml(select){"use strict";var out=$edbml.$out,$txt=edbml.safetext,$val=edbml.safeattr;return out.html+='<select id="'+$val(select.$instanceid)+'">',select.options.forEach(function(option){out.html+='<option value="'+$val(option.value)+'">'+$txt(option.text)+"</option>"}),out.html+="</select>",out.write()}),edbml.declare("ts.ui.statusbar.edbml").as(function $edbml(statusbar){"use strict";var out=$edbml.$out,$1=(0,edbml.$set)(function(){return statusbar},this);return out.html+='<footer data-ts="StatusBar" data-ts.model="edbml.$get(&quot;'+$1+'&quot;);"></header>',out.write()}),edbml.declare("ts.ui.svgicons.edbml").as(function $edbml(icon,size){"use strict";var out=$edbml.$out,$val=edbml.safeattr;switch(size=size||22,out.html+='<svg class="ts-svg-'+$val(icon)+'" xmlns="http://www.w3.org/2000/svg" width="'+$val(size)+'" height="'+$val(size)+'" lineHeight="'+$val(size)+'" viewBox="0 0 24 24">',icon){case"fast-forward":out.html+='<path d="M4 18l8.5-6L4 6v12zm9-12v12l8.5-6L13 6z"/>';break;case"fast-rewind":out.html+='<path d="M11 18V6l-8.5 6 8.5 6zm.5-6l8.5 6V6l-8.5 6z"/>';break;case"skip-next":out.html+='<path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"/>';break;case"skip-previous":out.html+='<path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/>';break;case"checked":case"accept":case"done":case"approve":case"appactive":out.html+='<path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/>';break;case"logo-t1":out.html+='<path d="M1.148 9.035v-1.98q0-0.246 0.281-0.246h8.074q0.27 0 0.27 0.246v11.883q0 0.258-0.27 0.258h-2.883q-0.129 0-0.205-0.070t-0.076-0.188v-9.645h-4.91q-0.281 0-0.281-0.258z"></path>';break;case"logo-t2":out.html+='<path d="M1.148 18.938v-11.883q0-0.246 0.281-0.246h8.063q0.281 0 0.281 0.246v1.98q0 0.258-0.281 0.258h-4.898v9.645q0 0.117-0.076 0.188t-0.205 0.070h-2.883q-0.129 0-0.205-0.070t-0.076-0.188z"></path>';break;case"logo-shift":out.html+='<path d="M0.762 10.723q0-1.922 1.23-3.012t3.691-1.090q1.664 0 4.008 0.586 0.469 0.141 0.375 0.516l-0.34 1.582q-0.094 0.387-0.375 0.305-2.355-0.504-3.434-0.504h-0.129q-1.688 0.059-1.688 1.254 0 0.281 0.111 0.492t0.275 0.334 0.475 0.217 0.568 0.141 0.691 0.117q0.211 0.035 0.316 0.047 0.492 0.082 0.814 0.146t0.773 0.205 0.75 0.311 0.627 0.469 0.516 0.668 0.316 0.908 0.129 1.195q0 0.832-0.258 1.482t-0.697 1.072-1.061 0.697-1.307 0.393-1.482 0.117q-1.055 0-2.139-0.146t-1.594-0.27-0.756-0.205q-0.293-0.105-0.293-0.41v-0.082l0.246-1.453q0.047-0.305 0.293-0.305 0.047 0 0.211 0.023 0.035 0.012 0.352 0.088t0.627 0.146 0.732 0.152 0.867 0.129 0.832 0.047q0.996 0 1.5-0.275t0.504-0.99q0-0.188-0.029-0.34t-0.123-0.27-0.158-0.205-0.246-0.164-0.275-0.123-0.346-0.1-0.357-0.070-0.416-0.070-0.428-0.076q-0.609-0.105-1.043-0.217t-1.020-0.381-0.949-0.633-0.627-0.996-0.264-1.453zM12.070 18.949v-11.895q0-0.246 0.27-0.246h2.777q0.281 0 0.281 0.246v4.781h4.148v-4.781q0-0.246 0.258-0.246h2.789q0.281 0 0.281 0.246v11.895q0 0.246-0.281 0.246h-2.789q-0.281 0-0.281-0.246v-4.758h-4.125v4.758q0 0.246-0.258 0.246h-2.789q-0.281 0-0.281-0.246zM25.254 18.949v-11.895q0-0.246 0.258-0.246h2.789q0.281 0 0.281 0.246v11.895q0 0.246-0.27 0.246h-2.777q-0.281 0-0.281-0.246zM30.961 18.938v-11.871q0-0.117 0.082-0.188t0.211-0.070h7.934q0.281 0 0.281 0.246v1.992q0 0.105-0.082 0.176t-0.199 0.070h-4.91v2.543h4.137q0.281 0 0.281 0.246v1.852q0 0.246-0.281 0.246h-4.137v4.758q0 0.117-0.082 0.188t-0.211 0.070h-2.73q-0.129 0-0.211-0.070t-0.082-0.188zM41.039 18.949v-11.895q0-0.246 0.281-0.246h8.074q0.281 0 0.281 0.246v1.992q0 0.105-0.082 0.176t-0.199 0.070h-4.91v9.656q0 0.246-0.281 0.246h-2.883q-0.281 0-0.281-0.246z"></path>';break;case"logo-trade":out.html+='<path d="M0.621 9.035v-1.98q0-0.246 0.281-0.246h8.063q0.281 0 0.281 0.246v11.883q0 0.246-0.281 0.246h-2.871q-0.281 0-0.281-0.246v-9.645h-4.91q-0.281 0-0.281-0.258zM11.637 18.938v-11.871q0-0.117 0.082-0.193t0.211-0.076h5.625q2.414 0 3.48 0.926t1.066 2.672q0 0.551-0.105 0.979t-0.369 0.838-0.779 0.686-1.266 0.404l-0.082 0.012q-0.188 0.012-0.188 0.188 0 0.199 0.164 0.199 0.129 0 0.258 0.088t0.188 0.182l0.070 0.094 2.637 3.574 3.305-10.641q0.059-0.199 0.281-0.199h4.898q0.223 0 0.281 0.199l3.68 11.93 0.023 0.047q0 0.094-0.076 0.152t-0.193 0.059h-2.859q-0.117 0-0.223-0.088t-0.129-0.205l-0.492-1.828h-4.969l-0.492 1.863q-0.059 0.258-0.316 0.258h-4.992q-0.293 0-0.387-0.164l-3-4.254h-2.016v4.172q0 0.246-0.258 0.246h-2.777q-0.281 0-0.281-0.246zM14.965 12.715h1.91q0.949 0 1.395-0.357t0.445-1.33q0-0.961-0.398-1.336t-1.301-0.398h-2.051v3.422zM26.766 14.766h3.75l-1.465-5.473h-0.832zM35.813 18.926v-11.859q0-0.117 0.076-0.193t0.193-0.076h5.484q1.336 0 2.32 0.299t1.6 0.814 0.984 1.313 0.51 1.664 0.141 1.992q0 1.207-0.141 2.121t-0.516 1.729-0.99 1.336-1.6 0.82-2.309 0.299h-5.484q-0.117 0-0.193-0.070t-0.076-0.188zM39.141 17.004h2.086q1.488 0 1.986-0.785t0.498-3.035q0-1.535-0.258-2.391t-0.732-1.178-1.283-0.322h-2.297v7.711zM48.586 18.926v-11.859q0-0.117 0.088-0.193t0.217-0.076h8.332q0.27 0 0.27 0.246v2.004q0 0.246-0.27 0.246h-5.309v2.543h5.051q0.281 0 0.281 0.223v1.875q0 0.246-0.281 0.246h-5.051v2.672h5.32q0.258 0 0.258 0.246v1.84q0 0.258-0.258 0.258h-8.344q-0.129 0-0.217-0.076t-0.088-0.193z"></path>';break;case"back":out.html+='<path d="M21 11H6.83l3.58-3.59L9 6l-6 6 6 6 1.41-1.41L6.83 13H21z"/>';break;case"discovery":out.html+='<path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zm6.93 6h-2.95c-.32-1.25-.78-2.45-1.38-3.56 1.84.63 3.37 1.91 4.33 3.56zM12 4.04c.83 1.2 1.48 2.53 1.91 3.96h-3.82c.43-1.43 1.08-2.76 1.91-3.96zM4.26 14C4.1 13.36 4 12.69 4 12s.1-1.36.26-2h3.38c-.08.66-.14 1.32-.14 2 0 .68.06 1.34.14 2H4.26zm.82 2h2.95c.32 1.25.78 2.45 1.38 3.56-1.84-.63-3.37-1.9-4.33-3.56zm2.95-8H5.08c.96-1.66 2.49-2.93 4.33-3.56C8.81 5.55 8.35 6.75 8.03 8zM12 19.96c-.83-1.2-1.48-2.53-1.91-3.96h3.82c-.43 1.43-1.08 2.76-1.91 3.96zM14.34 14H9.66c-.09-.66-.16-1.32-.16-2 0-.68.07-1.35.16-2h4.68c.09.65.16 1.32.16 2 0 .68-.07 1.34-.16 2zm.25 5.56c.6-1.11 1.06-2.31 1.38-3.56h2.95c-.96 1.65-2.49 2.93-4.33 3.56zM16.36 14c.08-.66.14-1.32.14-2 0-.68-.06-1.34-.14-2h3.38c.16.64.26 1.31.26 2s-.1 1.36-.26 2h-3.38z"/>';break;case"insertfrominventory":out.html+='<path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM8 14H6v-2h2v2zm0-3H6V9h2v2zm0-3H6V6h2v2zm7 6h-5v-2h5v2zm3-3h-8V9h8v2zm0-3h-8V6h8v2z"/>';break;case"preview":out.html+='<path d="M11.5 9C10.12 9 9 10.12 9 11.5s1.12 2.5 2.5 2.5 2.5-1.12 2.5-2.5S12.88 9 11.5 9zM20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-3.21 14.21l-2.91-2.91c-.69.44-1.51.7-2.39.7C9.01 16 7 13.99 7 11.5S9.01 7 11.5 7 16 9.01 16 11.5c0 .88-.26 1.69-.7 2.39l2.91 2.9-1.42 1.42z"/>';break;case"split":out.html+='<path d="M19.707,10.707L23.414,7l-3.707-3.707l-1.414,1.414L19.586,6H17c-3.905,0-4.943,1.489-5.858,2.803 C10.32,9.982,9.611,11,6,11H0v2h6c3.611,0,4.32,1.018,5.142,2.197C12.057,16.511,13.095,18,17,18h2.586l-1.293,1.293l1.414,1.414 L23.414,17l-3.707-3.707l-1.414,1.414L19.586,16H17c-2.861,0-3.43-0.816-4.217-1.946c-0.479-0.687-1.016-1.458-2.029-2.054 c1.014-0.596,1.551-1.367,2.029-2.054C13.57,8.816,14.139,8,17,8h2.586l-1.293,1.293L19.707,10.707z"/>';break;case"activity":out.html+='<g><polygon points="12.067,21.959 7.012,8.815 4.693,14.999 0,14.999 0,12.999 3.307,12.999 6.988,3.183 11.933,16.039 14.815,7.393 17.618,12.999 24,12.999 24,14.999 16.382,14.999 15.185,12.605 \t\t"/></g>';break;case"broadcastmessage":out.html+='<path d="M12 5c-3.87 0-7 3.13-7 7h2c0-2.76 2.24-5 5-5s5 2.24 5 5h2c0-3.87-3.13-7-7-7zm1 9.29c.88-.39 1.5-1.26 1.5-2.29 0-1.38-1.12-2.5-2.5-2.5S9.5 10.62 9.5 12c0 1.02.62 1.9 1.5 2.29v3.3L7.59 21 9 22.41l3-3 3 3L16.41 21 13 17.59v-3.3zM12 1C5.93 1 1 5.93 1 12h2c0-4.97 4.03-9 9-9s9 4.03 9 9h2c0-6.07-4.93-11-11-11z"/>';break;case"dispute":out.html+='<path d="M23.885,12.558l0.01-0.005L20.618,6H22V4h-9V2h-2v2H2v2h1.382l-3.276,6.553l0.01,0.005 C0.047,12.692,0,12.839,0,13c0,2.757,2.243,5,5,5s5-2.243,5-5c0-0.161-0.047-0.308-0.115-0.442l0.01-0.005L6.618,6H11v14H8v2h8v-2 h-3V6h4.382l-3.276,6.553l0.01,0.005C14.047,12.692,14,12.839,14,13c0,2.757,2.243,5,5,5s5-2.243,5-5 C24,12.839,23.953,12.692,23.885,12.558z M5,7.236L7.382,12H2.618L5,7.236z M5,16c-1.304,0-2.416-0.836-2.828-2h5.656 C7.416,15.164,6.304,16,5,16z M21.382,12h-4.764L19,7.236L21.382,12z M19,16c-1.304,0-2.416-0.836-2.828-2h5.656 C21.416,15.164,20.304,16,19,16z"/>';break;case"location":out.html+='<path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>';break;case"previously-requested":out.html+='<path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/>';break;case"statuschange":out.html+='<path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>';break;case"add":case"appactivate":out.html+='<path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>';break;case"cancel":case"reject":out.html+='<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8 0-1.85.63-3.55 1.69-4.9L16.9 18.31C15.55 19.37 13.85 20 12 20zm6.31-3.1L7.1 5.69C8.45 4.63 10.15 4 12 4c4.42 0 8 3.58 8 8 0 1.85-.63 3.55-1.69 4.9z"/>';break;case"document":out.html+='<path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>';break;case"locked":out.html+='<path d="M17,11V7c0-2.757-2.244-5-5-5C9.242,2,7,4.243,7,7v4c-1.103,0-2,0.896-2,2v7c0,1.103,0.897,2,2,2h10 c1.103,0,2-0.897,2-2v-7C19,11.896,18.103,11,17,11z M12,18c-0.828,0-1.5-0.672-1.5-1.5S11.172,15,12,15s1.5,0.672,1.5,1.5 S12.828,18,12,18z M15,11H9V7c0-1.654,1.346-3,3-3s3,1.346,3,3V11z"/>';break;case"proceed":out.html+='<path d="M12 8V4l8 8-8 8v-4H4V8z"/>';break;case"support":out.html+='<path d="M18.002,0.005c-3.309,0-6,2.693-6,6c0,3.309,2.691,6,6,6c3.308,0,6-2.691,6-6 C24.002,2.698,21.31,0.005,18.002,0.005z M19.002,10.006h-2v-4h2V10.006z M19.002,4.006c0,0.553-0.447,1-1,1c-0.553,0-1-0.447-1-1 c0-0.553,0.447-1,1-1C18.555,3.006,19.002,3.453,19.002,4.006z"/><path d="M6.3,12.198c1.003-0.485,1.702-1.505,1.702-2.692c0-1.654-1.346-3-3-3s-3,1.346-3,3 c0,1.188,0.699,2.207,1.702,2.692c-2.126,0.576-3.702,2.503-3.702,4.808v2c0,0.553,0.447,1,1,1h1v3c0,0.553,0.447,1,1,1h4 c0.553,0,1-0.447,1-1v-3h1c0.553,0,1-0.447,1-1v-2C10.002,14.701,8.426,12.774,6.3,12.198z"/><path d="M15.756,18.429c0.752-0.546,1.246-1.425,1.246-2.423c0-1.654-1.346-3-3-3s-3,1.346-3,3 c0,0.998,0.494,1.877,1.246,2.423c-1.324,0.652-2.246,2.004-2.246,3.577v1c0,0.553,0.447,1,1,1h6c0.553,0,1-0.447,1-1v-1 C18.002,20.433,17.081,19.081,15.756,18.429z"/>';break;case"add-to-archive":out.html+='<path d="M13,18H6V2h10v11h2V1c0-0.552-0.447-1-1-1H1C0.447,0,0,0.449,0,1v18c0,0.552,0.447,1,1,1h12V18z M4,18H2V2h2V18z"/><polygon points="23,18 20,18 20,15 18,15 18,18 15,18 15,20 18,20 18,23 20,23 20,20 23,20 \t\t"/>';break;case"cart":case"purchases":out.html+='<path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/>';break;case"timer":out.html+='<path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"/><path d="M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"/>';break;case"addfield":out.html+='<path d="M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4V7zm-1-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/>';break;case"categories":out.html+='<path d="M2 17h2v.5H3v1h1v.5H2v1h3v-4H2v1zm1-9h1V4H2v1h1v3zm-1 3h1.8L2 13.1v.9h3v-1H3.2L5 10.9V10H2v1zm5-6v2h14V5H7zm0 14h14v-2H7v2zm0-6h14v-2H7v2z"/>';break;case"download":out.html+='<path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>';break;case"radio":out.html+='<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"/>';break;case"todo":out.html+='<path d="M14.4 6L14 4H5v17h2v-7h5.6l.4 2h7V6z"/>';break;case"addfilter":out.html+='<path d="M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"/>';break;case"checkbox":out.html+='<path d="M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"/>';break;case"drafts":out.html+='<path d="M12,16.001c-2.205,0-4-1.794-4-4s1.795-4,4-4s4,1.794,4,4S14.205,16.001,12,16.001z M12,10.001 c-1.104,0-2,0.898-2,2c0,1.103,0.896,2,2,2s2-0.897,2-2C14,10.899,13.104,10.001,12,10.001z"/><path d="M12.165,23.046l-0.209-1.989l0.995-0.105c0.625-0.066,1.243-0.197,1.838-0.391l0.951-0.309 l0.619,1.901l-0.951,0.31c-0.728,0.237-1.484,0.397-2.248,0.478L12.165,23.046z M9.564,22.778L8.613,22.47 c-0.729-0.236-1.436-0.55-2.102-0.934l-0.867-0.499l0.998-1.733l0.867,0.499c0.545,0.314,1.123,0.571,1.719,0.764l0.951,0.307 L9.564,22.778z M18.622,20.842l-1.339-1.486l0.742-0.669c0.467-0.42,0.891-0.891,1.26-1.398l0.588-0.81l1.617,1.177 l-0.588,0.809c-0.451,0.62-0.969,1.194-1.537,1.708L18.622,20.842z M3.701,19.291l-0.59-0.808 c-0.453-0.621-0.842-1.29-1.154-1.988l-0.409-0.912l1.825-0.818l0.408,0.914c0.256,0.571,0.574,1.118,0.945,1.625l0.59,0.807 L3.701,19.291z M22.556,15.265l-1.957-0.414l0.206-0.978C20.935,13.262,21,12.631,21,12.001v-1l2-0.041v1.012 c0,0.798-0.08,1.566-0.238,2.314L22.556,15.265z M1,13.022v-1.001c0-0.78,0.078-1.541,0.232-2.282L1.438,8.76l1.957,0.409 l-0.203,0.979C3.064,10.754,3,11.378,3,12.001v1L1,13.022z M20.621,9.22L20.21,8.309c-0.257-0.57-0.575-1.116-0.947-1.624 l-0.591-0.807l1.613-1.183l0.591,0.807c0.454,0.62,0.845,1.289,1.158,1.985l0.41,0.912L20.621,9.22z M4.117,7.54L2.498,6.367 l0.586-0.81c0.45-0.621,0.967-1.196,1.534-1.71l0.741-0.671l1.343,1.483L5.961,5.329C5.496,5.75,5.072,6.222,4.705,6.73 L4.117,7.54z M17.34,4.688L16.473,4.19c-0.543-0.313-1.121-0.567-1.719-0.76l-0.952-0.306l0.611-1.904l0.952,0.306 c0.73,0.235,1.438,0.548,2.104,0.93l0.867,0.498L17.34,4.688z M8.243,3.759l-0.623-1.9l0.95-0.312 c0.728-0.239,1.484-0.401,2.248-0.483l0.994-0.106l0.213,1.989l-0.994,0.107c-0.625,0.067-1.244,0.199-1.838,0.394L8.243,3.759z"/>';break;case"logout":out.html+='<path d="M13 3h-2v10h2V3zm4.83 2.17l-1.42 1.42C17.99 7.86 19 9.81 19 12c0 3.87-3.13 7-7 7s-7-3.13-7-7c0-2.19 1.01-4.14 2.58-5.42L6.17 5.17C4.23 6.82 3 9.26 3 12c0 4.97 4.03 9 9 9s9-4.03 9-9c0-2.74-1.23-5.18-3.17-6.83z"/>';break;case"radioon":out.html+='<path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zm0-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"/>';break;case"alldocuments":out.html+='<path d="M17.414,0H10C8.897,0,8,0.898,8,2v14c0,1.103,0.897,2,2,2h10c1.103,0,2-0.897,2-2V4.586L17.414,0z M20.001,16H10V2h6v4h4L20.001,16z"/><path d="M7,3H5v16c0,1.103,0.897,2,2,2h12v-2H7V3z"/><path d="M4,6H2v16c0,1.103,0.897,2,2,2h12v-2H4V6z"/>';break;case"checkboxon":out.html+='<path d="M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>';break;case"edit":out.html+='<path d="M20.822,3.179C20.062,2.419,19.051,2,17.976,2S15.89,2.418,15.13,3.179l-9.983,9.982 c-0.391,0.391-0.391,1.024,0,1.414l0.104,0.104l-1.733,0.347c-0.417,0.084-0.734,0.42-0.794,0.84l-0.712,4.991 c-0.045,0.311,0.06,0.625,0.282,0.847c0.223,0.223,0.537,0.329,0.849,0.283l4.991-0.713c0.42-0.059,0.756-0.377,0.84-0.793 l0.347-1.733l0.104,0.104c0.391,0.392,1.023,0.392,1.414,0l9.983-9.982C21.581,8.11,22,7.1,22,6.024s-0.419-2.086-1.179-2.847 L20.822,3.179z M16.538,4.599l0.005-0.006c0.765-0.764,2.1-0.765,2.864,0c0.764,0.764,0.764,2.099,0,2.864l-0.006,0.005 L16.538,4.599z M7.151,19.397L4.179,19.82l0.424-2.971l2.348-0.469l0.669,0.669L7.151,19.397z M10.132,16.733l-2.863-2.864 l7.855-7.856l2.863,2.864L10.132,16.733z"/>';break;case"menuswitch":out.html+='<path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>';break;case"rating":case"followed":out.html+='<path d="M21.924,8.618C21.77,8.245,21.404,8.001,21,8.001h-5.382l-2.724-5.447c-0.339-0.677-1.45-0.677-1.789,0 L8.382,8.001H3c-0.404,0-0.77,0.244-0.924,0.617c-0.154,0.373-0.069,0.805,0.217,1.09l4.584,4.584l-1.838,6.435 c-0.115,0.403,0.033,0.835,0.371,1.082c0.34,0.248,0.797,0.257,1.144,0.024L12,18.203l5.445,3.63 c0.168,0.112,0.361,0.168,0.555,0.168c0.207,0,0.414-0.064,0.59-0.192c0.338-0.247,0.486-0.679,0.371-1.082l-1.838-6.435 l4.584-4.584C21.993,9.423,22.078,8.991,21.924,8.618z"/>';break;case"triangledown":case"triangleleft":case"triangleright":case"showpicker":out.html+='<path d="M7 10l5 5 5-5z"/>';break;case"triangleup":out.html+='<path d="M7 14l5-5 5 5z"/>';break;case"error":case"warning":out.html+='<path d="M21.895,20.553l-9-18c-0.339-0.677-1.45-0.677-1.789,0l-9,18c-0.154,0.31-0.139,0.677,0.044,0.974 C2.332,21.821,2.653,22,3,22h18c0.347,0,0.668-0.18,0.851-0.474C22.033,21.23,22.049,20.864,21.895,20.553z M11,10h2v6h-2V10z M12,19.25c-0.69,0-1.25-0.559-1.25-1.25c0-0.69,0.56-1.25,1.25-1.25s1.25,0.56,1.25,1.25C13.25,18.691,12.69,19.25,12,19.25z"/>';break;case"merge":out.html+='<path d="M17 20.41L18.41 19 15 15.59 13.59 17 17 20.41zM7.5 8H11v5.59L5.59 19 7 20.41l6-6V8h3.5L12 3.5 7.5 8z"/>';break;case"checked-alt":out.html+='<path d="M12.042,2c-5.523,0-10,4.477-10,10s4.477,10,10,10s10-4.477,10-10S17.564,2,12.042,2z M11.292,17.75 l-5-3.75l1.5-2l3,2.25l5.25-7l2,1.5L11.292,17.75z"/>';break;case"favorites":case"heart":out.html+='<path d="M16,4.001c-1.594,0-3.07,0.837-4,2.08c-0.93-1.243-2.406-2.08-4-2.08c-2.757,0-5,2.243-5,5 c0,5.491,8.124,10.632,8.471,10.848c0.162,0.101,0.346,0.152,0.529,0.152s0.367-0.051,0.529-0.152 C12.876,19.633,21,14.492,21,9.001C21,6.244,18.757,4.001,16,4.001z"/>';break;case"more":out.html+='<path d="M12,2.001c-5.514,0-10,4.486-10,10s4.486,10,10,10s10-4.486,10-10S17.514,2.001,12,2.001z M17,13.001h-4v4 h-2v-4H7v-2h4v-4h2v4h4V13.001z"/>';break;case"remove":out.html+='<path d="M12,2.001c-5.514,0-10,4.486-10,10s4.486,10,10,10s10-4.486,10-10S17.514,2.001,12,2.001z M16.707,15.294 l-1.414,1.414L12,13.415l-3.293,3.293l-1.414-1.414l3.293-3.293L7.293,8.708l1.414-1.414L12,10.587l3.293-3.293l1.414,1.414 l-3.293,3.293L16.707,15.294z"/>';break;case"close":out.html+='<g><polygon points="21.456,5.414 18.627,2.586 12.042,9.172 5.456,2.586 2.627,5.414 9.213,12 2.627,18.586 5.456,21.414 12.042,14.828 18.627,21.414 21.456,18.586 14.87,12 \t"/></g>';break;case"fileaccess":out.html+='<path d="M9,12c0-1,1-1,1-1h8.736C19.53,9.865,20,8.487,20,7c0-3.859-3.141-7-7-7c-2.51,0-4.74,1.31-5.978,3.357 C7.987,3.815,9.018,4.62,9.992,6.004L9.175,6.58C7.678,4.454,6.393,4,5,4C2.243,4,0,6.243,0,9c0,2.757,2.243,5,5,5h4 C9,12.981,9,12.228,9,12z"/><path d="M23,15h-5.586l-1.707-1.707C15.519,13.106,15.266,13,15,13h-3c-0.553,0-1,0.447-1,1v9c0,0.553,0.447,1,1,1 h11c0.553,0,1-0.447,1-1v-7C24,15.447,23.553,15,23,15z"/>';break;case"myapps":out.html+='<path d="M20,19.999h-4v2h4c1.103,0,2-0.897,2-2v-4h-2V19.999z"/><path d="M20,1.999h-4v2h4v4h2v-4C22,2.896,21.103,1.999,20,1.999z"/><path d="M2,3.999v4h2v-4h4v-2H4C2.897,1.999,2,2.896,2,3.999z"/><path d="M4,15.999H2v4c0,1.103,0.897,2,2,2h4v-2H4V15.999z"/><rect x="10" y="15.999" width="4" height="4"/><rect x="10" y="9.999" width="4" height="4"/><rect x="4" y="9.999" width="4" height="4"/><rect x="16" y="9.999" width="4" height="4"/><rect x="10" y="3.999" width="4" height="4"/>';break;case"reset":out.html+='<g><polygon points="11,8 11,14 15,14 15,12 13,12 13,8 \t\t"/><path d="M12,2C9.285,2,6.779,3.089,4.938,4.938L3,3v6h6L6.351,6.351C7.824,4.871,9.828,4,12,4 c4.411,0,8,3.589,8,8s-3.589,8-8,8v2c5.514,0,10-4.485,10-10S17.514,2,12,2z"/></g>';break;case"unfollowed":out.html+='<path d="M18,22.001c-0.193,0-0.387-0.056-0.555-0.168L12,18.203l-5.445,3.63 c-0.348,0.232-0.805,0.224-1.145-0.024c-0.338-0.247-0.486-0.679-0.371-1.082l1.838-6.435L2.293,9.708 c-0.286-0.285-0.371-0.716-0.217-1.09C2.23,8.245,2.596,8.001,3,8.001h5.382l2.724-5.447c0.339-0.677,1.45-0.677,1.789,0 l2.724,5.447H21c0.404,0,0.77,0.244,0.924,0.617c0.154,0.374,0.069,0.805-0.217,1.09l-4.584,4.584l1.838,6.435 c0.115,0.403-0.033,0.835-0.371,1.082C18.414,21.937,18.207,22.001,18,22.001z M12,16.001c0.193,0,0.387,0.057,0.555,0.168 l3.736,2.491l-1.252-4.384c-0.101-0.35-0.003-0.726,0.254-0.982l3.293-3.293H15c-0.379,0-0.725-0.214-0.895-0.553L12,5.237 L9.895,9.448C9.725,9.787,9.379,10.001,9,10.001H5.414l3.293,3.293c0.257,0.257,0.354,0.633,0.254,0.982L7.709,18.66l3.736-2.491 C11.613,16.058,11.807,16.001,12,16.001z"/>';break;case"apps":out.html+='<path d="M6,2.001H4c-1.103,0-2,0.898-2,2v2c0,1.102,0.897,2,2,2h2c1.103,0,2-0.898,2-2v-2 C8,2.899,7.103,2.001,6,2.001z"/><path d="M6,9.001H4c-1.103,0-2,0.898-2,2v2c0,1.102,0.897,2,2,2h2c1.103,0,2-0.898,2-2v-2 C8,9.899,7.103,9.001,6,9.001z"/><path d="M6,16.001H4c-1.103,0-2,0.898-2,2v2c0,1.103,0.897,2,2,2h2c1.103,0,2-0.897,2-2v-2 C8,16.899,7.103,16.001,6,16.001z"/><path d="M13,2.001h-2c-1.104,0-2,0.898-2,2v2c0,1.102,0.896,2,2,2h2c1.104,0,2-0.898,2-2v-2 C15,2.899,14.104,2.001,13,2.001z"/><path d="M13,9.001h-2c-1.104,0-2,0.898-2,2v2c0,1.102,0.896,2,2,2h2c1.104,0,2-0.898,2-2v-2 C15,9.899,14.104,9.001,13,9.001z"/><path d="M13,16.001h-2c-1.104,0-2,0.898-2,2v2c0,1.103,0.896,2,2,2h2c1.104,0,2-0.897,2-2v-2 C15,16.899,14.104,16.001,13,16.001z"/><path d="M20,2.001h-2c-1.104,0-2,0.898-2,2v2c0,1.102,0.896,2,2,2h2c1.104,0,2-0.898,2-2v-2 C22,2.899,21.104,2.001,20,2.001z"/><path d="M20,9.001h-2c-1.104,0-2,0.898-2,2v2c0,1.102,0.896,2,2,2h2c1.104,0,2-0.898,2-2v-2 C22,9.899,21.104,9.001,20,9.001z"/><path d="M20,16.001h-2c-1.104,0-2,0.898-2,2v2c0,1.103,0.896,2,2,2h2c1.104,0,2-0.897,2-2v-2 C22,16.899,21.104,16.001,20,16.001z"/>';break;case"code":out.html+='<g><polygon points="21,10 15.465,10 18.232,5.206 14.769,3.206 12,8 9.232,3.206 5.769,5.206 8.538,10 3,10 3,14 8.537,14 5.769,18.795 9.232,20.795 12.001,15.998 14.769,20.793 18.232,18.793 15.465,14 21,14 \t"/></g>';break;case"fileattach":out.html+='<path d="M11,23c-2.897,0-5-2.313-5-5.5V9c0-3.991,2.794-7,6.5-7S19,5.009,19,9v7h-2V9 c0-2.897-1.893-5-4.5-5S8,6.103,8,9v8.5c0,1.743,0.928,3.5,3,3.5s3-1.757,3-3.5V10c0-0.602-0.146-2-1.5-2S11,9.398,11,10v7H9v-7 c0-2.393,1.407-4,3.5-4S16,7.607,16,10v7.5C16,20.687,13.897,23,11,23z"/>';break;case"network":out.html+='<path d="M17,7c-3.055,0-4.539,2.375-5.848,4.471C9.779,13.666,8.814,15,7,15c-1.387,0-3-1.311-3-3 s1.613-3,3-3c1.037,0,1.795,0.448,2.512,1.231l1.139-1.706C9.721,7.631,8.569,7,7,7c-2.664,0-5,2.336-5,5s2.336,5,5,5 c3.055,0,4.539-2.375,5.848-4.471C14.221,10.334,15.186,9,17,9c1.387,0,3,1.311,3,3c0,2.074-0.926,3-3,3 c-0.988,0-1.723-0.406-2.409-1.121l-1.216,1.622C14.3,16.382,15.445,17,17,17c3.178,0,5-1.822,5-5C22,9.336,19.664,7,17,7z"/>';break;case"sales":out.html+='<g><circle cx="17" cy="18" r="2"/><path d="M8.965,15.173C8.976,15.115,9,15.061,9,15V8c0-0.552-0.447-1-1-1H6c-2.205,0-4,1.794-4,4v6 c0,0.552,0.447,1,1,1h2c0-1.656,1.344-3,3-3C8.34,15,8.66,15.069,8.965,15.173z M7,12H4v-2h3V12z"/><circle cx="8" cy="18" r="2"/><path d="M20,4h-8c-1.104,0-2,0.897-2,2v9.779c0.609,0.549,1,1.336,1,2.221h3c0-1.656,1.344-3,3-3 c1.656,0,3,1.344,3,3h1c0.553,0,1-0.448,1-1V6C22,4.897,21.104,4,20,4z"/></g>';break;case"unlocked":out.html+='<path d="M17,11H9V7c0-1.654,1.346-3,3-3s3,1.346,3,3v1h2V7c0-2.757-2.243-5-5-5S7,4.243,7,7v4c-1.103,0-2,0.896-2,2 v7c0,1.103,0.897,2,2,2h10c1.104,0,2-0.897,2-2v-7C19,11.896,18.104,11,17,11z M12,18c-0.828,0-1.5-0.672-1.5-1.5S11.172,15,12,15 s1.5,0.672,1.5,1.5S12.828,18,12,18z"/>';break;case"archive":case"split-alt":out.html+='<path d="M20,2.001H4c-0.553,0-1,0.448-1,1v18c0,0.552,0.447,1,1,1h16c0.553,0,1-0.448,1-1v-18 C21,2.449,20.553,2.001,20,2.001z M5,4.001h2v16H5V4.001z M19,20.001H9v-16h10V20.001z"/>';break;case"comment":out.html+='<path d="M19.998,2h-16c-1.104,0-2,0.895-2,2v12c0,1.104,0.896,2,2,2h1v4l4-4h10.999c1.105,0,2-0.896,2-2V4 C21.998,2.895,21.103,2,19.998,2z M7.998,11h-2V9h2V11z M12.998,11h-2V9h2V11z M17.998,11h-2V9h2V11z"/>';break;case"next":case"arrowright":out.html+='<g><polygon points="16.707,7.293 15.293,8.707 17.586,11 2,11 2,13 17.586,13 15.293,15.293 16.707,16.707 21.414,12 \t"/></g>';break;case"save":out.html+='<g><polygon points="16.707,13.709 15.293,12.295 13,14.588 13,2.002 11,2.002 11,14.588 8.707,12.295 7.293,13.709 12,18.416 \t\t"/><path d="M18,8.002h-1v2h1v10H6v-10h1v-2H6c-1.104,0-2,0.896-2,2v10c0,1.102,0.896,2,2,2h12 c1.104,0,2-0.898,2-2v-10C20,8.898,19.104,8.002,18,8.002z"/></g>';break;case"users":case"companysize":out.html+='<g><path d="M9.359,15.5c0,1.381-1.12,2.5-2.5,2.5c-1.381,0-2.5-1.119-2.5-2.5s1.119-2.5,2.5-2.5 C8.239,13,9.359,14.119,9.359,15.5"/><path d="M11.718,22c-0.446-1.722-1.997-3-3.858-3h-2c-1.862,0-3.413,1.278-3.859,3H11.718z"/><path d="M19.643,15.5c0,1.381-1.12,2.5-2.5,2.5c-1.381,0-2.5-1.119-2.5-2.5s1.119-2.5,2.5-2.5 C18.522,13,19.643,14.119,19.643,15.5"/><path d="M22.001,22c-0.446-1.722-1.997-3-3.858-3h-2c-1.862,0-3.413,1.278-3.859,3H22.001z"/><path d="M14.501,4.5c0,1.381-1.12,2.5-2.5,2.5c-1.381,0-2.5-1.119-2.5-2.5S10.62,2,12.001,2 C13.381,2,14.501,3.119,14.501,4.5"/><path d="M16.859,11c-0.446-1.722-1.997-3-3.858-3h-2c-1.862,0-3.413,1.278-3.859,3H16.859z"/></g>';break;case"arrowdown":out.html+='<g><polygon points="15.293,15.293 13,17.586 13,2 11,2 11,17.586 8.707,15.293 7.293,16.707 12,21.414 16.707,16.707 \t"/></g>';break;case"arrowleft":out.html+='<g><polygon points="22,11 6.414,11 8.707,8.707 7.293,7.293 2.586,12 7.293,16.707 8.707,15.293 6.414,13 22,13 \t"/></g>';break;case"arrowup":out.html+='<g><polygon points="16.707,7.293 12,2.586 7.293,7.293 8.707,8.707 11,6.414 11,22 13,22 13,6.414 15.293,8.707 \t"/></g>';break;case"companyevent":out.html+='<g><path d="M21,3h-3V1h-2v6h2V5h3v15H3V5h2V3H3C1.896,3,1,3.895,1,5v15c0,1.104,0.896,2,2,2h18 c1.104,0,2-0.896,2-2V5C23,3.895,22.104,3,21,3z"/><polygon points="8,5 15,5 15,3 8,3 8,1 6,1 6,7 8,7 \t\t"/><rect x="5" y="9" width="4" height="4"/><rect x="10" y="9" width="4" height="4"/><rect x="15" y="9" width="4" height="4"/><rect x="5" y="14" width="4" height="4"/><rect x="10" y="14" width="4" height="4"/></g>';break;case"forums":case"info":out.html+='<path d="M12,2C6.486,2,2,6.487,2,12c0,5.515,4.486,10,10,10s10-4.485,10-10C22,6.487,17.514,2,12,2z M12,6.751 c0.69,0,1.25,0.56,1.25,1.25c0,0.691-0.56,1.25-1.25,1.25S10.75,8.691,10.75,8C10.75,7.31,11.31,6.751,12,6.751z M15,17H9v-2h2v-3 h-1v-2h2c0.553,0,1,0.448,1,1v4h2V17z"/>';break;case"other":out.html+='<g><circle cx="5" cy="12" r="2"/><circle cx="12" cy="12" r="2"/><circle cx="19" cy="12" r="2"/></g>';break;case"search":out.html+='<path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>';break;case"usersettings":out.html+='<g><path d="M8.002,8.006c-2.205,0-4,1.795-4,4c0,2.205,1.795,4,4,4c2.205,0,4-1.795,4-4 C12.002,9.801,10.208,8.006,8.002,8.006z"/><path d="M8.002,17.006c-4.711,0-8,2.467-8,6v1h16v-1C16.002,19.473,12.713,17.006,8.002,17.006z"/><path d="M24.004,7.006v-2h-1.102c-0.13-0.638-0.385-1.229-0.732-1.754l0.783-0.784L21.54,1.054l-0.784,0.784 c-0.524-0.347-1.114-0.602-1.751-0.731V0.006h-2v1.101c-0.638,0.129-1.229,0.384-1.754,0.732l-0.783-0.783L13.053,2.47 l0.783,0.783c-0.348,0.524-0.601,1.116-0.731,1.753h-1.103v2h1.103c0.13,0.638,0.384,1.228,0.732,1.754l-0.784,0.784l1.416,1.413 l0.782-0.784c0.524,0.348,1.116,0.602,1.753,0.732v1.101h2v-1.102c0.638-0.13,1.229-0.385,1.754-0.732l0.783,0.783l1.414-1.415 l-0.784-0.782c0.347-0.524,0.601-1.115,0.731-1.752H24.004z M18.002,8.006c-1.105,0-2-0.897-2-2c0-1.104,0.895-2,2-2 c1.104,0,2,0.896,2,2C20.002,7.109,19.106,8.006,18.002,8.006z"/></g>';break;case"companyprofile":out.html+='<g><path d="M22.447,8.724l-4-2c-0.31-0.155-0.678-0.139-0.973,0.044C17.18,6.95,17,7.272,17,7.619V11.2l3,1.8v10h2 c0.552,0,1-0.447,1-1V9.619C23,9.239,22.786,8.893,22.447,8.724z"/><path d="M6.585,5.576C6.324,5.388,5.989,5.338,5.684,5.438l-4,1.334C1.275,6.908,1,7.291,1,7.721V22 c0,0.553,0.448,1,1,1h4c0.552,0,1-0.447,1-1V6.387C7,6.066,6.846,5.764,6.585,5.576z M5,20H3v-2h2V20z M5,16H3v-2h2V16z M5,12H3 v-2h2V12z"/><path d="M17.447,13.724c-0.403-0.202-2.046-1.101-2.447-1.101V2.721c0-0.43-0.275-0.812-0.684-0.948l-4-1.334 c-0.305-0.101-0.64-0.05-0.901,0.138C9.154,0.764,9,1.066,9,1.387V3h4v2H9v2h4v2H9v2h4v2H9v9c0,0.553,0.448,1,1,1h2v-1.5 c0-0.828,0.672-1.5,1.5-1.5s1.5,0.672,1.5,1.5V23h3v-8.381C18,14.239,17.786,13.893,17.447,13.724z M16,17h-5v-2h5V17z"/></g>';break;case"halt":out.html+='<path d="M23 5.5V20c0 2.2-1.8 4-4 4h-7.3c-1.08 0-2.1-.43-2.85-1.19L1 14.83s1.26-1.23 1.3-1.25c.22-.19.49-.29.79-.29.22 0 .42.06.6.16.04.01 4.31 2.46 4.31 2.46V4c0-.83.67-1.5 1.5-1.5S11 3.17 11 4v7h1V1.5c0-.83.67-1.5 1.5-1.5S15 .67 15 1.5V11h1V2.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5V11h1V5.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5z"/>';break;case"ownership":out.html+='<path d="M20,8h-3.101C16.435,5.721,14.415,4,12,4S7.565,5.721,7.101,8H4c-1.105,0-2,0.896-2,2v10 c0,1.104,0.895,2,2,2h16c1.104,0,2-0.896,2-2V10C22,8.896,21.104,8,20,8z M12,6c1.304,0,2.416,0.836,2.829,2H9.171 C9.584,6.836,10.696,6,12,6z M8,20H6V10h2V20z M18,20h-2V10h2V20z"/>';break;case"send":out.html+='<path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>';break;case"view":out.html+='<path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>';break;case"pay":out.html+='<path d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z"/>';break;case"settings":out.html+='<path d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.09.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"/>';break;case"createdocument":out.html+='<g><path d="M18,14.349V4.586L13.414,0H2C0.897,0,0,0.898,0,2v18c0,1.103,0.897,2,2,2h12.349 C14.127,21.374,14,20.703,14,20C14,17.389,15.671,15.173,18,14.349z M9,15H3v-2h6V15z M12,11H3V9h9V11z M12,6V1l5,5H12z"/><polygon points="21,19 21,16 19,16 19,19 16,19 16,21 19,21 19,24 21,24 21,21 24,21 24,19 \t\t"/></g>';break;case"industry":out.html+='<path d="M21.707,13.293l-11-11C10.519,2.105,10.266,2,10,2H3C2.447,2,2,2.447,2,3v7 c0,0.266,0.105,0.519,0.293,0.707l11,11C13.488,21.902,13.744,22,14,22s0.512-0.098,0.707-0.293l7-7 C22.098,14.316,22.098,13.684,21.707,13.293z M7,9C5.894,9,5,8.104,5,7c0-1.106,0.894-2,2-2c1.104,0,2,0.894,2,2 C9,8.104,8.104,9,7,9z"/>';break;case"pin":case"preferred":out.html+='<g><polygon points="22,12 12.101,2.101 10.686,3.514 12.101,4.929 12.101,4.929 7.151,9.878 7.151,9.88 5.736,8.465 4.322,9.88 8.565,14.122 2.908,19.778 4.322,21.192 9.979,15.536 14.222,19.778 15.636,18.364 14.222,16.95 14.222,16.95 19.171,12 19.172,12 20.586,13.414 \t"/></g>';break;case"share":out.html+='<path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"/>';break;case"written-request":out.html+='<g><path d="M11.607,18c-1.654,0-3,1.346-3,3s1.346,3,3,3s3-1.346,3-3S13.262,18,11.607,18z M11.607,22 c-0.551,0-1-0.448-1-1c0-0.551,0.449-1,1-1s1,0.449,1,1C12.607,21.552,12.158,22,11.607,22z"/><path d="M11,5.029C6.955,5.18,3.17,6.809,0.293,9.688l1.414,1.414c2.5-2.5,5.782-3.923,9.293-4.072V5.029z"/><path d="M23.707,3.294l-3-3c-0.391-0.392-1.023-0.392-1.414,0l-7,7c-0.129,0.128-0.219,0.288-0.264,0.464 l-1,4c-0.084,0.341,0.016,0.701,0.264,0.949C11.482,12.898,11.738,13,12,13c0.08,0,0.162-0.009,0.242-0.029l4-1 c0.176-0.044,0.337-0.135,0.465-0.264l7-7C24.098,4.316,24.098,3.684,23.707,3.294z M15.488,10.098l-2.113,0.528l0.527-2.114 L17,5.414L18.586,7L15.488,10.098z M20,5.586L18.414,4L20,2.414L21.586,4L20,5.586z"/><path d="M10,9.127c-2.517,0.338-4.947,1.458-6.878,3.387l1.414,1.414c1.54-1.539,3.462-2.461,5.464-2.783 V9.127z"/><path d="M10,13.162c-1.523,0.311-2.925,1.057-4.049,2.182l1.414,1.414c0.743-0.743,1.648-1.263,2.635-1.535 V13.162z"/></g>';break;case"associated":out.html+='<g><path d="M16.414,1H9C7.897,1,7,1.898,7,3v14c0,1.103,0.897,2,2,2h10c1.103,0,2-0.897,2-2V5.586L16.414,1z M19.001,17H9V3h6v4h4L19.001,17z"/><path d="M5,5H3v16c0,1.103,0.897,2,2,2h12v-2H5V5z"/></g>';break;case"delete":out.html+='<path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zm2.46-7.12l1.41-1.41L12 12.59l2.12-2.12 1.41 1.41L13.41 14l2.12 2.12-1.41 1.41L12 15.41l-2.12 2.12-1.41-1.41L10.59 14l-2.13-2.12zM15.5 4l-1-1h-5l-1 1H5v2h14V4z"/>';break;case"share":case"share":case"share":out.html+='<path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"/>'}return out.html+="</svg>",out.write()}),edbml.declare("ts.ui.svgname.edbml").as(function $edbml(text,col1,col2,size,stylesheet_url,stylesheet_txt){"use strict";var out=$edbml.$out,$txt=edbml.safetext,$val=edbml.safeattr;text=text||"?",col1=col1||"pink",col2=col2||"lime";var fontsize=size/2.6;return out.html+='<svg xmlns="http://www.w3.org/2000/svg" width="'+$val(size)+'px" height="'+$val(size)+'px" viewBox="0 0 '+$val(size)+" "+$val(size)+'" style="background-color:'+$val(col1)+';" text-rendering="optimizeLegibility">',stylesheet_url&&(out.html+="<defs>",function(imports){out.html+='<style type="text/css">',out.html+=imports?'@import "'+stylesheet_url+'";':stylesheet_txt,out.html+="</style>"}(!gui.Client.agent),out.html+="</defs>"),out.html+='<text x="50%" y="'+$val(function(Client){switch(Client.agent){case"gecko":return"65%";case"explorer":return"66%";case"webkit":return"54%";default:return"50%"}}(gui.Client))+'" text-anchor="middle" alignment-baseline="middle" font-size="'+$val(fontsize)+'" font-family="'+$val(stylesheet_url?"Open Sans":"Arial")+'" font-weight="300" fill="'+$val(col2)+'">'+$txt(text)+"</text></svg>",out.write()}),edbml.declare("ts.ui.switch.edbml").as(function $edbml(model){"use strict";var out=$edbml.$out,$att=$edbml.$att,$set=edbml.$set,$val=edbml.safeattr;$att.id="switch"+model.$instanceid,$att.name=model.name||null,$att.value=model.value||null,out.html+='<fieldset class="ts-form"><label><span></span>';var $1=$set(function(value,checked){model.checked=checked},this);return out.html+='<input type="checkbox" '+$att.$("id")+" "+$att.$("name")+" "+$att.$("value")+' checked="'+$val(model.checked)+'" onchange="edbml.$run(this, \''+$1+"');\"/></label></fieldset>",out.write()}),edbml.declare("ts.ui.switchonly.edbml").as(function $edbml(){"use strict";var out=$edbml.$out,$val=edbml.safeattr;return out.html+='<div data-ts="Spirit" class="ts-switcher '+$val(ts.ui.CLASS_ENGINE)+'"><i class="ts-icon-cancel"></i><i class="ts-icon-checked"></i></div>',out.write()}),edbml.declare("ts.ui.tablecheck.edbml").as(function $edbml(table,row,fixed){"use strict";var out=$edbml.$out,$att=$edbml.$att,$val=edbml.safeattr;return $att.class="ts-table-addition ts-table-checkbox ",$att.class+=row.selected?"ts-checked":"",out.html+="<td "+$att.$("class")+">",$att.id=table.$instanceid+(fixed?"-fixed-":"-floating-")+row.$index,$att.class=row.selected?"ts-icon-checkboxon":"ts-icon-checkbox",out.html+='<div class="ts-table-cell"><button class="ts-table-checkbox-button" '+$att.$("id")+' data-index="'+$val(row.$index)+'" tabindex="-1"><i '+$att.$("class")+"></i></button></div></td>",out.write()}),edbml.declare("ts.ui.tablecols.edbml").as(function $edbml(table,cols){"use strict";function renderOptions(col){col.search&&!col.search.hidden?out.html+=col.search.render():col.button&&!col.button.hidden&&(out.html+=col.button.render())}function renderHeader(col){$att.class=col.ascending?"ts-icon-triangledown":"ts-icon-triangleup",out.html+='<button class="ts-button-sort" id="label-'+$val(col.$instanceid)+'" data-index="'+$val(col.$index)+'"><span>'+$txt(col.label)+"</span><i "+$att.$("class")+"></i></button>"}function getCellClass(col){return col.type+(col.selected?" ts-selected":"")}var out=$edbml.$out,$att=$edbml.$att,$txt=edbml.safetext,$val=edbml.safeattr;return cols.length&&(out.html+="<tr>",table.numbered&&(out.html+='<td class="ts-table-addition ts-table-numbered"><div>#</div></td>'),table.selectable&&(out.html+='<td class="ts-table-addition ts-table-checkbox"></td>'),cols.forEach(function(col){$att.class=getCellClass(col),out.html+="<th "+$att.$("class")+'><fieldset id="fieldset-'+$val(col.$instanceid)+'">',renderOptions(col),renderHeader(col),out.html+="</fieldset></th>"}),out.html+="</tr>"),out.write()}),edbml.declare("ts.ui.tablegutter.edbml").as(function $edbml(table,rows){"use strict";var out=$edbml.$out,$att=$edbml.$att,renderCheck=ts.ui.tablecheck.edbml.lock(out),renderHilt=ts.ui.tablehilt.edbml.lock(out);return rows.forEach(function(row){var selectable=!1!==row.selectable;$att.class=table.selectable&&selectable&&row.selected?"ts-table-row-selected":"",out.html+="<tr "+$att.$("class")+">",selectable?renderCheck(table,row):renderHilt(table,row),out.html+="</tr>"}),out.write()}),edbml.declare("ts.ui.tablehilt.edbml").as(function $edbml(table,row,icon){"use strict";var out=$edbml.$out,$att=$edbml.$att,$val=edbml.safeattr;return out.html+='<td class="ts-table-addition ts-table-hilt">',$att.id=table.$instanceid+icon+row.$index,$att.class=icon?"icon":"",out.html+='<div class="ts-table-cell"><button '+$att.$("id")+' data-index="'+$val(row.$index)+'" tabindex="-1">',icon&&(out.html+="<i "+$att.$("class")+"></i>"),out.html+="</button></div></td>",out.write()}),edbml.declare("ts.ui.tablemenu.edbml").as(function $edbml(table){"use strict";var out=$edbml.$out,$att=$edbml.$att,$val=edbml.safeattr,id=table.$instanceid;$att.class="ts-table-menu ts-engine-"+gui.Client.agent,$att.class+=table.menuopen?" ts-open ts-bg-white":"",out.html+="<aside "+$att.$("class")+' id="'+$val(id)+'-menu" data-ts="Spirit"><table><thead><tr>';var check=table.isVisibleRowSelected();return $att.class="ts-table-checkbox ",$att.class+=check?"ts-checked":"",out.html+="<th "+$att.$("class")+'><button data-action="selection-menu" id="'+$val(id)+'-menu-button">',$att.class=check?"ts-icon-checkboxon":"ts-icon-checkbox",out.html+="<i "+$att.$("class")+"></i></button></th>",table.menuopen&&(out.html+='<th class="ts-table-choices"><button data-action="select-page" class="ts-button ts-tertiary"><span>This Page</span></button><button data-action="select-all" class="ts-button ts-tertiary"><span>All Pages</span></button></th><th class="ts-table-choices-close"><button data-action="selection-menu-close" class="ts-button ts-tertiary"><i class="ts-icon-close"></i></button></th></tr>'),out.html+="</thead></table></aside></scipt>",out.write()}),edbml.declare("ts.ui.tablerows.edbml").as(function $edbml(table,rows,cols){"use strict";function renderNumber(row){out.html+='<td class="ts-table-addition ts-table-numbered" data-index="'+$val(row.$index)+'"><div class="ts-table-cell">'+Markdown.parse(row.$index+1)+"</div></td>"}function renderCell(col,row,cell){var editable=iseditable(col,row,cell);$att.class=getCellClass(col,row,cell,editable),$att.id=table.$cellid(row.$index,cell.$index),out.html+="<td "+$att.$("id")+" "+$att.$("class")+" "+$att.$("note")+' data-index="'+$val(cell.$index)+'"><div class="ts-table-cell">',table.editable&&(out.html+='<div class="ts-table-line" tabindex="0"></div>'),editable&&renderEditor(cell.value),ts.ui.Model.is(cell)?out.html+=cell.render():out.html+=Markdown.parse(cell.text,whitelist),out.html+="</div></td>"}function renderEditor(value){out.html+='<textarea rows="1" data-ts="TextArea" class="ts-table-input" type="submit">'+edbml.safetext(value)+"</textarea>"}function getCellClass(col,row,cell,editable){var css=[row.type];return cell.item?(css.push("ts-has-extra"),css.push("ts-has-"+cell.item.toLowerCase()),col&&css.push(col.type)):(css.push(cell.type),css.push(editable?"ts-editable":""),css.push(cell.valid?"":"ts-table-invalid"),col&&(css=css.concat([col.type,col.wrap?"ts-wrap":""]))),col&&css.push(col.selected?"ts-selected":""),css.join(" ").trim()}function iseditable(col,row,cell){return!!table.editable&&(!!cell.editable||(!col||!1!==col.editable)&&!1!==row.editable)}var out=$edbml.$out,$att=$edbml.$att,$val=edbml.safeattr,renderCheck=ts.ui.tablecheck.edbml.lock(out),renderHilt=ts.ui.tablehilt.edbml.lock(out),colcount=cols.length,Markdown=ts.ui.Markdown,whitelist=["strong","em","strike","code","ul"];return table.linkable&&whitelist.push("a"),!cols.length&&table.cols.length||rows.forEach(function(row){var selectable=!1!==row.selectable;$att.class=row.TEMPFIX?"TEMPFIX":"",$att.class+=table.selectable&&selectable&&row.selected?"ts-table-row-selected":"",$att.class+=table.selectable&&!selectable?"ts-table-row-unselectable":"",$att.class+=row.new?"ts-table-new-row":"",out.html+='<tr data-index="'+$val(row.$index)+'" '+$att.$("class")+">",table.numbered&&renderNumber(row),table.selectable&&(selectable?renderCheck(table,row,!0):renderHilt(table,row));row.cells.forEach(function(cell,i){if(!colcount||i<colcount){var col=cols[cell.$index];col&&!col.visible||renderCell(col,row,cell)}}),out.html+="</tr>"}),out.write()}),edbml.declare("ts.ui.toolbar.edbml").as(function $edbml(toolbar){"use strict";var out=$edbml.$out,$1=(0,edbml.$set)(function(){return toolbar},this);return out.html+='<header data-ts="ToolBar" data-ts.model="edbml.$get(&quot;'+$1+'&quot;);"></header>',out.write()}),edbml.declare("ts.ui.toolbartabs.edbml").as(function $edbml(spirit,tabs,id,mobilos){"use strict";function rendertab(tab){$att.href=tab.href||null,$att.class="ts-tab",$att.class+=tab.selected?" ts-selected":"",$att.class+=tab.counter>0?" ts-counter":"",$att.class+=tab.selected&&tab.closeable?" ts-tab-close":"",out.html+='<li data-ts="Spirit" '+$att.$("class")+' id="'+$val(tab.$instanceid)+'">';var $1=$set(function(){tab.select()},this);if(out.html+='<a data-ts="Button" '+$att.$("href")+" onclick=\"edbml.$run(this, '"+$1+'\');" tabindex="-1">',tab.icon&&(out.html+='<i class="ts-tab-icon '+$val(tab.icon)+'"></i>'),out.html+='<span class="ts-tab-label">'+$txt(tab.label)+"</span>",tab.selected&&tab.closeable){var $2=$set(function(){close(tab)},this);out.html+='<span class="ts-close-bg" onclick="edbml.$run(this, \''+$2+'\');"><i class="ts-icon-close"></i></span>'}tab.counter>0&&(out.html+="<em>"+$txt(tab.counter)+"</em>"),out.html+="</a></li>"}function close(tab){var abort=!1;if(tab.selected&&(tab.onclose&&(abort=!1===tab.onclose()),!abort)){var index=tabs.indexOf(tab);gui.Array.remove(tabs,index)}}function rendermore(){$att.id=id+"-tabs-more",$att.class="ts-tab ts-tab-button ts-tab-more",$att.title=ts.ui.TopBar.localize("more"),out.html+='<li data-ts="Spirit" '+$att.$("class")+" "+$att.$("id")+">";var $3=$set(function(){showmore()},this);out.html+='<a data-ts="Button" '+$att.$("title")+" onclick=\"edbml.$run(this, '"+$3+'\');" tabindex="-1"><i class="ts-icon-other"></i><span class="ts-tab-label">\xa0</span></a></li>'}function rendernew(newtabbutton){$att.id=newtabbutton.$instanceid,$att.class="ts-tab ts-tab-button ts-add-tab",out.html+='<li data-ts="Spirit" '+$att.$("class")+" "+$att.$("id")+">";var $4=$set(function(){newtabbutton.click()},this);out.html+='<a data-ts="Button" tabindex="-1" onclick="edbml.$run(this, \''+$4+'\');"><i class="ts-icon-add"></i><span class="ts-tab-label">\xa0</span></a></li>'}function showmore(){spirit.puttabs(tabs.slice().reverse())}var out=$edbml.$out,$att=$edbml.$att,$set=edbml.$set,$txt=edbml.safetext,$val=edbml.safeattr;return function(topbar){$att.ts=topbar?"ts.ui.TopBarTabsSpirit":null,$att.class="ts-toolbar-tabs"+(topbar?" ts-topbar-tabs":""),out.html+="<ul "+$att.$("ts")+" "+$att.$("class")+' id="'+$val(id)+'-tabs">',tabs.forEach(rendertab),tabs.newtabbutton&&rendernew(tabs.newtabbutton),topbar&&mobilos||rendermore(),out.html+="</ul>"}(ts.ui.TopBarSpirit.is(spirit)),out.write()}),edbml.declare("ts.ui.usercard.edbml").as(function $edbml(user,contentonly,classconfig){"use strict";function renderBasic(){isType("ts-compact ts-reverse")?(renderName(),renderImage()):(renderImage(),renderName())}function renderImage(){out.html+='<p class="ts-usercard-image">',$att.src=image||null,$att.alt=name||null,$att.width=$att.height=isType("ts-details")?110:44,out.html+='<img data-ts="UserImage" '+$att.$("src")+" "+$att.$("alt")+" "+$att.$("width")+" "+$att.$("height")+"/></p>"}function renderName(){out.html+='<p class="ts-usercard-name"><span>'+$txt(show||"")+"</span></p>"}function renderDetails(){out.html+='<ul class="ts-usercard-details">',title&&(out.html+='<li class="ts-usercard-title">'+$txt(title)+"</li>"),role&&(out.html+='<li class="ts-usercard-role">'+$txt(role)+"</li>"),company&&(out.html+='<li class="ts-usercard-company">',out.html+=companyUrl?'<a href="'+$val(companyUrl)+"\" target='_blank'>"+$txt(company)+"</a>":"<span>"+$txt(company)+"</span>",out.html+="</li>"),email&&(out.html+='<li class="ts-usercard-email"><a href="mailto:'+$val(email)+'">'+$txt(email)+"</a></li>"),out.html+="</ul>"}function isType(string){return string.split(" ").every(function(single){return classconfig.includes(single)})}var out=$edbml.$out,$att=$edbml.$att,$set=edbml.$set,$txt=edbml.safetext,$val=edbml.safeattr,data=user.data||{},name=data.name,title=data.title,companyUrl=data.companyUrl,company=data.company,role=data.role,show=name,image=data.image,email=data.email;return isType("ts-current-user")&&(show=ts.ui.UserCard.localize("currentUserDisplayName")),contentonly?(out.html+='<div class="ts-usercard-main">',renderBasic(),isType("ts-details")&&renderDetails(),out.html+="</div>"):function(){$att.class=user.type||null;var $1=$set(function(){return user},this);out.html+='<div data-ts="UserCard" data-ts._model="edbml.$get(&quot;'+$1+'&quot;);" '+$att.$("class")+"></div>"}(),out.write()}),edbml.declare("ts.ui.userimage.edbml").as(function $edbml(image){"use strict";var out=$edbml.$out,$att=$edbml.$att;return $att.src=image.src||null,$att.alt=image.name||null,$att.width=image.size||null,$att.height=image.size||null,out.html+='<img data-ts="UserImage" '+$att.$("src")+" "+$att.$("alt")+" "+$att.$("width")+" "+$att.$("height")+"/>",out.write()}),edbml.declare("ts.ui.AsideSpirit.edbml").as(function $edbml(){"use strict";var out=$edbml.$out,$val=edbml.safeattr,aside=$edbml.$input(ts.ui.AsideModel);return out.html+='<header data-ts="ToolBar" id="'+$val(this.$instanceid)+'-header" class="ts-header" data-ts.title="'+$val(aside.title)+'"></header><div data-ts="Panel" id="'+$val(this.$instanceid)+'-panel">'+aside.items.render()+"</div>",out.write()}).withInstructions([{input:{name:"aside",type:"ts.ui.AsideModel"}}]),edbml.declare("ts.ui.AutocompleteDropdownSpirit.edbml").as(function $edbml(){"use strict";function printLabel(item,filter$2){var label=item.value,labelIndex=label.toLowerCase().indexOf(filter$2.toLowerCase()),output="";return output+=label.substr(0,labelIndex),out.html+="<b>",output+=label.substr(labelIndex,filter$2.length),out.html+="</b>",output+=label.substr(labelIndex+filter$2.length)}var out=$edbml.$out,$set=edbml.$set,$val=edbml.safeattr,autocomplete=$edbml.$input(ts.ui.AutocompleteDropdownModel),spirit=this,guid=autocomplete.$instanceid,filter=autocomplete.filter,count=autocomplete.filteredAutocompleteList.length,hiddenClass=spirit._isActive?"":"ts-hidden";return count&&(out.html+='<menu id="'+$val(guid)+'-list" class="ts-autocomplete-list '+$val(hiddenClass)+'">',count>1&&(out.html+='<li class="ts-autocomplete-results">'+spirit._locale.matchString(count)+"</li>"),(autocomplete.filteredAutocompleteList||[]).forEach(function(item){var json=JSON.stringify(item),$1=$set(function(){spirit._onselect(item)},this);out.html+="<li onclick=\"edbml.$run(this, '"+$1+'\');" data-item="'+$val(json)+'">'+printLabel(item,filter)+"</li>"}),out.html+="</menu>"),out.write()}).withInstructions([{input:{name:"autocomplete",type:"ts.ui.AutocompleteDropdownModel"}}]),edbml.declare("ts.ui.CalendarSpirit.edbml").as(function $edbml(labels,month,year,view,prevYear,nextYear,prevMonth,nextMonth,minDay,maxDay){"use strict";function renderbuttons(prev,label,next){renderbutton(prev,"ts-icon-triangleleft"),out.html+="<th><label>"+$txt(label)+"</label></th>",renderbutton(next,"ts-icon-triangleright")}function renderbutton(name,icon){$att.class=name?null:"ts-calendar-nogo",$att.name=name||null,out.html+="<th "+$att.$("class")+"><button "+$att.$("name")+'><i class="'+$val(icon)+'"></i></button></th>'}function rendercell(cell){var other=cell.prev||cell.next,allow=allowcell(cell,other);$att.name=allow?"accept":"reject",$att.value=allow?cell.stringify():null,$att.class=classname({"ts-calendar-other":other,"ts-calendar-today":cell.today,"ts-selected":cell.selected,"ts-calendar-nogo":!allow}),out.html+="<td "+$att.$("class")+"><button "+$att.$("name")+" "+$att.$("value")+"><span>"+$txt(cell.day)+"</span></button></td>"}function classname(classes){return Object.keys(classes).filter(function(c){return classes[c]}).join(" ")||null}function allowcell(cell,other){var all=Number.MAX_VALUE;return minDay!==all&&maxDay!==1-all&&!lower(cell.day,minDay,!other,!prevMonth,cell.prev)&&!upper(cell.day,maxDay,!other,!nextMonth,cell.next)}function lower(day,min,main,stops,before){return min&&main&&day<min||stops&&before}function upper(day,max,main,stops,after){return max&&main&&day>max||stops&&after}var out=$edbml.$out,$att=$edbml.$att,$txt=edbml.safetext,$val=edbml.safeattr;return out.html+='<table><thead><tr class="ts-calendar-transports">',renderbuttons(prevMonth,month,nextMonth),out.html+="<th/>",renderbuttons(prevYear,year,nextYear),out.html+='</tr><tr class="ts-calendar-labels">',labels.forEach(function(label){out.html+="<th>"+$txt(label)+"</th>"}),out.html+='</tr></thead><tbody class="ts-calendar-days">',view.forEach(function(row){out.html+="<tr>",row.forEach(rendercell),out.html+="</tr>"}),out.html+="</tbody></table>",out.write()}),edbml.declare("ts.ui.DialogSpirit.edbml").as(function $edbml(){"use strict";var out=$edbml.$out,$val=edbml.safeattr,dialog=$edbml.$input(ts.ui.DialogModel),buttons=(ts.ui.isMobilePoint(),dialog.buttons);return dialog.icon&&function(icon){out.html+='<div class="ts-dialog-head"><i class="ts-dialog-icon '+$val(icon)+'"></i></div>'}(dialog.icon),dialog.items.getLength()&&function(items){out.html+='<div class="ts-dialog-body">'+items.map(function(item){switch(item.item){case"text":var markdowntags=dialog.tags;return item.render(markdowntags);default:return item.render()}}),out.html+="</div>"}(dialog.items),buttons.getLength()&&function(buttons$2){out.html+='<div class="ts-dialog-buttons"><menu data-ts="Buttons"><menu data-ts="Buttons">',buttons$2.forEach(function(button){out.html+="<li>"+button.render()+"</li>"}),out.html+="</menu></menu></div>"}(buttons),out.write()}).withInstructions([{input:{name:"dialog",type:"ts.ui.DialogModel"}}]),edbml.declare("ts.ui.FooterBarSpirit.edbml").as(function $edbml(){"use strict";var out=$edbml.$out,$set=edbml.$set,$val=edbml.safeattr,footer=$edbml.$input(ts.ui.FooterBarModel),id=this.$instanceid+footer.$instanceid;return out.html+='<ul class="ts-footerbar-bars">',function(model){var $1=$set(function(){return model},this);out.html+='<li data-ts="ToolBar" class="ts-footerbar-bufferbar" id="'+$val(id)+'-bufferbar" data-ts.model="edbml.$get(&quot;'+$1+'&quot;);"></li>'}(footer.bufferbar),function(model){var $2=$set(function(){return model},this);out.html+='<li data-ts="ToolBar" class="ts-footerbar-actionbar ts-micro" id="'+$val(id)+'-actionbar" data-ts.model="edbml.$get(&quot;'+$2+'&quot;);" data-ts.visible="'+$val(footer.$showActionBar(model))+'"></li>'}(footer.actionbar),function(model){var $3=$set(function(){return model},this);out.html+='<li data-ts="StatusBar" class="ts-footerbar-centerbar" id="'+$val(id)+'-centerbar" data-ts.model="edbml.$get(&quot;'+$3+'&quot;);" data-ts.visible="'+$val(footer.$showCenterBar(model))+'"></li>'}(footer.centerbar),function(model){var $4=$set(function(){return model},this);out.html+='<li data-ts="ToolBar" class="ts-footerbar-backupbar" id="'+$val(id)+'-backupbar" data-ts.model="edbml.$get(&quot;'+$4+'&quot;);" data-ts.visible="'+$val(footer.$showBackupBar(model))+'"></li>'}(footer.backupbar),out.html+="</ul>",out.write()}).withInstructions([{input:{name:"footer",type:"ts.ui.FooterBarModel"}}]),edbml.declare("ts.ui.FormSpirit.edbml").as(function $edbml(){"use strict";var out=$edbml.$out,form=$edbml.$input(ts.ui.FormModel);return out.html+=form.items.render()+form.buttons.render(),out.write()}).withInstructions([{input:{name:"form",type:"ts.ui.FormModel"}}]),edbml.declare("ts.ui.NoteSpirit.edbml").as(function $edbml(){"use strict";var out=$edbml.$out,$set=edbml.$set,$val=edbml.safeattr,note=$edbml.$input(ts.ui.NoteModel);if(note.buttons&&note.buttons.length)out.html+='<div class="ts-note-buttons ts-micro">'+note.buttons.render(),out.html+="</div>";else if(note.onclose){var $1=$set(function(){this.close()},this);out.html+='<button class="ts-note-close" onclick="edbml.$run(this, \''+$1+'\');"><i class="ts-icon-close"></i></button>'}return note.icon&&(out.html+='<i class="'+$val(note.icon)+'"></i>'),note.text&&(out.html+=ts.ui.Markdown.parse(note.text)),out.write()}).withInstructions([{input:{name:"note",type:"ts.ui.NoteModel"}}]),edbml.declare("ts.ui.ObjectSpirit.edbml").as(function $edbml(object){"use strict";var out=$edbml.$out,classconfig=this.css.name();return object&&(out.html+=object.render(!0,classconfig)),out.write()}),edbml.declare("ts.ui.PagerSpirit.edbml").as(function $edbml(){"use strict";function renderJump(enabled,value,icon){out.html+="<li>",$att.disabled=enabled?null:"disabled",$att.class="ts-pager-jump ts-pager-"+value,$att.class+=" ts-engine-"+gui.Client.agent,out.html+="<button "+$att.$("class")+" "+$att.$("disabled")+' data-jump="'+$val(value)+'" id="'+$val(id)+"-"+$val(value)+'"><i>',renderIcon(icon),out.html+="</i></button></li>"}function renderStep(i,indicateless,indicatemore,index){out.html+="<li>",$att.class="ts-pager-step",$att.class+=model.page===i?" ts-selected":"",$att.class+=indicateless?" ts-less":"",$att.class+=indicatemore?" ts-more":"",out.html+="<button "+$att.$("class")+' data-page="'+$val(i)+'" id="'+$val(id)+"-"+$val(index)+'"><span>'+$txt(i+1)+"</span></button></li>"}var out=$edbml.$out,$att=$edbml.$att,$txt=edbml.safetext,$val=edbml.safeattr,renderIcon=ts.ui.svgicons.edbml.lock(out),model=$edbml.$input(ts.ui.PagerModel),id=this.$instanceid,most=model.max||model.defaultmax,init=model.init,last=init+most,size=model.pages,page=model.page,many=size>most,more=page<size-1,xxxx=0,less=page>0;return out.html+="<menu>",size&&function(i){for(many&&renderJump(less,"first","skip-previous"),renderJump(less,"prev","fast-rewind");i<last&&i<size;){var indicateless=init>0&&i===init;renderStep(i++,indicateless,i===last&&i<size,xxxx++)}renderJump(more,"next","fast-forward"),many&&renderJump(more,"last","skip-next")}(init),out.html+="</menu>",out.write()}).withInstructions([{input:{name:"model",type:"ts.ui.PagerModel"}}]),edbml.declare("ts.ui.SearchSpirit.edbml").as(function $edbml(){"use strict";var out=$edbml.$out,$att=$edbml.$att,$set=edbml.$set,$val=edbml.safeattr,search=$edbml.$input(ts.ui.SearchModel),id=search.$instanceid;$att.placeholder=gui.Client.isExplorer?null:search.info||null,$att.title=(search.focused||search.flex?null:search.info)||null,$att.class="ts-button-clear"+(search.value?"":" ts-hidden");var $1=$set(function(){return search},this);return out.html+='<input data-ts="Input" data-ts.model="edbml.$get(&quot;'+$1+'&quot;);" id="'+$val(id)+'-input" '+$att.$("title")+" "+$att.$("placeholder")+'/><button data-ts="Button" '+$att.$("class")+' tabindex="-1" id="'+$val(id)+'-clear"><i class="ts-icon-close"></i></button>',out.write()}).withInstructions([{input:{name:"search",type:"ts.ui.SearchModel"}}]),edbml.declare("ts.ui.TableGutterSpirit.edbml").as(function $edbml(){"use strict";var out=$edbml.$out,$att=$edbml.$att,renderGutter=ts.ui.tablegutter.edbml.lock(out),table=$edbml.$input(ts.ui.TableModel);return $att.style=null,out.html+="<table "+$att.$("style")+"><tbody>",renderGutter(table,table.visibleRows()),out.html+="</tbody></table>",out.write()}).withInstructions([{input:{name:"table",type:"ts.ui.TableModel"}}]),edbml.declare("ts.ui.TableSpirit.edbml").as(function $edbml(){"use strict";var out=$edbml.$out,$att=$edbml.$att,$val=edbml.safeattr,renderCols=ts.ui.tablecols.edbml.lock(out),renderRows=ts.ui.tablerows.edbml.lock(out),renderMenu=ts.ui.tablemenu.edbml.lock(out),renderGutter=ts.ui.tablegutter.edbml.lock(out),table=$edbml.$input(ts.ui.TableModel),guid=table.$instanceid,cols=table.visibleCols(),rows=table.visibleRows(),css1=table.selectable?"ts-selectable":"",css2=table.isWrapping()?"ts-wrapping":"",foot=(table.tempdirtyflag,table.toolbar);return this._onbeforerender(),out.html+='<header data-ts="Spirit" id="'+$val(guid)+'-cols" class="ts-table-cols '+$val(css1)+" "+$val(css2)+'"><table><thead>',renderCols(table,cols),out.html+='</thead></table></header><div id="'+$val(guid)+'-body" class="ts-table-body">',$att.style=this._scrollfixing?"left:-"+this._scroll.x+"px;":null,out.html+='<main data-ts="Spirit" id="'+$val(guid)+'-rows" class="ts-table-rows '+$val(css1)+" "+$val(css2)+'"><table '+$att.$("style")+"><tbody>",renderRows(table,rows,cols),out.html+="</tbody></table></main>",table.selectable&&(out.html+='<aside data-ts="Spirit" id="'+$val(guid)+'-gutter" class="ts-table-gutter"><table><tbody>',renderGutter(table,rows),out.html+="</tbody></table></aside>"),out.html+="</div>",table.selectable&&cols.length&&renderMenu(table),out.html+='<div id="'+$val(guid)+'-foot" class="ts-table-foot">'+foot.render()+"</div>",out.write()}).withInstructions([{input:{name:"table",type:"ts.ui.TableModel"}}]),edbml.declare("ts.ui.ToolBarSpirit.edbml").as(function $edbml(){"use strict";function showPager(pager){return!!(statusbar&&pager&&pager.pages&&pager.visible)}function hasicons(buttons){return buttons.every(function(button){return button.isPrimary()||!!button.icon})}function renderbuttons(specials,normals){1===normals.length?specials=normals.concat(specials):shouldrenderaside(normals)&&renderasidebutton(function(){spirit.putaside(normals)}),specials.forEach(renderbutton)}function shouldrenderaside(buttons){return buttons.length>1&&!buttons.every(function(button){return button.disabled})}function renderbutton(button){if(button&&button.visible){var id$2=spirit.$instanceid+button.$instanceid;$att.class=klass("ts-item",button),$att.class+=button.isAction?" ts-action":"",out.html+="<li "+$att.$("class")+' id="'+$val(id$2)+'-item">'+button.render(!1,mobilos)+"</li>"}}function renderasidebutton(action){$att.class="ts-toolbar-item ts-item",out.html+="<li "+$att.$("class")+' id="'+$val(id)+'-aside">';var $1=$set(function(){action()},this);out.html+='<button data-ts="Button" class="ts-tertiary" onclick="edbml.$run(this, \''+$1+'\');" tabindex="-1"><i class="ts-icon-other"></i></button></li>'}function rendercheckbox(box){$att.class=klass("ts-toolbar-checkbox",box),$att.title=box.info||null,out.html+="<li "+$att.$("class")+' id="'+$val(id)+'-checkbox">';var $2=$set(function(){box.onclick()},this);out.html+='<button data-ts="Button" onclick="edbml.$run(this, \''+$2+"');\" "+$att.$("title")+">",$att.class=box.checked?"ts-icon-checkboxon":"ts-icon-checkbox",out.html+="<i "+$att.$("class")+"></i></button></li>"}function renderlabels(title,status,search,hasactions){if(!search||!using(search))if(title)$att.class=klass("ts-toolbar-title",null,!hasactions),out.html+='<li id="'+$val(id)+'-title" '+$att.$("class")+"><label>"+$txt(title)+"</label></li>";else{$att.class=klass("ts-toolbar-status",null,!hasactions),out.html+='<li id="'+$val(id)+'-status" '+$att.$("class")+"><label>";var whitelist=["strong","em","strike","code"];toolbar.linkable&&whitelist.push("a"),out.html+=ts.ui.Markdown.parse(status,whitelist)+"</label></li>"}}function klass(cname,model,forceflex){var flex=model&&model.flex||forceflex;return["ts-toolbar-item",cname||"",flex?"ts-flex":""].join(" ")}function using(search){return search&&(search.focused||search.value||search.flex)}function renderNav(navbuttons){(navbuttons.getLength()||mobilos)&&menubutton(navbuttons).forEach(renderbutton)}function menubutton(navbuttons){return(mobilos?[toolbar.menubutton]:[]).concat(gui.Array.from(navbuttons))}var out=$edbml.$out,$att=$edbml.$att,$set=edbml.$set,$txt=edbml.safetext,$val=edbml.safeattr,renderTabs=ts.ui.toolbartabs.edbml.lock(out),toolbar=$edbml.$input(ts.ui.ToolBarModel),layout=$edbml.$input(ts.ui.LayoutModel),spirit=this,id=spirit.$instanceid+toolbar.$instanceid,mobilos=layout.isMobilePoint(),topbar=ts.ui.TopBarModel.is(toolbar),statusbar=ts.ui.StatusBarModel.is(toolbar),hasrealtitle=!!toolbar.title;return function(title,status,search,tabs,navigation,checkbox,actions){var hasnavi=!!(topbar&&navigation&&navigation.getLength()),hastabs=!!tabs.getLength(),hasactions=!!actions.length;(mobilos||status||search||checkbox||hasactions||hastabs||hasnavi||(topbar?hasrealtitle:title))&&(mobilos&&hastabs&&renderTabs(spirit,tabs,id,mobilos),out.html+='<menu id="'+$val(id)+'-items" class="ts-toolbar-menu ts-left">',topbar&&renderNav(navigation),mobilos||!hastabs||hasnavi?(search&&($att.class=klass("ts-toolbar-search",search),out.html+='<li id="'+$val(id)+'-search" '+$att.$("class")+">"+search.render()+"</li>"),checkbox&&checkbox.visible&&rendercheckbox(checkbox),(title||status)&&renderlabels(title,status,search,hasactions),actions.forEach(renderbutton)):renderTabs(spirit,tabs,id,mobilos),out.html+="</menu>")}(toolbar.title||(topbar?toolbar.defaultTitle:""),toolbar.status,toolbar.search,toolbar.tabs,toolbar.navigation,toolbar.checkbox,toolbar.$allactions()),function(id$2,pager){showPager(pager)&&(out.html+='<menu id="'+$val(id$2)+'-extras" class="ts-toolbar-menu ts-center">',$att.class=klass("ts-toolbar-pager",pager),out.html+='<li id="'+$val(id$2)+'-pager" '+$att.$("class")+">"+pager.render()+"</li></menu>")}(id,toolbar.pager),function(id$2,buttons){(buttons.length||toolbar.configbutton||toolbar.closebutton)&&(out.html+='<menu id="'+$val(id$2)+'-buttons" class="ts-toolbar-menu ts-right">',buttons.length&&(toolbar.compact?mobilos&&buttons.length>1&&!hasicons(buttons)?renderasidebutton(function(){spirit.putaside(toolbar.$allbuttons())}):renderbuttons(toolbar.$specialbuttons(),toolbar.$normalbuttons()):toolbar.$allbuttons().forEach(renderbutton)),[toolbar.configbutton,toolbar.closebutton].forEach(renderbutton),out.html+="</menu>")}(id,toolbar.$allbuttons()),function(on){$att.id=id+"-spinner",$att.class="ts-topbarspinner",on&&(out.html+='<div data-ts="Spinner" '+$att.$("id")+" "+$att.$("class")+' data-ts.spinning="true"></div>')}(topbar&&mobilos),out.write()}).withInstructions([{input:{name:"toolbar",type:"ts.ui.ToolBarModel"}},{input:{name:"layout",type:"ts.ui.LayoutModel"}}]);
//# sourceMappingURL=ts-9.1.2.min.js.map
